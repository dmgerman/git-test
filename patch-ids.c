macro_line|#include &quot;cache.h&quot;
macro_line|#include &quot;diff.h&quot;
macro_line|#include &quot;commit.h&quot;
macro_line|#include &quot;sha1-lookup.h&quot;
macro_line|#include &quot;patch-ids.h&quot;
DECL|function|commit_patch_id
r_static
r_int
id|commit_patch_id
c_func
(paren
r_struct
id|commit
op_star
id|commit
comma
r_struct
id|diff_options
op_star
id|options
comma
r_int
r_char
op_star
id|sha1
)paren
(brace
r_if
c_cond
(paren
id|commit-&gt;parents
)paren
id|diff_tree_sha1
c_func
(paren
id|get_object_hash
c_func
(paren
id|commit-&gt;parents-&gt;item-&gt;object
)paren
comma
id|get_object_hash
c_func
(paren
id|commit-&gt;object
)paren
comma
l_string|&quot;&quot;
comma
id|options
)paren
suffix:semicolon
r_else
id|diff_root_tree_sha1
c_func
(paren
id|get_object_hash
c_func
(paren
id|commit-&gt;object
)paren
comma
l_string|&quot;&quot;
comma
id|options
)paren
suffix:semicolon
id|diffcore_std
c_func
(paren
id|options
)paren
suffix:semicolon
r_return
id|diff_flush_patch_id
c_func
(paren
id|options
comma
id|sha1
)paren
suffix:semicolon
)brace
DECL|function|patch_id_access
r_static
r_const
r_int
r_char
op_star
id|patch_id_access
c_func
(paren
r_int
id|index
comma
r_void
op_star
id|table
)paren
(brace
r_struct
id|patch_id
op_star
op_star
id|id_table
op_assign
id|table
suffix:semicolon
r_return
id|id_table
(braket
id|index
)braket
op_member_access_from_pointer
id|patch_id
suffix:semicolon
)brace
DECL|function|patch_pos
r_static
r_int
id|patch_pos
c_func
(paren
r_struct
id|patch_id
op_star
op_star
id|table
comma
r_int
id|nr
comma
r_const
r_int
r_char
op_star
id|id
)paren
(brace
r_return
id|sha1_pos
c_func
(paren
id|id
comma
id|table
comma
id|nr
comma
id|patch_id_access
)paren
suffix:semicolon
)brace
DECL|macro|BUCKET_SIZE
mdefine_line|#define BUCKET_SIZE 190 /* 190 * 21 = 3990, with slop close enough to 4K */
DECL|struct|patch_id_bucket
r_struct
id|patch_id_bucket
(brace
DECL|member|next
r_struct
id|patch_id_bucket
op_star
id|next
suffix:semicolon
DECL|member|nr
r_int
id|nr
suffix:semicolon
DECL|member|bucket
r_struct
id|patch_id
id|bucket
(braket
id|BUCKET_SIZE
)braket
suffix:semicolon
)brace
suffix:semicolon
DECL|function|init_patch_ids
r_int
id|init_patch_ids
c_func
(paren
r_struct
id|patch_ids
op_star
id|ids
)paren
(brace
id|memset
c_func
(paren
id|ids
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|ids
)paren
)paren
suffix:semicolon
id|diff_setup
c_func
(paren
op_amp
id|ids-&gt;diffopts
)paren
suffix:semicolon
id|DIFF_OPT_SET
c_func
(paren
op_amp
id|ids-&gt;diffopts
comma
id|RECURSIVE
)paren
suffix:semicolon
id|diff_setup_done
c_func
(paren
op_amp
id|ids-&gt;diffopts
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|free_patch_ids
r_int
id|free_patch_ids
c_func
(paren
r_struct
id|patch_ids
op_star
id|ids
)paren
(brace
r_struct
id|patch_id_bucket
op_star
id|next
comma
op_star
id|patches
suffix:semicolon
id|free
c_func
(paren
id|ids-&gt;table
)paren
suffix:semicolon
r_for
c_loop
(paren
id|patches
op_assign
id|ids-&gt;patches
suffix:semicolon
id|patches
suffix:semicolon
id|patches
op_assign
id|next
)paren
(brace
id|next
op_assign
id|patches-&gt;next
suffix:semicolon
id|free
c_func
(paren
id|patches
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|add_commit
r_static
r_struct
id|patch_id
op_star
id|add_commit
c_func
(paren
r_struct
id|commit
op_star
id|commit
comma
r_struct
id|patch_ids
op_star
id|ids
comma
r_int
id|no_add
)paren
(brace
r_struct
id|patch_id_bucket
op_star
id|bucket
suffix:semicolon
r_struct
id|patch_id
op_star
id|ent
suffix:semicolon
r_int
r_char
id|sha1
(braket
l_int|20
)braket
suffix:semicolon
r_int
id|pos
suffix:semicolon
r_if
c_cond
(paren
id|commit_patch_id
c_func
(paren
id|commit
comma
op_amp
id|ids-&gt;diffopts
comma
id|sha1
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
id|pos
op_assign
id|patch_pos
c_func
(paren
id|ids-&gt;table
comma
id|ids-&gt;nr
comma
id|sha1
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|0
op_le
id|pos
)paren
r_return
id|ids-&gt;table
(braket
id|pos
)braket
suffix:semicolon
r_if
c_cond
(paren
id|no_add
)paren
r_return
l_int|NULL
suffix:semicolon
id|pos
op_assign
l_int|1
id|pos
suffix:semicolon
id|bucket
op_assign
id|ids-&gt;patches
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|bucket
op_logical_or
(paren
id|BUCKET_SIZE
op_le
id|bucket-&gt;nr
)paren
)paren
(brace
id|bucket
op_assign
id|xcalloc
c_func
(paren
l_int|1
comma
r_sizeof
(paren
op_star
id|bucket
)paren
)paren
suffix:semicolon
id|bucket-&gt;next
op_assign
id|ids-&gt;patches
suffix:semicolon
id|ids-&gt;patches
op_assign
id|bucket
suffix:semicolon
)brace
id|ent
op_assign
op_amp
id|bucket-&gt;bucket
(braket
id|bucket-&gt;nr
op_increment
)braket
suffix:semicolon
id|hashcpy
c_func
(paren
id|ent-&gt;patch_id
comma
id|sha1
)paren
suffix:semicolon
id|ALLOC_GROW
c_func
(paren
id|ids-&gt;table
comma
id|ids-&gt;nr
op_plus
l_int|1
comma
id|ids-&gt;alloc
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pos
OL
id|ids-&gt;nr
)paren
id|memmove
c_func
(paren
id|ids-&gt;table
op_plus
id|pos
op_plus
l_int|1
comma
id|ids-&gt;table
op_plus
id|pos
comma
r_sizeof
(paren
id|ent
)paren
op_star
(paren
id|ids-&gt;nr
id|pos
)paren
)paren
suffix:semicolon
id|ids-&gt;nr
op_increment
suffix:semicolon
id|ids-&gt;table
(braket
id|pos
)braket
op_assign
id|ent
suffix:semicolon
r_return
id|ids-&gt;table
(braket
id|pos
)braket
suffix:semicolon
)brace
DECL|function|has_commit_patch_id
r_struct
id|patch_id
op_star
id|has_commit_patch_id
c_func
(paren
r_struct
id|commit
op_star
id|commit
comma
r_struct
id|patch_ids
op_star
id|ids
)paren
(brace
r_return
id|add_commit
c_func
(paren
id|commit
comma
id|ids
comma
l_int|1
)paren
suffix:semicolon
)brace
DECL|function|add_commit_patch_id
r_struct
id|patch_id
op_star
id|add_commit_patch_id
c_func
(paren
r_struct
id|commit
op_star
id|commit
comma
r_struct
id|patch_ids
op_star
id|ids
)paren
(brace
r_return
id|add_commit
c_func
(paren
id|commit
comma
id|ids
comma
l_int|0
)paren
suffix:semicolon
)brace
eof
