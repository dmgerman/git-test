macro_line|#include &quot;cache.h&quot;
macro_line|#include &quot;quote.h&quot;
multiline_comment|/* Help to copy the thing properly quoted for the shell safety.&n; * any single quote is replaced with &squot;&bslash;&squot;&squot;, and the caller is&n; * expected to enclose the result within a single quote pair.&n; *&n; * E.g.&n; *  original     sq_quote     result&n; *  name     ==&gt; name      ==&gt; &squot;name&squot;&n; *  a b      ==&gt; a b       ==&gt; &squot;a b&squot;&n; *  a&squot;b      ==&gt; a&squot;&bslash;&squot;&squot;b    ==&gt; &squot;a&squot;&bslash;&squot;&squot;b&squot;&n; */
DECL|function|sq_quote
r_char
op_star
id|sq_quote
c_func
(paren
r_const
r_char
op_star
id|src
)paren
(brace
r_static
r_char
op_star
id|buf
op_assign
l_int|NULL
suffix:semicolon
r_int
id|cnt
comma
id|c
suffix:semicolon
r_const
r_char
op_star
id|cp
suffix:semicolon
r_char
op_star
id|bp
suffix:semicolon
multiline_comment|/* count bytes needed to store the quoted string. */
r_for
c_loop
(paren
id|cnt
op_assign
l_int|3
comma
id|cp
op_assign
id|src
suffix:semicolon
op_star
id|cp
suffix:semicolon
id|cnt
op_increment
comma
id|cp
op_increment
)paren
r_if
c_cond
(paren
op_star
id|cp
op_eq
l_char|&squot;&bslash;&squot;&squot;
)paren
id|cnt
op_add_assign
l_int|3
suffix:semicolon
id|buf
op_assign
id|xmalloc
c_func
(paren
id|cnt
)paren
suffix:semicolon
id|bp
op_assign
id|buf
suffix:semicolon
op_star
id|bp
op_increment
op_assign
l_char|&squot;&bslash;&squot;&squot;
suffix:semicolon
r_while
c_loop
(paren
(paren
id|c
op_assign
op_star
id|src
op_increment
)paren
)paren
(brace
r_if
c_cond
(paren
id|c
op_ne
l_char|&squot;&bslash;&squot;&squot;
)paren
op_star
id|bp
op_increment
op_assign
id|c
suffix:semicolon
r_else
(brace
id|bp
op_assign
id|strcpy
c_func
(paren
id|bp
comma
l_string|&quot;&squot;&bslash;&bslash;&squot;&squot;&quot;
)paren
suffix:semicolon
id|bp
op_add_assign
l_int|4
suffix:semicolon
)brace
)brace
op_star
id|bp
op_increment
op_assign
l_char|&squot;&bslash;&squot;&squot;
suffix:semicolon
op_star
id|bp
op_assign
l_int|0
suffix:semicolon
r_return
id|buf
suffix:semicolon
)brace
eof
