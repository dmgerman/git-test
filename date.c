multiline_comment|/*&n; * GIT - The information manager from hell&n; *&n; * Copyright (C) Linus Torvalds, 2005&n; */
macro_line|#include &lt;stdio.h&gt;
macro_line|#include &lt;stdlib.h&gt;
macro_line|#include &lt;string.h&gt;
macro_line|#include &lt;ctype.h&gt;
macro_line|#include &lt;time.h&gt;
DECL|function|my_mktime
r_static
id|time_t
id|my_mktime
c_func
(paren
r_struct
id|tm
op_star
id|tm
)paren
(brace
r_static
r_const
r_int
id|mdays
(braket
)braket
op_assign
(brace
l_int|0
comma
l_int|31
comma
l_int|59
comma
l_int|90
comma
l_int|120
comma
l_int|151
comma
l_int|181
comma
l_int|212
comma
l_int|243
comma
l_int|273
comma
l_int|304
comma
l_int|334
)brace
suffix:semicolon
r_int
id|year
op_assign
id|tm-&gt;tm_year
l_int|70
suffix:semicolon
r_int
id|month
op_assign
id|tm-&gt;tm_mon
suffix:semicolon
r_int
id|day
op_assign
id|tm-&gt;tm_mday
suffix:semicolon
r_if
c_cond
(paren
id|year
template_param
l_int|129
)paren
multiline_comment|/* algo only works for 1970-2099 */
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|month
template_param
l_int|11
)paren
multiline_comment|/* array bounds */
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|month
OL
l_int|2
op_logical_or
(paren
id|year
op_plus
l_int|2
)paren
op_mod
l_int|4
)paren
id|day
op_decrement
suffix:semicolon
r_return
(paren
id|year
op_star
l_int|365
op_plus
(paren
id|year
op_plus
l_int|1
)paren
op_div
l_int|4
op_plus
id|mdays
(braket
id|month
)braket
op_plus
id|day
)paren
op_star
l_int|24
op_star
l_int|60
op_star
l_int|60UL
op_plus
id|tm-&gt;tm_hour
op_star
l_int|60
op_star
l_int|60
op_plus
id|tm-&gt;tm_min
op_star
l_int|60
op_plus
id|tm-&gt;tm_sec
suffix:semicolon
)brace
DECL|variable|month_names
r_static
r_const
r_char
op_star
id|month_names
(braket
)braket
op_assign
(brace
l_string|&quot;Jan&quot;
comma
l_string|&quot;Feb&quot;
comma
l_string|&quot;Mar&quot;
comma
l_string|&quot;Apr&quot;
comma
l_string|&quot;May&quot;
comma
l_string|&quot;Jun&quot;
comma
l_string|&quot;Jul&quot;
comma
l_string|&quot;Aug&quot;
comma
l_string|&quot;Sep&quot;
comma
l_string|&quot;Oct&quot;
comma
l_string|&quot;Nov&quot;
comma
l_string|&quot;Dec&quot;
)brace
suffix:semicolon
DECL|variable|weekday_names
r_static
r_const
r_char
op_star
id|weekday_names
(braket
)braket
op_assign
(brace
l_string|&quot;Sun&quot;
comma
l_string|&quot;Mon&quot;
comma
l_string|&quot;Tue&quot;
comma
l_string|&quot;Wed&quot;
comma
l_string|&quot;Thu&quot;
comma
l_string|&quot;Fri&quot;
comma
l_string|&quot;Sat&quot;
)brace
suffix:semicolon
DECL|function|skipfws
r_static
r_char
op_star
id|skipfws
c_func
(paren
r_char
op_star
id|str
)paren
(brace
r_while
c_loop
(paren
id|isspace
c_func
(paren
op_star
id|str
)paren
)paren
id|str
op_increment
suffix:semicolon
r_return
id|str
suffix:semicolon
)brace
multiline_comment|/* Gr. strptime is crap for this; it doesn&squot;t have a way to require RFC2822&n;   (i.e. English) day/month names, and it doesn&squot;t work correctly with %z. */
DECL|function|parse_date
r_void
id|parse_date
c_func
(paren
r_char
op_star
id|date
comma
r_char
op_star
id|result
comma
r_int
id|maxlen
)paren
(brace
r_struct
id|tm
id|tm
suffix:semicolon
r_char
op_star
id|p
comma
op_star
id|tz
suffix:semicolon
r_int
id|i
comma
id|offset
suffix:semicolon
id|time_t
id|then
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|tm
comma
l_int|0
comma
r_sizeof
(paren
id|tm
)paren
)paren
suffix:semicolon
multiline_comment|/* Skip day-name */
id|p
op_assign
id|skipfws
c_func
(paren
id|date
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|isdigit
c_func
(paren
op_star
id|p
)paren
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|7
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|p
comma
id|weekday_names
(braket
id|i
)braket
comma
l_int|3
)paren
op_logical_and
id|p
(braket
l_int|3
)braket
op_eq
l_char|&squot;,&squot;
)paren
(brace
id|p
op_assign
id|skipfws
c_func
(paren
id|p
op_plus
l_int|4
)paren
suffix:semicolon
r_goto
id|day
suffix:semicolon
)brace
)brace
r_return
suffix:semicolon
)brace
multiline_comment|/* day */
id|day
suffix:colon
id|tm.tm_mday
op_assign
id|strtoul
c_func
(paren
id|p
comma
op_amp
id|p
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tm.tm_mday
template_param
l_int|31
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|isspace
c_func
(paren
op_star
id|p
)paren
)paren
r_return
suffix:semicolon
id|p
op_assign
id|skipfws
c_func
(paren
id|p
)paren
suffix:semicolon
multiline_comment|/* month */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|12
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|p
comma
id|month_names
(braket
id|i
)braket
comma
l_int|3
)paren
op_logical_and
id|isspace
c_func
(paren
id|p
(braket
l_int|3
)braket
)paren
)paren
(brace
id|tm.tm_mon
op_assign
id|i
suffix:semicolon
id|p
op_assign
id|skipfws
c_func
(paren
id|p
op_plus
id|strlen
c_func
(paren
id|month_names
(braket
id|i
)braket
)paren
)paren
suffix:semicolon
r_goto
id|year
suffix:semicolon
)brace
)brace
r_return
suffix:semicolon
multiline_comment|/* Error -- bad month */
multiline_comment|/* year */
id|year
suffix:colon
id|tm.tm_year
op_assign
id|strtoul
c_func
(paren
id|p
comma
op_amp
id|p
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tm.tm_year
op_logical_and
op_logical_neg
id|isspace
c_func
(paren
op_star
id|p
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|tm.tm_year
OG
l_int|1900
)paren
id|tm.tm_year
op_sub_assign
l_int|1900
suffix:semicolon
id|p
op_assign
id|skipfws
c_func
(paren
id|p
)paren
suffix:semicolon
multiline_comment|/* hour */
r_if
c_cond
(paren
op_logical_neg
id|isdigit
c_func
(paren
op_star
id|p
)paren
)paren
r_return
suffix:semicolon
id|tm.tm_hour
op_assign
id|strtoul
c_func
(paren
id|p
comma
op_amp
id|p
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tm.tm_hour
OG
l_int|23
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_star
id|p
op_ne
l_char|&squot;:&squot;
)paren
r_return
suffix:semicolon
multiline_comment|/* Error -- bad time */
id|p
op_increment
suffix:semicolon
multiline_comment|/* minute */
r_if
c_cond
(paren
op_logical_neg
id|isdigit
c_func
(paren
op_star
id|p
)paren
)paren
r_return
suffix:semicolon
id|tm.tm_min
op_assign
id|strtoul
c_func
(paren
id|p
comma
op_amp
id|p
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tm.tm_min
OG
l_int|59
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_star
id|p
op_ne
l_char|&squot;:&squot;
)paren
r_goto
id|zone
suffix:semicolon
id|p
op_increment
suffix:semicolon
multiline_comment|/* second */
r_if
c_cond
(paren
op_logical_neg
id|isdigit
c_func
(paren
op_star
id|p
)paren
)paren
r_return
suffix:semicolon
id|tm.tm_sec
op_assign
id|strtoul
c_func
(paren
id|p
comma
op_amp
id|p
comma
l_int|10
)paren
suffix:semicolon
r_if
c_cond
(paren
id|tm.tm_sec
OG
l_int|60
)paren
r_return
suffix:semicolon
id|zone
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|isspace
c_func
(paren
op_star
id|p
)paren
)paren
r_return
suffix:semicolon
id|p
op_assign
id|skipfws
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|p
op_eq
l_char|&squot;-&squot;
)paren
id|offset
op_assign
l_int|60
suffix:semicolon
r_else
r_if
c_cond
(paren
op_star
id|p
op_eq
l_char|&squot;+&squot;
)paren
id|offset
op_assign
l_int|60
suffix:semicolon
r_else
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|isdigit
c_func
(paren
id|p
(braket
l_int|1
)braket
)paren
op_logical_or
op_logical_neg
id|isdigit
c_func
(paren
id|p
(braket
l_int|2
)braket
)paren
op_logical_or
op_logical_neg
id|isdigit
c_func
(paren
id|p
(braket
l_int|3
)braket
)paren
op_logical_or
op_logical_neg
id|isdigit
c_func
(paren
id|p
(braket
l_int|4
)braket
)paren
)paren
r_return
suffix:semicolon
id|tz
op_assign
id|p
suffix:semicolon
id|i
op_assign
id|strtoul
c_func
(paren
id|p
op_plus
l_int|1
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
id|offset
op_mul_assign
(paren
(paren
id|i
op_mod
l_int|100
)paren
op_plus
(paren
(paren
id|i
op_div
l_int|100
)paren
op_star
l_int|60
)paren
)paren
suffix:semicolon
id|p
op_assign
id|skipfws
c_func
(paren
id|p
op_plus
l_int|5
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|p
op_logical_and
op_star
id|p
op_ne
l_char|&squot;(&squot;
)paren
multiline_comment|/* trailing comment like (EDT) is ok */
r_return
suffix:semicolon
id|then
op_assign
id|my_mktime
c_func
(paren
op_amp
id|tm
)paren
suffix:semicolon
multiline_comment|/* mktime uses local timezone */
r_if
c_cond
(paren
id|then
op_eq
l_int|1
)paren
r_return
suffix:semicolon
id|then
op_sub_assign
id|offset
suffix:semicolon
id|snprintf
c_func
(paren
id|result
comma
id|maxlen
comma
l_string|&quot;%lu %5.5s&quot;
comma
id|then
comma
id|tz
)paren
suffix:semicolon
)brace
DECL|function|datestamp
r_void
id|datestamp
c_func
(paren
r_char
op_star
id|buf
comma
r_int
id|bufsize
)paren
(brace
id|time_t
id|now
suffix:semicolon
r_int
id|offset
suffix:semicolon
id|time
c_func
(paren
op_amp
id|now
)paren
suffix:semicolon
id|offset
op_assign
id|my_mktime
c_func
(paren
id|localtime
c_func
(paren
op_amp
id|now
)paren
)paren
id|now
suffix:semicolon
id|offset
op_div_assign
l_int|60
suffix:semicolon
id|snprintf
c_func
(paren
id|buf
comma
id|bufsize
comma
l_string|&quot;%lu %+05d&quot;
comma
id|now
comma
id|offset
op_div
l_int|60
op_star
l_int|100
op_plus
id|offset
op_mod
l_int|60
)paren
suffix:semicolon
)brace
eof
