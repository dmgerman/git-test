macro_line|#include &quot;cache.h&quot;
macro_line|#include &quot;commit.h&quot;
macro_line|#include &quot;notes.h&quot;
macro_line|#include &quot;refs.h&quot;
macro_line|#include &quot;utf8.h&quot;
macro_line|#include &quot;strbuf.h&quot;
DECL|variable|initialized
r_static
r_int
id|initialized
suffix:semicolon
DECL|function|get_commit_notes
r_void
id|get_commit_notes
c_func
(paren
r_const
r_struct
id|commit
op_star
id|commit
comma
r_struct
id|strbuf
op_star
id|sb
comma
r_const
r_char
op_star
id|output_encoding
)paren
(brace
r_static
r_const
r_char
op_star
id|utf8
op_assign
l_string|&quot;utf-8&quot;
suffix:semicolon
r_struct
id|strbuf
id|name
op_assign
id|STRBUF_INIT
suffix:semicolon
r_const
r_char
op_star
id|hex
suffix:semicolon
r_int
r_char
id|sha1
(braket
l_int|20
)braket
suffix:semicolon
r_char
op_star
id|msg
suffix:semicolon
r_int
r_int
id|msgoffset
comma
id|msglen
suffix:semicolon
r_enum
id|object_type
id|type
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|initialized
)paren
(brace
r_const
r_char
op_star
id|env
op_assign
id|getenv
c_func
(paren
id|GIT_NOTES_REF_ENVIRONMENT
)paren
suffix:semicolon
r_if
c_cond
(paren
id|env
)paren
id|notes_ref_name
op_assign
id|getenv
c_func
(paren
id|GIT_NOTES_REF_ENVIRONMENT
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|notes_ref_name
)paren
id|notes_ref_name
op_assign
id|GIT_NOTES_DEFAULT_REF
suffix:semicolon
r_if
c_cond
(paren
id|notes_ref_name
op_logical_and
id|read_ref
c_func
(paren
id|notes_ref_name
comma
id|sha1
)paren
)paren
id|notes_ref_name
op_assign
l_int|NULL
suffix:semicolon
id|initialized
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|notes_ref_name
)paren
r_return
suffix:semicolon
id|strbuf_addf
c_func
(paren
op_amp
id|name
comma
l_string|&quot;%s:%s&quot;
comma
id|notes_ref_name
comma
id|sha1_to_hex
c_func
(paren
id|commit-&gt;object.sha1
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|get_sha1
c_func
(paren
id|name.buf
comma
id|sha1
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|msg
op_assign
id|read_sha1_file
c_func
(paren
id|sha1
comma
op_amp
id|type
comma
op_amp
id|msglen
)paren
)paren
op_logical_or
op_logical_neg
id|msglen
op_logical_or
id|type
op_ne
id|OBJ_BLOB
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|output_encoding
op_logical_and
op_star
id|output_encoding
op_logical_and
id|strcmp
c_func
(paren
id|utf8
comma
id|output_encoding
)paren
)paren
(brace
r_char
op_star
id|reencoded
op_assign
id|reencode_string
c_func
(paren
id|msg
comma
id|output_encoding
comma
id|utf8
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reencoded
)paren
(brace
id|free
c_func
(paren
id|msg
)paren
suffix:semicolon
id|msg
op_assign
id|reencoded
suffix:semicolon
id|msglen
op_assign
id|strlen
c_func
(paren
id|msg
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* we will end the annotation by a newline anyway */
r_if
c_cond
(paren
id|msglen
op_logical_and
id|msg
(braket
id|msglen
l_int|1
)braket
op_eq
l_char|&squot;&bslash;n&squot;
)paren
id|msglen
op_decrement
suffix:semicolon
id|strbuf_addstr
c_func
(paren
id|sb
comma
l_string|&quot;&bslash;nNotes:&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|msgoffset
op_assign
l_int|0
suffix:semicolon
id|msgoffset
OL
id|msglen
suffix:semicolon
)paren
(brace
r_int
id|linelen
op_assign
id|strchrnul
c_func
(paren
id|msg
comma
l_char|&squot;&bslash;n&squot;
)paren
id|msg
suffix:semicolon
id|strbuf_addstr
c_func
(paren
id|sb
comma
l_string|&quot;    &quot;
)paren
suffix:semicolon
id|strbuf_add
c_func
(paren
id|sb
comma
id|msg
op_plus
id|msgoffset
comma
id|linelen
)paren
suffix:semicolon
id|msgoffset
op_add_assign
id|linelen
suffix:semicolon
)brace
id|free
c_func
(paren
id|msg
)paren
suffix:semicolon
)brace
eof
