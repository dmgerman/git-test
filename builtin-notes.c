multiline_comment|/*&n; * Builtin &quot;git notes&quot;&n; *&n; * Copyright (c) 2010 Johan Herland &lt;johan@herland.net&gt;&n; *&n; * Based on git-notes.sh by Johannes Schindelin,&n; * and builtin-tag.c by Kristian H&oslash;gsberg and Carlos Rica.&n; */
macro_line|#include &quot;cache.h&quot;
macro_line|#include &quot;builtin.h&quot;
macro_line|#include &quot;notes.h&quot;
macro_line|#include &quot;blob.h&quot;
macro_line|#include &quot;commit.h&quot;
macro_line|#include &quot;refs.h&quot;
macro_line|#include &quot;exec_cmd.h&quot;
macro_line|#include &quot;run-command.h&quot;
macro_line|#include &quot;parse-options.h&quot;
DECL|variable|git_notes_usage
r_static
r_const
r_char
op_star
r_const
id|git_notes_usage
(braket
)braket
op_assign
(brace
l_string|&quot;git notes [list [&lt;object&gt;]]&quot;
comma
l_string|&quot;git notes add [-f] [-m &lt;msg&gt; | -F &lt;file&gt;] [&lt;object&gt;]&quot;
comma
l_string|&quot;git notes append [-m &lt;msg&gt; | -F &lt;file&gt;] [&lt;object&gt;]&quot;
comma
l_string|&quot;git notes edit [-m &lt;msg&gt; | -F &lt;file&gt;] [&lt;object&gt;]&quot;
comma
l_string|&quot;git notes show [&lt;object&gt;]&quot;
comma
l_string|&quot;git notes remove [&lt;object&gt;]&quot;
comma
l_string|&quot;git notes prune&quot;
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|note_template
r_static
r_const
r_char
id|note_template
(braket
)braket
op_assign
l_string|&quot;&bslash;n&quot;
l_string|&quot;#&bslash;n&quot;
l_string|&quot;# Write/edit the notes for the following object:&bslash;n&quot;
l_string|&quot;#&bslash;n&quot;
suffix:semicolon
DECL|function|list_each_note
r_static
r_int
id|list_each_note
c_func
(paren
r_const
r_int
r_char
op_star
id|object_sha1
comma
r_const
r_int
r_char
op_star
id|note_sha1
comma
r_char
op_star
id|note_path
comma
r_void
op_star
id|cb_data
)paren
(brace
id|printf
c_func
(paren
l_string|&quot;%s %s&bslash;n&quot;
comma
id|sha1_to_hex
c_func
(paren
id|note_sha1
)paren
comma
id|sha1_to_hex
c_func
(paren
id|object_sha1
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|write_note_data
r_static
r_void
id|write_note_data
c_func
(paren
r_int
id|fd
comma
r_const
r_int
r_char
op_star
id|sha1
)paren
(brace
r_int
r_int
id|size
suffix:semicolon
r_enum
id|object_type
id|type
suffix:semicolon
r_char
op_star
id|buf
op_assign
id|read_sha1_file
c_func
(paren
id|sha1
comma
op_amp
id|type
comma
op_amp
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buf
)paren
(brace
r_if
c_cond
(paren
id|size
)paren
id|write_or_die
c_func
(paren
id|fd
comma
id|buf
comma
id|size
)paren
suffix:semicolon
id|free
c_func
(paren
id|buf
)paren
suffix:semicolon
)brace
)brace
DECL|function|write_commented_object
r_static
r_void
id|write_commented_object
c_func
(paren
r_int
id|fd
comma
r_const
r_int
r_char
op_star
id|object
)paren
(brace
r_const
r_char
op_star
id|show_args
(braket
l_int|5
)braket
op_assign
(brace
l_string|&quot;show&quot;
comma
l_string|&quot;--stat&quot;
comma
l_string|&quot;--no-notes&quot;
comma
id|sha1_to_hex
c_func
(paren
id|object
)paren
comma
l_int|NULL
)brace
suffix:semicolon
r_struct
id|child_process
id|show
suffix:semicolon
r_struct
id|strbuf
id|buf
op_assign
id|STRBUF_INIT
suffix:semicolon
id|FILE
op_star
id|show_out
suffix:semicolon
multiline_comment|/* Invoke &quot;git show --stat --no-notes $object&quot; */
id|memset
c_func
(paren
op_amp
id|show
comma
l_int|0
comma
r_sizeof
(paren
id|show
)paren
)paren
suffix:semicolon
id|show.argv
op_assign
id|show_args
suffix:semicolon
id|show.no_stdin
op_assign
l_int|1
suffix:semicolon
id|show.out
op_assign
l_int|1
suffix:semicolon
id|show.err
op_assign
l_int|0
suffix:semicolon
id|show.git_cmd
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|start_command
c_func
(paren
op_amp
id|show
)paren
)paren
id|die
c_func
(paren
l_string|&quot;unable to start &squot;show&squot; for object &squot;%s&squot;&quot;
comma
id|sha1_to_hex
c_func
(paren
id|object
)paren
)paren
suffix:semicolon
multiline_comment|/* Open the output as FILE* so strbuf_getline() can be used. */
id|show_out
op_assign
id|xfdopen
c_func
(paren
id|show.out
comma
l_string|&quot;r&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|show_out
op_eq
l_int|NULL
)paren
id|die_errno
c_func
(paren
l_string|&quot;can&squot;t fdopen &squot;show&squot; output fd&quot;
)paren
suffix:semicolon
multiline_comment|/* Prepend &quot;# &quot; to each output line and write result to &squot;fd&squot; */
r_while
c_loop
(paren
id|strbuf_getline
c_func
(paren
op_amp
id|buf
comma
id|show_out
comma
l_char|&squot;&bslash;n&squot;
)paren
op_ne
id|EOF
)paren
(brace
id|write_or_die
c_func
(paren
id|fd
comma
l_string|&quot;# &quot;
comma
l_int|2
)paren
suffix:semicolon
id|write_or_die
c_func
(paren
id|fd
comma
id|buf.buf
comma
id|buf.len
)paren
suffix:semicolon
id|write_or_die
c_func
(paren
id|fd
comma
l_string|&quot;&bslash;n&quot;
comma
l_int|1
)paren
suffix:semicolon
)brace
id|strbuf_release
c_func
(paren
op_amp
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fclose
c_func
(paren
id|show_out
)paren
)paren
id|die_errno
c_func
(paren
l_string|&quot;failed to close pipe to &squot;show&squot; for object &squot;%s&squot;&quot;
comma
id|sha1_to_hex
c_func
(paren
id|object
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|finish_command
c_func
(paren
op_amp
id|show
)paren
)paren
id|die
c_func
(paren
l_string|&quot;failed to finish &squot;show&squot; for object &squot;%s&squot;&quot;
comma
id|sha1_to_hex
c_func
(paren
id|object
)paren
)paren
suffix:semicolon
)brace
DECL|function|create_note
r_static
r_void
id|create_note
c_func
(paren
r_const
r_int
r_char
op_star
id|object
comma
r_struct
id|strbuf
op_star
id|buf
comma
r_int
id|skip_editor
comma
r_int
id|append_only
comma
r_const
r_int
r_char
op_star
id|prev
comma
r_int
r_char
op_star
id|result
)paren
(brace
r_char
op_star
id|path
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skip_editor
)paren
(brace
r_int
id|fd
suffix:semicolon
multiline_comment|/* write the template message before editing: */
id|path
op_assign
id|git_pathdup
c_func
(paren
l_string|&quot;NOTES_EDITMSG&quot;
)paren
suffix:semicolon
id|fd
op_assign
id|open
c_func
(paren
id|path
comma
id|O_CREAT
op_or
id|O_TRUNC
op_or
id|O_WRONLY
comma
l_int|0600
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fd
OL
l_int|0
)paren
id|die_errno
c_func
(paren
l_string|&quot;could not create file &squot;%s&squot;&quot;
comma
id|path
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prev
op_logical_and
op_logical_neg
id|append_only
)paren
id|write_note_data
c_func
(paren
id|fd
comma
id|prev
)paren
suffix:semicolon
id|write_or_die
c_func
(paren
id|fd
comma
id|note_template
comma
id|strlen
c_func
(paren
id|note_template
)paren
)paren
suffix:semicolon
id|write_commented_object
c_func
(paren
id|fd
comma
id|object
)paren
suffix:semicolon
id|close
c_func
(paren
id|fd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|launch_editor
c_func
(paren
id|path
comma
id|buf
comma
l_int|NULL
)paren
)paren
(brace
id|die
c_func
(paren
l_string|&quot;Please supply the note contents using either -m&quot;
"&bslash;"
l_string|&quot; or -F option&quot;
)paren
suffix:semicolon
)brace
)brace
id|stripspace
c_func
(paren
id|buf
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prev
op_logical_and
id|append_only
)paren
(brace
multiline_comment|/* Append buf to previous note contents */
r_int
r_int
id|size
suffix:semicolon
r_enum
id|object_type
id|type
suffix:semicolon
r_char
op_star
id|prev_buf
op_assign
id|read_sha1_file
c_func
(paren
id|prev
comma
op_amp
id|type
comma
op_amp
id|size
)paren
suffix:semicolon
id|strbuf_grow
c_func
(paren
id|buf
comma
id|size
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buf-&gt;len
op_logical_and
id|prev_buf
op_logical_and
id|size
)paren
id|strbuf_insert
c_func
(paren
id|buf
comma
l_int|0
comma
l_string|&quot;&bslash;n&quot;
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prev_buf
op_logical_and
id|size
)paren
id|strbuf_insert
c_func
(paren
id|buf
comma
l_int|0
comma
id|prev_buf
comma
id|size
)paren
suffix:semicolon
id|free
c_func
(paren
id|prev_buf
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|buf-&gt;len
)paren
(brace
id|fprintf
c_func
(paren
id|stderr
comma
l_string|&quot;Removing note for object %s&bslash;n&quot;
comma
id|sha1_to_hex
c_func
(paren
id|object
)paren
)paren
suffix:semicolon
id|hashclr
c_func
(paren
id|result
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|write_sha1_file
c_func
(paren
id|buf-&gt;buf
comma
id|buf-&gt;len
comma
id|blob_type
comma
id|result
)paren
)paren
(brace
id|error
c_func
(paren
l_string|&quot;unable to write note object&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|path
)paren
id|error
c_func
(paren
l_string|&quot;The note contents has been left in %s&quot;
comma
id|path
)paren
suffix:semicolon
m_exit
(paren
l_int|128
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|path
)paren
(brace
id|unlink_or_warn
c_func
(paren
id|path
)paren
suffix:semicolon
id|free
c_func
(paren
id|path
)paren
suffix:semicolon
)brace
)brace
DECL|struct|msg_arg
r_struct
id|msg_arg
(brace
DECL|member|given
r_int
id|given
suffix:semicolon
DECL|member|buf
r_struct
id|strbuf
id|buf
suffix:semicolon
)brace
suffix:semicolon
DECL|function|parse_msg_arg
r_static
r_int
id|parse_msg_arg
c_func
(paren
r_const
r_struct
id|option
op_star
id|opt
comma
r_const
r_char
op_star
id|arg
comma
r_int
id|unset
)paren
(brace
r_struct
id|msg_arg
op_star
id|msg
op_assign
id|opt-&gt;value
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|arg
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|msg-&gt;buf.len
)paren
id|strbuf_addstr
c_func
(paren
op_amp
(paren
id|msg-&gt;buf
)paren
comma
l_string|&quot;&bslash;n&bslash;n&quot;
)paren
suffix:semicolon
id|strbuf_addstr
c_func
(paren
op_amp
(paren
id|msg-&gt;buf
)paren
comma
id|arg
)paren
suffix:semicolon
id|msg-&gt;given
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|commit_notes
r_int
id|commit_notes
c_func
(paren
r_struct
id|notes_tree
op_star
id|t
comma
r_const
r_char
op_star
id|msg
)paren
(brace
r_struct
id|commit_list
op_star
id|parent
suffix:semicolon
r_int
r_char
id|tree_sha1
(braket
l_int|20
)braket
comma
id|prev_commit
(braket
l_int|20
)braket
comma
id|new_commit
(braket
l_int|20
)braket
suffix:semicolon
r_struct
id|strbuf
id|buf
op_assign
id|STRBUF_INIT
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|t
)paren
id|t
op_assign
op_amp
id|default_notes_tree
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|t-&gt;initialized
op_logical_or
op_logical_neg
id|t-&gt;ref
op_logical_or
op_logical_neg
op_star
id|t-&gt;ref
)paren
id|die
c_func
(paren
l_string|&quot;Cannot commit uninitialized/unreferenced notes tree&quot;
)paren
suffix:semicolon
multiline_comment|/* Prepare commit message and reflog message */
id|strbuf_addstr
c_func
(paren
op_amp
id|buf
comma
l_string|&quot;notes: &quot;
)paren
suffix:semicolon
multiline_comment|/* commit message starts at index 7 */
id|strbuf_addstr
c_func
(paren
op_amp
id|buf
comma
id|msg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buf.buf
(braket
id|buf.len
l_int|1
)braket
op_ne
l_char|&squot;&bslash;n&squot;
)paren
id|strbuf_addch
c_func
(paren
op_amp
id|buf
comma
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
multiline_comment|/* Make sure msg ends with newline */
multiline_comment|/* Convert notes tree to tree object */
r_if
c_cond
(paren
id|write_notes_tree
c_func
(paren
id|t
comma
id|tree_sha1
)paren
)paren
id|die
c_func
(paren
l_string|&quot;Failed to write current notes tree to database&quot;
)paren
suffix:semicolon
multiline_comment|/* Create new commit for the tree object */
r_if
c_cond
(paren
op_logical_neg
id|read_ref
c_func
(paren
id|t-&gt;ref
comma
id|prev_commit
)paren
)paren
(brace
multiline_comment|/* retrieve parent commit */
id|parent
op_assign
id|xmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|parent
)paren
)paren
suffix:semicolon
id|parent-&gt;item
op_assign
id|lookup_commit
c_func
(paren
id|prev_commit
)paren
suffix:semicolon
id|parent-&gt;next
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
id|hashclr
c_func
(paren
id|prev_commit
)paren
suffix:semicolon
id|parent
op_assign
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|commit_tree
c_func
(paren
id|buf.buf
op_plus
l_int|7
comma
id|tree_sha1
comma
id|parent
comma
id|new_commit
comma
l_int|NULL
)paren
)paren
id|die
c_func
(paren
l_string|&quot;Failed to commit notes tree to database&quot;
)paren
suffix:semicolon
multiline_comment|/* Update notes ref with new commit */
id|update_ref
c_func
(paren
id|buf.buf
comma
id|t-&gt;ref
comma
id|new_commit
comma
id|prev_commit
comma
l_int|0
comma
id|DIE_ON_ERR
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|buf
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cmd_notes
r_int
id|cmd_notes
c_func
(paren
r_int
id|argc
comma
r_const
r_char
op_star
op_star
id|argv
comma
r_const
r_char
op_star
id|prefix
)paren
(brace
r_struct
id|strbuf
id|buf
op_assign
id|STRBUF_INIT
suffix:semicolon
r_struct
id|notes_tree
op_star
id|t
suffix:semicolon
r_int
r_char
id|object
(braket
l_int|20
)braket
comma
id|new_note
(braket
l_int|20
)braket
suffix:semicolon
r_const
r_int
r_char
op_star
id|note
suffix:semicolon
r_const
r_char
op_star
id|object_ref
suffix:semicolon
r_char
id|logmsg
(braket
l_int|100
)braket
suffix:semicolon
r_int
id|list
op_assign
l_int|0
comma
id|add
op_assign
l_int|0
comma
id|append
op_assign
l_int|0
comma
id|edit
op_assign
l_int|0
comma
id|show
op_assign
l_int|0
comma
id|remove
op_assign
l_int|0
comma
id|prune
op_assign
l_int|0
comma
id|force
op_assign
l_int|0
suffix:semicolon
r_int
id|given_object
suffix:semicolon
r_const
r_char
op_star
id|msgfile
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|msg_arg
id|msg
op_assign
(brace
l_int|0
comma
id|STRBUF_INIT
)brace
suffix:semicolon
r_struct
id|option
id|options
(braket
)braket
op_assign
(brace
id|OPT_GROUP
c_func
(paren
l_string|&quot;Notes edit options&quot;
)paren
comma
id|OPT_CALLBACK
c_func
(paren
l_char|&squot;m&squot;
comma
l_string|&quot;message&quot;
comma
op_amp
id|msg
comma
l_string|&quot;msg&quot;
comma
l_string|&quot;note contents as a string&quot;
comma
id|parse_msg_arg
)paren
comma
id|OPT_FILENAME
c_func
(paren
l_char|&squot;F&squot;
comma
l_string|&quot;file&quot;
comma
op_amp
id|msgfile
comma
l_string|&quot;note contents in a file&quot;
)paren
comma
id|OPT_BOOLEAN
c_func
(paren
l_char|&squot;f&squot;
comma
l_string|&quot;force&quot;
comma
op_amp
id|force
comma
l_string|&quot;replace existing notes&quot;
)paren
comma
id|OPT_END
c_func
(paren
)paren
)brace
suffix:semicolon
id|git_config
c_func
(paren
id|git_default_config
comma
l_int|NULL
)paren
suffix:semicolon
id|argc
op_assign
id|parse_options
c_func
(paren
id|argc
comma
id|argv
comma
id|prefix
comma
id|options
comma
id|git_notes_usage
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|argc
op_logical_and
op_logical_neg
id|strcmp
c_func
(paren
id|argv
(braket
l_int|0
)braket
comma
l_string|&quot;list&quot;
)paren
)paren
id|list
op_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
id|argc
op_logical_and
op_logical_neg
id|strcmp
c_func
(paren
id|argv
(braket
l_int|0
)braket
comma
l_string|&quot;add&quot;
)paren
)paren
id|add
op_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
id|argc
op_logical_and
op_logical_neg
id|strcmp
c_func
(paren
id|argv
(braket
l_int|0
)braket
comma
l_string|&quot;append&quot;
)paren
)paren
id|append
op_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
id|argc
op_logical_and
op_logical_neg
id|strcmp
c_func
(paren
id|argv
(braket
l_int|0
)braket
comma
l_string|&quot;edit&quot;
)paren
)paren
id|edit
op_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
id|argc
op_logical_and
op_logical_neg
id|strcmp
c_func
(paren
id|argv
(braket
l_int|0
)braket
comma
l_string|&quot;show&quot;
)paren
)paren
id|show
op_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
id|argc
op_logical_and
op_logical_neg
id|strcmp
c_func
(paren
id|argv
(braket
l_int|0
)braket
comma
l_string|&quot;remove&quot;
)paren
)paren
id|remove
op_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
id|argc
op_logical_and
op_logical_neg
id|strcmp
c_func
(paren
id|argv
(braket
l_int|0
)braket
comma
l_string|&quot;prune&quot;
)paren
)paren
id|prune
op_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|argc
)paren
id|list
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Default to &squot;list&squot; if no other subcommand given */
r_if
c_cond
(paren
id|list
op_plus
id|add
op_plus
id|append
op_plus
id|edit
op_plus
id|show
op_plus
id|remove
op_plus
id|prune
op_ne
l_int|1
)paren
id|usage_with_options
c_func
(paren
id|git_notes_usage
comma
id|options
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|msg.given
op_logical_or
id|msgfile
)paren
op_logical_and
op_logical_neg
(paren
id|add
op_logical_or
id|append
op_logical_or
id|edit
)paren
)paren
(brace
id|error
c_func
(paren
l_string|&quot;cannot use -m/-F options with %s subcommand.&quot;
comma
id|argv
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|usage_with_options
c_func
(paren
id|git_notes_usage
comma
id|options
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|msg.given
op_logical_and
id|msgfile
)paren
(brace
id|error
c_func
(paren
l_string|&quot;mixing -m and -F options is not allowed.&quot;
)paren
suffix:semicolon
id|usage_with_options
c_func
(paren
id|git_notes_usage
comma
id|options
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|force
op_logical_and
op_logical_neg
id|add
)paren
(brace
id|error
c_func
(paren
l_string|&quot;cannot use -f option with %s subcommand.&quot;
comma
id|argv
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|usage_with_options
c_func
(paren
id|git_notes_usage
comma
id|options
)paren
suffix:semicolon
)brace
id|given_object
op_assign
id|argc
op_eq
l_int|2
suffix:semicolon
id|object_ref
op_assign
id|given_object
ques
c_cond
id|argv
(braket
l_int|1
)braket
suffix:colon
l_string|&quot;HEAD&quot;
suffix:semicolon
r_if
c_cond
(paren
id|argc
OG
l_int|2
op_logical_or
(paren
id|prune
op_logical_and
id|argc
OG
l_int|1
)paren
)paren
(brace
id|error
c_func
(paren
l_string|&quot;too many parameters&quot;
)paren
suffix:semicolon
id|usage_with_options
c_func
(paren
id|git_notes_usage
comma
id|options
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|get_sha1
c_func
(paren
id|object_ref
comma
id|object
)paren
)paren
id|die
c_func
(paren
l_string|&quot;Failed to resolve &squot;%s&squot; as a valid ref.&quot;
comma
id|object_ref
)paren
suffix:semicolon
id|init_notes
c_func
(paren
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|t
op_assign
op_amp
id|default_notes_tree
suffix:semicolon
r_if
c_cond
(paren
id|prefixcmp
c_func
(paren
id|t-&gt;ref
comma
l_string|&quot;refs/notes/&quot;
)paren
)paren
id|die
c_func
(paren
l_string|&quot;Refusing to %s notes in %s (outside of refs/notes/)&quot;
comma
id|argv
(braket
l_int|0
)braket
comma
id|t-&gt;ref
)paren
suffix:semicolon
id|note
op_assign
id|get_note
c_func
(paren
id|t
comma
id|object
)paren
suffix:semicolon
multiline_comment|/* list command */
r_if
c_cond
(paren
id|list
)paren
(brace
r_if
c_cond
(paren
id|given_object
)paren
(brace
r_if
c_cond
(paren
id|note
)paren
(brace
id|puts
c_func
(paren
id|sha1_to_hex
c_func
(paren
id|note
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_else
r_return
id|for_each_note
c_func
(paren
id|t
comma
l_int|0
comma
id|list_each_note
comma
l_int|NULL
)paren
suffix:semicolon
)brace
multiline_comment|/* show command */
r_if
c_cond
(paren
(paren
id|list
op_logical_or
id|show
)paren
op_logical_and
op_logical_neg
id|note
)paren
(brace
id|error
c_func
(paren
l_string|&quot;No note found for object %s.&quot;
comma
id|sha1_to_hex
c_func
(paren
id|object
)paren
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|show
)paren
(brace
r_const
r_char
op_star
id|show_args
(braket
l_int|3
)braket
op_assign
(brace
l_string|&quot;show&quot;
comma
id|sha1_to_hex
c_func
(paren
id|note
)paren
comma
l_int|NULL
)brace
suffix:semicolon
r_return
id|execv_git_cmd
c_func
(paren
id|show_args
)paren
suffix:semicolon
)brace
multiline_comment|/* add/append/edit/remove/prune command */
r_if
c_cond
(paren
id|add
op_logical_and
id|note
)paren
(brace
r_if
c_cond
(paren
id|force
)paren
id|fprintf
c_func
(paren
id|stderr
comma
l_string|&quot;Overwriting existing notes for object %s&bslash;n&quot;
comma
id|sha1_to_hex
c_func
(paren
id|object
)paren
)paren
suffix:semicolon
r_else
(brace
id|error
c_func
(paren
l_string|&quot;Cannot add notes. Found existing notes for object %s. &quot;
l_string|&quot;Use &squot;-f&squot; to overwrite existing notes&quot;
comma
id|sha1_to_hex
c_func
(paren
id|object
)paren
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|remove
)paren
id|strbuf_reset
c_func
(paren
op_amp
id|buf
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|msg.given
)paren
id|strbuf_addbuf
c_func
(paren
op_amp
id|buf
comma
op_amp
(paren
id|msg.buf
)paren
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|msgfile
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|msgfile
comma
l_string|&quot;-&quot;
)paren
)paren
(brace
r_if
c_cond
(paren
id|strbuf_read
c_func
(paren
op_amp
id|buf
comma
l_int|0
comma
l_int|1024
)paren
OL
l_int|0
)paren
id|die_errno
c_func
(paren
l_string|&quot;cannot read &squot;%s&squot;&quot;
comma
id|msgfile
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strbuf_read_file
c_func
(paren
op_amp
id|buf
comma
id|msgfile
comma
l_int|1024
)paren
OL
l_int|0
)paren
id|die_errno
c_func
(paren
l_string|&quot;could not open or read &squot;%s&squot;&quot;
comma
id|msgfile
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|prune
)paren
(brace
id|hashclr
c_func
(paren
id|new_note
)paren
suffix:semicolon
id|prune_notes
c_func
(paren
id|t
)paren
suffix:semicolon
)brace
r_else
(brace
id|create_note
c_func
(paren
id|object
comma
op_amp
id|buf
comma
id|msg.given
op_logical_or
id|msgfile
op_logical_or
id|remove
comma
id|append
comma
id|note
comma
id|new_note
)paren
suffix:semicolon
r_if
c_cond
(paren
id|is_null_sha1
c_func
(paren
id|new_note
)paren
)paren
id|remove_note
c_func
(paren
id|t
comma
id|object
)paren
suffix:semicolon
r_else
id|add_note
c_func
(paren
id|t
comma
id|object
comma
id|new_note
comma
id|combine_notes_overwrite
)paren
suffix:semicolon
)brace
id|snprintf
c_func
(paren
id|logmsg
comma
r_sizeof
(paren
id|logmsg
)paren
comma
l_string|&quot;Note %s by &squot;git notes %s&squot;&quot;
comma
id|is_null_sha1
c_func
(paren
id|new_note
)paren
ques
c_cond
l_string|&quot;removed&quot;
suffix:colon
l_string|&quot;added&quot;
comma
id|argv
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|commit_notes
c_func
(paren
id|t
comma
id|logmsg
)paren
suffix:semicolon
id|free_notes
c_func
(paren
id|t
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|buf
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
eof
