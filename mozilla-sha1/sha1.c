multiline_comment|/* &n; * The contents of this file are subject to the Mozilla Public&n; * License Version 1.1 (the &quot;License&quot;); you may not use this file&n; * except in compliance with the License. You may obtain a copy of&n; * the License at http://www.mozilla.org/MPL/&n; * &n; * Software distributed under the License is distributed on an &quot;AS&n; * IS&quot; basis, WITHOUT WARRANTY OF ANY KIND, either express or&n; * implied. See the License for the specific language governing&n; * rights and limitations under the License.&n; * &n; * The Original Code is SHA 180-1 Reference Implementation (Compact version)&n; * &n; * The Initial Developer of the Original Code is Paul Kocher of&n; * Cryptography Research.  Portions created by Paul Kocher are &n; * Copyright (C) 1995-9 by Cryptography Research, Inc.  All&n; * Rights Reserved.&n; * &n; * Contributor(s):&n; *&n; *     Paul Kocher&n; * &n; * Alternatively, the contents of this file may be used under the&n; * terms of the GNU General Public License Version 2 or later (the&n; * &quot;GPL&quot;), in which case the provisions of the GPL are applicable &n; * instead of those above.  If you wish to allow use of your &n; * version of this file only under the terms of the GPL and not to&n; * allow others to use your version of this file under the MPL,&n; * indicate your decision by deleting the provisions above and&n; * replace them with the notice and other provisions required by&n; * the GPL.  If you do not delete the provisions above, a recipient&n; * may use your version of this file under either the MPL or the&n; * GPL.&n; */
macro_line|#include &quot;sha1.h&quot;
r_static
r_void
id|shaHashBlock
c_func
(paren
id|SHA_CTX
op_star
id|ctx
)paren
suffix:semicolon
DECL|function|SHA1_Init
r_void
id|SHA1_Init
c_func
(paren
id|SHA_CTX
op_star
id|ctx
)paren
(brace
r_int
id|i
suffix:semicolon
id|ctx-&gt;lenW
op_assign
l_int|0
suffix:semicolon
id|ctx-&gt;sizeHi
op_assign
id|ctx-&gt;sizeLo
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* Initialize H with the magic constants (see FIPS180 for constants)&n;   */
id|ctx-&gt;H
(braket
l_int|0
)braket
op_assign
l_int|0x67452301
suffix:semicolon
id|ctx-&gt;H
(braket
l_int|1
)braket
op_assign
l_int|0xefcdab89
suffix:semicolon
id|ctx-&gt;H
(braket
l_int|2
)braket
op_assign
l_int|0x98badcfe
suffix:semicolon
id|ctx-&gt;H
(braket
l_int|3
)braket
op_assign
l_int|0x10325476
suffix:semicolon
id|ctx-&gt;H
(braket
l_int|4
)braket
op_assign
l_int|0xc3d2e1f0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|80
suffix:semicolon
id|i
op_increment
)paren
id|ctx-&gt;W
(braket
id|i
)braket
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|SHA1_Update
r_void
id|SHA1_Update
c_func
(paren
id|SHA_CTX
op_star
id|ctx
comma
r_void
op_star
id|_dataIn
comma
r_int
id|len
)paren
(brace
r_int
r_char
op_star
id|dataIn
op_assign
id|_dataIn
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/* Read the data into W and process blocks as they get full&n;   */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|len
suffix:semicolon
id|i
op_increment
)paren
(brace
id|ctx-&gt;W
(braket
id|ctx-&gt;lenW
op_div
l_int|4
)braket
op_lshift_assign
l_int|8
suffix:semicolon
id|ctx-&gt;W
(braket
id|ctx-&gt;lenW
op_div
l_int|4
)braket
op_or_assign
(paren
r_int
r_int
)paren
id|dataIn
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
op_increment
id|ctx-&gt;lenW
)paren
op_mod
l_int|64
op_eq
l_int|0
)paren
(brace
id|shaHashBlock
c_func
(paren
id|ctx
)paren
suffix:semicolon
id|ctx-&gt;lenW
op_assign
l_int|0
suffix:semicolon
)brace
id|ctx-&gt;sizeLo
op_add_assign
l_int|8
suffix:semicolon
id|ctx-&gt;sizeHi
op_add_assign
(paren
id|ctx-&gt;sizeLo
OL
l_int|8
)paren
suffix:semicolon
)brace
)brace
DECL|function|SHA1_Final
r_void
id|SHA1_Final
c_func
(paren
r_int
r_char
id|hashout
(braket
l_int|20
)braket
comma
id|SHA_CTX
op_star
id|ctx
)paren
(brace
r_int
r_char
id|pad0x80
op_assign
l_int|0x80
suffix:semicolon
r_int
r_char
id|pad0x00
op_assign
l_int|0x00
suffix:semicolon
r_int
r_char
id|padlen
(braket
l_int|8
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/* Pad with a binary 1 (e.g. 0x80), then zeroes, then length&n;   */
id|padlen
(braket
l_int|0
)braket
op_assign
(paren
r_int
r_char
)paren
(paren
(paren
id|ctx-&gt;sizeHi
op_rshift
l_int|24
)paren
op_amp
l_int|255
)paren
suffix:semicolon
id|padlen
(braket
l_int|1
)braket
op_assign
(paren
r_int
r_char
)paren
(paren
(paren
id|ctx-&gt;sizeHi
op_rshift
l_int|16
)paren
op_amp
l_int|255
)paren
suffix:semicolon
id|padlen
(braket
l_int|2
)braket
op_assign
(paren
r_int
r_char
)paren
(paren
(paren
id|ctx-&gt;sizeHi
op_rshift
l_int|8
)paren
op_amp
l_int|255
)paren
suffix:semicolon
id|padlen
(braket
l_int|3
)braket
op_assign
(paren
r_int
r_char
)paren
(paren
(paren
id|ctx-&gt;sizeHi
op_rshift
l_int|0
)paren
op_amp
l_int|255
)paren
suffix:semicolon
id|padlen
(braket
l_int|4
)braket
op_assign
(paren
r_int
r_char
)paren
(paren
(paren
id|ctx-&gt;sizeLo
op_rshift
l_int|24
)paren
op_amp
l_int|255
)paren
suffix:semicolon
id|padlen
(braket
l_int|5
)braket
op_assign
(paren
r_int
r_char
)paren
(paren
(paren
id|ctx-&gt;sizeLo
op_rshift
l_int|16
)paren
op_amp
l_int|255
)paren
suffix:semicolon
id|padlen
(braket
l_int|6
)braket
op_assign
(paren
r_int
r_char
)paren
(paren
(paren
id|ctx-&gt;sizeLo
op_rshift
l_int|8
)paren
op_amp
l_int|255
)paren
suffix:semicolon
id|padlen
(braket
l_int|7
)braket
op_assign
(paren
r_int
r_char
)paren
(paren
(paren
id|ctx-&gt;sizeLo
op_rshift
l_int|0
)paren
op_amp
l_int|255
)paren
suffix:semicolon
id|SHA1_Update
c_func
(paren
id|ctx
comma
op_amp
id|pad0x80
comma
l_int|1
)paren
suffix:semicolon
r_while
c_loop
(paren
id|ctx-&gt;lenW
op_ne
l_int|56
)paren
id|SHA1_Update
c_func
(paren
id|ctx
comma
op_amp
id|pad0x00
comma
l_int|1
)paren
suffix:semicolon
id|SHA1_Update
c_func
(paren
id|ctx
comma
id|padlen
comma
l_int|8
)paren
suffix:semicolon
multiline_comment|/* Output hash&n;   */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|20
suffix:semicolon
id|i
op_increment
)paren
(brace
id|hashout
(braket
id|i
)braket
op_assign
(paren
r_int
r_char
)paren
(paren
id|ctx-&gt;H
(braket
id|i
op_div
l_int|4
)braket
op_rshift
l_int|24
)paren
suffix:semicolon
id|ctx-&gt;H
(braket
id|i
op_div
l_int|4
)braket
op_lshift_assign
l_int|8
suffix:semicolon
)brace
multiline_comment|/*&n;   *  Re-initialize the context (also zeroizes contents)&n;   */
id|SHA1_Init
c_func
(paren
id|ctx
)paren
suffix:semicolon
)brace
DECL|macro|SHA_ROT
mdefine_line|#define SHA_ROT(X,n) (((X) &lt;&lt; (n)) | ((X) &gt;&gt; (32-(n))))
DECL|function|shaHashBlock
r_static
r_void
id|shaHashBlock
c_func
(paren
id|SHA_CTX
op_star
id|ctx
)paren
(brace
r_int
id|t
suffix:semicolon
r_int
r_int
id|A
comma
id|B
comma
id|C
comma
id|D
comma
id|E
comma
id|TEMP
suffix:semicolon
r_for
c_loop
(paren
id|t
op_assign
l_int|16
suffix:semicolon
id|t
op_le
l_int|79
suffix:semicolon
id|t
op_increment
)paren
id|ctx-&gt;W
(braket
id|t
)braket
op_assign
id|SHA_ROT
c_func
(paren
id|ctx-&gt;W
(braket
id|t
op_minus
l_int|3
)braket
op_xor
id|ctx-&gt;W
(braket
id|t
op_minus
l_int|8
)braket
op_xor
id|ctx-&gt;W
(braket
id|t
op_minus
l_int|14
)braket
op_xor
id|ctx-&gt;W
(braket
id|t
op_minus
l_int|16
)braket
comma
l_int|1
)paren
suffix:semicolon
id|A
op_assign
id|ctx-&gt;H
(braket
l_int|0
)braket
suffix:semicolon
id|B
op_assign
id|ctx-&gt;H
(braket
l_int|1
)braket
suffix:semicolon
id|C
op_assign
id|ctx-&gt;H
(braket
l_int|2
)braket
suffix:semicolon
id|D
op_assign
id|ctx-&gt;H
(braket
l_int|3
)braket
suffix:semicolon
id|E
op_assign
id|ctx-&gt;H
(braket
l_int|4
)braket
suffix:semicolon
r_for
c_loop
(paren
id|t
op_assign
l_int|0
suffix:semicolon
id|t
op_le
l_int|19
suffix:semicolon
id|t
op_increment
)paren
(brace
id|TEMP
op_assign
id|SHA_ROT
c_func
(paren
id|A
comma
l_int|5
)paren
op_plus
(paren
(paren
(paren
id|C
op_xor
id|D
)paren
op_amp
id|B
)paren
op_xor
id|D
)paren
op_plus
id|E
op_plus
id|ctx-&gt;W
(braket
id|t
)braket
op_plus
l_int|0x5a827999
suffix:semicolon
id|E
op_assign
id|D
suffix:semicolon
id|D
op_assign
id|C
suffix:semicolon
id|C
op_assign
id|SHA_ROT
c_func
(paren
id|B
comma
l_int|30
)paren
suffix:semicolon
id|B
op_assign
id|A
suffix:semicolon
id|A
op_assign
id|TEMP
suffix:semicolon
)brace
r_for
c_loop
(paren
id|t
op_assign
l_int|20
suffix:semicolon
id|t
op_le
l_int|39
suffix:semicolon
id|t
op_increment
)paren
(brace
id|TEMP
op_assign
id|SHA_ROT
c_func
(paren
id|A
comma
l_int|5
)paren
op_plus
(paren
id|B
op_xor
id|C
op_xor
id|D
)paren
op_plus
id|E
op_plus
id|ctx-&gt;W
(braket
id|t
)braket
op_plus
l_int|0x6ed9eba1
suffix:semicolon
id|E
op_assign
id|D
suffix:semicolon
id|D
op_assign
id|C
suffix:semicolon
id|C
op_assign
id|SHA_ROT
c_func
(paren
id|B
comma
l_int|30
)paren
suffix:semicolon
id|B
op_assign
id|A
suffix:semicolon
id|A
op_assign
id|TEMP
suffix:semicolon
)brace
r_for
c_loop
(paren
id|t
op_assign
l_int|40
suffix:semicolon
id|t
op_le
l_int|59
suffix:semicolon
id|t
op_increment
)paren
(brace
id|TEMP
op_assign
id|SHA_ROT
c_func
(paren
id|A
comma
l_int|5
)paren
op_plus
(paren
(paren
id|B
op_amp
id|C
)paren
op_or
(paren
id|D
op_amp
(paren
id|B
op_or
id|C
)paren
)paren
)paren
op_plus
id|E
op_plus
id|ctx-&gt;W
(braket
id|t
)braket
op_plus
l_int|0x8f1bbcdc
suffix:semicolon
id|E
op_assign
id|D
suffix:semicolon
id|D
op_assign
id|C
suffix:semicolon
id|C
op_assign
id|SHA_ROT
c_func
(paren
id|B
comma
l_int|30
)paren
suffix:semicolon
id|B
op_assign
id|A
suffix:semicolon
id|A
op_assign
id|TEMP
suffix:semicolon
)brace
r_for
c_loop
(paren
id|t
op_assign
l_int|60
suffix:semicolon
id|t
op_le
l_int|79
suffix:semicolon
id|t
op_increment
)paren
(brace
id|TEMP
op_assign
id|SHA_ROT
c_func
(paren
id|A
comma
l_int|5
)paren
op_plus
(paren
id|B
op_xor
id|C
op_xor
id|D
)paren
op_plus
id|E
op_plus
id|ctx-&gt;W
(braket
id|t
)braket
op_plus
l_int|0xca62c1d6
suffix:semicolon
id|E
op_assign
id|D
suffix:semicolon
id|D
op_assign
id|C
suffix:semicolon
id|C
op_assign
id|SHA_ROT
c_func
(paren
id|B
comma
l_int|30
)paren
suffix:semicolon
id|B
op_assign
id|A
suffix:semicolon
id|A
op_assign
id|TEMP
suffix:semicolon
)brace
id|ctx-&gt;H
(braket
l_int|0
)braket
op_add_assign
id|A
suffix:semicolon
id|ctx-&gt;H
(braket
l_int|1
)braket
op_add_assign
id|B
suffix:semicolon
id|ctx-&gt;H
(braket
l_int|2
)braket
op_add_assign
id|C
suffix:semicolon
id|ctx-&gt;H
(braket
l_int|3
)braket
op_add_assign
id|D
suffix:semicolon
id|ctx-&gt;H
(braket
l_int|4
)braket
op_add_assign
id|E
suffix:semicolon
)brace
eof
