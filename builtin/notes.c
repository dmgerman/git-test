multiline_comment|/*&n; * Builtin &quot;git notes&quot;&n; *&n; * Copyright (c) 2010 Johan Herland &lt;johan@herland.net&gt;&n; *&n; * Based on git-notes.sh by Johannes Schindelin,&n; * and builtin-tag.c by Kristian H&oslash;gsberg and Carlos Rica.&n; */
macro_line|#include &quot;cache.h&quot;
macro_line|#include &quot;builtin.h&quot;
macro_line|#include &quot;notes.h&quot;
macro_line|#include &quot;blob.h&quot;
macro_line|#include &quot;commit.h&quot;
macro_line|#include &quot;refs.h&quot;
macro_line|#include &quot;exec_cmd.h&quot;
macro_line|#include &quot;run-command.h&quot;
macro_line|#include &quot;parse-options.h&quot;
macro_line|#include &quot;string-list.h&quot;
macro_line|#include &quot;notes-merge.h&quot;
DECL|variable|git_notes_usage
r_static
r_const
r_char
op_star
r_const
id|git_notes_usage
(braket
)braket
op_assign
(brace
l_string|&quot;git notes [--ref &lt;notes_ref&gt;] [list [&lt;object&gt;]]&quot;
comma
l_string|&quot;git notes [--ref &lt;notes_ref&gt;] add [-f] [-m &lt;msg&gt; | -F &lt;file&gt; | (-c | -C) &lt;object&gt;] [&lt;object&gt;]&quot;
comma
l_string|&quot;git notes [--ref &lt;notes_ref&gt;] copy [-f] &lt;from-object&gt; &lt;to-object&gt;&quot;
comma
l_string|&quot;git notes [--ref &lt;notes_ref&gt;] append [-m &lt;msg&gt; | -F &lt;file&gt; | (-c | -C) &lt;object&gt;] [&lt;object&gt;]&quot;
comma
l_string|&quot;git notes [--ref &lt;notes_ref&gt;] edit [&lt;object&gt;]&quot;
comma
l_string|&quot;git notes [--ref &lt;notes_ref&gt;] show [&lt;object&gt;]&quot;
comma
l_string|&quot;git notes [--ref &lt;notes_ref&gt;] merge [-v | -q] [-s &lt;strategy&gt; ] &lt;notes_ref&gt;&quot;
comma
l_string|&quot;git notes merge --commit [-v | -q]&quot;
comma
l_string|&quot;git notes merge --abort [-v | -q]&quot;
comma
l_string|&quot;git notes [--ref &lt;notes_ref&gt;] remove [&lt;object&gt;...]&quot;
comma
l_string|&quot;git notes [--ref &lt;notes_ref&gt;] prune [-n | -v]&quot;
comma
l_string|&quot;git notes [--ref &lt;notes_ref&gt;] get-ref&quot;
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|git_notes_list_usage
r_static
r_const
r_char
op_star
r_const
id|git_notes_list_usage
(braket
)braket
op_assign
(brace
l_string|&quot;git notes [list [&lt;object&gt;]]&quot;
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|git_notes_add_usage
r_static
r_const
r_char
op_star
r_const
id|git_notes_add_usage
(braket
)braket
op_assign
(brace
l_string|&quot;git notes add [&lt;options&gt;] [&lt;object&gt;]&quot;
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|git_notes_copy_usage
r_static
r_const
r_char
op_star
r_const
id|git_notes_copy_usage
(braket
)braket
op_assign
(brace
l_string|&quot;git notes copy [&lt;options&gt;] &lt;from-object&gt; &lt;to-object&gt;&quot;
comma
l_string|&quot;git notes copy --stdin [&lt;from-object&gt; &lt;to-object&gt;]...&quot;
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|git_notes_append_usage
r_static
r_const
r_char
op_star
r_const
id|git_notes_append_usage
(braket
)braket
op_assign
(brace
l_string|&quot;git notes append [&lt;options&gt;] [&lt;object&gt;]&quot;
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|git_notes_edit_usage
r_static
r_const
r_char
op_star
r_const
id|git_notes_edit_usage
(braket
)braket
op_assign
(brace
l_string|&quot;git notes edit [&lt;object&gt;]&quot;
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|git_notes_show_usage
r_static
r_const
r_char
op_star
r_const
id|git_notes_show_usage
(braket
)braket
op_assign
(brace
l_string|&quot;git notes show [&lt;object&gt;]&quot;
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|git_notes_merge_usage
r_static
r_const
r_char
op_star
r_const
id|git_notes_merge_usage
(braket
)braket
op_assign
(brace
l_string|&quot;git notes merge [&lt;options&gt;] &lt;notes_ref&gt;&quot;
comma
l_string|&quot;git notes merge --commit [&lt;options&gt;]&quot;
comma
l_string|&quot;git notes merge --abort [&lt;options&gt;]&quot;
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|git_notes_remove_usage
r_static
r_const
r_char
op_star
r_const
id|git_notes_remove_usage
(braket
)braket
op_assign
(brace
l_string|&quot;git notes remove [&lt;object&gt;]&quot;
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|git_notes_prune_usage
r_static
r_const
r_char
op_star
r_const
id|git_notes_prune_usage
(braket
)braket
op_assign
(brace
l_string|&quot;git notes prune [&lt;options&gt;]&quot;
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|git_notes_get_ref_usage
r_static
r_const
r_char
op_star
r_const
id|git_notes_get_ref_usage
(braket
)braket
op_assign
(brace
l_string|&quot;git notes get-ref&quot;
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|note_template
r_static
r_const
r_char
id|note_template
(braket
)braket
op_assign
l_string|&quot;&bslash;n&quot;
l_string|&quot;#&bslash;n&quot;
l_string|&quot;# Write/edit the notes for the following object:&bslash;n&quot;
l_string|&quot;#&bslash;n&quot;
suffix:semicolon
DECL|struct|msg_arg
r_struct
id|msg_arg
(brace
DECL|member|given
r_int
id|given
suffix:semicolon
DECL|member|use_editor
r_int
id|use_editor
suffix:semicolon
DECL|member|buf
r_struct
id|strbuf
id|buf
suffix:semicolon
)brace
suffix:semicolon
DECL|function|list_each_note
r_static
r_int
id|list_each_note
c_func
(paren
r_const
r_int
r_char
op_star
id|object_sha1
comma
r_const
r_int
r_char
op_star
id|note_sha1
comma
r_char
op_star
id|note_path
comma
r_void
op_star
id|cb_data
)paren
(brace
id|printf
c_func
(paren
l_string|&quot;%s %s&bslash;n&quot;
comma
id|sha1_to_hex
c_func
(paren
id|note_sha1
)paren
comma
id|sha1_to_hex
c_func
(paren
id|object_sha1
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|write_note_data
r_static
r_void
id|write_note_data
c_func
(paren
r_int
id|fd
comma
r_const
r_int
r_char
op_star
id|sha1
)paren
(brace
r_int
r_int
id|size
suffix:semicolon
r_enum
id|object_type
id|type
suffix:semicolon
r_char
op_star
id|buf
op_assign
id|read_sha1_file
c_func
(paren
id|sha1
comma
op_amp
id|type
comma
op_amp
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buf
)paren
(brace
r_if
c_cond
(paren
id|size
)paren
id|write_or_die
c_func
(paren
id|fd
comma
id|buf
comma
id|size
)paren
suffix:semicolon
id|free
c_func
(paren
id|buf
)paren
suffix:semicolon
)brace
)brace
DECL|function|write_commented_object
r_static
r_void
id|write_commented_object
c_func
(paren
r_int
id|fd
comma
r_const
r_int
r_char
op_star
id|object
)paren
(brace
r_const
r_char
op_star
id|show_args
(braket
l_int|5
)braket
op_assign
(brace
l_string|&quot;show&quot;
comma
l_string|&quot;--stat&quot;
comma
l_string|&quot;--no-notes&quot;
comma
id|sha1_to_hex
c_func
(paren
id|object
)paren
comma
l_int|NULL
)brace
suffix:semicolon
r_struct
id|child_process
id|show
suffix:semicolon
r_struct
id|strbuf
id|buf
op_assign
id|STRBUF_INIT
suffix:semicolon
id|FILE
op_star
id|show_out
suffix:semicolon
multiline_comment|/* Invoke &quot;git show --stat --no-notes $object&quot; */
id|memset
c_func
(paren
op_amp
id|show
comma
l_int|0
comma
r_sizeof
(paren
id|show
)paren
)paren
suffix:semicolon
id|show.argv
op_assign
id|show_args
suffix:semicolon
id|show.no_stdin
op_assign
l_int|1
suffix:semicolon
id|show.out
op_assign
l_int|1
suffix:semicolon
id|show.err
op_assign
l_int|0
suffix:semicolon
id|show.git_cmd
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|start_command
c_func
(paren
op_amp
id|show
)paren
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;unable to start &squot;show&squot; for object &squot;%s&squot;&quot;
)paren
comma
id|sha1_to_hex
c_func
(paren
id|object
)paren
)paren
suffix:semicolon
multiline_comment|/* Open the output as FILE* so strbuf_getline() can be used. */
id|show_out
op_assign
id|xfdopen
c_func
(paren
id|show.out
comma
l_string|&quot;r&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|show_out
op_eq
l_int|NULL
)paren
id|die_errno
c_func
(paren
id|_
c_func
(paren
l_string|&quot;can&squot;t fdopen &squot;show&squot; output fd&quot;
)paren
)paren
suffix:semicolon
multiline_comment|/* Prepend &quot;# &quot; to each output line and write result to &squot;fd&squot; */
r_while
c_loop
(paren
id|strbuf_getline
c_func
(paren
op_amp
id|buf
comma
id|show_out
comma
l_char|&squot;&bslash;n&squot;
)paren
op_ne
id|EOF
)paren
(brace
id|write_or_die
c_func
(paren
id|fd
comma
l_string|&quot;# &quot;
comma
l_int|2
)paren
suffix:semicolon
id|write_or_die
c_func
(paren
id|fd
comma
id|buf.buf
comma
id|buf.len
)paren
suffix:semicolon
id|write_or_die
c_func
(paren
id|fd
comma
l_string|&quot;&bslash;n&quot;
comma
l_int|1
)paren
suffix:semicolon
)brace
id|strbuf_release
c_func
(paren
op_amp
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fclose
c_func
(paren
id|show_out
)paren
)paren
id|die_errno
c_func
(paren
id|_
c_func
(paren
l_string|&quot;failed to close pipe to &squot;show&squot; for object &squot;%s&squot;&quot;
)paren
comma
id|sha1_to_hex
c_func
(paren
id|object
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|finish_command
c_func
(paren
op_amp
id|show
)paren
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;failed to finish &squot;show&squot; for object &squot;%s&squot;&quot;
)paren
comma
id|sha1_to_hex
c_func
(paren
id|object
)paren
)paren
suffix:semicolon
)brace
DECL|function|create_note
r_static
r_void
id|create_note
c_func
(paren
r_const
r_int
r_char
op_star
id|object
comma
r_struct
id|msg_arg
op_star
id|msg
comma
r_int
id|append_only
comma
r_const
r_int
r_char
op_star
id|prev
comma
r_int
r_char
op_star
id|result
)paren
(brace
r_char
op_star
id|path
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|msg-&gt;use_editor
op_logical_or
op_logical_neg
id|msg-&gt;given
)paren
(brace
r_int
id|fd
suffix:semicolon
multiline_comment|/* write the template message before editing: */
id|path
op_assign
id|git_pathdup
c_func
(paren
l_string|&quot;NOTES_EDITMSG&quot;
)paren
suffix:semicolon
id|fd
op_assign
id|open
c_func
(paren
id|path
comma
id|O_CREAT
op_or
id|O_TRUNC
op_or
id|O_WRONLY
comma
l_int|0600
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fd
OL
l_int|0
)paren
id|die_errno
c_func
(paren
id|_
c_func
(paren
l_string|&quot;could not create file &squot;%s&squot;&quot;
)paren
comma
id|path
)paren
suffix:semicolon
r_if
c_cond
(paren
id|msg-&gt;given
)paren
id|write_or_die
c_func
(paren
id|fd
comma
id|msg-&gt;buf.buf
comma
id|msg-&gt;buf.len
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|prev
op_logical_and
op_logical_neg
id|append_only
)paren
id|write_note_data
c_func
(paren
id|fd
comma
id|prev
)paren
suffix:semicolon
id|write_or_die
c_func
(paren
id|fd
comma
id|note_template
comma
id|strlen
c_func
(paren
id|note_template
)paren
)paren
suffix:semicolon
id|write_commented_object
c_func
(paren
id|fd
comma
id|object
)paren
suffix:semicolon
id|close
c_func
(paren
id|fd
)paren
suffix:semicolon
id|strbuf_reset
c_func
(paren
op_amp
(paren
id|msg-&gt;buf
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|launch_editor
c_func
(paren
id|path
comma
op_amp
(paren
id|msg-&gt;buf
)paren
comma
l_int|NULL
)paren
)paren
(brace
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Please supply the note contents using either -m&quot;
"&bslash;"
l_string|&quot; or -F option&quot;
)paren
)paren
suffix:semicolon
)brace
id|stripspace
c_func
(paren
op_amp
(paren
id|msg-&gt;buf
)paren
comma
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|prev
op_logical_and
id|append_only
)paren
(brace
multiline_comment|/* Append buf to previous note contents */
r_int
r_int
id|size
suffix:semicolon
r_enum
id|object_type
id|type
suffix:semicolon
r_char
op_star
id|prev_buf
op_assign
id|read_sha1_file
c_func
(paren
id|prev
comma
op_amp
id|type
comma
op_amp
id|size
)paren
suffix:semicolon
id|strbuf_grow
c_func
(paren
op_amp
(paren
id|msg-&gt;buf
)paren
comma
id|size
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|msg-&gt;buf.len
op_logical_and
id|prev_buf
op_logical_and
id|size
)paren
id|strbuf_insert
c_func
(paren
op_amp
(paren
id|msg-&gt;buf
)paren
comma
l_int|0
comma
l_string|&quot;&bslash;n&quot;
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prev_buf
op_logical_and
id|size
)paren
id|strbuf_insert
c_func
(paren
op_amp
(paren
id|msg-&gt;buf
)paren
comma
l_int|0
comma
id|prev_buf
comma
id|size
)paren
suffix:semicolon
id|free
c_func
(paren
id|prev_buf
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|msg-&gt;buf.len
)paren
(brace
id|fprintf
c_func
(paren
id|stderr
comma
id|_
c_func
(paren
l_string|&quot;Removing note for object %s&bslash;n&quot;
)paren
comma
id|sha1_to_hex
c_func
(paren
id|object
)paren
)paren
suffix:semicolon
id|hashclr
c_func
(paren
id|result
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|write_sha1_file
c_func
(paren
id|msg-&gt;buf.buf
comma
id|msg-&gt;buf.len
comma
id|blob_type
comma
id|result
)paren
)paren
(brace
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;unable to write note object&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|path
)paren
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;The note contents has been left in %s&quot;
)paren
comma
id|path
)paren
suffix:semicolon
m_exit
(paren
l_int|128
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|path
)paren
(brace
id|unlink_or_warn
c_func
(paren
id|path
)paren
suffix:semicolon
id|free
c_func
(paren
id|path
)paren
suffix:semicolon
)brace
)brace
DECL|function|parse_msg_arg
r_static
r_int
id|parse_msg_arg
c_func
(paren
r_const
r_struct
id|option
op_star
id|opt
comma
r_const
r_char
op_star
id|arg
comma
r_int
id|unset
)paren
(brace
r_struct
id|msg_arg
op_star
id|msg
op_assign
id|opt-&gt;value
suffix:semicolon
id|strbuf_grow
c_func
(paren
op_amp
(paren
id|msg-&gt;buf
)paren
comma
id|strlen
c_func
(paren
id|arg
)paren
op_plus
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|msg-&gt;buf.len
)paren
id|strbuf_addch
c_func
(paren
op_amp
(paren
id|msg-&gt;buf
)paren
comma
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
id|strbuf_addstr
c_func
(paren
op_amp
(paren
id|msg-&gt;buf
)paren
comma
id|arg
)paren
suffix:semicolon
id|stripspace
c_func
(paren
op_amp
(paren
id|msg-&gt;buf
)paren
comma
l_int|0
)paren
suffix:semicolon
id|msg-&gt;given
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|parse_file_arg
r_static
r_int
id|parse_file_arg
c_func
(paren
r_const
r_struct
id|option
op_star
id|opt
comma
r_const
r_char
op_star
id|arg
comma
r_int
id|unset
)paren
(brace
r_struct
id|msg_arg
op_star
id|msg
op_assign
id|opt-&gt;value
suffix:semicolon
r_if
c_cond
(paren
id|msg-&gt;buf.len
)paren
id|strbuf_addch
c_func
(paren
op_amp
(paren
id|msg-&gt;buf
)paren
comma
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|arg
comma
l_string|&quot;-&quot;
)paren
)paren
(brace
r_if
c_cond
(paren
id|strbuf_read
c_func
(paren
op_amp
(paren
id|msg-&gt;buf
)paren
comma
l_int|0
comma
l_int|1024
)paren
OL
l_int|0
)paren
id|die_errno
c_func
(paren
id|_
c_func
(paren
l_string|&quot;cannot read &squot;%s&squot;&quot;
)paren
comma
id|arg
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|strbuf_read_file
c_func
(paren
op_amp
(paren
id|msg-&gt;buf
)paren
comma
id|arg
comma
l_int|1024
)paren
OL
l_int|0
)paren
id|die_errno
c_func
(paren
id|_
c_func
(paren
l_string|&quot;could not open or read &squot;%s&squot;&quot;
)paren
comma
id|arg
)paren
suffix:semicolon
id|stripspace
c_func
(paren
op_amp
(paren
id|msg-&gt;buf
)paren
comma
l_int|0
)paren
suffix:semicolon
id|msg-&gt;given
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|parse_reuse_arg
r_static
r_int
id|parse_reuse_arg
c_func
(paren
r_const
r_struct
id|option
op_star
id|opt
comma
r_const
r_char
op_star
id|arg
comma
r_int
id|unset
)paren
(brace
r_struct
id|msg_arg
op_star
id|msg
op_assign
id|opt-&gt;value
suffix:semicolon
r_char
op_star
id|buf
suffix:semicolon
r_int
r_char
id|object
(braket
l_int|20
)braket
suffix:semicolon
r_enum
id|object_type
id|type
suffix:semicolon
r_int
r_int
id|len
suffix:semicolon
r_if
c_cond
(paren
id|msg-&gt;buf.len
)paren
id|strbuf_addch
c_func
(paren
op_amp
(paren
id|msg-&gt;buf
)paren
comma
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|get_sha1
c_func
(paren
id|arg
comma
id|object
)paren
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Failed to resolve &squot;%s&squot; as a valid ref.&quot;
)paren
comma
id|arg
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|buf
op_assign
id|read_sha1_file
c_func
(paren
id|object
comma
op_amp
id|type
comma
op_amp
id|len
)paren
)paren
op_logical_or
op_logical_neg
id|len
)paren
(brace
id|free
c_func
(paren
id|buf
)paren
suffix:semicolon
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Failed to read object &squot;%s&squot;.&quot;
)paren
comma
id|arg
)paren
suffix:semicolon
suffix:semicolon
)brace
id|strbuf_add
c_func
(paren
op_amp
(paren
id|msg-&gt;buf
)paren
comma
id|buf
comma
id|len
)paren
suffix:semicolon
id|free
c_func
(paren
id|buf
)paren
suffix:semicolon
id|msg-&gt;given
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|parse_reedit_arg
r_static
r_int
id|parse_reedit_arg
c_func
(paren
r_const
r_struct
id|option
op_star
id|opt
comma
r_const
r_char
op_star
id|arg
comma
r_int
id|unset
)paren
(brace
r_struct
id|msg_arg
op_star
id|msg
op_assign
id|opt-&gt;value
suffix:semicolon
id|msg-&gt;use_editor
op_assign
l_int|1
suffix:semicolon
r_return
id|parse_reuse_arg
c_func
(paren
id|opt
comma
id|arg
comma
id|unset
)paren
suffix:semicolon
)brace
DECL|function|commit_notes
r_void
id|commit_notes
c_func
(paren
r_struct
id|notes_tree
op_star
id|t
comma
r_const
r_char
op_star
id|msg
)paren
(brace
r_struct
id|strbuf
id|buf
op_assign
id|STRBUF_INIT
suffix:semicolon
r_int
r_char
id|commit_sha1
(braket
l_int|20
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|t
)paren
id|t
op_assign
op_amp
id|default_notes_tree
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|t-&gt;initialized
op_logical_or
op_logical_neg
id|t-&gt;ref
op_logical_or
op_logical_neg
op_star
id|t-&gt;ref
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Cannot commit uninitialized/unreferenced notes tree&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|t-&gt;dirty
)paren
r_return
suffix:semicolon
multiline_comment|/* don&squot;t have to commit an unchanged tree */
multiline_comment|/* Prepare commit message and reflog message */
id|strbuf_addstr
c_func
(paren
op_amp
id|buf
comma
id|msg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buf.buf
(braket
id|buf.len
l_int|1
)braket
op_ne
l_char|&squot;&bslash;n&squot;
)paren
id|strbuf_addch
c_func
(paren
op_amp
id|buf
comma
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
multiline_comment|/* Make sure msg ends with newline */
id|create_notes_commit
c_func
(paren
id|t
comma
l_int|NULL
comma
op_amp
id|buf
comma
id|commit_sha1
)paren
suffix:semicolon
id|strbuf_insert
c_func
(paren
op_amp
id|buf
comma
l_int|0
comma
l_string|&quot;notes: &quot;
comma
l_int|7
)paren
suffix:semicolon
multiline_comment|/* commit message starts at index 7 */
id|update_ref
c_func
(paren
id|buf.buf
comma
id|t-&gt;ref
comma
id|commit_sha1
comma
l_int|NULL
comma
l_int|0
comma
id|DIE_ON_ERR
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|buf
)paren
suffix:semicolon
)brace
DECL|function|parse_combine_notes_fn
id|combine_notes_fn
id|parse_combine_notes_fn
c_func
(paren
r_const
r_char
op_star
id|v
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcasecmp
c_func
(paren
id|v
comma
l_string|&quot;overwrite&quot;
)paren
)paren
r_return
id|combine_notes_overwrite
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcasecmp
c_func
(paren
id|v
comma
l_string|&quot;ignore&quot;
)paren
)paren
r_return
id|combine_notes_ignore
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcasecmp
c_func
(paren
id|v
comma
l_string|&quot;concatenate&quot;
)paren
)paren
r_return
id|combine_notes_concatenate
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcasecmp
c_func
(paren
id|v
comma
l_string|&quot;cat_sort_uniq&quot;
)paren
)paren
r_return
id|combine_notes_cat_sort_uniq
suffix:semicolon
r_else
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|notes_rewrite_config
r_static
r_int
id|notes_rewrite_config
c_func
(paren
r_const
r_char
op_star
id|k
comma
r_const
r_char
op_star
id|v
comma
r_void
op_star
id|cb
)paren
(brace
r_struct
id|notes_rewrite_cfg
op_star
id|c
op_assign
id|cb
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|prefixcmp
c_func
(paren
id|k
comma
l_string|&quot;notes.rewrite.&quot;
)paren
op_logical_and
op_logical_neg
id|strcmp
c_func
(paren
id|k
op_plus
l_int|14
comma
id|c-&gt;cmd
)paren
)paren
(brace
id|c-&gt;enabled
op_assign
id|git_config_bool
c_func
(paren
id|k
comma
id|v
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|c-&gt;mode_from_env
op_logical_and
op_logical_neg
id|strcmp
c_func
(paren
id|k
comma
l_string|&quot;notes.rewritemode&quot;
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|v
)paren
id|config_error_nonbool
c_func
(paren
id|k
)paren
suffix:semicolon
id|c-&gt;combine
op_assign
id|parse_combine_notes_fn
c_func
(paren
id|v
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|c-&gt;combine
)paren
(brace
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Bad notes.rewriteMode value: &squot;%s&squot;&quot;
)paren
comma
id|v
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|c-&gt;refs_from_env
op_logical_and
op_logical_neg
id|strcmp
c_func
(paren
id|k
comma
l_string|&quot;notes.rewriteref&quot;
)paren
)paren
(brace
multiline_comment|/* note that a refs/ prefix is implied in the&n;&t;&t; * underlying for_each_glob_ref */
r_if
c_cond
(paren
op_logical_neg
id|prefixcmp
c_func
(paren
id|v
comma
l_string|&quot;refs/notes/&quot;
)paren
)paren
id|string_list_add_refs_by_glob
c_func
(paren
id|c-&gt;refs
comma
id|v
)paren
suffix:semicolon
r_else
id|warning
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Refusing to rewrite notes in %s&quot;
l_string|&quot; (outside of refs/notes/)&quot;
)paren
comma
id|v
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|init_copy_notes_for_rewrite
r_struct
id|notes_rewrite_cfg
op_star
id|init_copy_notes_for_rewrite
c_func
(paren
r_const
r_char
op_star
id|cmd
)paren
(brace
r_struct
id|notes_rewrite_cfg
op_star
id|c
op_assign
id|xmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|notes_rewrite_cfg
)paren
)paren
suffix:semicolon
r_const
r_char
op_star
id|rewrite_mode_env
op_assign
id|getenv
c_func
(paren
id|GIT_NOTES_REWRITE_MODE_ENVIRONMENT
)paren
suffix:semicolon
r_const
r_char
op_star
id|rewrite_refs_env
op_assign
id|getenv
c_func
(paren
id|GIT_NOTES_REWRITE_REF_ENVIRONMENT
)paren
suffix:semicolon
id|c-&gt;cmd
op_assign
id|cmd
suffix:semicolon
id|c-&gt;enabled
op_assign
l_int|1
suffix:semicolon
id|c-&gt;combine
op_assign
id|combine_notes_concatenate
suffix:semicolon
id|c-&gt;refs
op_assign
id|xcalloc
c_func
(paren
l_int|1
comma
r_sizeof
(paren
r_struct
id|string_list
)paren
)paren
suffix:semicolon
id|c-&gt;refs-&gt;strdup_strings
op_assign
l_int|1
suffix:semicolon
id|c-&gt;refs_from_env
op_assign
l_int|0
suffix:semicolon
id|c-&gt;mode_from_env
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|rewrite_mode_env
)paren
(brace
id|c-&gt;mode_from_env
op_assign
l_int|1
suffix:semicolon
id|c-&gt;combine
op_assign
id|parse_combine_notes_fn
c_func
(paren
id|rewrite_mode_env
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|c-&gt;combine
)paren
multiline_comment|/* TRANSLATORS: The first %s is the name of the&n;&t;&t;&t;   environment variable, the second %s is its value */
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Bad %s value: &squot;%s&squot;&quot;
)paren
comma
id|GIT_NOTES_REWRITE_MODE_ENVIRONMENT
comma
id|rewrite_mode_env
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|rewrite_refs_env
)paren
(brace
id|c-&gt;refs_from_env
op_assign
l_int|1
suffix:semicolon
id|string_list_add_refs_from_colon_sep
c_func
(paren
id|c-&gt;refs
comma
id|rewrite_refs_env
)paren
suffix:semicolon
)brace
id|git_config
c_func
(paren
id|notes_rewrite_config
comma
id|c
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|c-&gt;enabled
op_logical_or
op_logical_neg
id|c-&gt;refs-&gt;nr
)paren
(brace
id|string_list_clear
c_func
(paren
id|c-&gt;refs
comma
l_int|0
)paren
suffix:semicolon
id|free
c_func
(paren
id|c-&gt;refs
)paren
suffix:semicolon
id|free
c_func
(paren
id|c
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
id|c-&gt;trees
op_assign
id|load_notes_trees
c_func
(paren
id|c-&gt;refs
)paren
suffix:semicolon
id|string_list_clear
c_func
(paren
id|c-&gt;refs
comma
l_int|0
)paren
suffix:semicolon
id|free
c_func
(paren
id|c-&gt;refs
)paren
suffix:semicolon
r_return
id|c
suffix:semicolon
)brace
DECL|function|copy_note_for_rewrite
r_int
id|copy_note_for_rewrite
c_func
(paren
r_struct
id|notes_rewrite_cfg
op_star
id|c
comma
r_const
r_int
r_char
op_star
id|from_obj
comma
r_const
r_int
r_char
op_star
id|to_obj
)paren
(brace
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|c-&gt;trees
(braket
id|i
)braket
suffix:semicolon
id|i
op_increment
)paren
id|ret
op_assign
id|copy_note
c_func
(paren
id|c-&gt;trees
(braket
id|i
)braket
comma
id|from_obj
comma
id|to_obj
comma
l_int|1
comma
id|c-&gt;combine
)paren
op_logical_or
id|ret
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|finish_copy_notes_for_rewrite
r_void
id|finish_copy_notes_for_rewrite
c_func
(paren
r_struct
id|notes_rewrite_cfg
op_star
id|c
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|c-&gt;trees
(braket
id|i
)braket
suffix:semicolon
id|i
op_increment
)paren
(brace
id|commit_notes
c_func
(paren
id|c-&gt;trees
(braket
id|i
)braket
comma
l_string|&quot;Notes added by &squot;git notes copy&squot;&quot;
)paren
suffix:semicolon
id|free_notes
c_func
(paren
id|c-&gt;trees
(braket
id|i
)braket
)paren
suffix:semicolon
)brace
id|free
c_func
(paren
id|c-&gt;trees
)paren
suffix:semicolon
id|free
c_func
(paren
id|c
)paren
suffix:semicolon
)brace
DECL|function|notes_copy_from_stdin
r_static
r_int
id|notes_copy_from_stdin
c_func
(paren
r_int
id|force
comma
r_const
r_char
op_star
id|rewrite_cmd
)paren
(brace
r_struct
id|strbuf
id|buf
op_assign
id|STRBUF_INIT
suffix:semicolon
r_struct
id|notes_rewrite_cfg
op_star
id|c
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|notes_tree
op_star
id|t
op_assign
l_int|NULL
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|rewrite_cmd
)paren
(brace
id|c
op_assign
id|init_copy_notes_for_rewrite
c_func
(paren
id|rewrite_cmd
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|c
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_else
(brace
id|init_notes
c_func
(paren
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|t
op_assign
op_amp
id|default_notes_tree
suffix:semicolon
)brace
r_while
c_loop
(paren
id|strbuf_getline
c_func
(paren
op_amp
id|buf
comma
id|stdin
comma
l_char|&squot;&bslash;n&squot;
)paren
op_ne
id|EOF
)paren
(brace
r_int
r_char
id|from_obj
(braket
l_int|20
)braket
comma
id|to_obj
(braket
l_int|20
)braket
suffix:semicolon
r_struct
id|strbuf
op_star
op_star
id|split
suffix:semicolon
r_int
id|err
suffix:semicolon
id|split
op_assign
id|strbuf_split
c_func
(paren
op_amp
id|buf
comma
l_char|&squot; &squot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|split
(braket
l_int|0
)braket
op_logical_or
op_logical_neg
id|split
(braket
l_int|1
)braket
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Malformed input line: &squot;%s&squot;.&quot;
)paren
comma
id|buf.buf
)paren
suffix:semicolon
id|strbuf_rtrim
c_func
(paren
id|split
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|strbuf_rtrim
c_func
(paren
id|split
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|get_sha1
c_func
(paren
id|split
(braket
l_int|0
)braket
op_member_access_from_pointer
id|buf
comma
id|from_obj
)paren
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Failed to resolve &squot;%s&squot; as a valid ref.&quot;
)paren
comma
id|split
(braket
l_int|0
)braket
op_member_access_from_pointer
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|get_sha1
c_func
(paren
id|split
(braket
l_int|1
)braket
op_member_access_from_pointer
id|buf
comma
id|to_obj
)paren
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Failed to resolve &squot;%s&squot; as a valid ref.&quot;
)paren
comma
id|split
(braket
l_int|1
)braket
op_member_access_from_pointer
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rewrite_cmd
)paren
id|err
op_assign
id|copy_note_for_rewrite
c_func
(paren
id|c
comma
id|from_obj
comma
id|to_obj
)paren
suffix:semicolon
r_else
id|err
op_assign
id|copy_note
c_func
(paren
id|t
comma
id|from_obj
comma
id|to_obj
comma
id|force
comma
id|combine_notes_overwrite
)paren
suffix:semicolon
r_if
c_cond
(paren
id|err
)paren
(brace
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Failed to copy notes from &squot;%s&squot; to &squot;%s&squot;&quot;
)paren
comma
id|split
(braket
l_int|0
)braket
op_member_access_from_pointer
id|buf
comma
id|split
(braket
l_int|1
)braket
op_member_access_from_pointer
id|buf
)paren
suffix:semicolon
id|ret
op_assign
l_int|1
suffix:semicolon
)brace
id|strbuf_list_free
c_func
(paren
id|split
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|rewrite_cmd
)paren
(brace
id|commit_notes
c_func
(paren
id|t
comma
l_string|&quot;Notes added by &squot;git notes copy&squot;&quot;
)paren
suffix:semicolon
id|free_notes
c_func
(paren
id|t
)paren
suffix:semicolon
)brace
r_else
(brace
id|finish_copy_notes_for_rewrite
c_func
(paren
id|c
)paren
suffix:semicolon
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|function|init_notes_check
r_static
r_struct
id|notes_tree
op_star
id|init_notes_check
c_func
(paren
r_const
r_char
op_star
id|subcommand
)paren
(brace
r_struct
id|notes_tree
op_star
id|t
suffix:semicolon
id|init_notes
c_func
(paren
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|0
)paren
suffix:semicolon
id|t
op_assign
op_amp
id|default_notes_tree
suffix:semicolon
r_if
c_cond
(paren
id|prefixcmp
c_func
(paren
id|t-&gt;ref
comma
l_string|&quot;refs/notes/&quot;
)paren
)paren
id|die
c_func
(paren
l_string|&quot;Refusing to %s notes in %s (outside of refs/notes/)&quot;
comma
id|subcommand
comma
id|t-&gt;ref
)paren
suffix:semicolon
r_return
id|t
suffix:semicolon
)brace
DECL|function|list
r_static
r_int
id|list
c_func
(paren
r_int
id|argc
comma
r_const
r_char
op_star
op_star
id|argv
comma
r_const
r_char
op_star
id|prefix
)paren
(brace
r_struct
id|notes_tree
op_star
id|t
suffix:semicolon
r_int
r_char
id|object
(braket
l_int|20
)braket
suffix:semicolon
r_const
r_int
r_char
op_star
id|note
suffix:semicolon
r_int
id|retval
op_assign
l_int|1
suffix:semicolon
r_struct
id|option
id|options
(braket
)braket
op_assign
(brace
id|OPT_END
c_func
(paren
)paren
)brace
suffix:semicolon
r_if
c_cond
(paren
id|argc
)paren
id|argc
op_assign
id|parse_options
c_func
(paren
id|argc
comma
id|argv
comma
id|prefix
comma
id|options
comma
id|git_notes_list_usage
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|1
OL
id|argc
)paren
(brace
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;too many parameters&quot;
)paren
)paren
suffix:semicolon
id|usage_with_options
c_func
(paren
id|git_notes_list_usage
comma
id|options
)paren
suffix:semicolon
)brace
id|t
op_assign
id|init_notes_check
c_func
(paren
l_string|&quot;list&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|argc
)paren
(brace
r_if
c_cond
(paren
id|get_sha1
c_func
(paren
id|argv
(braket
l_int|0
)braket
comma
id|object
)paren
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Failed to resolve &squot;%s&squot; as a valid ref.&quot;
)paren
comma
id|argv
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|note
op_assign
id|get_note
c_func
(paren
id|t
comma
id|object
)paren
suffix:semicolon
r_if
c_cond
(paren
id|note
)paren
(brace
id|puts
c_func
(paren
id|sha1_to_hex
c_func
(paren
id|note
)paren
)paren
suffix:semicolon
id|retval
op_assign
l_int|0
suffix:semicolon
)brace
r_else
id|retval
op_assign
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;No note found for object %s.&quot;
)paren
comma
id|sha1_to_hex
c_func
(paren
id|object
)paren
)paren
suffix:semicolon
)brace
r_else
id|retval
op_assign
id|for_each_note
c_func
(paren
id|t
comma
l_int|0
comma
id|list_each_note
comma
l_int|NULL
)paren
suffix:semicolon
id|free_notes
c_func
(paren
id|t
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
r_static
r_int
id|append_edit
c_func
(paren
r_int
id|argc
comma
r_const
r_char
op_star
op_star
id|argv
comma
r_const
r_char
op_star
id|prefix
)paren
suffix:semicolon
DECL|function|add
r_static
r_int
id|add
c_func
(paren
r_int
id|argc
comma
r_const
r_char
op_star
op_star
id|argv
comma
r_const
r_char
op_star
id|prefix
)paren
(brace
r_int
id|retval
op_assign
l_int|0
comma
id|force
op_assign
l_int|0
suffix:semicolon
r_const
r_char
op_star
id|object_ref
suffix:semicolon
r_struct
id|notes_tree
op_star
id|t
suffix:semicolon
r_int
r_char
id|object
(braket
l_int|20
)braket
comma
id|new_note
(braket
l_int|20
)braket
suffix:semicolon
r_char
id|logmsg
(braket
l_int|100
)braket
suffix:semicolon
r_const
r_int
r_char
op_star
id|note
suffix:semicolon
r_struct
id|msg_arg
id|msg
op_assign
(brace
l_int|0
comma
l_int|0
comma
id|STRBUF_INIT
)brace
suffix:semicolon
r_struct
id|option
id|options
(braket
)braket
op_assign
(brace
(brace
id|OPTION_CALLBACK
comma
l_char|&squot;m&squot;
comma
l_string|&quot;message&quot;
comma
op_amp
id|msg
comma
l_string|&quot;msg&quot;
comma
l_string|&quot;note contents as a string&quot;
comma
id|PARSE_OPT_NONEG
comma
id|parse_msg_arg
)brace
comma
(brace
id|OPTION_CALLBACK
comma
l_char|&squot;F&squot;
comma
l_string|&quot;file&quot;
comma
op_amp
id|msg
comma
l_string|&quot;file&quot;
comma
l_string|&quot;note contents in a file&quot;
comma
id|PARSE_OPT_NONEG
comma
id|parse_file_arg
)brace
comma
(brace
id|OPTION_CALLBACK
comma
l_char|&squot;c&squot;
comma
l_string|&quot;reedit-message&quot;
comma
op_amp
id|msg
comma
l_string|&quot;object&quot;
comma
l_string|&quot;reuse and edit specified note object&quot;
comma
id|PARSE_OPT_NONEG
comma
id|parse_reedit_arg
)brace
comma
(brace
id|OPTION_CALLBACK
comma
l_char|&squot;C&squot;
comma
l_string|&quot;reuse-message&quot;
comma
op_amp
id|msg
comma
l_string|&quot;object&quot;
comma
l_string|&quot;reuse specified note object&quot;
comma
id|PARSE_OPT_NONEG
comma
id|parse_reuse_arg
)brace
comma
id|OPT__FORCE
c_func
(paren
op_amp
id|force
comma
l_string|&quot;replace existing notes&quot;
)paren
comma
id|OPT_END
c_func
(paren
)paren
)brace
suffix:semicolon
id|argc
op_assign
id|parse_options
c_func
(paren
id|argc
comma
id|argv
comma
id|prefix
comma
id|options
comma
id|git_notes_add_usage
comma
id|PARSE_OPT_KEEP_ARGV0
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|2
OL
id|argc
)paren
(brace
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;too many parameters&quot;
)paren
)paren
suffix:semicolon
id|usage_with_options
c_func
(paren
id|git_notes_add_usage
comma
id|options
)paren
suffix:semicolon
)brace
id|object_ref
op_assign
id|argc
OG
l_int|1
ques
c_cond
id|argv
(braket
l_int|1
)braket
suffix:colon
l_string|&quot;HEAD&quot;
suffix:semicolon
r_if
c_cond
(paren
id|get_sha1
c_func
(paren
id|object_ref
comma
id|object
)paren
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Failed to resolve &squot;%s&squot; as a valid ref.&quot;
)paren
comma
id|object_ref
)paren
suffix:semicolon
id|t
op_assign
id|init_notes_check
c_func
(paren
l_string|&quot;add&quot;
)paren
suffix:semicolon
id|note
op_assign
id|get_note
c_func
(paren
id|t
comma
id|object
)paren
suffix:semicolon
r_if
c_cond
(paren
id|note
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|force
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|msg.given
)paren
(brace
multiline_comment|/*&n;&t;&t;&t;&t; * Redirect to &quot;edit&quot; subcommand.&n;&t;&t;&t;&t; *&n;&t;&t;&t;&t; * We only end up here if none of -m/-F/-c/-C&n;&t;&t;&t;&t; * or -f are given. The original args are&n;&t;&t;&t;&t; * therefore still in argv[0-1].&n;&t;&t;&t;&t; */
id|argv
(braket
l_int|0
)braket
op_assign
l_string|&quot;edit&quot;
suffix:semicolon
id|free_notes
c_func
(paren
id|t
)paren
suffix:semicolon
r_return
id|append_edit
c_func
(paren
id|argc
comma
id|argv
comma
id|prefix
)paren
suffix:semicolon
)brace
id|retval
op_assign
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Cannot add notes. Found existing notes &quot;
l_string|&quot;for object %s. Use &squot;-f&squot; to overwrite &quot;
l_string|&quot;existing notes&quot;
)paren
comma
id|sha1_to_hex
c_func
(paren
id|object
)paren
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|fprintf
c_func
(paren
id|stderr
comma
id|_
c_func
(paren
l_string|&quot;Overwriting existing notes for object %s&bslash;n&quot;
)paren
comma
id|sha1_to_hex
c_func
(paren
id|object
)paren
)paren
suffix:semicolon
)brace
id|create_note
c_func
(paren
id|object
comma
op_amp
id|msg
comma
l_int|0
comma
id|note
comma
id|new_note
)paren
suffix:semicolon
r_if
c_cond
(paren
id|is_null_sha1
c_func
(paren
id|new_note
)paren
)paren
id|remove_note
c_func
(paren
id|t
comma
id|object
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|add_note
c_func
(paren
id|t
comma
id|object
comma
id|new_note
comma
id|combine_notes_overwrite
)paren
)paren
id|die
c_func
(paren
l_string|&quot;BUG: combine_notes_overwrite failed&quot;
)paren
suffix:semicolon
id|snprintf
c_func
(paren
id|logmsg
comma
r_sizeof
(paren
id|logmsg
)paren
comma
l_string|&quot;Notes %s by &squot;git notes %s&squot;&quot;
comma
id|is_null_sha1
c_func
(paren
id|new_note
)paren
ques
c_cond
l_string|&quot;removed&quot;
suffix:colon
l_string|&quot;added&quot;
comma
l_string|&quot;add&quot;
)paren
suffix:semicolon
id|commit_notes
c_func
(paren
id|t
comma
id|logmsg
)paren
suffix:semicolon
id|out
suffix:colon
id|free_notes
c_func
(paren
id|t
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
(paren
id|msg.buf
)paren
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|copy
r_static
r_int
id|copy
c_func
(paren
r_int
id|argc
comma
r_const
r_char
op_star
op_star
id|argv
comma
r_const
r_char
op_star
id|prefix
)paren
(brace
r_int
id|retval
op_assign
l_int|0
comma
id|force
op_assign
l_int|0
comma
id|from_stdin
op_assign
l_int|0
suffix:semicolon
r_const
r_int
r_char
op_star
id|from_note
comma
op_star
id|note
suffix:semicolon
r_const
r_char
op_star
id|object_ref
suffix:semicolon
r_int
r_char
id|object
(braket
l_int|20
)braket
comma
id|from_obj
(braket
l_int|20
)braket
suffix:semicolon
r_struct
id|notes_tree
op_star
id|t
suffix:semicolon
r_const
r_char
op_star
id|rewrite_cmd
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|option
id|options
(braket
)braket
op_assign
(brace
id|OPT__FORCE
c_func
(paren
op_amp
id|force
comma
l_string|&quot;replace existing notes&quot;
)paren
comma
id|OPT_BOOLEAN
c_func
(paren
l_int|0
comma
l_string|&quot;stdin&quot;
comma
op_amp
id|from_stdin
comma
l_string|&quot;read objects from stdin&quot;
)paren
comma
id|OPT_STRING
c_func
(paren
l_int|0
comma
l_string|&quot;for-rewrite&quot;
comma
op_amp
id|rewrite_cmd
comma
l_string|&quot;command&quot;
comma
l_string|&quot;load rewriting config for &lt;command&gt; (implies &quot;
l_string|&quot;--stdin)&quot;
)paren
comma
id|OPT_END
c_func
(paren
)paren
)brace
suffix:semicolon
id|argc
op_assign
id|parse_options
c_func
(paren
id|argc
comma
id|argv
comma
id|prefix
comma
id|options
comma
id|git_notes_copy_usage
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|from_stdin
op_logical_or
id|rewrite_cmd
)paren
(brace
r_if
c_cond
(paren
id|argc
)paren
(brace
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;too many parameters&quot;
)paren
)paren
suffix:semicolon
id|usage_with_options
c_func
(paren
id|git_notes_copy_usage
comma
id|options
)paren
suffix:semicolon
)brace
r_else
(brace
r_return
id|notes_copy_from_stdin
c_func
(paren
id|force
comma
id|rewrite_cmd
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|argc
OL
l_int|2
)paren
(brace
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;too few parameters&quot;
)paren
)paren
suffix:semicolon
id|usage_with_options
c_func
(paren
id|git_notes_copy_usage
comma
id|options
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
l_int|2
OL
id|argc
)paren
(brace
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;too many parameters&quot;
)paren
)paren
suffix:semicolon
id|usage_with_options
c_func
(paren
id|git_notes_copy_usage
comma
id|options
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|get_sha1
c_func
(paren
id|argv
(braket
l_int|0
)braket
comma
id|from_obj
)paren
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Failed to resolve &squot;%s&squot; as a valid ref.&quot;
)paren
comma
id|argv
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|object_ref
op_assign
l_int|1
OL
id|argc
ques
c_cond
id|argv
(braket
l_int|1
)braket
suffix:colon
l_string|&quot;HEAD&quot;
suffix:semicolon
r_if
c_cond
(paren
id|get_sha1
c_func
(paren
id|object_ref
comma
id|object
)paren
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Failed to resolve &squot;%s&squot; as a valid ref.&quot;
)paren
comma
id|object_ref
)paren
suffix:semicolon
id|t
op_assign
id|init_notes_check
c_func
(paren
l_string|&quot;copy&quot;
)paren
suffix:semicolon
id|note
op_assign
id|get_note
c_func
(paren
id|t
comma
id|object
)paren
suffix:semicolon
r_if
c_cond
(paren
id|note
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|force
)paren
(brace
id|retval
op_assign
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Cannot copy notes. Found existing &quot;
l_string|&quot;notes for object %s. Use &squot;-f&squot; to &quot;
l_string|&quot;overwrite existing notes&quot;
)paren
comma
id|sha1_to_hex
c_func
(paren
id|object
)paren
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
id|fprintf
c_func
(paren
id|stderr
comma
id|_
c_func
(paren
l_string|&quot;Overwriting existing notes for object %s&bslash;n&quot;
)paren
comma
id|sha1_to_hex
c_func
(paren
id|object
)paren
)paren
suffix:semicolon
)brace
id|from_note
op_assign
id|get_note
c_func
(paren
id|t
comma
id|from_obj
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|from_note
)paren
(brace
id|retval
op_assign
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Missing notes on source object %s. Cannot &quot;
l_string|&quot;copy.&quot;
)paren
comma
id|sha1_to_hex
c_func
(paren
id|from_obj
)paren
)paren
suffix:semicolon
r_goto
id|out
suffix:semicolon
)brace
r_if
c_cond
(paren
id|add_note
c_func
(paren
id|t
comma
id|object
comma
id|from_note
comma
id|combine_notes_overwrite
)paren
)paren
id|die
c_func
(paren
l_string|&quot;BUG: combine_notes_overwrite failed&quot;
)paren
suffix:semicolon
id|commit_notes
c_func
(paren
id|t
comma
l_string|&quot;Notes added by &squot;git notes copy&squot;&quot;
)paren
suffix:semicolon
id|out
suffix:colon
id|free_notes
c_func
(paren
id|t
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|append_edit
r_static
r_int
id|append_edit
c_func
(paren
r_int
id|argc
comma
r_const
r_char
op_star
op_star
id|argv
comma
r_const
r_char
op_star
id|prefix
)paren
(brace
r_const
r_char
op_star
id|object_ref
suffix:semicolon
r_struct
id|notes_tree
op_star
id|t
suffix:semicolon
r_int
r_char
id|object
(braket
l_int|20
)braket
comma
id|new_note
(braket
l_int|20
)braket
suffix:semicolon
r_const
r_int
r_char
op_star
id|note
suffix:semicolon
r_char
id|logmsg
(braket
l_int|100
)braket
suffix:semicolon
r_const
r_char
op_star
r_const
op_star
id|usage
suffix:semicolon
r_struct
id|msg_arg
id|msg
op_assign
(brace
l_int|0
comma
l_int|0
comma
id|STRBUF_INIT
)brace
suffix:semicolon
r_struct
id|option
id|options
(braket
)braket
op_assign
(brace
(brace
id|OPTION_CALLBACK
comma
l_char|&squot;m&squot;
comma
l_string|&quot;message&quot;
comma
op_amp
id|msg
comma
l_string|&quot;msg&quot;
comma
l_string|&quot;note contents as a string&quot;
comma
id|PARSE_OPT_NONEG
comma
id|parse_msg_arg
)brace
comma
(brace
id|OPTION_CALLBACK
comma
l_char|&squot;F&squot;
comma
l_string|&quot;file&quot;
comma
op_amp
id|msg
comma
l_string|&quot;file&quot;
comma
l_string|&quot;note contents in a file&quot;
comma
id|PARSE_OPT_NONEG
comma
id|parse_file_arg
)brace
comma
(brace
id|OPTION_CALLBACK
comma
l_char|&squot;c&squot;
comma
l_string|&quot;reedit-message&quot;
comma
op_amp
id|msg
comma
l_string|&quot;object&quot;
comma
l_string|&quot;reuse and edit specified note object&quot;
comma
id|PARSE_OPT_NONEG
comma
id|parse_reedit_arg
)brace
comma
(brace
id|OPTION_CALLBACK
comma
l_char|&squot;C&squot;
comma
l_string|&quot;reuse-message&quot;
comma
op_amp
id|msg
comma
l_string|&quot;object&quot;
comma
l_string|&quot;reuse specified note object&quot;
comma
id|PARSE_OPT_NONEG
comma
id|parse_reuse_arg
)brace
comma
id|OPT_END
c_func
(paren
)paren
)brace
suffix:semicolon
r_int
id|edit
op_assign
op_logical_neg
id|strcmp
c_func
(paren
id|argv
(braket
l_int|0
)braket
comma
l_string|&quot;edit&quot;
)paren
suffix:semicolon
id|usage
op_assign
id|edit
ques
c_cond
id|git_notes_edit_usage
suffix:colon
id|git_notes_append_usage
suffix:semicolon
id|argc
op_assign
id|parse_options
c_func
(paren
id|argc
comma
id|argv
comma
id|prefix
comma
id|options
comma
id|usage
comma
id|PARSE_OPT_KEEP_ARGV0
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|2
OL
id|argc
)paren
(brace
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;too many parameters&quot;
)paren
)paren
suffix:semicolon
id|usage_with_options
c_func
(paren
id|usage
comma
id|options
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|msg.given
op_logical_and
id|edit
)paren
id|fprintf
c_func
(paren
id|stderr
comma
id|_
c_func
(paren
l_string|&quot;The -m/-F/-c/-C options have been deprecated &quot;
l_string|&quot;for the &squot;edit&squot; subcommand.&bslash;n&quot;
l_string|&quot;Please use &squot;git notes add -f -m/-F/-c/-C&squot; instead.&bslash;n&quot;
)paren
)paren
suffix:semicolon
id|object_ref
op_assign
l_int|1
OL
id|argc
ques
c_cond
id|argv
(braket
l_int|1
)braket
suffix:colon
l_string|&quot;HEAD&quot;
suffix:semicolon
r_if
c_cond
(paren
id|get_sha1
c_func
(paren
id|object_ref
comma
id|object
)paren
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Failed to resolve &squot;%s&squot; as a valid ref.&quot;
)paren
comma
id|object_ref
)paren
suffix:semicolon
id|t
op_assign
id|init_notes_check
c_func
(paren
id|argv
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|note
op_assign
id|get_note
c_func
(paren
id|t
comma
id|object
)paren
suffix:semicolon
id|create_note
c_func
(paren
id|object
comma
op_amp
id|msg
comma
op_logical_neg
id|edit
comma
id|note
comma
id|new_note
)paren
suffix:semicolon
r_if
c_cond
(paren
id|is_null_sha1
c_func
(paren
id|new_note
)paren
)paren
id|remove_note
c_func
(paren
id|t
comma
id|object
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|add_note
c_func
(paren
id|t
comma
id|object
comma
id|new_note
comma
id|combine_notes_overwrite
)paren
)paren
id|die
c_func
(paren
l_string|&quot;BUG: combine_notes_overwrite failed&quot;
)paren
suffix:semicolon
id|snprintf
c_func
(paren
id|logmsg
comma
r_sizeof
(paren
id|logmsg
)paren
comma
l_string|&quot;Notes %s by &squot;git notes %s&squot;&quot;
comma
id|is_null_sha1
c_func
(paren
id|new_note
)paren
ques
c_cond
l_string|&quot;removed&quot;
suffix:colon
l_string|&quot;added&quot;
comma
id|argv
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|commit_notes
c_func
(paren
id|t
comma
id|logmsg
)paren
suffix:semicolon
id|free_notes
c_func
(paren
id|t
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
(paren
id|msg.buf
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|show
r_static
r_int
id|show
c_func
(paren
r_int
id|argc
comma
r_const
r_char
op_star
op_star
id|argv
comma
r_const
r_char
op_star
id|prefix
)paren
(brace
r_const
r_char
op_star
id|object_ref
suffix:semicolon
r_struct
id|notes_tree
op_star
id|t
suffix:semicolon
r_int
r_char
id|object
(braket
l_int|20
)braket
suffix:semicolon
r_const
r_int
r_char
op_star
id|note
suffix:semicolon
r_int
id|retval
suffix:semicolon
r_struct
id|option
id|options
(braket
)braket
op_assign
(brace
id|OPT_END
c_func
(paren
)paren
)brace
suffix:semicolon
id|argc
op_assign
id|parse_options
c_func
(paren
id|argc
comma
id|argv
comma
id|prefix
comma
id|options
comma
id|git_notes_show_usage
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
l_int|1
OL
id|argc
)paren
(brace
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;too many parameters&quot;
)paren
)paren
suffix:semicolon
id|usage_with_options
c_func
(paren
id|git_notes_show_usage
comma
id|options
)paren
suffix:semicolon
)brace
id|object_ref
op_assign
id|argc
ques
c_cond
id|argv
(braket
l_int|0
)braket
suffix:colon
l_string|&quot;HEAD&quot;
suffix:semicolon
r_if
c_cond
(paren
id|get_sha1
c_func
(paren
id|object_ref
comma
id|object
)paren
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Failed to resolve &squot;%s&squot; as a valid ref.&quot;
)paren
comma
id|object_ref
)paren
suffix:semicolon
id|t
op_assign
id|init_notes_check
c_func
(paren
l_string|&quot;show&quot;
)paren
suffix:semicolon
id|note
op_assign
id|get_note
c_func
(paren
id|t
comma
id|object
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|note
)paren
id|retval
op_assign
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;No note found for object %s.&quot;
)paren
comma
id|sha1_to_hex
c_func
(paren
id|object
)paren
)paren
suffix:semicolon
r_else
(brace
r_const
r_char
op_star
id|show_args
(braket
l_int|3
)braket
op_assign
(brace
l_string|&quot;show&quot;
comma
id|sha1_to_hex
c_func
(paren
id|note
)paren
comma
l_int|NULL
)brace
suffix:semicolon
id|retval
op_assign
id|execv_git_cmd
c_func
(paren
id|show_args
)paren
suffix:semicolon
)brace
id|free_notes
c_func
(paren
id|t
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|merge_abort
r_static
r_int
id|merge_abort
c_func
(paren
r_struct
id|notes_merge_options
op_star
id|o
)paren
(brace
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t; * Remove .git/NOTES_MERGE_PARTIAL and .git/NOTES_MERGE_REF, and call&n;&t; * notes_merge_abort() to remove .git/NOTES_MERGE_WORKTREE.&n;&t; */
r_if
c_cond
(paren
id|delete_ref
c_func
(paren
l_string|&quot;NOTES_MERGE_PARTIAL&quot;
comma
l_int|NULL
comma
l_int|0
)paren
)paren
id|ret
op_add_assign
id|error
c_func
(paren
l_string|&quot;Failed to delete ref NOTES_MERGE_PARTIAL&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|delete_ref
c_func
(paren
l_string|&quot;NOTES_MERGE_REF&quot;
comma
l_int|NULL
comma
id|REF_NODEREF
)paren
)paren
id|ret
op_add_assign
id|error
c_func
(paren
l_string|&quot;Failed to delete ref NOTES_MERGE_REF&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|notes_merge_abort
c_func
(paren
id|o
)paren
)paren
id|ret
op_add_assign
id|error
c_func
(paren
l_string|&quot;Failed to remove &squot;git notes merge&squot; worktree&quot;
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|merge_commit
r_static
r_int
id|merge_commit
c_func
(paren
r_struct
id|notes_merge_options
op_star
id|o
)paren
(brace
r_struct
id|strbuf
id|msg
op_assign
id|STRBUF_INIT
suffix:semicolon
r_int
r_char
id|sha1
(braket
l_int|20
)braket
comma
id|parent_sha1
(braket
l_int|20
)braket
suffix:semicolon
r_struct
id|notes_tree
op_star
id|t
suffix:semicolon
r_struct
id|commit
op_star
id|partial
suffix:semicolon
r_struct
id|pretty_print_context
id|pretty_ctx
suffix:semicolon
multiline_comment|/*&n;&t; * Read partial merge result from .git/NOTES_MERGE_PARTIAL,&n;&t; * and target notes ref from .git/NOTES_MERGE_REF.&n;&t; */
r_if
c_cond
(paren
id|get_sha1
c_func
(paren
l_string|&quot;NOTES_MERGE_PARTIAL&quot;
comma
id|sha1
)paren
)paren
id|die
c_func
(paren
l_string|&quot;Failed to read ref NOTES_MERGE_PARTIAL&quot;
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
(paren
id|partial
op_assign
id|lookup_commit_reference
c_func
(paren
id|sha1
)paren
)paren
)paren
id|die
c_func
(paren
l_string|&quot;Could not find commit from NOTES_MERGE_PARTIAL.&quot;
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|parse_commit
c_func
(paren
id|partial
)paren
)paren
id|die
c_func
(paren
l_string|&quot;Could not parse commit from NOTES_MERGE_PARTIAL.&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|partial-&gt;parents
)paren
id|hashcpy
c_func
(paren
id|parent_sha1
comma
id|partial-&gt;parents-&gt;item-&gt;object.sha1
)paren
suffix:semicolon
r_else
id|hashclr
c_func
(paren
id|parent_sha1
)paren
suffix:semicolon
id|t
op_assign
id|xcalloc
c_func
(paren
l_int|1
comma
r_sizeof
(paren
r_struct
id|notes_tree
)paren
)paren
suffix:semicolon
id|init_notes
c_func
(paren
id|t
comma
l_string|&quot;NOTES_MERGE_PARTIAL&quot;
comma
id|combine_notes_overwrite
comma
l_int|0
)paren
suffix:semicolon
id|o-&gt;local_ref
op_assign
id|resolve_ref
c_func
(paren
l_string|&quot;NOTES_MERGE_REF&quot;
comma
id|sha1
comma
l_int|0
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|o-&gt;local_ref
)paren
id|die
c_func
(paren
l_string|&quot;Failed to resolve NOTES_MERGE_REF&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|notes_merge_commit
c_func
(paren
id|o
comma
id|t
comma
id|partial
comma
id|sha1
)paren
)paren
id|die
c_func
(paren
l_string|&quot;Failed to finalize notes merge&quot;
)paren
suffix:semicolon
multiline_comment|/* Reuse existing commit message in reflog message */
id|memset
c_func
(paren
op_amp
id|pretty_ctx
comma
l_int|0
comma
r_sizeof
(paren
id|pretty_ctx
)paren
)paren
suffix:semicolon
id|format_commit_message
c_func
(paren
id|partial
comma
l_string|&quot;%s&quot;
comma
op_amp
id|msg
comma
op_amp
id|pretty_ctx
)paren
suffix:semicolon
id|strbuf_trim
c_func
(paren
op_amp
id|msg
)paren
suffix:semicolon
id|strbuf_insert
c_func
(paren
op_amp
id|msg
comma
l_int|0
comma
l_string|&quot;notes: &quot;
comma
l_int|7
)paren
suffix:semicolon
id|update_ref
c_func
(paren
id|msg.buf
comma
id|o-&gt;local_ref
comma
id|sha1
comma
id|is_null_sha1
c_func
(paren
id|parent_sha1
)paren
ques
c_cond
l_int|NULL
suffix:colon
id|parent_sha1
comma
l_int|0
comma
id|DIE_ON_ERR
)paren
suffix:semicolon
id|free_notes
c_func
(paren
id|t
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|msg
)paren
suffix:semicolon
r_return
id|merge_abort
c_func
(paren
id|o
)paren
suffix:semicolon
)brace
DECL|function|merge
r_static
r_int
id|merge
c_func
(paren
r_int
id|argc
comma
r_const
r_char
op_star
op_star
id|argv
comma
r_const
r_char
op_star
id|prefix
)paren
(brace
r_struct
id|strbuf
id|remote_ref
op_assign
id|STRBUF_INIT
comma
id|msg
op_assign
id|STRBUF_INIT
suffix:semicolon
r_int
r_char
id|result_sha1
(braket
l_int|20
)braket
suffix:semicolon
r_struct
id|notes_tree
op_star
id|t
suffix:semicolon
r_struct
id|notes_merge_options
id|o
suffix:semicolon
r_int
id|do_merge
op_assign
l_int|0
comma
id|do_commit
op_assign
l_int|0
comma
id|do_abort
op_assign
l_int|0
suffix:semicolon
r_int
id|verbosity
op_assign
l_int|0
comma
id|result
suffix:semicolon
r_const
r_char
op_star
id|strategy
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|option
id|options
(braket
)braket
op_assign
(brace
id|OPT_GROUP
c_func
(paren
l_string|&quot;General options&quot;
)paren
comma
id|OPT__VERBOSITY
c_func
(paren
op_amp
id|verbosity
)paren
comma
id|OPT_GROUP
c_func
(paren
l_string|&quot;Merge options&quot;
)paren
comma
id|OPT_STRING
c_func
(paren
l_char|&squot;s&squot;
comma
l_string|&quot;strategy&quot;
comma
op_amp
id|strategy
comma
l_string|&quot;strategy&quot;
comma
l_string|&quot;resolve notes conflicts using the given strategy &quot;
l_string|&quot;(manual/ours/theirs/union/cat_sort_uniq)&quot;
)paren
comma
id|OPT_GROUP
c_func
(paren
l_string|&quot;Committing unmerged notes&quot;
)paren
comma
(brace
id|OPTION_BOOLEAN
comma
l_int|0
comma
l_string|&quot;commit&quot;
comma
op_amp
id|do_commit
comma
l_int|NULL
comma
l_string|&quot;finalize notes merge by committing unmerged notes&quot;
comma
id|PARSE_OPT_NOARG
op_or
id|PARSE_OPT_NONEG
)brace
comma
id|OPT_GROUP
c_func
(paren
l_string|&quot;Aborting notes merge resolution&quot;
)paren
comma
(brace
id|OPTION_BOOLEAN
comma
l_int|0
comma
l_string|&quot;abort&quot;
comma
op_amp
id|do_abort
comma
l_int|NULL
comma
l_string|&quot;abort notes merge&quot;
comma
id|PARSE_OPT_NOARG
op_or
id|PARSE_OPT_NONEG
)brace
comma
id|OPT_END
c_func
(paren
)paren
)brace
suffix:semicolon
id|argc
op_assign
id|parse_options
c_func
(paren
id|argc
comma
id|argv
comma
id|prefix
comma
id|options
comma
id|git_notes_merge_usage
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strategy
op_logical_or
id|do_commit
op_plus
id|do_abort
op_eq
l_int|0
)paren
id|do_merge
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|do_merge
op_plus
id|do_commit
op_plus
id|do_abort
op_ne
l_int|1
)paren
(brace
id|error
c_func
(paren
l_string|&quot;cannot mix --commit, --abort or -s/--strategy&quot;
)paren
suffix:semicolon
id|usage_with_options
c_func
(paren
id|git_notes_merge_usage
comma
id|options
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|do_merge
op_logical_and
id|argc
op_ne
l_int|1
)paren
(brace
id|error
c_func
(paren
l_string|&quot;Must specify a notes ref to merge&quot;
)paren
suffix:semicolon
id|usage_with_options
c_func
(paren
id|git_notes_merge_usage
comma
id|options
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|do_merge
op_logical_and
id|argc
)paren
(brace
id|error
c_func
(paren
l_string|&quot;too many parameters&quot;
)paren
suffix:semicolon
id|usage_with_options
c_func
(paren
id|git_notes_merge_usage
comma
id|options
)paren
suffix:semicolon
)brace
id|init_notes_merge_options
c_func
(paren
op_amp
id|o
)paren
suffix:semicolon
id|o.verbosity
op_assign
id|verbosity
op_plus
id|NOTES_MERGE_VERBOSITY_DEFAULT
suffix:semicolon
r_if
c_cond
(paren
id|do_abort
)paren
r_return
id|merge_abort
c_func
(paren
op_amp
id|o
)paren
suffix:semicolon
r_if
c_cond
(paren
id|do_commit
)paren
r_return
id|merge_commit
c_func
(paren
op_amp
id|o
)paren
suffix:semicolon
id|o.local_ref
op_assign
id|default_notes_ref
c_func
(paren
)paren
suffix:semicolon
id|strbuf_addstr
c_func
(paren
op_amp
id|remote_ref
comma
id|argv
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|expand_notes_ref
c_func
(paren
op_amp
id|remote_ref
)paren
suffix:semicolon
id|o.remote_ref
op_assign
id|remote_ref.buf
suffix:semicolon
r_if
c_cond
(paren
id|strategy
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|strategy
comma
l_string|&quot;manual&quot;
)paren
)paren
id|o.strategy
op_assign
id|NOTES_MERGE_RESOLVE_MANUAL
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|strategy
comma
l_string|&quot;ours&quot;
)paren
)paren
id|o.strategy
op_assign
id|NOTES_MERGE_RESOLVE_OURS
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|strategy
comma
l_string|&quot;theirs&quot;
)paren
)paren
id|o.strategy
op_assign
id|NOTES_MERGE_RESOLVE_THEIRS
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|strategy
comma
l_string|&quot;union&quot;
)paren
)paren
id|o.strategy
op_assign
id|NOTES_MERGE_RESOLVE_UNION
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|strategy
comma
l_string|&quot;cat_sort_uniq&quot;
)paren
)paren
id|o.strategy
op_assign
id|NOTES_MERGE_RESOLVE_CAT_SORT_UNIQ
suffix:semicolon
r_else
(brace
id|error
c_func
(paren
l_string|&quot;Unknown -s/--strategy: %s&quot;
comma
id|strategy
)paren
suffix:semicolon
id|usage_with_options
c_func
(paren
id|git_notes_merge_usage
comma
id|options
)paren
suffix:semicolon
)brace
)brace
id|t
op_assign
id|init_notes_check
c_func
(paren
l_string|&quot;merge&quot;
)paren
suffix:semicolon
id|strbuf_addf
c_func
(paren
op_amp
id|msg
comma
l_string|&quot;notes: Merged notes from %s into %s&quot;
comma
id|remote_ref.buf
comma
id|default_notes_ref
c_func
(paren
)paren
)paren
suffix:semicolon
id|strbuf_add
c_func
(paren
op_amp
(paren
id|o.commit_msg
)paren
comma
id|msg.buf
op_plus
l_int|7
comma
id|msg.len
l_int|7
)paren
suffix:semicolon
multiline_comment|/* skip &quot;notes: &quot; */
id|result
op_assign
id|notes_merge
c_func
(paren
op_amp
id|o
comma
id|t
comma
id|result_sha1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|result
op_ge
l_int|0
)paren
multiline_comment|/* Merge resulted (trivially) in result_sha1 */
multiline_comment|/* Update default notes ref with new commit */
id|update_ref
c_func
(paren
id|msg.buf
comma
id|default_notes_ref
c_func
(paren
)paren
comma
id|result_sha1
comma
l_int|NULL
comma
l_int|0
comma
id|DIE_ON_ERR
)paren
suffix:semicolon
r_else
(brace
multiline_comment|/* Merge has unresolved conflicts */
multiline_comment|/* Update .git/NOTES_MERGE_PARTIAL with partial merge result */
id|update_ref
c_func
(paren
id|msg.buf
comma
l_string|&quot;NOTES_MERGE_PARTIAL&quot;
comma
id|result_sha1
comma
l_int|NULL
comma
l_int|0
comma
id|DIE_ON_ERR
)paren
suffix:semicolon
multiline_comment|/* Store ref-to-be-updated into .git/NOTES_MERGE_REF */
r_if
c_cond
(paren
id|create_symref
c_func
(paren
l_string|&quot;NOTES_MERGE_REF&quot;
comma
id|default_notes_ref
c_func
(paren
)paren
comma
l_int|NULL
)paren
)paren
id|die
c_func
(paren
l_string|&quot;Failed to store link to current notes ref (%s)&quot;
comma
id|default_notes_ref
c_func
(paren
)paren
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;Automatic notes merge failed. Fix conflicts in %s and &quot;
l_string|&quot;commit the result with &squot;git notes merge --commit&squot;, or &quot;
l_string|&quot;abort the merge with &squot;git notes merge --abort&squot;.&bslash;n&quot;
comma
id|git_path
c_func
(paren
id|NOTES_MERGE_WORKTREE
)paren
)paren
suffix:semicolon
)brace
id|free_notes
c_func
(paren
id|t
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|remote_ref
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|msg
)paren
suffix:semicolon
r_return
id|result
OL
l_int|0
suffix:semicolon
multiline_comment|/* return non-zero on conflicts */
)brace
DECL|macro|IGNORE_MISSING
mdefine_line|#define IGNORE_MISSING 1
DECL|function|remove_one_note
r_static
r_int
id|remove_one_note
c_func
(paren
r_struct
id|notes_tree
op_star
id|t
comma
r_const
r_char
op_star
id|name
comma
r_int
id|flag
)paren
(brace
r_int
id|status
suffix:semicolon
r_int
r_char
id|sha1
(braket
l_int|20
)braket
suffix:semicolon
r_if
c_cond
(paren
id|get_sha1
c_func
(paren
id|name
comma
id|sha1
)paren
)paren
r_return
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Failed to resolve &squot;%s&squot; as a valid ref.&quot;
)paren
comma
id|name
)paren
suffix:semicolon
id|status
op_assign
id|remove_note
c_func
(paren
id|t
comma
id|sha1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
id|fprintf
c_func
(paren
id|stderr
comma
id|_
c_func
(paren
l_string|&quot;Object %s has no note&bslash;n&quot;
)paren
comma
id|name
)paren
suffix:semicolon
r_else
id|fprintf
c_func
(paren
id|stderr
comma
id|_
c_func
(paren
l_string|&quot;Removing note for object %s&bslash;n&quot;
)paren
comma
id|name
)paren
suffix:semicolon
r_return
(paren
id|flag
op_amp
id|IGNORE_MISSING
)paren
ques
c_cond
l_int|0
suffix:colon
id|status
suffix:semicolon
)brace
DECL|function|remove_cmd
r_static
r_int
id|remove_cmd
c_func
(paren
r_int
id|argc
comma
r_const
r_char
op_star
op_star
id|argv
comma
r_const
r_char
op_star
id|prefix
)paren
(brace
r_int
id|flag
op_assign
l_int|0
suffix:semicolon
r_int
id|from_stdin
op_assign
l_int|0
suffix:semicolon
r_struct
id|option
id|options
(braket
)braket
op_assign
(brace
id|OPT_BIT
c_func
(paren
l_int|0
comma
l_string|&quot;ignore-missing&quot;
comma
op_amp
id|flag
comma
l_string|&quot;attempt to remove non-existent note is not an error&quot;
comma
id|IGNORE_MISSING
)paren
comma
id|OPT_BOOLEAN
c_func
(paren
l_int|0
comma
l_string|&quot;stdin&quot;
comma
op_amp
id|from_stdin
comma
l_string|&quot;read object names from the standard input&quot;
)paren
comma
id|OPT_END
c_func
(paren
)paren
)brace
suffix:semicolon
r_struct
id|notes_tree
op_star
id|t
suffix:semicolon
r_int
id|retval
op_assign
l_int|0
suffix:semicolon
id|argc
op_assign
id|parse_options
c_func
(paren
id|argc
comma
id|argv
comma
id|prefix
comma
id|options
comma
id|git_notes_remove_usage
comma
l_int|0
)paren
suffix:semicolon
id|t
op_assign
id|init_notes_check
c_func
(paren
l_string|&quot;remove&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|argc
op_logical_and
op_logical_neg
id|from_stdin
)paren
(brace
id|retval
op_assign
id|remove_one_note
c_func
(paren
id|t
comma
l_string|&quot;HEAD&quot;
comma
id|flag
)paren
suffix:semicolon
)brace
r_else
(brace
r_while
c_loop
(paren
op_star
id|argv
)paren
(brace
id|retval
op_or_assign
id|remove_one_note
c_func
(paren
id|t
comma
op_star
id|argv
comma
id|flag
)paren
suffix:semicolon
id|argv
op_increment
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|from_stdin
)paren
(brace
r_struct
id|strbuf
id|sb
op_assign
id|STRBUF_INIT
suffix:semicolon
r_while
c_loop
(paren
id|strbuf_getwholeline
c_func
(paren
op_amp
id|sb
comma
id|stdin
comma
l_char|&squot;&bslash;n&squot;
)paren
op_ne
id|EOF
)paren
(brace
id|strbuf_rtrim
c_func
(paren
op_amp
id|sb
)paren
suffix:semicolon
id|retval
op_or_assign
id|remove_one_note
c_func
(paren
id|t
comma
id|sb.buf
comma
id|flag
)paren
suffix:semicolon
)brace
id|strbuf_release
c_func
(paren
op_amp
id|sb
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|retval
)paren
id|commit_notes
c_func
(paren
id|t
comma
l_string|&quot;Notes removed by &squot;git notes remove&squot;&quot;
)paren
suffix:semicolon
id|free_notes
c_func
(paren
id|t
)paren
suffix:semicolon
r_return
id|retval
suffix:semicolon
)brace
DECL|function|prune
r_static
r_int
id|prune
c_func
(paren
r_int
id|argc
comma
r_const
r_char
op_star
op_star
id|argv
comma
r_const
r_char
op_star
id|prefix
)paren
(brace
r_struct
id|notes_tree
op_star
id|t
suffix:semicolon
r_int
id|show_only
op_assign
l_int|0
comma
id|verbose
op_assign
l_int|0
suffix:semicolon
r_struct
id|option
id|options
(braket
)braket
op_assign
(brace
id|OPT__DRY_RUN
c_func
(paren
op_amp
id|show_only
comma
l_string|&quot;do not remove, show only&quot;
)paren
comma
id|OPT__VERBOSE
c_func
(paren
op_amp
id|verbose
comma
l_string|&quot;report pruned notes&quot;
)paren
comma
id|OPT_END
c_func
(paren
)paren
)brace
suffix:semicolon
id|argc
op_assign
id|parse_options
c_func
(paren
id|argc
comma
id|argv
comma
id|prefix
comma
id|options
comma
id|git_notes_prune_usage
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|argc
)paren
(brace
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;too many parameters&quot;
)paren
)paren
suffix:semicolon
id|usage_with_options
c_func
(paren
id|git_notes_prune_usage
comma
id|options
)paren
suffix:semicolon
)brace
id|t
op_assign
id|init_notes_check
c_func
(paren
l_string|&quot;prune&quot;
)paren
suffix:semicolon
id|prune_notes
c_func
(paren
id|t
comma
(paren
id|verbose
ques
c_cond
id|NOTES_PRUNE_VERBOSE
suffix:colon
l_int|0
)paren
op_or
(paren
id|show_only
ques
c_cond
id|NOTES_PRUNE_VERBOSE
op_or
id|NOTES_PRUNE_DRYRUN
suffix:colon
l_int|0
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|show_only
)paren
id|commit_notes
c_func
(paren
id|t
comma
l_string|&quot;Notes removed by &squot;git notes prune&squot;&quot;
)paren
suffix:semicolon
id|free_notes
c_func
(paren
id|t
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|get_ref
r_static
r_int
id|get_ref
c_func
(paren
r_int
id|argc
comma
r_const
r_char
op_star
op_star
id|argv
comma
r_const
r_char
op_star
id|prefix
)paren
(brace
r_struct
id|option
id|options
(braket
)braket
op_assign
(brace
id|OPT_END
c_func
(paren
)paren
)brace
suffix:semicolon
id|argc
op_assign
id|parse_options
c_func
(paren
id|argc
comma
id|argv
comma
id|prefix
comma
id|options
comma
id|git_notes_get_ref_usage
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|argc
)paren
(brace
id|error
c_func
(paren
l_string|&quot;too many parameters&quot;
)paren
suffix:semicolon
id|usage_with_options
c_func
(paren
id|git_notes_get_ref_usage
comma
id|options
)paren
suffix:semicolon
)brace
id|puts
c_func
(paren
id|default_notes_ref
c_func
(paren
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cmd_notes
r_int
id|cmd_notes
c_func
(paren
r_int
id|argc
comma
r_const
r_char
op_star
op_star
id|argv
comma
r_const
r_char
op_star
id|prefix
)paren
(brace
r_int
id|result
suffix:semicolon
r_const
r_char
op_star
id|override_notes_ref
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|option
id|options
(braket
)braket
op_assign
(brace
id|OPT_STRING
c_func
(paren
l_int|0
comma
l_string|&quot;ref&quot;
comma
op_amp
id|override_notes_ref
comma
l_string|&quot;notes_ref&quot;
comma
l_string|&quot;use notes from &lt;notes_ref&gt;&quot;
)paren
comma
id|OPT_END
c_func
(paren
)paren
)brace
suffix:semicolon
id|git_config
c_func
(paren
id|git_default_config
comma
l_int|NULL
)paren
suffix:semicolon
id|argc
op_assign
id|parse_options
c_func
(paren
id|argc
comma
id|argv
comma
id|prefix
comma
id|options
comma
id|git_notes_usage
comma
id|PARSE_OPT_STOP_AT_NON_OPTION
)paren
suffix:semicolon
r_if
c_cond
(paren
id|override_notes_ref
)paren
(brace
r_struct
id|strbuf
id|sb
op_assign
id|STRBUF_INIT
suffix:semicolon
id|strbuf_addstr
c_func
(paren
op_amp
id|sb
comma
id|override_notes_ref
)paren
suffix:semicolon
id|expand_notes_ref
c_func
(paren
op_amp
id|sb
)paren
suffix:semicolon
id|setenv
c_func
(paren
l_string|&quot;GIT_NOTES_REF&quot;
comma
id|sb.buf
comma
l_int|1
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|sb
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|argc
OL
l_int|1
op_logical_or
op_logical_neg
id|strcmp
c_func
(paren
id|argv
(braket
l_int|0
)braket
comma
l_string|&quot;list&quot;
)paren
)paren
id|result
op_assign
id|list
c_func
(paren
id|argc
comma
id|argv
comma
id|prefix
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|argv
(braket
l_int|0
)braket
comma
l_string|&quot;add&quot;
)paren
)paren
id|result
op_assign
id|add
c_func
(paren
id|argc
comma
id|argv
comma
id|prefix
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|argv
(braket
l_int|0
)braket
comma
l_string|&quot;copy&quot;
)paren
)paren
id|result
op_assign
id|copy
c_func
(paren
id|argc
comma
id|argv
comma
id|prefix
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|argv
(braket
l_int|0
)braket
comma
l_string|&quot;append&quot;
)paren
op_logical_or
op_logical_neg
id|strcmp
c_func
(paren
id|argv
(braket
l_int|0
)braket
comma
l_string|&quot;edit&quot;
)paren
)paren
id|result
op_assign
id|append_edit
c_func
(paren
id|argc
comma
id|argv
comma
id|prefix
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|argv
(braket
l_int|0
)braket
comma
l_string|&quot;show&quot;
)paren
)paren
id|result
op_assign
id|show
c_func
(paren
id|argc
comma
id|argv
comma
id|prefix
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|argv
(braket
l_int|0
)braket
comma
l_string|&quot;merge&quot;
)paren
)paren
id|result
op_assign
id|merge
c_func
(paren
id|argc
comma
id|argv
comma
id|prefix
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|argv
(braket
l_int|0
)braket
comma
l_string|&quot;remove&quot;
)paren
)paren
id|result
op_assign
id|remove_cmd
c_func
(paren
id|argc
comma
id|argv
comma
id|prefix
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|argv
(braket
l_int|0
)braket
comma
l_string|&quot;prune&quot;
)paren
)paren
id|result
op_assign
id|prune
c_func
(paren
id|argc
comma
id|argv
comma
id|prefix
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|argv
(braket
l_int|0
)braket
comma
l_string|&quot;get-ref&quot;
)paren
)paren
id|result
op_assign
id|get_ref
c_func
(paren
id|argc
comma
id|argv
comma
id|prefix
)paren
suffix:semicolon
r_else
(brace
id|result
op_assign
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Unknown subcommand: %s&quot;
)paren
comma
id|argv
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|usage_with_options
c_func
(paren
id|git_notes_usage
comma
id|options
)paren
suffix:semicolon
)brace
r_return
id|result
ques
c_cond
l_int|1
suffix:colon
l_int|0
suffix:semicolon
)brace
eof
