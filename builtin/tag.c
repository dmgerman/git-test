multiline_comment|/*&n; * Builtin &quot;git tag&quot;&n; *&n; * Copyright (c) 2007 Kristian H&oslash;gsberg &lt;krh@redhat.com&gt;,&n; *                    Carlos Rica &lt;jasampler@gmail.com&gt;&n; * Based on git-tag.sh and mktag.c by Linus Torvalds.&n; */
macro_line|#include &quot;cache.h&quot;
macro_line|#include &quot;builtin.h&quot;
macro_line|#include &quot;refs.h&quot;
macro_line|#include &quot;tag.h&quot;
macro_line|#include &quot;run-command.h&quot;
macro_line|#include &quot;parse-options.h&quot;
macro_line|#include &quot;diff.h&quot;
macro_line|#include &quot;revision.h&quot;
macro_line|#include &quot;gpg-interface.h&quot;
macro_line|#include &quot;sha1-array.h&quot;
macro_line|#include &quot;column.h&quot;
macro_line|#include &quot;ref-filter.h&quot;
DECL|variable|git_tag_usage
r_static
r_const
r_char
op_star
r_const
id|git_tag_usage
(braket
)braket
op_assign
(brace
id|N_
c_func
(paren
l_string|&quot;git tag [-a | -s | -u &lt;key-id&gt;] [-f] [-m &lt;msg&gt; | -F &lt;file&gt;] &lt;tagname&gt; [&lt;head&gt;]&quot;
)paren
comma
id|N_
c_func
(paren
l_string|&quot;git tag -d &lt;tagname&gt;...&quot;
)paren
comma
id|N_
c_func
(paren
l_string|&quot;git tag -l [-n[&lt;num&gt;]] [--contains &lt;commit&gt;] [--points-at &lt;object&gt;]&quot;
l_string|&quot;&bslash;n&bslash;t&bslash;t[--format=&lt;format&gt;] [--[no-]merged [&lt;commit&gt;]] [&lt;pattern&gt;...]&quot;
)paren
comma
id|N_
c_func
(paren
l_string|&quot;git tag -v &lt;tagname&gt;...&quot;
)paren
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|colopts
r_static
r_int
r_int
id|colopts
suffix:semicolon
DECL|function|list_tags
r_static
r_int
id|list_tags
c_func
(paren
r_struct
id|ref_filter
op_star
id|filter
comma
r_struct
id|ref_sorting
op_star
id|sorting
comma
r_const
r_char
op_star
id|format
)paren
(brace
r_struct
id|ref_array
id|array
suffix:semicolon
r_char
op_star
id|to_free
op_assign
l_int|NULL
suffix:semicolon
r_int
id|i
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|array
comma
l_int|0
comma
r_sizeof
(paren
id|array
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|filter-&gt;lines
op_eq
l_int|1
)paren
id|filter-&gt;lines
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|format
)paren
(brace
r_if
c_cond
(paren
id|filter-&gt;lines
)paren
(brace
id|to_free
op_assign
id|xstrfmt
c_func
(paren
l_string|&quot;%s %%(contents:lines=%d)&quot;
comma
l_string|&quot;%(align:15)%(refname:short)%(end)&quot;
comma
id|filter-&gt;lines
)paren
suffix:semicolon
id|format
op_assign
id|to_free
suffix:semicolon
)brace
r_else
id|format
op_assign
l_string|&quot;%(refname:short)&quot;
suffix:semicolon
)brace
id|verify_ref_format
c_func
(paren
id|format
)paren
suffix:semicolon
id|filter-&gt;with_commit_tag_algo
op_assign
l_int|1
suffix:semicolon
id|filter_refs
c_func
(paren
op_amp
id|array
comma
id|filter
comma
id|FILTER_REFS_TAGS
)paren
suffix:semicolon
id|ref_array_sort
c_func
(paren
id|sorting
comma
op_amp
id|array
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|array.nr
suffix:semicolon
id|i
op_increment
)paren
id|show_ref_array_item
c_func
(paren
id|array.items
(braket
id|i
)braket
comma
id|format
comma
l_int|0
)paren
suffix:semicolon
id|ref_array_clear
c_func
(paren
op_amp
id|array
)paren
suffix:semicolon
id|free
c_func
(paren
id|to_free
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|typedef|each_tag_name_fn
r_typedef
r_int
(paren
op_star
id|each_tag_name_fn
)paren
(paren
r_const
r_char
op_star
id|name
comma
r_const
r_char
op_star
id|ref
comma
r_const
r_int
r_char
op_star
id|sha1
)paren
suffix:semicolon
DECL|function|for_each_tag_name
r_static
r_int
id|for_each_tag_name
c_func
(paren
r_const
r_char
op_star
op_star
id|argv
comma
id|each_tag_name_fn
id|fn
)paren
(brace
r_const
r_char
op_star
op_star
id|p
suffix:semicolon
r_char
id|ref
(braket
id|PATH_MAX
)braket
suffix:semicolon
r_int
id|had_error
op_assign
l_int|0
suffix:semicolon
r_int
r_char
id|sha1
(braket
l_int|20
)braket
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|argv
suffix:semicolon
op_star
id|p
suffix:semicolon
id|p
op_increment
)paren
(brace
r_if
c_cond
(paren
id|snprintf
c_func
(paren
id|ref
comma
r_sizeof
(paren
id|ref
)paren
comma
l_string|&quot;refs/tags/%s&quot;
comma
op_star
id|p
)paren
op_ge
r_sizeof
(paren
id|ref
)paren
)paren
(brace
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;tag name too long: %.*s...&quot;
)paren
comma
l_int|50
comma
op_star
id|p
)paren
suffix:semicolon
id|had_error
op_assign
l_int|1
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|read_ref
c_func
(paren
id|ref
comma
id|sha1
)paren
)paren
(brace
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;tag &squot;%s&squot; not found.&quot;
)paren
comma
op_star
id|p
)paren
suffix:semicolon
id|had_error
op_assign
l_int|1
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fn
c_func
(paren
op_star
id|p
comma
id|ref
comma
id|sha1
)paren
)paren
id|had_error
op_assign
l_int|1
suffix:semicolon
)brace
r_return
id|had_error
suffix:semicolon
)brace
DECL|function|delete_tag
r_static
r_int
id|delete_tag
c_func
(paren
r_const
r_char
op_star
id|name
comma
r_const
r_char
op_star
id|ref
comma
r_const
r_int
r_char
op_star
id|sha1
)paren
(brace
r_if
c_cond
(paren
id|delete_ref
c_func
(paren
id|ref
comma
id|sha1
comma
l_int|0
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|printf
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Deleted tag &squot;%s&squot; (was %s)&bslash;n&quot;
)paren
comma
id|name
comma
id|find_unique_abbrev
c_func
(paren
id|sha1
comma
id|DEFAULT_ABBREV
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|verify_tag
r_static
r_int
id|verify_tag
c_func
(paren
r_const
r_char
op_star
id|name
comma
r_const
r_char
op_star
id|ref
comma
r_const
r_int
r_char
op_star
id|sha1
)paren
(brace
r_const
r_char
op_star
id|argv_verify_tag
(braket
)braket
op_assign
(brace
l_string|&quot;verify-tag&quot;
comma
l_string|&quot;-v&quot;
comma
l_string|&quot;SHA1_HEX&quot;
comma
l_int|NULL
)brace
suffix:semicolon
id|argv_verify_tag
(braket
l_int|2
)braket
op_assign
id|sha1_to_hex
c_func
(paren
id|sha1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|run_command_v_opt
c_func
(paren
id|argv_verify_tag
comma
id|RUN_GIT_CMD
)paren
)paren
r_return
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;could not verify the tag &squot;%s&squot;&quot;
)paren
comma
id|name
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|do_sign
r_static
r_int
id|do_sign
c_func
(paren
r_struct
id|strbuf
op_star
id|buffer
)paren
(brace
r_return
id|sign_buffer
c_func
(paren
id|buffer
comma
id|buffer
comma
id|get_signing_key
c_func
(paren
)paren
)paren
suffix:semicolon
)brace
DECL|variable|tag_template
r_static
r_const
r_char
id|tag_template
(braket
)braket
op_assign
id|N_
c_func
(paren
l_string|&quot;&bslash;nWrite a message for tag:&bslash;n  %s&bslash;n&quot;
l_string|&quot;Lines starting with &squot;%c&squot; will be ignored.&bslash;n&quot;
)paren
suffix:semicolon
DECL|variable|tag_template_nocleanup
r_static
r_const
r_char
id|tag_template_nocleanup
(braket
)braket
op_assign
id|N_
c_func
(paren
l_string|&quot;&bslash;nWrite a message for tag:&bslash;n  %s&bslash;n&quot;
l_string|&quot;Lines starting with &squot;%c&squot; will be kept; you may remove them&quot;
l_string|&quot; yourself if you want to.&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Parse arg given and add it the ref_sorting array */
DECL|function|parse_sorting_string
r_static
r_int
id|parse_sorting_string
c_func
(paren
r_const
r_char
op_star
id|arg
comma
r_struct
id|ref_sorting
op_star
op_star
id|sorting_tail
)paren
(brace
r_struct
id|ref_sorting
op_star
id|s
suffix:semicolon
r_int
id|len
suffix:semicolon
id|s
op_assign
id|xcalloc
c_func
(paren
l_int|1
comma
r_sizeof
(paren
op_star
id|s
)paren
)paren
suffix:semicolon
id|s-&gt;next
op_assign
op_star
id|sorting_tail
suffix:semicolon
op_star
id|sorting_tail
op_assign
id|s
suffix:semicolon
r_if
c_cond
(paren
op_star
id|arg
op_eq
l_char|&squot;-&squot;
)paren
(brace
id|s-&gt;reverse
op_assign
l_int|1
suffix:semicolon
id|arg
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|skip_prefix
c_func
(paren
id|arg
comma
l_string|&quot;version:&quot;
comma
op_amp
id|arg
)paren
op_logical_or
id|skip_prefix
c_func
(paren
id|arg
comma
l_string|&quot;v:&quot;
comma
op_amp
id|arg
)paren
)paren
id|s-&gt;version
op_assign
l_int|1
suffix:semicolon
id|len
op_assign
id|strlen
c_func
(paren
id|arg
)paren
suffix:semicolon
id|s-&gt;atom
op_assign
id|parse_ref_filter_atom
c_func
(paren
id|arg
comma
id|arg
op_plus
id|len
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|git_tag_config
r_static
r_int
id|git_tag_config
c_func
(paren
r_const
r_char
op_star
id|var
comma
r_const
r_char
op_star
id|value
comma
r_void
op_star
id|cb
)paren
(brace
r_int
id|status
suffix:semicolon
r_struct
id|ref_sorting
op_star
op_star
id|sorting_tail
op_assign
(paren
r_struct
id|ref_sorting
op_star
op_star
)paren
id|cb
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|var
comma
l_string|&quot;tag.sort&quot;
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|value
)paren
r_return
id|config_error_nonbool
c_func
(paren
id|var
)paren
suffix:semicolon
id|parse_sorting_string
c_func
(paren
id|value
comma
id|sorting_tail
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|status
op_assign
id|git_gpg_config
c_func
(paren
id|var
comma
id|value
comma
id|cb
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
)paren
r_return
id|status
suffix:semicolon
r_if
c_cond
(paren
id|starts_with
c_func
(paren
id|var
comma
l_string|&quot;column.&quot;
)paren
)paren
r_return
id|git_column_config
c_func
(paren
id|var
comma
id|value
comma
l_string|&quot;tag&quot;
comma
op_amp
id|colopts
)paren
suffix:semicolon
r_return
id|git_default_config
c_func
(paren
id|var
comma
id|value
comma
id|cb
)paren
suffix:semicolon
)brace
DECL|function|write_tag_body
r_static
r_void
id|write_tag_body
c_func
(paren
r_int
id|fd
comma
r_const
r_int
r_char
op_star
id|sha1
)paren
(brace
r_int
r_int
id|size
suffix:semicolon
r_enum
id|object_type
id|type
suffix:semicolon
r_char
op_star
id|buf
comma
op_star
id|sp
suffix:semicolon
id|buf
op_assign
id|read_sha1_file
c_func
(paren
id|sha1
comma
op_amp
id|type
comma
op_amp
id|size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buf
)paren
r_return
suffix:semicolon
multiline_comment|/* skip header */
id|sp
op_assign
id|strstr
c_func
(paren
id|buf
comma
l_string|&quot;&bslash;n&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sp
op_logical_or
op_logical_neg
id|size
op_logical_or
id|type
op_ne
id|OBJ_TAG
)paren
(brace
id|free
c_func
(paren
id|buf
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|sp
op_add_assign
l_int|2
suffix:semicolon
multiline_comment|/* skip the 2 LFs */
id|write_or_die
c_func
(paren
id|fd
comma
id|sp
comma
id|parse_signature
c_func
(paren
id|sp
comma
id|buf
op_plus
id|size
id|sp
)paren
)paren
suffix:semicolon
id|free
c_func
(paren
id|buf
)paren
suffix:semicolon
)brace
DECL|function|build_tag_object
r_static
r_int
id|build_tag_object
c_func
(paren
r_struct
id|strbuf
op_star
id|buf
comma
r_int
id|sign
comma
r_int
r_char
op_star
id|result
)paren
(brace
r_if
c_cond
(paren
id|sign
op_logical_and
id|do_sign
c_func
(paren
id|buf
)paren
OL
l_int|0
)paren
r_return
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;unable to sign the tag&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|write_sha1_file
c_func
(paren
id|buf-&gt;buf
comma
id|buf-&gt;len
comma
id|tag_type
comma
id|result
)paren
OL
l_int|0
)paren
r_return
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;unable to write tag file&quot;
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|struct|create_tag_options
r_struct
id|create_tag_options
(brace
DECL|member|message_given
r_int
r_int
id|message_given
suffix:colon
l_int|1
suffix:semicolon
DECL|member|sign
r_int
r_int
id|sign
suffix:semicolon
r_enum
(brace
DECL|enumerator|CLEANUP_NONE
id|CLEANUP_NONE
comma
DECL|enumerator|CLEANUP_SPACE
id|CLEANUP_SPACE
comma
DECL|enumerator|CLEANUP_ALL
id|CLEANUP_ALL
DECL|member|cleanup_mode
)brace
id|cleanup_mode
suffix:semicolon
)brace
suffix:semicolon
DECL|function|create_tag
r_static
r_void
id|create_tag
c_func
(paren
r_const
r_int
r_char
op_star
id|object
comma
r_const
r_char
op_star
id|tag
comma
r_struct
id|strbuf
op_star
id|buf
comma
r_struct
id|create_tag_options
op_star
id|opt
comma
r_int
r_char
op_star
id|prev
comma
r_int
r_char
op_star
id|result
)paren
(brace
r_enum
id|object_type
id|type
suffix:semicolon
r_char
id|header_buf
(braket
l_int|1024
)braket
suffix:semicolon
r_int
id|header_len
suffix:semicolon
r_char
op_star
id|path
op_assign
l_int|NULL
suffix:semicolon
id|type
op_assign
id|sha1_object_info
c_func
(paren
id|object
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|type
op_le
id|OBJ_NONE
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;bad object type.&quot;
)paren
)paren
suffix:semicolon
id|header_len
op_assign
id|snprintf
c_func
(paren
id|header_buf
comma
r_sizeof
(paren
id|header_buf
)paren
comma
l_string|&quot;object %s&bslash;n&quot;
l_string|&quot;type %s&bslash;n&quot;
l_string|&quot;tag %s&bslash;n&quot;
l_string|&quot;tagger %s&bslash;n&bslash;n&quot;
comma
id|sha1_to_hex
c_func
(paren
id|object
)paren
comma
r_typename
(paren
id|type
)paren
comma
id|tag
comma
id|git_committer_info
c_func
(paren
id|IDENT_STRICT
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|header_len
OG
r_sizeof
(paren
id|header_buf
)paren
l_int|1
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;tag header too big.&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|opt-&gt;message_given
)paren
(brace
r_int
id|fd
suffix:semicolon
multiline_comment|/* write the template message before editing: */
id|path
op_assign
id|git_pathdup
c_func
(paren
l_string|&quot;TAG_EDITMSG&quot;
)paren
suffix:semicolon
id|fd
op_assign
id|open
c_func
(paren
id|path
comma
id|O_CREAT
op_or
id|O_TRUNC
op_or
id|O_WRONLY
comma
l_int|0600
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fd
OL
l_int|0
)paren
id|die_errno
c_func
(paren
id|_
c_func
(paren
l_string|&quot;could not create file &squot;%s&squot;&quot;
)paren
comma
id|path
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|is_null_sha1
c_func
(paren
id|prev
)paren
)paren
(brace
id|write_tag_body
c_func
(paren
id|fd
comma
id|prev
)paren
suffix:semicolon
)brace
r_else
(brace
r_struct
id|strbuf
id|buf
op_assign
id|STRBUF_INIT
suffix:semicolon
id|strbuf_addch
c_func
(paren
op_amp
id|buf
comma
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opt-&gt;cleanup_mode
op_eq
id|CLEANUP_ALL
)paren
id|strbuf_commented_addf
c_func
(paren
op_amp
id|buf
comma
id|_
c_func
(paren
id|tag_template
)paren
comma
id|tag
comma
id|comment_line_char
)paren
suffix:semicolon
r_else
id|strbuf_commented_addf
c_func
(paren
op_amp
id|buf
comma
id|_
c_func
(paren
id|tag_template_nocleanup
)paren
comma
id|tag
comma
id|comment_line_char
)paren
suffix:semicolon
id|write_or_die
c_func
(paren
id|fd
comma
id|buf.buf
comma
id|buf.len
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|buf
)paren
suffix:semicolon
)brace
id|close
c_func
(paren
id|fd
)paren
suffix:semicolon
r_if
c_cond
(paren
id|launch_editor
c_func
(paren
id|path
comma
id|buf
comma
l_int|NULL
)paren
)paren
(brace
id|fprintf
c_func
(paren
id|stderr
comma
id|_
c_func
(paren
l_string|&quot;Please supply the message using either -m or -F option.&bslash;n&quot;
)paren
)paren
suffix:semicolon
m_exit
(paren
l_int|1
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|opt-&gt;cleanup_mode
op_ne
id|CLEANUP_NONE
)paren
id|stripspace
c_func
(paren
id|buf
comma
id|opt-&gt;cleanup_mode
op_eq
id|CLEANUP_ALL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|opt-&gt;message_given
op_logical_and
op_logical_neg
id|buf-&gt;len
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;no tag message?&quot;
)paren
)paren
suffix:semicolon
id|strbuf_insert
c_func
(paren
id|buf
comma
l_int|0
comma
id|header_buf
comma
id|header_len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|build_tag_object
c_func
(paren
id|buf
comma
id|opt-&gt;sign
comma
id|result
)paren
OL
l_int|0
)paren
(brace
r_if
c_cond
(paren
id|path
)paren
id|fprintf
c_func
(paren
id|stderr
comma
id|_
c_func
(paren
l_string|&quot;The tag message has been left in %s&bslash;n&quot;
)paren
comma
id|path
)paren
suffix:semicolon
m_exit
(paren
l_int|128
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|path
)paren
(brace
id|unlink_or_warn
c_func
(paren
id|path
)paren
suffix:semicolon
id|free
c_func
(paren
id|path
)paren
suffix:semicolon
)brace
)brace
DECL|struct|msg_arg
r_struct
id|msg_arg
(brace
DECL|member|given
r_int
id|given
suffix:semicolon
DECL|member|buf
r_struct
id|strbuf
id|buf
suffix:semicolon
)brace
suffix:semicolon
DECL|function|parse_msg_arg
r_static
r_int
id|parse_msg_arg
c_func
(paren
r_const
r_struct
id|option
op_star
id|opt
comma
r_const
r_char
op_star
id|arg
comma
r_int
id|unset
)paren
(brace
r_struct
id|msg_arg
op_star
id|msg
op_assign
id|opt-&gt;value
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|arg
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|msg-&gt;buf.len
)paren
id|strbuf_addstr
c_func
(paren
op_amp
(paren
id|msg-&gt;buf
)paren
comma
l_string|&quot;&bslash;n&bslash;n&quot;
)paren
suffix:semicolon
id|strbuf_addstr
c_func
(paren
op_amp
(paren
id|msg-&gt;buf
)paren
comma
id|arg
)paren
suffix:semicolon
id|msg-&gt;given
op_assign
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|strbuf_check_tag_ref
r_static
r_int
id|strbuf_check_tag_ref
c_func
(paren
r_struct
id|strbuf
op_star
id|sb
comma
r_const
r_char
op_star
id|name
)paren
(brace
r_if
c_cond
(paren
id|name
(braket
l_int|0
)braket
op_eq
l_char|&squot;-&squot;
)paren
r_return
l_int|1
suffix:semicolon
id|strbuf_reset
c_func
(paren
id|sb
)paren
suffix:semicolon
id|strbuf_addf
c_func
(paren
id|sb
comma
l_string|&quot;refs/tags/%s&quot;
comma
id|name
)paren
suffix:semicolon
r_return
id|check_refname_format
c_func
(paren
id|sb-&gt;buf
comma
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|cmd_tag
r_int
id|cmd_tag
c_func
(paren
r_int
id|argc
comma
r_const
r_char
op_star
op_star
id|argv
comma
r_const
r_char
op_star
id|prefix
)paren
(brace
r_struct
id|strbuf
id|buf
op_assign
id|STRBUF_INIT
suffix:semicolon
r_struct
id|strbuf
id|ref
op_assign
id|STRBUF_INIT
suffix:semicolon
r_int
r_char
id|object
(braket
l_int|20
)braket
comma
id|prev
(braket
l_int|20
)braket
suffix:semicolon
r_const
r_char
op_star
id|object_ref
comma
op_star
id|tag
suffix:semicolon
r_struct
id|create_tag_options
id|opt
suffix:semicolon
r_char
op_star
id|cleanup_arg
op_assign
l_int|NULL
suffix:semicolon
r_int
id|create_reflog
op_assign
l_int|0
suffix:semicolon
r_int
id|annotate
op_assign
l_int|0
comma
id|force
op_assign
l_int|0
suffix:semicolon
r_int
id|cmdmode
op_assign
l_int|0
suffix:semicolon
r_const
r_char
op_star
id|msgfile
op_assign
l_int|NULL
comma
op_star
id|keyid
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|msg_arg
id|msg
op_assign
(brace
l_int|0
comma
id|STRBUF_INIT
)brace
suffix:semicolon
r_struct
id|ref_transaction
op_star
id|transaction
suffix:semicolon
r_struct
id|strbuf
id|err
op_assign
id|STRBUF_INIT
suffix:semicolon
r_struct
id|ref_filter
id|filter
suffix:semicolon
r_static
r_struct
id|ref_sorting
op_star
id|sorting
op_assign
l_int|NULL
comma
op_star
op_star
id|sorting_tail
op_assign
op_amp
id|sorting
suffix:semicolon
r_const
r_char
op_star
id|format
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|option
id|options
(braket
)braket
op_assign
(brace
id|OPT_CMDMODE
c_func
(paren
l_char|&squot;l&squot;
comma
l_string|&quot;list&quot;
comma
op_amp
id|cmdmode
comma
id|N_
c_func
(paren
l_string|&quot;list tag names&quot;
)paren
comma
l_char|&squot;l&squot;
)paren
comma
(brace
id|OPTION_INTEGER
comma
l_char|&squot;n&squot;
comma
l_int|NULL
comma
op_amp
id|filter.lines
comma
id|N_
c_func
(paren
l_string|&quot;n&quot;
)paren
comma
id|N_
c_func
(paren
l_string|&quot;print &lt;n&gt; lines of each tag message&quot;
)paren
comma
id|PARSE_OPT_OPTARG
comma
l_int|NULL
comma
l_int|1
)brace
comma
id|OPT_CMDMODE
c_func
(paren
l_char|&squot;d&squot;
comma
l_string|&quot;delete&quot;
comma
op_amp
id|cmdmode
comma
id|N_
c_func
(paren
l_string|&quot;delete tags&quot;
)paren
comma
l_char|&squot;d&squot;
)paren
comma
id|OPT_CMDMODE
c_func
(paren
l_char|&squot;v&squot;
comma
l_string|&quot;verify&quot;
comma
op_amp
id|cmdmode
comma
id|N_
c_func
(paren
l_string|&quot;verify tags&quot;
)paren
comma
l_char|&squot;v&squot;
)paren
comma
id|OPT_GROUP
c_func
(paren
id|N_
c_func
(paren
l_string|&quot;Tag creation options&quot;
)paren
)paren
comma
id|OPT_BOOL
c_func
(paren
l_char|&squot;a&squot;
comma
l_string|&quot;annotate&quot;
comma
op_amp
id|annotate
comma
id|N_
c_func
(paren
l_string|&quot;annotated tag, needs a message&quot;
)paren
)paren
comma
id|OPT_CALLBACK
c_func
(paren
l_char|&squot;m&squot;
comma
l_string|&quot;message&quot;
comma
op_amp
id|msg
comma
id|N_
c_func
(paren
l_string|&quot;message&quot;
)paren
comma
id|N_
c_func
(paren
l_string|&quot;tag message&quot;
)paren
comma
id|parse_msg_arg
)paren
comma
id|OPT_FILENAME
c_func
(paren
l_char|&squot;F&squot;
comma
l_string|&quot;file&quot;
comma
op_amp
id|msgfile
comma
id|N_
c_func
(paren
l_string|&quot;read message from file&quot;
)paren
)paren
comma
id|OPT_BOOL
c_func
(paren
l_char|&squot;s&squot;
comma
l_string|&quot;sign&quot;
comma
op_amp
id|opt.sign
comma
id|N_
c_func
(paren
l_string|&quot;annotated and GPG-signed tag&quot;
)paren
)paren
comma
id|OPT_STRING
c_func
(paren
l_int|0
comma
l_string|&quot;cleanup&quot;
comma
op_amp
id|cleanup_arg
comma
id|N_
c_func
(paren
l_string|&quot;mode&quot;
)paren
comma
id|N_
c_func
(paren
l_string|&quot;how to strip spaces and #comments from message&quot;
)paren
)paren
comma
id|OPT_STRING
c_func
(paren
l_char|&squot;u&squot;
comma
l_string|&quot;local-user&quot;
comma
op_amp
id|keyid
comma
id|N_
c_func
(paren
l_string|&quot;key-id&quot;
)paren
comma
id|N_
c_func
(paren
l_string|&quot;use another key to sign the tag&quot;
)paren
)paren
comma
id|OPT__FORCE
c_func
(paren
op_amp
id|force
comma
id|N_
c_func
(paren
l_string|&quot;replace the tag if exists&quot;
)paren
)paren
comma
id|OPT_BOOL
c_func
(paren
l_int|0
comma
l_string|&quot;create-reflog&quot;
comma
op_amp
id|create_reflog
comma
id|N_
c_func
(paren
l_string|&quot;create_reflog&quot;
)paren
)paren
comma
id|OPT_GROUP
c_func
(paren
id|N_
c_func
(paren
l_string|&quot;Tag listing options&quot;
)paren
)paren
comma
id|OPT_COLUMN
c_func
(paren
l_int|0
comma
l_string|&quot;column&quot;
comma
op_amp
id|colopts
comma
id|N_
c_func
(paren
l_string|&quot;show tag list in columns&quot;
)paren
)paren
comma
id|OPT_CONTAINS
c_func
(paren
op_amp
id|filter.with_commit
comma
id|N_
c_func
(paren
l_string|&quot;print only tags that contain the commit&quot;
)paren
)paren
comma
id|OPT_WITH
c_func
(paren
op_amp
id|filter.with_commit
comma
id|N_
c_func
(paren
l_string|&quot;print only tags that contain the commit&quot;
)paren
)paren
comma
id|OPT_MERGED
c_func
(paren
op_amp
id|filter
comma
id|N_
c_func
(paren
l_string|&quot;print only tags that are merged&quot;
)paren
)paren
comma
id|OPT_NO_MERGED
c_func
(paren
op_amp
id|filter
comma
id|N_
c_func
(paren
l_string|&quot;print only tags that are not merged&quot;
)paren
)paren
comma
id|OPT_CALLBACK
c_func
(paren
l_int|0
comma
l_string|&quot;sort&quot;
comma
id|sorting_tail
comma
id|N_
c_func
(paren
l_string|&quot;key&quot;
)paren
comma
id|N_
c_func
(paren
l_string|&quot;field name to sort on&quot;
)paren
comma
op_amp
id|parse_opt_ref_sorting
)paren
comma
(brace
id|OPTION_CALLBACK
comma
l_int|0
comma
l_string|&quot;points-at&quot;
comma
op_amp
id|filter.points_at
comma
id|N_
c_func
(paren
l_string|&quot;object&quot;
)paren
comma
id|N_
c_func
(paren
l_string|&quot;print only tags of the object&quot;
)paren
comma
l_int|0
comma
id|parse_opt_object_name
)brace
comma
id|OPT_STRING
c_func
(paren
l_int|0
comma
l_string|&quot;format&quot;
comma
op_amp
id|format
comma
id|N_
c_func
(paren
l_string|&quot;format&quot;
)paren
comma
id|N_
c_func
(paren
l_string|&quot;format to use for the output&quot;
)paren
)paren
comma
id|OPT_END
c_func
(paren
)paren
)brace
suffix:semicolon
id|git_config
c_func
(paren
id|git_tag_config
comma
id|sorting_tail
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|opt
comma
l_int|0
comma
r_sizeof
(paren
id|opt
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|filter
comma
l_int|0
comma
r_sizeof
(paren
id|filter
)paren
)paren
suffix:semicolon
id|filter.lines
op_assign
l_int|1
suffix:semicolon
id|argc
op_assign
id|parse_options
c_func
(paren
id|argc
comma
id|argv
comma
id|prefix
comma
id|options
comma
id|git_tag_usage
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|keyid
)paren
(brace
id|opt.sign
op_assign
l_int|1
suffix:semicolon
id|set_signing_key
c_func
(paren
id|keyid
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|opt.sign
)paren
id|annotate
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|argc
op_eq
l_int|0
op_logical_and
op_logical_neg
id|cmdmode
)paren
id|cmdmode
op_assign
l_char|&squot;l&squot;
suffix:semicolon
r_if
c_cond
(paren
(paren
id|annotate
op_logical_or
id|msg.given
op_logical_or
id|msgfile
op_logical_or
id|force
)paren
op_logical_and
(paren
id|cmdmode
op_ne
l_int|0
)paren
)paren
id|usage_with_options
c_func
(paren
id|git_tag_usage
comma
id|options
)paren
suffix:semicolon
id|finalize_colopts
c_func
(paren
op_amp
id|colopts
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmdmode
op_eq
l_char|&squot;l&squot;
op_logical_and
id|filter.lines
op_ne
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|explicitly_enable_column
c_func
(paren
id|colopts
)paren
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;--column and -n are incompatible&quot;
)paren
)paren
suffix:semicolon
id|colopts
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|sorting
)paren
id|sorting
op_assign
id|ref_default_sorting
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmdmode
op_eq
l_char|&squot;l&squot;
)paren
(brace
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
id|column_active
c_func
(paren
id|colopts
)paren
)paren
(brace
r_struct
id|column_options
id|copts
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|copts
comma
l_int|0
comma
r_sizeof
(paren
id|copts
)paren
)paren
suffix:semicolon
id|copts.padding
op_assign
l_int|2
suffix:semicolon
id|run_column_filter
c_func
(paren
id|colopts
comma
op_amp
id|copts
)paren
suffix:semicolon
)brace
id|filter.name_patterns
op_assign
id|argv
suffix:semicolon
id|ret
op_assign
id|list_tags
c_func
(paren
op_amp
id|filter
comma
id|sorting
comma
id|format
)paren
suffix:semicolon
r_if
c_cond
(paren
id|column_active
c_func
(paren
id|colopts
)paren
)paren
id|stop_column_filter
c_func
(paren
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
r_if
c_cond
(paren
id|filter.lines
op_ne
l_int|1
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;-n option is only allowed with -l.&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|filter.with_commit
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;--contains option is only allowed with -l.&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|filter.points_at.nr
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;--points-at option is only allowed with -l.&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|filter.merge_commit
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;--merged and --no-merged option are only allowed with -l&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmdmode
op_eq
l_char|&squot;d&squot;
)paren
r_return
id|for_each_tag_name
c_func
(paren
id|argv
comma
id|delete_tag
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cmdmode
op_eq
l_char|&squot;v&squot;
)paren
r_return
id|for_each_tag_name
c_func
(paren
id|argv
comma
id|verify_tag
)paren
suffix:semicolon
r_if
c_cond
(paren
id|msg.given
op_logical_or
id|msgfile
)paren
(brace
r_if
c_cond
(paren
id|msg.given
op_logical_and
id|msgfile
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;only one -F or -m option is allowed.&quot;
)paren
)paren
suffix:semicolon
id|annotate
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|msg.given
)paren
id|strbuf_addbuf
c_func
(paren
op_amp
id|buf
comma
op_amp
(paren
id|msg.buf
)paren
)paren
suffix:semicolon
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|msgfile
comma
l_string|&quot;-&quot;
)paren
)paren
(brace
r_if
c_cond
(paren
id|strbuf_read
c_func
(paren
op_amp
id|buf
comma
l_int|0
comma
l_int|1024
)paren
OL
l_int|0
)paren
id|die_errno
c_func
(paren
id|_
c_func
(paren
l_string|&quot;cannot read &squot;%s&squot;&quot;
)paren
comma
id|msgfile
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|strbuf_read_file
c_func
(paren
op_amp
id|buf
comma
id|msgfile
comma
l_int|1024
)paren
OL
l_int|0
)paren
id|die_errno
c_func
(paren
id|_
c_func
(paren
l_string|&quot;could not open or read &squot;%s&squot;&quot;
)paren
comma
id|msgfile
)paren
suffix:semicolon
)brace
)brace
)brace
id|tag
op_assign
id|argv
(braket
l_int|0
)braket
suffix:semicolon
id|object_ref
op_assign
id|argc
op_eq
l_int|2
ques
c_cond
id|argv
(braket
l_int|1
)braket
suffix:colon
l_string|&quot;HEAD&quot;
suffix:semicolon
r_if
c_cond
(paren
id|argc
OG
l_int|2
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;too many params&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|get_sha1
c_func
(paren
id|object_ref
comma
id|object
)paren
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Failed to resolve &squot;%s&squot; as a valid ref.&quot;
)paren
comma
id|object_ref
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strbuf_check_tag_ref
c_func
(paren
op_amp
id|ref
comma
id|tag
)paren
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;&squot;%s&squot; is not a valid tag name.&quot;
)paren
comma
id|tag
)paren
suffix:semicolon
r_if
c_cond
(paren
id|read_ref
c_func
(paren
id|ref.buf
comma
id|prev
)paren
)paren
id|hashclr
c_func
(paren
id|prev
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|force
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;tag &squot;%s&squot; already exists&quot;
)paren
comma
id|tag
)paren
suffix:semicolon
id|opt.message_given
op_assign
id|msg.given
op_logical_or
id|msgfile
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cleanup_arg
op_logical_or
op_logical_neg
id|strcmp
c_func
(paren
id|cleanup_arg
comma
l_string|&quot;strip&quot;
)paren
)paren
id|opt.cleanup_mode
op_assign
id|CLEANUP_ALL
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|cleanup_arg
comma
l_string|&quot;verbatim&quot;
)paren
)paren
id|opt.cleanup_mode
op_assign
id|CLEANUP_NONE
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|cleanup_arg
comma
l_string|&quot;whitespace&quot;
)paren
)paren
id|opt.cleanup_mode
op_assign
id|CLEANUP_SPACE
suffix:semicolon
r_else
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Invalid cleanup mode %s&quot;
)paren
comma
id|cleanup_arg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|annotate
)paren
id|create_tag
c_func
(paren
id|object
comma
id|tag
comma
op_amp
id|buf
comma
op_amp
id|opt
comma
id|prev
comma
id|object
)paren
suffix:semicolon
id|transaction
op_assign
id|ref_transaction_begin
c_func
(paren
op_amp
id|err
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|transaction
op_logical_or
id|ref_transaction_update
c_func
(paren
id|transaction
comma
id|ref.buf
comma
id|object
comma
id|prev
comma
id|create_reflog
ques
c_cond
id|REF_FORCE_CREATE_REFLOG
suffix:colon
l_int|0
comma
l_int|NULL
comma
op_amp
id|err
)paren
op_logical_or
id|ref_transaction_commit
c_func
(paren
id|transaction
comma
op_amp
id|err
)paren
)paren
id|die
c_func
(paren
l_string|&quot;%s&quot;
comma
id|err.buf
)paren
suffix:semicolon
id|ref_transaction_free
c_func
(paren
id|transaction
)paren
suffix:semicolon
r_if
c_cond
(paren
id|force
op_logical_and
op_logical_neg
id|is_null_sha1
c_func
(paren
id|prev
)paren
op_logical_and
id|hashcmp
c_func
(paren
id|prev
comma
id|object
)paren
)paren
id|printf
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Updated tag &squot;%s&squot; (was %s)&bslash;n&quot;
)paren
comma
id|tag
comma
id|find_unique_abbrev
c_func
(paren
id|prev
comma
id|DEFAULT_ABBREV
)paren
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|err
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|buf
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|ref
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
eof
