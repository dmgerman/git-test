macro_line|#include &quot;cache.h&quot;
macro_line|#include &quot;builtin.h&quot;
macro_line|#include &quot;dir.h&quot;
macro_line|#include &quot;parse-options.h&quot;
macro_line|#include &quot;argv-array.h&quot;
macro_line|#include &quot;branch.h&quot;
macro_line|#include &quot;refs.h&quot;
macro_line|#include &quot;run-command.h&quot;
macro_line|#include &quot;sigchain.h&quot;
macro_line|#include &quot;refs.h&quot;
macro_line|#include &quot;utf8.h&quot;
macro_line|#include &quot;worktree.h&quot;
DECL|variable|worktree_usage
r_static
r_const
r_char
op_star
r_const
id|worktree_usage
(braket
)braket
op_assign
(brace
id|N_
c_func
(paren
l_string|&quot;git worktree add [&lt;options&gt;] &lt;path&gt; [&lt;branch&gt;]&quot;
)paren
comma
id|N_
c_func
(paren
l_string|&quot;git worktree prune [&lt;options&gt;]&quot;
)paren
comma
id|N_
c_func
(paren
l_string|&quot;git worktree list [&lt;options&gt;]&quot;
)paren
comma
l_int|NULL
)brace
suffix:semicolon
DECL|struct|add_opts
r_struct
id|add_opts
(brace
DECL|member|force
r_int
id|force
suffix:semicolon
DECL|member|detach
r_int
id|detach
suffix:semicolon
DECL|member|new_branch
r_const
r_char
op_star
id|new_branch
suffix:semicolon
DECL|member|force_new_branch
r_int
id|force_new_branch
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|show_only
r_static
r_int
id|show_only
suffix:semicolon
DECL|variable|verbose
r_static
r_int
id|verbose
suffix:semicolon
DECL|variable|expire
r_static
r_int
r_int
id|expire
suffix:semicolon
DECL|function|prune_worktree
r_static
r_int
id|prune_worktree
c_func
(paren
r_const
r_char
op_star
id|id
comma
r_struct
id|strbuf
op_star
id|reason
)paren
(brace
r_struct
id|stat
id|st
suffix:semicolon
r_char
op_star
id|path
suffix:semicolon
r_int
id|fd
comma
id|len
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|is_directory
c_func
(paren
id|git_path
c_func
(paren
l_string|&quot;worktrees/%s&quot;
comma
id|id
)paren
)paren
)paren
(brace
id|strbuf_addf
c_func
(paren
id|reason
comma
id|_
c_func
(paren
l_string|&quot;Removing worktrees/%s: not a valid directory&quot;
)paren
comma
id|id
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|file_exists
c_func
(paren
id|git_path
c_func
(paren
l_string|&quot;worktrees/%s/locked&quot;
comma
id|id
)paren
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|stat
c_func
(paren
id|git_path
c_func
(paren
l_string|&quot;worktrees/%s/gitdir&quot;
comma
id|id
)paren
comma
op_amp
id|st
)paren
)paren
(brace
id|strbuf_addf
c_func
(paren
id|reason
comma
id|_
c_func
(paren
l_string|&quot;Removing worktrees/%s: gitdir file does not exist&quot;
)paren
comma
id|id
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|fd
op_assign
id|open
c_func
(paren
id|git_path
c_func
(paren
l_string|&quot;worktrees/%s/gitdir&quot;
comma
id|id
)paren
comma
id|O_RDONLY
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fd
OL
l_int|0
)paren
(brace
id|strbuf_addf
c_func
(paren
id|reason
comma
id|_
c_func
(paren
l_string|&quot;Removing worktrees/%s: unable to read gitdir file (%s)&quot;
)paren
comma
id|id
comma
id|strerror
c_func
(paren
id|errno
)paren
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|len
op_assign
id|st.st_size
suffix:semicolon
id|path
op_assign
id|xmalloc
c_func
(paren
id|len
op_plus
l_int|1
)paren
suffix:semicolon
id|read_in_full
c_func
(paren
id|fd
comma
id|path
comma
id|len
)paren
suffix:semicolon
id|close
c_func
(paren
id|fd
)paren
suffix:semicolon
r_while
c_loop
(paren
id|len
op_logical_and
(paren
id|path
(braket
id|len
l_int|1
)braket
op_eq
l_char|&squot;&bslash;n&squot;
op_logical_or
id|path
(braket
id|len
l_int|1
)braket
op_eq
l_char|&squot;&bslash;r&squot;
)paren
)paren
id|len
op_decrement
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|len
)paren
(brace
id|strbuf_addf
c_func
(paren
id|reason
comma
id|_
c_func
(paren
l_string|&quot;Removing worktrees/%s: invalid gitdir file&quot;
)paren
comma
id|id
)paren
suffix:semicolon
id|free
c_func
(paren
id|path
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|path
(braket
id|len
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|file_exists
c_func
(paren
id|path
)paren
)paren
(brace
r_struct
id|stat
id|st_link
suffix:semicolon
id|free
c_func
(paren
id|path
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * the repo is moved manually and has not been&n;&t;&t; * accessed since?&n;&t;&t; */
r_if
c_cond
(paren
op_logical_neg
id|stat
c_func
(paren
id|git_path
c_func
(paren
l_string|&quot;worktrees/%s/link&quot;
comma
id|id
)paren
comma
op_amp
id|st_link
)paren
op_logical_and
id|st_link.st_nlink
OG
l_int|1
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|st.st_mtime
op_le
id|expire
)paren
(brace
id|strbuf_addf
c_func
(paren
id|reason
comma
id|_
c_func
(paren
l_string|&quot;Removing worktrees/%s: gitdir file points to non-existent location&quot;
)paren
comma
id|id
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_else
(brace
r_return
l_int|0
suffix:semicolon
)brace
)brace
id|free
c_func
(paren
id|path
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|prune_worktrees
r_static
r_void
id|prune_worktrees
c_func
(paren
r_void
)paren
(brace
r_struct
id|strbuf
id|reason
op_assign
id|STRBUF_INIT
suffix:semicolon
r_struct
id|strbuf
id|path
op_assign
id|STRBUF_INIT
suffix:semicolon
id|DIR
op_star
id|dir
op_assign
id|opendir
c_func
(paren
id|git_path
c_func
(paren
l_string|&quot;worktrees&quot;
)paren
)paren
suffix:semicolon
r_struct
id|dirent
op_star
id|d
suffix:semicolon
r_int
id|ret
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dir
)paren
r_return
suffix:semicolon
r_while
c_loop
(paren
(paren
id|d
op_assign
id|readdir
c_func
(paren
id|dir
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|d-&gt;d_name
comma
l_string|&quot;.&quot;
)paren
op_logical_or
op_logical_neg
id|strcmp
c_func
(paren
id|d-&gt;d_name
comma
l_string|&quot;..&quot;
)paren
)paren
r_continue
suffix:semicolon
id|strbuf_reset
c_func
(paren
op_amp
id|reason
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|prune_worktree
c_func
(paren
id|d-&gt;d_name
comma
op_amp
id|reason
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|show_only
op_logical_or
id|verbose
)paren
id|printf
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|reason.buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|show_only
)paren
r_continue
suffix:semicolon
id|strbuf_reset
c_func
(paren
op_amp
id|path
)paren
suffix:semicolon
id|strbuf_addstr
c_func
(paren
op_amp
id|path
comma
id|git_path
c_func
(paren
l_string|&quot;worktrees/%s&quot;
comma
id|d-&gt;d_name
)paren
)paren
suffix:semicolon
id|ret
op_assign
id|remove_dir_recursively
c_func
(paren
op_amp
id|path
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
OL
l_int|0
op_logical_and
id|errno
op_eq
id|ENOTDIR
)paren
id|ret
op_assign
id|unlink
c_func
(paren
id|path.buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;failed to remove: %s&quot;
)paren
comma
id|strerror
c_func
(paren
id|errno
)paren
)paren
suffix:semicolon
)brace
id|closedir
c_func
(paren
id|dir
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|show_only
)paren
id|rmdir
c_func
(paren
id|git_path
c_func
(paren
l_string|&quot;worktrees&quot;
)paren
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|reason
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|path
)paren
suffix:semicolon
)brace
DECL|function|prune
r_static
r_int
id|prune
c_func
(paren
r_int
id|ac
comma
r_const
r_char
op_star
op_star
id|av
comma
r_const
r_char
op_star
id|prefix
)paren
(brace
r_struct
id|option
id|options
(braket
)braket
op_assign
(brace
id|OPT__DRY_RUN
c_func
(paren
op_amp
id|show_only
comma
id|N_
c_func
(paren
l_string|&quot;do not remove, show only&quot;
)paren
)paren
comma
id|OPT__VERBOSE
c_func
(paren
op_amp
id|verbose
comma
id|N_
c_func
(paren
l_string|&quot;report pruned objects&quot;
)paren
)paren
comma
id|OPT_EXPIRY_DATE
c_func
(paren
l_int|0
comma
l_string|&quot;expire&quot;
comma
op_amp
id|expire
comma
id|N_
c_func
(paren
l_string|&quot;expire objects older than &lt;time&gt;&quot;
)paren
)paren
comma
id|OPT_END
c_func
(paren
)paren
)brace
suffix:semicolon
id|expire
op_assign
id|ULONG_MAX
suffix:semicolon
id|ac
op_assign
id|parse_options
c_func
(paren
id|ac
comma
id|av
comma
id|prefix
comma
id|options
comma
id|worktree_usage
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ac
)paren
id|usage_with_options
c_func
(paren
id|worktree_usage
comma
id|options
)paren
suffix:semicolon
id|prune_worktrees
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|junk_work_tree
r_static
r_char
op_star
id|junk_work_tree
suffix:semicolon
DECL|variable|junk_git_dir
r_static
r_char
op_star
id|junk_git_dir
suffix:semicolon
DECL|variable|is_junk
r_static
r_int
id|is_junk
suffix:semicolon
DECL|variable|junk_pid
r_static
id|pid_t
id|junk_pid
suffix:semicolon
DECL|function|remove_junk
r_static
r_void
id|remove_junk
c_func
(paren
r_void
)paren
(brace
r_struct
id|strbuf
id|sb
op_assign
id|STRBUF_INIT
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|is_junk
op_logical_or
id|getpid
c_func
(paren
)paren
op_ne
id|junk_pid
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|junk_git_dir
)paren
(brace
id|strbuf_addstr
c_func
(paren
op_amp
id|sb
comma
id|junk_git_dir
)paren
suffix:semicolon
id|remove_dir_recursively
c_func
(paren
op_amp
id|sb
comma
l_int|0
)paren
suffix:semicolon
id|strbuf_reset
c_func
(paren
op_amp
id|sb
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|junk_work_tree
)paren
(brace
id|strbuf_addstr
c_func
(paren
op_amp
id|sb
comma
id|junk_work_tree
)paren
suffix:semicolon
id|remove_dir_recursively
c_func
(paren
op_amp
id|sb
comma
l_int|0
)paren
suffix:semicolon
)brace
id|strbuf_release
c_func
(paren
op_amp
id|sb
)paren
suffix:semicolon
)brace
DECL|function|remove_junk_on_signal
r_static
r_void
id|remove_junk_on_signal
c_func
(paren
r_int
id|signo
)paren
(brace
id|remove_junk
c_func
(paren
)paren
suffix:semicolon
id|sigchain_pop
c_func
(paren
id|signo
)paren
suffix:semicolon
id|raise
c_func
(paren
id|signo
)paren
suffix:semicolon
)brace
DECL|function|worktree_basename
r_static
r_const
r_char
op_star
id|worktree_basename
c_func
(paren
r_const
r_char
op_star
id|path
comma
r_int
op_star
id|olen
)paren
(brace
r_const
r_char
op_star
id|name
suffix:semicolon
r_int
id|len
suffix:semicolon
id|len
op_assign
id|strlen
c_func
(paren
id|path
)paren
suffix:semicolon
r_while
c_loop
(paren
id|len
op_logical_and
id|is_dir_sep
c_func
(paren
id|path
(braket
id|len
l_int|1
)braket
)paren
)paren
id|len
op_decrement
suffix:semicolon
r_for
c_loop
(paren
id|name
op_assign
id|path
op_plus
id|len
l_int|1
suffix:semicolon
id|name
OG
id|path
suffix:semicolon
id|name
op_decrement
)paren
r_if
c_cond
(paren
id|is_dir_sep
c_func
(paren
op_star
id|name
)paren
)paren
(brace
id|name
op_increment
suffix:semicolon
r_break
suffix:semicolon
)brace
op_star
id|olen
op_assign
id|len
suffix:semicolon
r_return
id|name
suffix:semicolon
)brace
DECL|function|add_worktree
r_static
r_int
id|add_worktree
c_func
(paren
r_const
r_char
op_star
id|path
comma
r_const
r_char
op_star
id|refname
comma
r_const
r_struct
id|add_opts
op_star
id|opts
)paren
(brace
r_struct
id|strbuf
id|sb_git
op_assign
id|STRBUF_INIT
comma
id|sb_repo
op_assign
id|STRBUF_INIT
suffix:semicolon
r_struct
id|strbuf
id|sb
op_assign
id|STRBUF_INIT
suffix:semicolon
r_const
r_char
op_star
id|name
suffix:semicolon
r_struct
id|stat
id|st
suffix:semicolon
r_struct
id|child_process
id|cp
suffix:semicolon
r_struct
id|argv_array
id|child_env
op_assign
id|ARGV_ARRAY_INIT
suffix:semicolon
r_int
id|counter
op_assign
l_int|0
comma
id|len
comma
id|ret
suffix:semicolon
r_struct
id|strbuf
id|symref
op_assign
id|STRBUF_INIT
suffix:semicolon
r_struct
id|commit
op_star
id|commit
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|file_exists
c_func
(paren
id|path
)paren
op_logical_and
op_logical_neg
id|is_empty_dir
c_func
(paren
id|path
)paren
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;&squot;%s&squot; already exists&quot;
)paren
comma
id|path
)paren
suffix:semicolon
multiline_comment|/* is &squot;refname&squot; a branch or commit? */
r_if
c_cond
(paren
id|opts-&gt;force_new_branch
)paren
multiline_comment|/* definitely a branch */
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|opts-&gt;detach
op_logical_and
op_logical_neg
id|strbuf_check_branch_ref
c_func
(paren
op_amp
id|symref
comma
id|refname
)paren
op_logical_and
id|ref_exists
c_func
(paren
id|symref.buf
)paren
)paren
(brace
multiline_comment|/* it&squot;s a branch */
r_if
c_cond
(paren
op_logical_neg
id|opts-&gt;force
)paren
id|die_if_checked_out
c_func
(paren
id|symref.buf
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* must be a commit */
id|commit
op_assign
id|lookup_commit_reference_by_name
c_func
(paren
id|refname
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|commit
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;invalid reference: %s&quot;
)paren
comma
id|refname
)paren
suffix:semicolon
)brace
id|name
op_assign
id|worktree_basename
c_func
(paren
id|path
comma
op_amp
id|len
)paren
suffix:semicolon
id|strbuf_addstr
c_func
(paren
op_amp
id|sb_repo
comma
id|git_path
c_func
(paren
l_string|&quot;worktrees/%.*s&quot;
comma
(paren
r_int
)paren
(paren
id|path
op_plus
id|len
id|name
)paren
comma
id|name
)paren
)paren
suffix:semicolon
id|len
op_assign
id|sb_repo.len
suffix:semicolon
r_if
c_cond
(paren
id|safe_create_leading_directories_const
c_func
(paren
id|sb_repo.buf
)paren
)paren
id|die_errno
c_func
(paren
id|_
c_func
(paren
l_string|&quot;could not create leading directories of &squot;%s&squot;&quot;
)paren
comma
id|sb_repo.buf
)paren
suffix:semicolon
r_while
c_loop
(paren
op_logical_neg
id|stat
c_func
(paren
id|sb_repo.buf
comma
op_amp
id|st
)paren
)paren
(brace
id|counter
op_increment
suffix:semicolon
id|strbuf_setlen
c_func
(paren
op_amp
id|sb_repo
comma
id|len
)paren
suffix:semicolon
id|strbuf_addf
c_func
(paren
op_amp
id|sb_repo
comma
l_string|&quot;%d&quot;
comma
id|counter
)paren
suffix:semicolon
)brace
id|name
op_assign
id|strrchr
c_func
(paren
id|sb_repo.buf
comma
l_char|&squot;/&squot;
)paren
op_plus
l_int|1
suffix:semicolon
id|junk_pid
op_assign
id|getpid
c_func
(paren
)paren
suffix:semicolon
id|atexit
c_func
(paren
id|remove_junk
)paren
suffix:semicolon
id|sigchain_push_common
c_func
(paren
id|remove_junk_on_signal
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mkdir
c_func
(paren
id|sb_repo.buf
comma
l_int|0777
)paren
)paren
id|die_errno
c_func
(paren
id|_
c_func
(paren
l_string|&quot;could not create directory of &squot;%s&squot;&quot;
)paren
comma
id|sb_repo.buf
)paren
suffix:semicolon
id|junk_git_dir
op_assign
id|xstrdup
c_func
(paren
id|sb_repo.buf
)paren
suffix:semicolon
id|is_junk
op_assign
l_int|1
suffix:semicolon
multiline_comment|/*&n;&t; * lock the incomplete repo so prune won&squot;t delete it, unlock&n;&t; * after the preparation is over.&n;&t; */
id|strbuf_addf
c_func
(paren
op_amp
id|sb
comma
l_string|&quot;%s/locked&quot;
comma
id|sb_repo.buf
)paren
suffix:semicolon
id|write_file
c_func
(paren
id|sb.buf
comma
l_string|&quot;initializing&quot;
)paren
suffix:semicolon
id|strbuf_addf
c_func
(paren
op_amp
id|sb_git
comma
l_string|&quot;%s/.git&quot;
comma
id|path
)paren
suffix:semicolon
r_if
c_cond
(paren
id|safe_create_leading_directories_const
c_func
(paren
id|sb_git.buf
)paren
)paren
id|die_errno
c_func
(paren
id|_
c_func
(paren
l_string|&quot;could not create leading directories of &squot;%s&squot;&quot;
)paren
comma
id|sb_git.buf
)paren
suffix:semicolon
id|junk_work_tree
op_assign
id|xstrdup
c_func
(paren
id|path
)paren
suffix:semicolon
id|strbuf_reset
c_func
(paren
op_amp
id|sb
)paren
suffix:semicolon
id|strbuf_addf
c_func
(paren
op_amp
id|sb
comma
l_string|&quot;%s/gitdir&quot;
comma
id|sb_repo.buf
)paren
suffix:semicolon
id|write_file
c_func
(paren
id|sb.buf
comma
l_string|&quot;%s&quot;
comma
id|real_path
c_func
(paren
id|sb_git.buf
)paren
)paren
suffix:semicolon
id|write_file
c_func
(paren
id|sb_git.buf
comma
l_string|&quot;gitdir: %s/worktrees/%s&quot;
comma
id|real_path
c_func
(paren
id|get_git_common_dir
c_func
(paren
)paren
)paren
comma
id|name
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * This is to keep resolve_ref() happy. We need a valid HEAD&n;&t; * or is_git_directory() will reject the directory. Any value which&n;&t; * looks like an object ID will do since it will be immediately&n;&t; * replaced by the symbolic-ref or update-ref invocation in the new&n;&t; * worktree.&n;&t; */
id|strbuf_reset
c_func
(paren
op_amp
id|sb
)paren
suffix:semicolon
id|strbuf_addf
c_func
(paren
op_amp
id|sb
comma
l_string|&quot;%s/HEAD&quot;
comma
id|sb_repo.buf
)paren
suffix:semicolon
id|write_file
c_func
(paren
id|sb.buf
comma
l_string|&quot;0000000000000000000000000000000000000000&quot;
)paren
suffix:semicolon
id|strbuf_reset
c_func
(paren
op_amp
id|sb
)paren
suffix:semicolon
id|strbuf_addf
c_func
(paren
op_amp
id|sb
comma
l_string|&quot;%s/commondir&quot;
comma
id|sb_repo.buf
)paren
suffix:semicolon
id|write_file
c_func
(paren
id|sb.buf
comma
l_string|&quot;../..&quot;
)paren
suffix:semicolon
id|fprintf_ln
c_func
(paren
id|stderr
comma
id|_
c_func
(paren
l_string|&quot;Preparing %s (identifier %s)&quot;
)paren
comma
id|path
comma
id|name
)paren
suffix:semicolon
id|argv_array_pushf
c_func
(paren
op_amp
id|child_env
comma
l_string|&quot;%s=%s&quot;
comma
id|GIT_DIR_ENVIRONMENT
comma
id|sb_git.buf
)paren
suffix:semicolon
id|argv_array_pushf
c_func
(paren
op_amp
id|child_env
comma
l_string|&quot;%s=%s&quot;
comma
id|GIT_WORK_TREE_ENVIRONMENT
comma
id|path
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|cp
comma
l_int|0
comma
r_sizeof
(paren
id|cp
)paren
)paren
suffix:semicolon
id|cp.git_cmd
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|commit
)paren
id|argv_array_pushl
c_func
(paren
op_amp
id|cp.args
comma
l_string|&quot;update-ref&quot;
comma
l_string|&quot;HEAD&quot;
comma
id|oid_to_hex
c_func
(paren
op_amp
id|commit-&gt;object.oid
)paren
comma
l_int|NULL
)paren
suffix:semicolon
r_else
id|argv_array_pushl
c_func
(paren
op_amp
id|cp.args
comma
l_string|&quot;symbolic-ref&quot;
comma
l_string|&quot;HEAD&quot;
comma
id|symref.buf
comma
l_int|NULL
)paren
suffix:semicolon
id|cp.env
op_assign
id|child_env.argv
suffix:semicolon
id|ret
op_assign
id|run_command
c_func
(paren
op_amp
id|cp
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_goto
id|done
suffix:semicolon
id|cp.argv
op_assign
l_int|NULL
suffix:semicolon
id|argv_array_clear
c_func
(paren
op_amp
id|cp.args
)paren
suffix:semicolon
id|argv_array_pushl
c_func
(paren
op_amp
id|cp.args
comma
l_string|&quot;reset&quot;
comma
l_string|&quot;--hard&quot;
comma
l_int|NULL
)paren
suffix:semicolon
id|cp.env
op_assign
id|child_env.argv
suffix:semicolon
id|ret
op_assign
id|run_command
c_func
(paren
op_amp
id|cp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ret
)paren
(brace
id|is_junk
op_assign
l_int|0
suffix:semicolon
id|free
c_func
(paren
id|junk_work_tree
)paren
suffix:semicolon
id|free
c_func
(paren
id|junk_git_dir
)paren
suffix:semicolon
id|junk_work_tree
op_assign
l_int|NULL
suffix:semicolon
id|junk_git_dir
op_assign
l_int|NULL
suffix:semicolon
)brace
id|done
suffix:colon
id|strbuf_reset
c_func
(paren
op_amp
id|sb
)paren
suffix:semicolon
id|strbuf_addf
c_func
(paren
op_amp
id|sb
comma
l_string|&quot;%s/locked&quot;
comma
id|sb_repo.buf
)paren
suffix:semicolon
id|unlink_or_warn
c_func
(paren
id|sb.buf
)paren
suffix:semicolon
id|argv_array_clear
c_func
(paren
op_amp
id|child_env
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|sb
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|symref
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|sb_repo
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|sb_git
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|add
r_static
r_int
id|add
c_func
(paren
r_int
id|ac
comma
r_const
r_char
op_star
op_star
id|av
comma
r_const
r_char
op_star
id|prefix
)paren
(brace
r_struct
id|add_opts
id|opts
suffix:semicolon
r_const
r_char
op_star
id|new_branch_force
op_assign
l_int|NULL
suffix:semicolon
r_const
r_char
op_star
id|path
comma
op_star
id|branch
suffix:semicolon
r_struct
id|option
id|options
(braket
)braket
op_assign
(brace
id|OPT__FORCE
c_func
(paren
op_amp
id|opts.force
comma
id|N_
c_func
(paren
l_string|&quot;checkout &lt;branch&gt; even if already checked out in other worktree&quot;
)paren
)paren
comma
id|OPT_STRING
c_func
(paren
l_char|&squot;b&squot;
comma
l_int|NULL
comma
op_amp
id|opts.new_branch
comma
id|N_
c_func
(paren
l_string|&quot;branch&quot;
)paren
comma
id|N_
c_func
(paren
l_string|&quot;create a new branch&quot;
)paren
)paren
comma
id|OPT_STRING
c_func
(paren
l_char|&squot;B&squot;
comma
l_int|NULL
comma
op_amp
id|new_branch_force
comma
id|N_
c_func
(paren
l_string|&quot;branch&quot;
)paren
comma
id|N_
c_func
(paren
l_string|&quot;create or reset a branch&quot;
)paren
)paren
comma
id|OPT_BOOL
c_func
(paren
l_int|0
comma
l_string|&quot;detach&quot;
comma
op_amp
id|opts.detach
comma
id|N_
c_func
(paren
l_string|&quot;detach HEAD at named commit&quot;
)paren
)paren
comma
id|OPT_END
c_func
(paren
)paren
)brace
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|opts
comma
l_int|0
comma
r_sizeof
(paren
id|opts
)paren
)paren
suffix:semicolon
id|ac
op_assign
id|parse_options
c_func
(paren
id|ac
comma
id|av
comma
id|prefix
comma
id|options
comma
id|worktree_usage
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_logical_neg
id|opts.detach
op_plus
op_logical_neg
op_logical_neg
id|opts.new_branch
op_plus
op_logical_neg
op_logical_neg
id|new_branch_force
OG
l_int|1
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;-b, -B, and --detach are mutually exclusive&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ac
template_param
l_int|2
)paren
id|usage_with_options
c_func
(paren
id|worktree_usage
comma
id|options
)paren
suffix:semicolon
id|path
op_assign
id|prefix
ques
c_cond
id|prefix_filename
c_func
(paren
id|prefix
comma
id|strlen
c_func
(paren
id|prefix
)paren
comma
id|av
(braket
l_int|0
)braket
)paren
suffix:colon
id|av
(braket
l_int|0
)braket
suffix:semicolon
id|branch
op_assign
id|ac
OL
l_int|2
ques
c_cond
l_string|&quot;HEAD&quot;
suffix:colon
id|av
(braket
l_int|1
)braket
suffix:semicolon
id|opts.force_new_branch
op_assign
op_logical_neg
op_logical_neg
id|new_branch_force
suffix:semicolon
r_if
c_cond
(paren
id|opts.force_new_branch
)paren
id|opts.new_branch
op_assign
id|new_branch_force
suffix:semicolon
r_if
c_cond
(paren
id|ac
OL
l_int|2
op_logical_and
op_logical_neg
id|opts.new_branch
op_logical_and
op_logical_neg
id|opts.detach
)paren
(brace
r_int
id|n
suffix:semicolon
r_const
r_char
op_star
id|s
op_assign
id|worktree_basename
c_func
(paren
id|path
comma
op_amp
id|n
)paren
suffix:semicolon
id|opts.new_branch
op_assign
id|xstrndup
c_func
(paren
id|s
comma
id|n
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|opts.new_branch
)paren
(brace
r_struct
id|child_process
id|cp
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|cp
comma
l_int|0
comma
r_sizeof
(paren
id|cp
)paren
)paren
suffix:semicolon
id|cp.git_cmd
op_assign
l_int|1
suffix:semicolon
id|argv_array_push
c_func
(paren
op_amp
id|cp.args
comma
l_string|&quot;branch&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opts.force_new_branch
)paren
id|argv_array_push
c_func
(paren
op_amp
id|cp.args
comma
l_string|&quot;--force&quot;
)paren
suffix:semicolon
id|argv_array_push
c_func
(paren
op_amp
id|cp.args
comma
id|opts.new_branch
)paren
suffix:semicolon
id|argv_array_push
c_func
(paren
op_amp
id|cp.args
comma
id|branch
)paren
suffix:semicolon
r_if
c_cond
(paren
id|run_command
c_func
(paren
op_amp
id|cp
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|branch
op_assign
id|opts.new_branch
suffix:semicolon
)brace
r_return
id|add_worktree
c_func
(paren
id|path
comma
id|branch
comma
op_amp
id|opts
)paren
suffix:semicolon
)brace
DECL|function|show_worktree_porcelain
r_static
r_void
id|show_worktree_porcelain
c_func
(paren
r_struct
id|worktree
op_star
id|wt
)paren
(brace
id|printf
c_func
(paren
l_string|&quot;worktree %s&bslash;n&quot;
comma
id|wt-&gt;path
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wt-&gt;is_bare
)paren
id|printf
c_func
(paren
l_string|&quot;bare&bslash;n&quot;
)paren
suffix:semicolon
r_else
(brace
id|printf
c_func
(paren
l_string|&quot;HEAD %s&bslash;n&quot;
comma
id|sha1_to_hex
c_func
(paren
id|wt-&gt;head_sha1
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wt-&gt;is_detached
)paren
id|printf
c_func
(paren
l_string|&quot;detached&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|printf
c_func
(paren
l_string|&quot;branch %s&bslash;n&quot;
comma
id|wt-&gt;head_ref
)paren
suffix:semicolon
)brace
id|printf
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
DECL|function|show_worktree
r_static
r_void
id|show_worktree
c_func
(paren
r_struct
id|worktree
op_star
id|wt
comma
r_int
id|path_maxlen
comma
r_int
id|abbrev_len
)paren
(brace
r_struct
id|strbuf
id|sb
op_assign
id|STRBUF_INIT
suffix:semicolon
r_int
id|cur_path_len
op_assign
id|strlen
c_func
(paren
id|wt-&gt;path
)paren
suffix:semicolon
r_int
id|path_adj
op_assign
id|cur_path_len
id|utf8_strwidth
c_func
(paren
id|wt-&gt;path
)paren
suffix:semicolon
id|strbuf_addf
c_func
(paren
op_amp
id|sb
comma
l_string|&quot;%-*s &quot;
comma
l_int|1
op_plus
id|path_maxlen
op_plus
id|path_adj
comma
id|wt-&gt;path
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wt-&gt;is_bare
)paren
id|strbuf_addstr
c_func
(paren
op_amp
id|sb
comma
l_string|&quot;(bare)&quot;
)paren
suffix:semicolon
r_else
(brace
id|strbuf_addf
c_func
(paren
op_amp
id|sb
comma
l_string|&quot;%-*s &quot;
comma
id|abbrev_len
comma
id|find_unique_abbrev
c_func
(paren
id|wt-&gt;head_sha1
comma
id|DEFAULT_ABBREV
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|wt-&gt;is_detached
)paren
id|strbuf_addf
c_func
(paren
op_amp
id|sb
comma
l_string|&quot;[%s]&quot;
comma
id|shorten_unambiguous_ref
c_func
(paren
id|wt-&gt;head_ref
comma
l_int|0
)paren
)paren
suffix:semicolon
r_else
id|strbuf_addstr
c_func
(paren
op_amp
id|sb
comma
l_string|&quot;(detached HEAD)&quot;
)paren
suffix:semicolon
)brace
id|printf
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|sb.buf
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|sb
)paren
suffix:semicolon
)brace
DECL|function|measure_widths
r_static
r_void
id|measure_widths
c_func
(paren
r_struct
id|worktree
op_star
op_star
id|wt
comma
r_int
op_star
id|abbrev
comma
r_int
op_star
id|maxlen
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|wt
(braket
id|i
)braket
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|sha1_len
suffix:semicolon
r_int
id|path_len
op_assign
id|strlen
c_func
(paren
id|wt
(braket
id|i
)braket
op_member_access_from_pointer
id|path
)paren
suffix:semicolon
r_if
c_cond
(paren
id|path_len
OG
op_star
id|maxlen
)paren
op_star
id|maxlen
op_assign
id|path_len
suffix:semicolon
id|sha1_len
op_assign
id|strlen
c_func
(paren
id|find_unique_abbrev
c_func
(paren
id|wt
(braket
id|i
)braket
op_member_access_from_pointer
id|head_sha1
comma
op_star
id|abbrev
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sha1_len
OG
op_star
id|abbrev
)paren
op_star
id|abbrev
op_assign
id|sha1_len
suffix:semicolon
)brace
)brace
DECL|function|list
r_static
r_int
id|list
c_func
(paren
r_int
id|ac
comma
r_const
r_char
op_star
op_star
id|av
comma
r_const
r_char
op_star
id|prefix
)paren
(brace
r_int
id|porcelain
op_assign
l_int|0
suffix:semicolon
r_struct
id|option
id|options
(braket
)braket
op_assign
(brace
id|OPT_BOOL
c_func
(paren
l_int|0
comma
l_string|&quot;porcelain&quot;
comma
op_amp
id|porcelain
comma
id|N_
c_func
(paren
l_string|&quot;machine-readable output&quot;
)paren
)paren
comma
id|OPT_END
c_func
(paren
)paren
)brace
suffix:semicolon
id|ac
op_assign
id|parse_options
c_func
(paren
id|ac
comma
id|av
comma
id|prefix
comma
id|options
comma
id|worktree_usage
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ac
)paren
id|usage_with_options
c_func
(paren
id|worktree_usage
comma
id|options
)paren
suffix:semicolon
r_else
(brace
r_struct
id|worktree
op_star
op_star
id|worktrees
op_assign
id|get_worktrees
c_func
(paren
)paren
suffix:semicolon
r_int
id|path_maxlen
op_assign
l_int|0
comma
id|abbrev
op_assign
id|DEFAULT_ABBREV
comma
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|porcelain
)paren
id|measure_widths
c_func
(paren
id|worktrees
comma
op_amp
id|abbrev
comma
op_amp
id|path_maxlen
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|worktrees
(braket
id|i
)braket
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|porcelain
)paren
id|show_worktree_porcelain
c_func
(paren
id|worktrees
(braket
id|i
)braket
)paren
suffix:semicolon
r_else
id|show_worktree
c_func
(paren
id|worktrees
(braket
id|i
)braket
comma
id|path_maxlen
comma
id|abbrev
)paren
suffix:semicolon
)brace
id|free_worktrees
c_func
(paren
id|worktrees
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|cmd_worktree
r_int
id|cmd_worktree
c_func
(paren
r_int
id|ac
comma
r_const
r_char
op_star
op_star
id|av
comma
r_const
r_char
op_star
id|prefix
)paren
(brace
r_struct
id|option
id|options
(braket
)braket
op_assign
(brace
id|OPT_END
c_func
(paren
)paren
)brace
suffix:semicolon
r_if
c_cond
(paren
id|ac
OL
l_int|2
)paren
id|usage_with_options
c_func
(paren
id|worktree_usage
comma
id|options
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|av
(braket
l_int|1
)braket
comma
l_string|&quot;add&quot;
)paren
)paren
r_return
id|add
c_func
(paren
id|ac
l_int|1
comma
id|av
op_plus
l_int|1
comma
id|prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|av
(braket
l_int|1
)braket
comma
l_string|&quot;prune&quot;
)paren
)paren
r_return
id|prune
c_func
(paren
id|ac
l_int|1
comma
id|av
op_plus
l_int|1
comma
id|prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|av
(braket
l_int|1
)braket
comma
l_string|&quot;list&quot;
)paren
)paren
r_return
id|list
c_func
(paren
id|ac
l_int|1
comma
id|av
op_plus
l_int|1
comma
id|prefix
)paren
suffix:semicolon
id|usage_with_options
c_func
(paren
id|worktree_usage
comma
id|options
)paren
suffix:semicolon
)brace
eof
