macro_line|#include &quot;cache.h&quot;
macro_line|#include &quot;builtin.h&quot;
macro_line|#include &quot;object.h&quot;
macro_line|#include &quot;commit.h&quot;
macro_line|#include &quot;tag.h&quot;
macro_line|#include &quot;run-command.h&quot;
macro_line|#include &quot;exec_cmd.h&quot;
macro_line|#include &quot;utf8.h&quot;
macro_line|#include &quot;parse-options.h&quot;
macro_line|#include &quot;cache-tree.h&quot;
macro_line|#include &quot;diff.h&quot;
macro_line|#include &quot;revision.h&quot;
macro_line|#include &quot;rerere.h&quot;
macro_line|#include &quot;merge-recursive.h&quot;
macro_line|#include &quot;refs.h&quot;
macro_line|#include &quot;dir.h&quot;
macro_line|#include &quot;sequencer.h&quot;
multiline_comment|/*&n; * This implements the builtins revert and cherry-pick.&n; *&n; * Copyright (c) 2007 Johannes E. Schindelin&n; *&n; * Based on git-revert.sh, which is&n; *&n; * Copyright (c) 2005 Linus Torvalds&n; * Copyright (c) 2005 Junio C Hamano&n; */
DECL|variable|revert_usage
r_static
r_const
r_char
op_star
r_const
id|revert_usage
(braket
)braket
op_assign
(brace
l_string|&quot;git revert [options] &lt;commit-ish&gt;&quot;
comma
l_string|&quot;git revert &lt;subcommand&gt;&quot;
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|cherry_pick_usage
r_static
r_const
r_char
op_star
r_const
id|cherry_pick_usage
(braket
)braket
op_assign
(brace
l_string|&quot;git cherry-pick [options] &lt;commit-ish&gt;&quot;
comma
l_string|&quot;git cherry-pick &lt;subcommand&gt;&quot;
comma
l_int|NULL
)brace
suffix:semicolon
DECL|enum|replay_action
DECL|enumerator|REVERT
DECL|enumerator|CHERRY_PICK
r_enum
id|replay_action
(brace
id|REVERT
comma
id|CHERRY_PICK
)brace
suffix:semicolon
DECL|enum|replay_subcommand
r_enum
id|replay_subcommand
(brace
DECL|enumerator|REPLAY_NONE
id|REPLAY_NONE
comma
DECL|enumerator|REPLAY_REMOVE_STATE
id|REPLAY_REMOVE_STATE
comma
DECL|enumerator|REPLAY_CONTINUE
id|REPLAY_CONTINUE
comma
DECL|enumerator|REPLAY_ROLLBACK
id|REPLAY_ROLLBACK
)brace
suffix:semicolon
DECL|struct|replay_opts
r_struct
id|replay_opts
(brace
DECL|member|action
r_enum
id|replay_action
id|action
suffix:semicolon
DECL|member|subcommand
r_enum
id|replay_subcommand
id|subcommand
suffix:semicolon
multiline_comment|/* Boolean options */
DECL|member|edit
r_int
id|edit
suffix:semicolon
DECL|member|record_origin
r_int
id|record_origin
suffix:semicolon
DECL|member|no_commit
r_int
id|no_commit
suffix:semicolon
DECL|member|signoff
r_int
id|signoff
suffix:semicolon
DECL|member|allow_ff
r_int
id|allow_ff
suffix:semicolon
DECL|member|allow_rerere_auto
r_int
id|allow_rerere_auto
suffix:semicolon
DECL|member|mainline
r_int
id|mainline
suffix:semicolon
multiline_comment|/* Merge strategy */
DECL|member|strategy
r_const
r_char
op_star
id|strategy
suffix:semicolon
DECL|member|xopts
r_const
r_char
op_star
op_star
id|xopts
suffix:semicolon
DECL|member|xopts_nr
DECL|member|xopts_alloc
r_int
id|xopts_nr
comma
id|xopts_alloc
suffix:semicolon
multiline_comment|/* Only used by REPLAY_NONE */
DECL|member|revs
r_struct
id|rev_info
op_star
id|revs
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|GIT_REFLOG_ACTION
mdefine_line|#define GIT_REFLOG_ACTION &quot;GIT_REFLOG_ACTION&quot;
DECL|function|action_name
r_static
r_const
r_char
op_star
id|action_name
c_func
(paren
r_const
r_struct
id|replay_opts
op_star
id|opts
)paren
(brace
r_return
id|opts-&gt;action
op_eq
id|REVERT
ques
c_cond
l_string|&quot;revert&quot;
suffix:colon
l_string|&quot;cherry-pick&quot;
suffix:semicolon
)brace
r_static
r_char
op_star
id|get_encoding
c_func
(paren
r_const
r_char
op_star
id|message
)paren
suffix:semicolon
DECL|function|revert_or_cherry_pick_usage
r_static
r_const
r_char
op_star
r_const
op_star
id|revert_or_cherry_pick_usage
c_func
(paren
r_struct
id|replay_opts
op_star
id|opts
)paren
(brace
r_return
id|opts-&gt;action
op_eq
id|REVERT
ques
c_cond
id|revert_usage
suffix:colon
id|cherry_pick_usage
suffix:semicolon
)brace
DECL|function|option_parse_x
r_static
r_int
id|option_parse_x
c_func
(paren
r_const
r_struct
id|option
op_star
id|opt
comma
r_const
r_char
op_star
id|arg
comma
r_int
id|unset
)paren
(brace
r_struct
id|replay_opts
op_star
op_star
id|opts_ptr
op_assign
id|opt-&gt;value
suffix:semicolon
r_struct
id|replay_opts
op_star
id|opts
op_assign
op_star
id|opts_ptr
suffix:semicolon
r_if
c_cond
(paren
id|unset
)paren
r_return
l_int|0
suffix:semicolon
id|ALLOC_GROW
c_func
(paren
id|opts-&gt;xopts
comma
id|opts-&gt;xopts_nr
op_plus
l_int|1
comma
id|opts-&gt;xopts_alloc
)paren
suffix:semicolon
id|opts-&gt;xopts
(braket
id|opts-&gt;xopts_nr
op_increment
)braket
op_assign
id|xstrdup
c_func
(paren
id|arg
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|verify_opt_compatible
r_static
r_void
id|verify_opt_compatible
c_func
(paren
r_const
r_char
op_star
id|me
comma
r_const
r_char
op_star
id|base_opt
comma
dot
dot
dot
)paren
(brace
r_const
r_char
op_star
id|this_opt
suffix:semicolon
id|va_list
id|ap
suffix:semicolon
id|va_start
c_func
(paren
id|ap
comma
id|base_opt
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|this_opt
op_assign
id|va_arg
c_func
(paren
id|ap
comma
r_const
r_char
op_star
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|va_arg
c_func
(paren
id|ap
comma
r_int
)paren
)paren
r_break
suffix:semicolon
)brace
id|va_end
c_func
(paren
id|ap
)paren
suffix:semicolon
r_if
c_cond
(paren
id|this_opt
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;%s: %s cannot be used with %s&quot;
)paren
comma
id|me
comma
id|this_opt
comma
id|base_opt
)paren
suffix:semicolon
)brace
DECL|function|verify_opt_mutually_compatible
r_static
r_void
id|verify_opt_mutually_compatible
c_func
(paren
r_const
r_char
op_star
id|me
comma
dot
dot
dot
)paren
(brace
r_const
r_char
op_star
id|opt1
comma
op_star
id|opt2
op_assign
l_int|NULL
suffix:semicolon
id|va_list
id|ap
suffix:semicolon
id|va_start
c_func
(paren
id|ap
comma
id|me
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|opt1
op_assign
id|va_arg
c_func
(paren
id|ap
comma
r_const
r_char
op_star
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|va_arg
c_func
(paren
id|ap
comma
r_int
)paren
)paren
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|opt1
)paren
(brace
r_while
c_loop
(paren
(paren
id|opt2
op_assign
id|va_arg
c_func
(paren
id|ap
comma
r_const
r_char
op_star
)paren
)paren
)paren
(brace
r_if
c_cond
(paren
id|va_arg
c_func
(paren
id|ap
comma
r_int
)paren
)paren
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|opt1
op_logical_and
id|opt2
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;%s: %s cannot be used with %s&quot;
)paren
comma
id|me
comma
id|opt1
comma
id|opt2
)paren
suffix:semicolon
)brace
DECL|function|parse_args
r_static
r_void
id|parse_args
c_func
(paren
r_int
id|argc
comma
r_const
r_char
op_star
op_star
id|argv
comma
r_struct
id|replay_opts
op_star
id|opts
)paren
(brace
r_const
r_char
op_star
r_const
op_star
id|usage_str
op_assign
id|revert_or_cherry_pick_usage
c_func
(paren
id|opts
)paren
suffix:semicolon
r_const
r_char
op_star
id|me
op_assign
id|action_name
c_func
(paren
id|opts
)paren
suffix:semicolon
r_int
id|remove_state
op_assign
l_int|0
suffix:semicolon
r_int
id|contin
op_assign
l_int|0
suffix:semicolon
r_int
id|rollback
op_assign
l_int|0
suffix:semicolon
r_struct
id|option
id|options
(braket
)braket
op_assign
(brace
id|OPT_BOOLEAN
c_func
(paren
l_int|0
comma
l_string|&quot;quit&quot;
comma
op_amp
id|remove_state
comma
l_string|&quot;end revert or cherry-pick sequence&quot;
)paren
comma
id|OPT_BOOLEAN
c_func
(paren
l_int|0
comma
l_string|&quot;continue&quot;
comma
op_amp
id|contin
comma
l_string|&quot;resume revert or cherry-pick sequence&quot;
)paren
comma
id|OPT_BOOLEAN
c_func
(paren
l_int|0
comma
l_string|&quot;abort&quot;
comma
op_amp
id|rollback
comma
l_string|&quot;cancel revert or cherry-pick sequence&quot;
)paren
comma
id|OPT_BOOLEAN
c_func
(paren
l_char|&squot;n&squot;
comma
l_string|&quot;no-commit&quot;
comma
op_amp
id|opts-&gt;no_commit
comma
l_string|&quot;don&squot;t automatically commit&quot;
)paren
comma
id|OPT_BOOLEAN
c_func
(paren
l_char|&squot;e&squot;
comma
l_string|&quot;edit&quot;
comma
op_amp
id|opts-&gt;edit
comma
l_string|&quot;edit the commit message&quot;
)paren
comma
id|OPT_NOOP_NOARG
c_func
(paren
l_char|&squot;r&squot;
comma
l_int|NULL
)paren
comma
id|OPT_BOOLEAN
c_func
(paren
l_char|&squot;s&squot;
comma
l_string|&quot;signoff&quot;
comma
op_amp
id|opts-&gt;signoff
comma
l_string|&quot;add Signed-off-by:&quot;
)paren
comma
id|OPT_INTEGER
c_func
(paren
l_char|&squot;m&squot;
comma
l_string|&quot;mainline&quot;
comma
op_amp
id|opts-&gt;mainline
comma
l_string|&quot;parent number&quot;
)paren
comma
id|OPT_RERERE_AUTOUPDATE
c_func
(paren
op_amp
id|opts-&gt;allow_rerere_auto
)paren
comma
id|OPT_STRING
c_func
(paren
l_int|0
comma
l_string|&quot;strategy&quot;
comma
op_amp
id|opts-&gt;strategy
comma
l_string|&quot;strategy&quot;
comma
l_string|&quot;merge strategy&quot;
)paren
comma
id|OPT_CALLBACK
c_func
(paren
l_char|&squot;X&squot;
comma
l_string|&quot;strategy-option&quot;
comma
op_amp
id|opts
comma
l_string|&quot;option&quot;
comma
l_string|&quot;option for merge strategy&quot;
comma
id|option_parse_x
)paren
comma
id|OPT_END
c_func
(paren
)paren
comma
id|OPT_END
c_func
(paren
)paren
comma
id|OPT_END
c_func
(paren
)paren
comma
)brace
suffix:semicolon
r_if
c_cond
(paren
id|opts-&gt;action
op_eq
id|CHERRY_PICK
)paren
(brace
r_struct
id|option
id|cp_extra
(braket
)braket
op_assign
(brace
id|OPT_BOOLEAN
c_func
(paren
l_char|&squot;x&squot;
comma
l_int|NULL
comma
op_amp
id|opts-&gt;record_origin
comma
l_string|&quot;append commit name&quot;
)paren
comma
id|OPT_BOOLEAN
c_func
(paren
l_int|0
comma
l_string|&quot;ff&quot;
comma
op_amp
id|opts-&gt;allow_ff
comma
l_string|&quot;allow fast-forward&quot;
)paren
comma
id|OPT_END
c_func
(paren
)paren
comma
)brace
suffix:semicolon
r_if
c_cond
(paren
id|parse_options_concat
c_func
(paren
id|options
comma
id|ARRAY_SIZE
c_func
(paren
id|options
)paren
comma
id|cp_extra
)paren
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;program error&quot;
)paren
)paren
suffix:semicolon
)brace
id|argc
op_assign
id|parse_options
c_func
(paren
id|argc
comma
id|argv
comma
l_int|NULL
comma
id|options
comma
id|usage_str
comma
id|PARSE_OPT_KEEP_ARGV0
op_or
id|PARSE_OPT_KEEP_UNKNOWN
)paren
suffix:semicolon
multiline_comment|/* Check for incompatible subcommands */
id|verify_opt_mutually_compatible
c_func
(paren
id|me
comma
l_string|&quot;--quit&quot;
comma
id|remove_state
comma
l_string|&quot;--continue&quot;
comma
id|contin
comma
l_string|&quot;--abort&quot;
comma
id|rollback
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/* Set the subcommand */
r_if
c_cond
(paren
id|remove_state
)paren
id|opts-&gt;subcommand
op_assign
id|REPLAY_REMOVE_STATE
suffix:semicolon
r_else
r_if
c_cond
(paren
id|contin
)paren
id|opts-&gt;subcommand
op_assign
id|REPLAY_CONTINUE
suffix:semicolon
r_else
r_if
c_cond
(paren
id|rollback
)paren
id|opts-&gt;subcommand
op_assign
id|REPLAY_ROLLBACK
suffix:semicolon
r_else
id|opts-&gt;subcommand
op_assign
id|REPLAY_NONE
suffix:semicolon
multiline_comment|/* Check for incompatible command line arguments */
r_if
c_cond
(paren
id|opts-&gt;subcommand
op_ne
id|REPLAY_NONE
)paren
(brace
r_char
op_star
id|this_operation
suffix:semicolon
r_if
c_cond
(paren
id|opts-&gt;subcommand
op_eq
id|REPLAY_REMOVE_STATE
)paren
id|this_operation
op_assign
l_string|&quot;--quit&quot;
suffix:semicolon
r_else
r_if
c_cond
(paren
id|opts-&gt;subcommand
op_eq
id|REPLAY_CONTINUE
)paren
id|this_operation
op_assign
l_string|&quot;--continue&quot;
suffix:semicolon
r_else
(brace
m_assert
(paren
id|opts-&gt;subcommand
op_eq
id|REPLAY_ROLLBACK
)paren
suffix:semicolon
id|this_operation
op_assign
l_string|&quot;--abort&quot;
suffix:semicolon
)brace
id|verify_opt_compatible
c_func
(paren
id|me
comma
id|this_operation
comma
l_string|&quot;--no-commit&quot;
comma
id|opts-&gt;no_commit
comma
l_string|&quot;--signoff&quot;
comma
id|opts-&gt;signoff
comma
l_string|&quot;--mainline&quot;
comma
id|opts-&gt;mainline
comma
l_string|&quot;--strategy&quot;
comma
id|opts-&gt;strategy
ques
c_cond
l_int|1
suffix:colon
l_int|0
comma
l_string|&quot;--strategy-option&quot;
comma
id|opts-&gt;xopts
ques
c_cond
l_int|1
suffix:colon
l_int|0
comma
l_string|&quot;-x&quot;
comma
id|opts-&gt;record_origin
comma
l_string|&quot;--ff&quot;
comma
id|opts-&gt;allow_ff
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|opts-&gt;allow_ff
)paren
id|verify_opt_compatible
c_func
(paren
id|me
comma
l_string|&quot;--ff&quot;
comma
l_string|&quot;--signoff&quot;
comma
id|opts-&gt;signoff
comma
l_string|&quot;--no-commit&quot;
comma
id|opts-&gt;no_commit
comma
l_string|&quot;-x&quot;
comma
id|opts-&gt;record_origin
comma
l_string|&quot;--edit&quot;
comma
id|opts-&gt;edit
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opts-&gt;subcommand
op_ne
id|REPLAY_NONE
)paren
(brace
id|opts-&gt;revs
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
(brace
id|opts-&gt;revs
op_assign
id|xmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|opts-&gt;revs
)paren
)paren
suffix:semicolon
id|init_revisions
c_func
(paren
id|opts-&gt;revs
comma
l_int|NULL
)paren
suffix:semicolon
id|opts-&gt;revs-&gt;no_walk
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|argc
OL
l_int|2
)paren
id|usage_with_options
c_func
(paren
id|usage_str
comma
id|options
)paren
suffix:semicolon
id|argc
op_assign
id|setup_revisions
c_func
(paren
id|argc
comma
id|argv
comma
id|opts-&gt;revs
comma
l_int|NULL
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|argc
OG
l_int|1
)paren
id|usage_with_options
c_func
(paren
id|usage_str
comma
id|options
)paren
suffix:semicolon
)brace
DECL|struct|commit_message
r_struct
id|commit_message
(brace
DECL|member|parent_label
r_char
op_star
id|parent_label
suffix:semicolon
DECL|member|label
r_const
r_char
op_star
id|label
suffix:semicolon
DECL|member|subject
r_const
r_char
op_star
id|subject
suffix:semicolon
DECL|member|reencoded_message
r_char
op_star
id|reencoded_message
suffix:semicolon
DECL|member|message
r_const
r_char
op_star
id|message
suffix:semicolon
)brace
suffix:semicolon
DECL|function|get_message
r_static
r_int
id|get_message
c_func
(paren
r_struct
id|commit
op_star
id|commit
comma
r_struct
id|commit_message
op_star
id|out
)paren
(brace
r_const
r_char
op_star
id|encoding
suffix:semicolon
r_const
r_char
op_star
id|abbrev
comma
op_star
id|subject
suffix:semicolon
r_int
id|abbrev_len
comma
id|subject_len
suffix:semicolon
r_char
op_star
id|q
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|commit-&gt;buffer
)paren
r_return
l_int|1
suffix:semicolon
id|encoding
op_assign
id|get_encoding
c_func
(paren
id|commit-&gt;buffer
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|encoding
)paren
id|encoding
op_assign
l_string|&quot;UTF-8&quot;
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|git_commit_encoding
)paren
id|git_commit_encoding
op_assign
l_string|&quot;UTF-8&quot;
suffix:semicolon
id|out-&gt;reencoded_message
op_assign
l_int|NULL
suffix:semicolon
id|out-&gt;message
op_assign
id|commit-&gt;buffer
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|encoding
comma
id|git_commit_encoding
)paren
)paren
id|out-&gt;reencoded_message
op_assign
id|reencode_string
c_func
(paren
id|commit-&gt;buffer
comma
id|git_commit_encoding
comma
id|encoding
)paren
suffix:semicolon
r_if
c_cond
(paren
id|out-&gt;reencoded_message
)paren
id|out-&gt;message
op_assign
id|out-&gt;reencoded_message
suffix:semicolon
id|abbrev
op_assign
id|find_unique_abbrev
c_func
(paren
id|commit-&gt;object.sha1
comma
id|DEFAULT_ABBREV
)paren
suffix:semicolon
id|abbrev_len
op_assign
id|strlen
c_func
(paren
id|abbrev
)paren
suffix:semicolon
id|subject_len
op_assign
id|find_commit_subject
c_func
(paren
id|out-&gt;message
comma
op_amp
id|subject
)paren
suffix:semicolon
id|out-&gt;parent_label
op_assign
id|xmalloc
c_func
(paren
id|strlen
c_func
(paren
l_string|&quot;parent of &quot;
)paren
op_plus
id|abbrev_len
op_plus
id|strlen
c_func
(paren
l_string|&quot;... &quot;
)paren
op_plus
id|subject_len
op_plus
l_int|1
)paren
suffix:semicolon
id|q
op_assign
id|out-&gt;parent_label
suffix:semicolon
id|q
op_assign
id|mempcpy
c_func
(paren
id|q
comma
l_string|&quot;parent of &quot;
comma
id|strlen
c_func
(paren
l_string|&quot;parent of &quot;
)paren
)paren
suffix:semicolon
id|out-&gt;label
op_assign
id|q
suffix:semicolon
id|q
op_assign
id|mempcpy
c_func
(paren
id|q
comma
id|abbrev
comma
id|abbrev_len
)paren
suffix:semicolon
id|q
op_assign
id|mempcpy
c_func
(paren
id|q
comma
l_string|&quot;... &quot;
comma
id|strlen
c_func
(paren
l_string|&quot;... &quot;
)paren
)paren
suffix:semicolon
id|out-&gt;subject
op_assign
id|q
suffix:semicolon
id|q
op_assign
id|mempcpy
c_func
(paren
id|q
comma
id|subject
comma
id|subject_len
)paren
suffix:semicolon
op_star
id|q
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|free_message
r_static
r_void
id|free_message
c_func
(paren
r_struct
id|commit_message
op_star
id|msg
)paren
(brace
id|free
c_func
(paren
id|msg-&gt;parent_label
)paren
suffix:semicolon
id|free
c_func
(paren
id|msg-&gt;reencoded_message
)paren
suffix:semicolon
)brace
DECL|function|get_encoding
r_static
r_char
op_star
id|get_encoding
c_func
(paren
r_const
r_char
op_star
id|message
)paren
(brace
r_const
r_char
op_star
id|p
op_assign
id|message
comma
op_star
id|eol
suffix:semicolon
r_while
c_loop
(paren
op_star
id|p
op_logical_and
op_star
id|p
op_ne
l_char|&squot;&bslash;n&squot;
)paren
(brace
r_for
c_loop
(paren
id|eol
op_assign
id|p
op_plus
l_int|1
suffix:semicolon
op_star
id|eol
op_logical_and
op_star
id|eol
op_ne
l_char|&squot;&bslash;n&squot;
suffix:semicolon
id|eol
op_increment
)paren
suffix:semicolon
multiline_comment|/* do nothing */
r_if
c_cond
(paren
op_logical_neg
id|prefixcmp
c_func
(paren
id|p
comma
l_string|&quot;encoding &quot;
)paren
)paren
(brace
r_char
op_star
id|result
op_assign
id|xmalloc
c_func
(paren
id|eol
l_int|8
id|p
)paren
suffix:semicolon
id|strlcpy
c_func
(paren
id|result
comma
id|p
op_plus
l_int|9
comma
id|eol
l_int|8
id|p
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
id|p
op_assign
id|eol
suffix:semicolon
r_if
c_cond
(paren
op_star
id|p
op_eq
l_char|&squot;&bslash;n&squot;
)paren
id|p
op_increment
suffix:semicolon
)brace
r_return
l_int|NULL
suffix:semicolon
)brace
DECL|function|write_cherry_pick_head
r_static
r_void
id|write_cherry_pick_head
c_func
(paren
r_struct
id|commit
op_star
id|commit
comma
r_const
r_char
op_star
id|pseudoref
)paren
(brace
r_const
r_char
op_star
id|filename
suffix:semicolon
r_int
id|fd
suffix:semicolon
r_struct
id|strbuf
id|buf
op_assign
id|STRBUF_INIT
suffix:semicolon
id|strbuf_addf
c_func
(paren
op_amp
id|buf
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|sha1_to_hex
c_func
(paren
id|commit-&gt;object.sha1
)paren
)paren
suffix:semicolon
id|filename
op_assign
id|git_path
c_func
(paren
l_string|&quot;%s&quot;
comma
id|pseudoref
)paren
suffix:semicolon
id|fd
op_assign
id|open
c_func
(paren
id|filename
comma
id|O_WRONLY
op_or
id|O_CREAT
comma
l_int|0666
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fd
OL
l_int|0
)paren
id|die_errno
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Could not open &squot;%s&squot; for writing&quot;
)paren
comma
id|filename
)paren
suffix:semicolon
r_if
c_cond
(paren
id|write_in_full
c_func
(paren
id|fd
comma
id|buf.buf
comma
id|buf.len
)paren
op_ne
id|buf.len
op_logical_or
id|close
c_func
(paren
id|fd
)paren
)paren
id|die_errno
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Could not write to &squot;%s&squot;&quot;
)paren
comma
id|filename
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|buf
)paren
suffix:semicolon
)brace
DECL|function|print_advice
r_static
r_void
id|print_advice
c_func
(paren
r_int
id|show_hint
)paren
(brace
r_char
op_star
id|msg
op_assign
id|getenv
c_func
(paren
l_string|&quot;GIT_CHERRY_PICK_HELP&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|msg
)paren
(brace
id|fprintf
c_func
(paren
id|stderr
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|msg
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * A conflict has occured but the porcelain&n;&t;&t; * (typically rebase --interactive) wants to take care&n;&t;&t; * of the commit itself so remove CHERRY_PICK_HEAD&n;&t;&t; */
id|unlink
c_func
(paren
id|git_path
c_func
(paren
l_string|&quot;CHERRY_PICK_HEAD&quot;
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|show_hint
)paren
(brace
id|advise
c_func
(paren
l_string|&quot;after resolving the conflicts, mark the corrected paths&quot;
)paren
suffix:semicolon
id|advise
c_func
(paren
l_string|&quot;with &squot;git add &lt;paths&gt;&squot; or &squot;git rm &lt;paths&gt;&squot;&quot;
)paren
suffix:semicolon
id|advise
c_func
(paren
l_string|&quot;and commit the result with &squot;git commit&squot;&quot;
)paren
suffix:semicolon
)brace
)brace
DECL|function|write_message
r_static
r_void
id|write_message
c_func
(paren
r_struct
id|strbuf
op_star
id|msgbuf
comma
r_const
r_char
op_star
id|filename
)paren
(brace
r_static
r_struct
id|lock_file
id|msg_file
suffix:semicolon
r_int
id|msg_fd
op_assign
id|hold_lock_file_for_update
c_func
(paren
op_amp
id|msg_file
comma
id|filename
comma
id|LOCK_DIE_ON_ERROR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|write_in_full
c_func
(paren
id|msg_fd
comma
id|msgbuf-&gt;buf
comma
id|msgbuf-&gt;len
)paren
OL
l_int|0
)paren
id|die_errno
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Could not write to %s&quot;
)paren
comma
id|filename
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
id|msgbuf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|commit_lock_file
c_func
(paren
op_amp
id|msg_file
)paren
OL
l_int|0
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Error wrapping up %s&quot;
)paren
comma
id|filename
)paren
suffix:semicolon
)brace
DECL|function|empty_tree
r_static
r_struct
id|tree
op_star
id|empty_tree
c_func
(paren
r_void
)paren
(brace
r_return
id|lookup_tree
c_func
(paren
(paren
r_const
r_int
r_char
op_star
)paren
id|EMPTY_TREE_SHA1_BIN
)paren
suffix:semicolon
)brace
DECL|function|error_dirty_index
r_static
r_int
id|error_dirty_index
c_func
(paren
r_struct
id|replay_opts
op_star
id|opts
)paren
(brace
r_if
c_cond
(paren
id|read_cache_unmerged
c_func
(paren
)paren
)paren
r_return
id|error_resolve_conflict
c_func
(paren
id|action_name
c_func
(paren
id|opts
)paren
)paren
suffix:semicolon
multiline_comment|/* Different translation strings for cherry-pick and revert */
r_if
c_cond
(paren
id|opts-&gt;action
op_eq
id|CHERRY_PICK
)paren
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Your local changes would be overwritten by cherry-pick.&quot;
)paren
)paren
suffix:semicolon
r_else
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Your local changes would be overwritten by revert.&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|advice_commit_before_merge
)paren
id|advise
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Commit your changes or stash them to proceed.&quot;
)paren
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|fast_forward_to
r_static
r_int
id|fast_forward_to
c_func
(paren
r_const
r_int
r_char
op_star
id|to
comma
r_const
r_int
r_char
op_star
id|from
)paren
(brace
r_struct
id|ref_lock
op_star
id|ref_lock
suffix:semicolon
id|read_cache
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|checkout_fast_forward
c_func
(paren
id|from
comma
id|to
)paren
)paren
m_exit
(paren
l_int|1
)paren
suffix:semicolon
multiline_comment|/* the callee should have complained already */
id|ref_lock
op_assign
id|lock_any_ref_for_update
c_func
(paren
l_string|&quot;HEAD&quot;
comma
id|from
comma
l_int|0
)paren
suffix:semicolon
r_return
id|write_ref_sha1
c_func
(paren
id|ref_lock
comma
id|to
comma
l_string|&quot;cherry-pick&quot;
)paren
suffix:semicolon
)brace
DECL|function|do_recursive_merge
r_static
r_int
id|do_recursive_merge
c_func
(paren
r_struct
id|commit
op_star
id|base
comma
r_struct
id|commit
op_star
id|next
comma
r_const
r_char
op_star
id|base_label
comma
r_const
r_char
op_star
id|next_label
comma
r_int
r_char
op_star
id|head
comma
r_struct
id|strbuf
op_star
id|msgbuf
comma
r_struct
id|replay_opts
op_star
id|opts
)paren
(brace
r_struct
id|merge_options
id|o
suffix:semicolon
r_struct
id|tree
op_star
id|result
comma
op_star
id|next_tree
comma
op_star
id|base_tree
comma
op_star
id|head_tree
suffix:semicolon
r_int
id|clean
comma
id|index_fd
suffix:semicolon
r_const
r_char
op_star
op_star
id|xopt
suffix:semicolon
r_static
r_struct
id|lock_file
id|index_lock
suffix:semicolon
id|index_fd
op_assign
id|hold_locked_index
c_func
(paren
op_amp
id|index_lock
comma
l_int|1
)paren
suffix:semicolon
id|read_cache
c_func
(paren
)paren
suffix:semicolon
id|init_merge_options
c_func
(paren
op_amp
id|o
)paren
suffix:semicolon
id|o.ancestor
op_assign
id|base
ques
c_cond
id|base_label
suffix:colon
l_string|&quot;(empty tree)&quot;
suffix:semicolon
id|o.branch1
op_assign
l_string|&quot;HEAD&quot;
suffix:semicolon
id|o.branch2
op_assign
id|next
ques
c_cond
id|next_label
suffix:colon
l_string|&quot;(empty tree)&quot;
suffix:semicolon
id|head_tree
op_assign
id|parse_tree_indirect
c_func
(paren
id|head
)paren
suffix:semicolon
id|next_tree
op_assign
id|next
ques
c_cond
id|next-&gt;tree
suffix:colon
id|empty_tree
c_func
(paren
)paren
suffix:semicolon
id|base_tree
op_assign
id|base
ques
c_cond
id|base-&gt;tree
suffix:colon
id|empty_tree
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|xopt
op_assign
id|opts-&gt;xopts
suffix:semicolon
id|xopt
op_ne
id|opts-&gt;xopts
op_plus
id|opts-&gt;xopts_nr
suffix:semicolon
id|xopt
op_increment
)paren
id|parse_merge_opt
c_func
(paren
op_amp
id|o
comma
op_star
id|xopt
)paren
suffix:semicolon
id|clean
op_assign
id|merge_trees
c_func
(paren
op_amp
id|o
comma
id|head_tree
comma
id|next_tree
comma
id|base_tree
comma
op_amp
id|result
)paren
suffix:semicolon
r_if
c_cond
(paren
id|active_cache_changed
op_logical_and
(paren
id|write_cache
c_func
(paren
id|index_fd
comma
id|active_cache
comma
id|active_nr
)paren
op_logical_or
id|commit_locked_index
c_func
(paren
op_amp
id|index_lock
)paren
)paren
)paren
multiline_comment|/* TRANSLATORS: %s will be &quot;revert&quot; or &quot;cherry-pick&quot; */
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;%s: Unable to write new index file&quot;
)paren
comma
id|action_name
c_func
(paren
id|opts
)paren
)paren
suffix:semicolon
id|rollback_lock_file
c_func
(paren
op_amp
id|index_lock
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|clean
)paren
(brace
r_int
id|i
suffix:semicolon
id|strbuf_addstr
c_func
(paren
id|msgbuf
comma
l_string|&quot;&bslash;nConflicts:&bslash;n&bslash;n&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|active_nr
suffix:semicolon
)paren
(brace
r_struct
id|cache_entry
op_star
id|ce
op_assign
id|active_cache
(braket
id|i
op_increment
)braket
suffix:semicolon
r_if
c_cond
(paren
id|ce_stage
c_func
(paren
id|ce
)paren
)paren
(brace
id|strbuf_addch
c_func
(paren
id|msgbuf
comma
l_char|&squot;&bslash;t&squot;
)paren
suffix:semicolon
id|strbuf_addstr
c_func
(paren
id|msgbuf
comma
id|ce-&gt;name
)paren
suffix:semicolon
id|strbuf_addch
c_func
(paren
id|msgbuf
comma
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
r_while
c_loop
(paren
id|i
OL
id|active_nr
op_logical_and
op_logical_neg
id|strcmp
c_func
(paren
id|ce-&gt;name
comma
id|active_cache
(braket
id|i
)braket
op_member_access_from_pointer
id|name
)paren
)paren
id|i
op_increment
suffix:semicolon
)brace
)brace
)brace
r_return
op_logical_neg
id|clean
suffix:semicolon
)brace
multiline_comment|/*&n; * If we are cherry-pick, and if the merge did not result in&n; * hand-editing, we will hit this commit and inherit the original&n; * author date and name.&n; * If we are revert, or if our cherry-pick results in a hand merge,&n; * we had better say that the current user is responsible for that.&n; */
DECL|function|run_git_commit
r_static
r_int
id|run_git_commit
c_func
(paren
r_const
r_char
op_star
id|defmsg
comma
r_struct
id|replay_opts
op_star
id|opts
)paren
(brace
multiline_comment|/* 6 is max possible length of our args array including NULL */
r_const
r_char
op_star
id|args
(braket
l_int|6
)braket
suffix:semicolon
r_int
id|i
op_assign
l_int|0
suffix:semicolon
id|args
(braket
id|i
op_increment
)braket
op_assign
l_string|&quot;commit&quot;
suffix:semicolon
id|args
(braket
id|i
op_increment
)braket
op_assign
l_string|&quot;-n&quot;
suffix:semicolon
r_if
c_cond
(paren
id|opts-&gt;signoff
)paren
id|args
(braket
id|i
op_increment
)braket
op_assign
l_string|&quot;-s&quot;
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|opts-&gt;edit
)paren
(brace
id|args
(braket
id|i
op_increment
)braket
op_assign
l_string|&quot;-F&quot;
suffix:semicolon
id|args
(braket
id|i
op_increment
)braket
op_assign
id|defmsg
suffix:semicolon
)brace
id|args
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
r_return
id|run_command_v_opt
c_func
(paren
id|args
comma
id|RUN_GIT_CMD
)paren
suffix:semicolon
)brace
DECL|function|do_pick_commit
r_static
r_int
id|do_pick_commit
c_func
(paren
r_struct
id|commit
op_star
id|commit
comma
r_struct
id|replay_opts
op_star
id|opts
)paren
(brace
r_int
r_char
id|head
(braket
l_int|20
)braket
suffix:semicolon
r_struct
id|commit
op_star
id|base
comma
op_star
id|next
comma
op_star
id|parent
suffix:semicolon
r_const
r_char
op_star
id|base_label
comma
op_star
id|next_label
suffix:semicolon
r_struct
id|commit_message
id|msg
op_assign
(brace
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
)brace
suffix:semicolon
r_char
op_star
id|defmsg
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|strbuf
id|msgbuf
op_assign
id|STRBUF_INIT
suffix:semicolon
r_int
id|res
suffix:semicolon
r_if
c_cond
(paren
id|opts-&gt;no_commit
)paren
(brace
multiline_comment|/*&n;&t;&t; * We do not intend to commit immediately.  We just want to&n;&t;&t; * merge the differences in, so let&squot;s compute the tree&n;&t;&t; * that represents the &quot;current&quot; state for merge-recursive&n;&t;&t; * to work on.&n;&t;&t; */
r_if
c_cond
(paren
id|write_cache_as_tree
c_func
(paren
id|head
comma
l_int|0
comma
l_int|NULL
)paren
)paren
id|die
(paren
id|_
c_func
(paren
l_string|&quot;Your index file is unmerged.&quot;
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|get_sha1
c_func
(paren
l_string|&quot;HEAD&quot;
comma
id|head
)paren
)paren
r_return
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;You do not have a valid HEAD&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|index_differs_from
c_func
(paren
l_string|&quot;HEAD&quot;
comma
l_int|0
)paren
)paren
r_return
id|error_dirty_index
c_func
(paren
id|opts
)paren
suffix:semicolon
)brace
id|discard_cache
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|commit-&gt;parents
)paren
(brace
id|parent
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|commit-&gt;parents-&gt;next
)paren
(brace
multiline_comment|/* Reverting or cherry-picking a merge commit */
r_int
id|cnt
suffix:semicolon
r_struct
id|commit_list
op_star
id|p
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|opts-&gt;mainline
)paren
r_return
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Commit %s is a merge but no -m option was given.&quot;
)paren
comma
id|sha1_to_hex
c_func
(paren
id|commit-&gt;object.sha1
)paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cnt
op_assign
l_int|1
comma
id|p
op_assign
id|commit-&gt;parents
suffix:semicolon
id|cnt
op_ne
id|opts-&gt;mainline
op_logical_and
id|p
suffix:semicolon
id|cnt
op_increment
)paren
id|p
op_assign
id|p-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|cnt
op_ne
id|opts-&gt;mainline
op_logical_or
op_logical_neg
id|p
)paren
r_return
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Commit %s does not have parent %d&quot;
)paren
comma
id|sha1_to_hex
c_func
(paren
id|commit-&gt;object.sha1
)paren
comma
id|opts-&gt;mainline
)paren
suffix:semicolon
id|parent
op_assign
id|p-&gt;item
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
l_int|0
OL
id|opts-&gt;mainline
)paren
r_return
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Mainline was specified but commit %s is not a merge.&quot;
)paren
comma
id|sha1_to_hex
c_func
(paren
id|commit-&gt;object.sha1
)paren
)paren
suffix:semicolon
r_else
id|parent
op_assign
id|commit-&gt;parents-&gt;item
suffix:semicolon
r_if
c_cond
(paren
id|opts-&gt;allow_ff
op_logical_and
id|parent
op_logical_and
op_logical_neg
id|hashcmp
c_func
(paren
id|parent-&gt;object.sha1
comma
id|head
)paren
)paren
r_return
id|fast_forward_to
c_func
(paren
id|commit-&gt;object.sha1
comma
id|head
)paren
suffix:semicolon
r_if
c_cond
(paren
id|parent
op_logical_and
id|parse_commit
c_func
(paren
id|parent
)paren
OL
l_int|0
)paren
multiline_comment|/* TRANSLATORS: The first %s will be &quot;revert&quot; or&n;&t;&t;   &quot;cherry-pick&quot;, the second %s a SHA1 */
r_return
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;%s: cannot parse parent commit %s&quot;
)paren
comma
id|action_name
c_func
(paren
id|opts
)paren
comma
id|sha1_to_hex
c_func
(paren
id|parent-&gt;object.sha1
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|get_message
c_func
(paren
id|commit
comma
op_amp
id|msg
)paren
op_ne
l_int|0
)paren
r_return
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Cannot get commit message for %s&quot;
)paren
comma
id|sha1_to_hex
c_func
(paren
id|commit-&gt;object.sha1
)paren
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * &quot;commit&quot; is an existing commit.  We would want to apply&n;&t; * the difference it introduces since its first parent &quot;prev&quot;&n;&t; * on top of the current HEAD if we are cherry-pick.  Or the&n;&t; * reverse of it if we are revert.&n;&t; */
id|defmsg
op_assign
id|git_pathdup
c_func
(paren
l_string|&quot;MERGE_MSG&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opts-&gt;action
op_eq
id|REVERT
)paren
(brace
id|base
op_assign
id|commit
suffix:semicolon
id|base_label
op_assign
id|msg.label
suffix:semicolon
id|next
op_assign
id|parent
suffix:semicolon
id|next_label
op_assign
id|msg.parent_label
suffix:semicolon
id|strbuf_addstr
c_func
(paren
op_amp
id|msgbuf
comma
l_string|&quot;Revert &bslash;&quot;&quot;
)paren
suffix:semicolon
id|strbuf_addstr
c_func
(paren
op_amp
id|msgbuf
comma
id|msg.subject
)paren
suffix:semicolon
id|strbuf_addstr
c_func
(paren
op_amp
id|msgbuf
comma
l_string|&quot;&bslash;&quot;&bslash;n&bslash;nThis reverts commit &quot;
)paren
suffix:semicolon
id|strbuf_addstr
c_func
(paren
op_amp
id|msgbuf
comma
id|sha1_to_hex
c_func
(paren
id|commit-&gt;object.sha1
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|commit-&gt;parents
op_logical_and
id|commit-&gt;parents-&gt;next
)paren
(brace
id|strbuf_addstr
c_func
(paren
op_amp
id|msgbuf
comma
l_string|&quot;, reversing&bslash;nchanges made to &quot;
)paren
suffix:semicolon
id|strbuf_addstr
c_func
(paren
op_amp
id|msgbuf
comma
id|sha1_to_hex
c_func
(paren
id|parent-&gt;object.sha1
)paren
)paren
suffix:semicolon
)brace
id|strbuf_addstr
c_func
(paren
op_amp
id|msgbuf
comma
l_string|&quot;.&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
(brace
r_const
r_char
op_star
id|p
suffix:semicolon
id|base
op_assign
id|parent
suffix:semicolon
id|base_label
op_assign
id|msg.parent_label
suffix:semicolon
id|next
op_assign
id|commit
suffix:semicolon
id|next_label
op_assign
id|msg.label
suffix:semicolon
multiline_comment|/*&n;&t;&t; * Append the commit log message to msgbuf; it starts&n;&t;&t; * after the tree, parent, author, committer&n;&t;&t; * information followed by &quot;&bslash;n&bslash;n&quot;.&n;&t;&t; */
id|p
op_assign
id|strstr
c_func
(paren
id|msg.message
comma
l_string|&quot;&bslash;n&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p
)paren
(brace
id|p
op_add_assign
l_int|2
suffix:semicolon
id|strbuf_addstr
c_func
(paren
op_amp
id|msgbuf
comma
id|p
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|opts-&gt;record_origin
)paren
(brace
id|strbuf_addstr
c_func
(paren
op_amp
id|msgbuf
comma
l_string|&quot;(cherry picked from commit &quot;
)paren
suffix:semicolon
id|strbuf_addstr
c_func
(paren
op_amp
id|msgbuf
comma
id|sha1_to_hex
c_func
(paren
id|commit-&gt;object.sha1
)paren
)paren
suffix:semicolon
id|strbuf_addstr
c_func
(paren
op_amp
id|msgbuf
comma
l_string|&quot;)&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|opts-&gt;strategy
op_logical_or
op_logical_neg
id|strcmp
c_func
(paren
id|opts-&gt;strategy
comma
l_string|&quot;recursive&quot;
)paren
op_logical_or
id|opts-&gt;action
op_eq
id|REVERT
)paren
(brace
id|res
op_assign
id|do_recursive_merge
c_func
(paren
id|base
comma
id|next
comma
id|base_label
comma
id|next_label
comma
id|head
comma
op_amp
id|msgbuf
comma
id|opts
)paren
suffix:semicolon
id|write_message
c_func
(paren
op_amp
id|msgbuf
comma
id|defmsg
)paren
suffix:semicolon
)brace
r_else
(brace
r_struct
id|commit_list
op_star
id|common
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|commit_list
op_star
id|remotes
op_assign
l_int|NULL
suffix:semicolon
id|write_message
c_func
(paren
op_amp
id|msgbuf
comma
id|defmsg
)paren
suffix:semicolon
id|commit_list_insert
c_func
(paren
id|base
comma
op_amp
id|common
)paren
suffix:semicolon
id|commit_list_insert
c_func
(paren
id|next
comma
op_amp
id|remotes
)paren
suffix:semicolon
id|res
op_assign
id|try_merge_command
c_func
(paren
id|opts-&gt;strategy
comma
id|opts-&gt;xopts_nr
comma
id|opts-&gt;xopts
comma
id|common
comma
id|sha1_to_hex
c_func
(paren
id|head
)paren
comma
id|remotes
)paren
suffix:semicolon
id|free_commit_list
c_func
(paren
id|common
)paren
suffix:semicolon
id|free_commit_list
c_func
(paren
id|remotes
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * If the merge was clean or if it failed due to conflict, we write&n;&t; * CHERRY_PICK_HEAD for the subsequent invocation of commit to use.&n;&t; * However, if the merge did not even start, then we don&squot;t want to&n;&t; * write it at all.&n;&t; */
r_if
c_cond
(paren
id|opts-&gt;action
op_eq
id|CHERRY_PICK
op_logical_and
op_logical_neg
id|opts-&gt;no_commit
op_logical_and
(paren
id|res
op_eq
l_int|0
op_logical_or
id|res
op_eq
l_int|1
)paren
)paren
id|write_cherry_pick_head
c_func
(paren
id|commit
comma
l_string|&quot;CHERRY_PICK_HEAD&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opts-&gt;action
op_eq
id|REVERT
op_logical_and
(paren
(paren
id|opts-&gt;no_commit
op_logical_and
id|res
op_eq
l_int|0
)paren
op_logical_or
id|res
op_eq
l_int|1
)paren
)paren
id|write_cherry_pick_head
c_func
(paren
id|commit
comma
l_string|&quot;REVERT_HEAD&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
)paren
(brace
id|error
c_func
(paren
id|opts-&gt;action
op_eq
id|REVERT
ques
c_cond
id|_
c_func
(paren
l_string|&quot;could not revert %s... %s&quot;
)paren
suffix:colon
id|_
c_func
(paren
l_string|&quot;could not apply %s... %s&quot;
)paren
comma
id|find_unique_abbrev
c_func
(paren
id|commit-&gt;object.sha1
comma
id|DEFAULT_ABBREV
)paren
comma
id|msg.subject
)paren
suffix:semicolon
id|print_advice
c_func
(paren
id|res
op_eq
l_int|1
)paren
suffix:semicolon
id|rerere
c_func
(paren
id|opts-&gt;allow_rerere_auto
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
op_logical_neg
id|opts-&gt;no_commit
)paren
id|res
op_assign
id|run_git_commit
c_func
(paren
id|defmsg
comma
id|opts
)paren
suffix:semicolon
)brace
id|free_message
c_func
(paren
op_amp
id|msg
)paren
suffix:semicolon
id|free
c_func
(paren
id|defmsg
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
DECL|function|prepare_revs
r_static
r_void
id|prepare_revs
c_func
(paren
r_struct
id|replay_opts
op_star
id|opts
)paren
(brace
r_if
c_cond
(paren
id|opts-&gt;action
op_ne
id|REVERT
)paren
id|opts-&gt;revs-&gt;reverse
op_xor_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|prepare_revision_walk
c_func
(paren
id|opts-&gt;revs
)paren
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;revision walk setup failed&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|opts-&gt;revs-&gt;commits
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;empty commit set passed&quot;
)paren
)paren
suffix:semicolon
)brace
DECL|function|read_and_refresh_cache
r_static
r_void
id|read_and_refresh_cache
c_func
(paren
r_struct
id|replay_opts
op_star
id|opts
)paren
(brace
r_static
r_struct
id|lock_file
id|index_lock
suffix:semicolon
r_int
id|index_fd
op_assign
id|hold_locked_index
c_func
(paren
op_amp
id|index_lock
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|read_index_preload
c_func
(paren
op_amp
id|the_index
comma
l_int|NULL
)paren
OL
l_int|0
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;git %s: failed to read the index&quot;
)paren
comma
id|action_name
c_func
(paren
id|opts
)paren
)paren
suffix:semicolon
id|refresh_index
c_func
(paren
op_amp
id|the_index
comma
id|REFRESH_QUIET
op_or
id|REFRESH_UNMERGED
comma
l_int|NULL
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|the_index.cache_changed
)paren
(brace
r_if
c_cond
(paren
id|write_index
c_func
(paren
op_amp
id|the_index
comma
id|index_fd
)paren
op_logical_or
id|commit_locked_index
c_func
(paren
op_amp
id|index_lock
)paren
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;git %s: failed to refresh the index&quot;
)paren
comma
id|action_name
c_func
(paren
id|opts
)paren
)paren
suffix:semicolon
)brace
id|rollback_lock_file
c_func
(paren
op_amp
id|index_lock
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Append a commit to the end of the commit_list.&n; *&n; * next starts by pointing to the variable that holds the head of an&n; * empty commit_list, and is updated to point to the &quot;next&quot; field of&n; * the last item on the list as new commits are appended.&n; *&n; * Usage example:&n; *&n; *     struct commit_list *list;&n; *     struct commit_list **next = &amp;list;&n; *&n; *     next = commit_list_append(c1, next);&n; *     next = commit_list_append(c2, next);&n; *     assert(commit_list_count(list) == 2);&n; *     return list;&n; */
DECL|function|commit_list_append
r_static
r_struct
id|commit_list
op_star
op_star
id|commit_list_append
c_func
(paren
r_struct
id|commit
op_star
id|commit
comma
r_struct
id|commit_list
op_star
op_star
id|next
)paren
(brace
r_struct
id|commit_list
op_star
r_new
op_assign
id|xmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|commit_list
)paren
)paren
suffix:semicolon
r_new
op_member_access_from_pointer
id|item
op_assign
id|commit
suffix:semicolon
op_star
id|next
op_assign
r_new
suffix:semicolon
r_new
op_member_access_from_pointer
id|next
op_assign
l_int|NULL
suffix:semicolon
r_return
op_amp
r_new
op_member_access_from_pointer
id|next
suffix:semicolon
)brace
DECL|function|format_todo
r_static
r_int
id|format_todo
c_func
(paren
r_struct
id|strbuf
op_star
id|buf
comma
r_struct
id|commit_list
op_star
id|todo_list
comma
r_struct
id|replay_opts
op_star
id|opts
)paren
(brace
r_struct
id|commit_list
op_star
id|cur
op_assign
l_int|NULL
suffix:semicolon
r_const
r_char
op_star
id|sha1_abbrev
op_assign
l_int|NULL
suffix:semicolon
r_const
r_char
op_star
id|action_str
op_assign
id|opts-&gt;action
op_eq
id|REVERT
ques
c_cond
l_string|&quot;revert&quot;
suffix:colon
l_string|&quot;pick&quot;
suffix:semicolon
r_const
r_char
op_star
id|subject
suffix:semicolon
r_int
id|subject_len
suffix:semicolon
r_for
c_loop
(paren
id|cur
op_assign
id|todo_list
suffix:semicolon
id|cur
suffix:semicolon
id|cur
op_assign
id|cur-&gt;next
)paren
(brace
id|sha1_abbrev
op_assign
id|find_unique_abbrev
c_func
(paren
id|cur-&gt;item-&gt;object.sha1
comma
id|DEFAULT_ABBREV
)paren
suffix:semicolon
id|subject_len
op_assign
id|find_commit_subject
c_func
(paren
id|cur-&gt;item-&gt;buffer
comma
op_amp
id|subject
)paren
suffix:semicolon
id|strbuf_addf
c_func
(paren
id|buf
comma
l_string|&quot;%s %s %.*s&bslash;n&quot;
comma
id|action_str
comma
id|sha1_abbrev
comma
id|subject_len
comma
id|subject
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|parse_insn_line
r_static
r_struct
id|commit
op_star
id|parse_insn_line
c_func
(paren
r_char
op_star
id|bol
comma
r_char
op_star
id|eol
comma
r_struct
id|replay_opts
op_star
id|opts
)paren
(brace
r_int
r_char
id|commit_sha1
(braket
l_int|20
)braket
suffix:semicolon
r_enum
id|replay_action
id|action
suffix:semicolon
r_char
op_star
id|end_of_object_name
suffix:semicolon
r_int
id|saved
comma
id|status
comma
id|padding
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|prefixcmp
c_func
(paren
id|bol
comma
l_string|&quot;pick&quot;
)paren
)paren
(brace
id|action
op_assign
id|CHERRY_PICK
suffix:semicolon
id|bol
op_add_assign
id|strlen
c_func
(paren
l_string|&quot;pick&quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|prefixcmp
c_func
(paren
id|bol
comma
l_string|&quot;revert&quot;
)paren
)paren
(brace
id|action
op_assign
id|REVERT
suffix:semicolon
id|bol
op_add_assign
id|strlen
c_func
(paren
l_string|&quot;revert&quot;
)paren
suffix:semicolon
)brace
r_else
r_return
l_int|NULL
suffix:semicolon
multiline_comment|/* Eat up extra spaces/ tabs before object name */
id|padding
op_assign
id|strspn
c_func
(paren
id|bol
comma
l_string|&quot; &bslash;t&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|padding
)paren
r_return
l_int|NULL
suffix:semicolon
id|bol
op_add_assign
id|padding
suffix:semicolon
id|end_of_object_name
op_assign
id|bol
op_plus
id|strcspn
c_func
(paren
id|bol
comma
l_string|&quot; &bslash;t&bslash;n&quot;
)paren
suffix:semicolon
id|saved
op_assign
op_star
id|end_of_object_name
suffix:semicolon
op_star
id|end_of_object_name
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|status
op_assign
id|get_sha1
c_func
(paren
id|bol
comma
id|commit_sha1
)paren
suffix:semicolon
op_star
id|end_of_object_name
op_assign
id|saved
suffix:semicolon
multiline_comment|/*&n;&t; * Verify that the action matches up with the one in&n;&t; * opts; we don&squot;t support arbitrary instructions&n;&t; */
r_if
c_cond
(paren
id|action
op_ne
id|opts-&gt;action
)paren
(brace
r_const
r_char
op_star
id|action_str
suffix:semicolon
id|action_str
op_assign
id|action
op_eq
id|REVERT
ques
c_cond
l_string|&quot;revert&quot;
suffix:colon
l_string|&quot;cherry-pick&quot;
suffix:semicolon
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Cannot %s during a %s&quot;
)paren
comma
id|action_str
comma
id|action_name
c_func
(paren
id|opts
)paren
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
OL
l_int|0
)paren
r_return
l_int|NULL
suffix:semicolon
r_return
id|lookup_commit_reference
c_func
(paren
id|commit_sha1
)paren
suffix:semicolon
)brace
DECL|function|parse_insn_buffer
r_static
r_int
id|parse_insn_buffer
c_func
(paren
r_char
op_star
id|buf
comma
r_struct
id|commit_list
op_star
op_star
id|todo_list
comma
r_struct
id|replay_opts
op_star
id|opts
)paren
(brace
r_struct
id|commit_list
op_star
op_star
id|next
op_assign
id|todo_list
suffix:semicolon
r_struct
id|commit
op_star
id|commit
suffix:semicolon
r_char
op_star
id|p
op_assign
id|buf
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
op_star
id|p
suffix:semicolon
id|i
op_increment
)paren
(brace
r_char
op_star
id|eol
op_assign
id|strchrnul
c_func
(paren
id|p
comma
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
id|commit
op_assign
id|parse_insn_line
c_func
(paren
id|p
comma
id|eol
comma
id|opts
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|commit
)paren
r_return
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Could not parse line %d.&quot;
)paren
comma
id|i
)paren
suffix:semicolon
id|next
op_assign
id|commit_list_append
c_func
(paren
id|commit
comma
id|next
)paren
suffix:semicolon
id|p
op_assign
op_star
id|eol
ques
c_cond
id|eol
op_plus
l_int|1
suffix:colon
id|eol
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
op_star
id|todo_list
)paren
r_return
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;No commits parsed.&quot;
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|read_populate_todo
r_static
r_void
id|read_populate_todo
c_func
(paren
r_struct
id|commit_list
op_star
op_star
id|todo_list
comma
r_struct
id|replay_opts
op_star
id|opts
)paren
(brace
r_const
r_char
op_star
id|todo_file
op_assign
id|git_path
c_func
(paren
id|SEQ_TODO_FILE
)paren
suffix:semicolon
r_struct
id|strbuf
id|buf
op_assign
id|STRBUF_INIT
suffix:semicolon
r_int
id|fd
comma
id|res
suffix:semicolon
id|fd
op_assign
id|open
c_func
(paren
id|todo_file
comma
id|O_RDONLY
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fd
OL
l_int|0
)paren
id|die_errno
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Could not open %s&quot;
)paren
comma
id|todo_file
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strbuf_read
c_func
(paren
op_amp
id|buf
comma
id|fd
comma
l_int|0
)paren
OL
l_int|0
)paren
(brace
id|close
c_func
(paren
id|fd
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|buf
)paren
suffix:semicolon
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Could not read %s.&quot;
)paren
comma
id|todo_file
)paren
suffix:semicolon
)brace
id|close
c_func
(paren
id|fd
)paren
suffix:semicolon
id|res
op_assign
id|parse_insn_buffer
c_func
(paren
id|buf.buf
comma
id|todo_list
comma
id|opts
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Unusable instruction sheet: %s&quot;
)paren
comma
id|todo_file
)paren
suffix:semicolon
)brace
DECL|function|populate_opts_cb
r_static
r_int
id|populate_opts_cb
c_func
(paren
r_const
r_char
op_star
id|key
comma
r_const
r_char
op_star
id|value
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|replay_opts
op_star
id|opts
op_assign
id|data
suffix:semicolon
r_int
id|error_flag
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|value
)paren
id|error_flag
op_assign
l_int|0
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|key
comma
l_string|&quot;options.no-commit&quot;
)paren
)paren
id|opts-&gt;no_commit
op_assign
id|git_config_bool_or_int
c_func
(paren
id|key
comma
id|value
comma
op_amp
id|error_flag
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|key
comma
l_string|&quot;options.edit&quot;
)paren
)paren
id|opts-&gt;edit
op_assign
id|git_config_bool_or_int
c_func
(paren
id|key
comma
id|value
comma
op_amp
id|error_flag
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|key
comma
l_string|&quot;options.signoff&quot;
)paren
)paren
id|opts-&gt;signoff
op_assign
id|git_config_bool_or_int
c_func
(paren
id|key
comma
id|value
comma
op_amp
id|error_flag
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|key
comma
l_string|&quot;options.record-origin&quot;
)paren
)paren
id|opts-&gt;record_origin
op_assign
id|git_config_bool_or_int
c_func
(paren
id|key
comma
id|value
comma
op_amp
id|error_flag
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|key
comma
l_string|&quot;options.allow-ff&quot;
)paren
)paren
id|opts-&gt;allow_ff
op_assign
id|git_config_bool_or_int
c_func
(paren
id|key
comma
id|value
comma
op_amp
id|error_flag
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|key
comma
l_string|&quot;options.mainline&quot;
)paren
)paren
id|opts-&gt;mainline
op_assign
id|git_config_int
c_func
(paren
id|key
comma
id|value
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|key
comma
l_string|&quot;options.strategy&quot;
)paren
)paren
id|git_config_string
c_func
(paren
op_amp
id|opts-&gt;strategy
comma
id|key
comma
id|value
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|key
comma
l_string|&quot;options.strategy-option&quot;
)paren
)paren
(brace
id|ALLOC_GROW
c_func
(paren
id|opts-&gt;xopts
comma
id|opts-&gt;xopts_nr
op_plus
l_int|1
comma
id|opts-&gt;xopts_alloc
)paren
suffix:semicolon
id|opts-&gt;xopts
(braket
id|opts-&gt;xopts_nr
op_increment
)braket
op_assign
id|xstrdup
c_func
(paren
id|value
)paren
suffix:semicolon
)brace
r_else
r_return
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Invalid key: %s&quot;
)paren
comma
id|key
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|error_flag
)paren
r_return
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Invalid value for %s: %s&quot;
)paren
comma
id|key
comma
id|value
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|read_populate_opts
r_static
r_void
id|read_populate_opts
c_func
(paren
r_struct
id|replay_opts
op_star
op_star
id|opts_ptr
)paren
(brace
r_const
r_char
op_star
id|opts_file
op_assign
id|git_path
c_func
(paren
id|SEQ_OPTS_FILE
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|file_exists
c_func
(paren
id|opts_file
)paren
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|git_config_from_file
c_func
(paren
id|populate_opts_cb
comma
id|opts_file
comma
op_star
id|opts_ptr
)paren
OL
l_int|0
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Malformed options sheet: %s&quot;
)paren
comma
id|opts_file
)paren
suffix:semicolon
)brace
DECL|function|walk_revs_populate_todo
r_static
r_void
id|walk_revs_populate_todo
c_func
(paren
r_struct
id|commit_list
op_star
op_star
id|todo_list
comma
r_struct
id|replay_opts
op_star
id|opts
)paren
(brace
r_struct
id|commit
op_star
id|commit
suffix:semicolon
r_struct
id|commit_list
op_star
op_star
id|next
suffix:semicolon
id|prepare_revs
c_func
(paren
id|opts
)paren
suffix:semicolon
id|next
op_assign
id|todo_list
suffix:semicolon
r_while
c_loop
(paren
(paren
id|commit
op_assign
id|get_revision
c_func
(paren
id|opts-&gt;revs
)paren
)paren
)paren
id|next
op_assign
id|commit_list_append
c_func
(paren
id|commit
comma
id|next
)paren
suffix:semicolon
)brace
DECL|function|create_seq_dir
r_static
r_int
id|create_seq_dir
c_func
(paren
r_void
)paren
(brace
r_const
r_char
op_star
id|seq_dir
op_assign
id|git_path
c_func
(paren
id|SEQ_DIR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file_exists
c_func
(paren
id|seq_dir
)paren
)paren
(brace
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;a cherry-pick or revert is already in progress&quot;
)paren
)paren
suffix:semicolon
id|advise
c_func
(paren
id|_
c_func
(paren
l_string|&quot;try &bslash;&quot;git cherry-pick (--continue | --quit | --abort)&bslash;&quot;&quot;
)paren
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|mkdir
c_func
(paren
id|seq_dir
comma
l_int|0777
)paren
OL
l_int|0
)paren
id|die_errno
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Could not create sequencer directory %s&quot;
)paren
comma
id|seq_dir
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|save_head
r_static
r_void
id|save_head
c_func
(paren
r_const
r_char
op_star
id|head
)paren
(brace
r_const
r_char
op_star
id|head_file
op_assign
id|git_path
c_func
(paren
id|SEQ_HEAD_FILE
)paren
suffix:semicolon
r_static
r_struct
id|lock_file
id|head_lock
suffix:semicolon
r_struct
id|strbuf
id|buf
op_assign
id|STRBUF_INIT
suffix:semicolon
r_int
id|fd
suffix:semicolon
id|fd
op_assign
id|hold_lock_file_for_update
c_func
(paren
op_amp
id|head_lock
comma
id|head_file
comma
id|LOCK_DIE_ON_ERROR
)paren
suffix:semicolon
id|strbuf_addf
c_func
(paren
op_amp
id|buf
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|head
)paren
suffix:semicolon
r_if
c_cond
(paren
id|write_in_full
c_func
(paren
id|fd
comma
id|buf.buf
comma
id|buf.len
)paren
OL
l_int|0
)paren
id|die_errno
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Could not write to %s&quot;
)paren
comma
id|head_file
)paren
suffix:semicolon
r_if
c_cond
(paren
id|commit_lock_file
c_func
(paren
op_amp
id|head_lock
)paren
OL
l_int|0
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Error wrapping up %s.&quot;
)paren
comma
id|head_file
)paren
suffix:semicolon
)brace
DECL|function|reset_for_rollback
r_static
r_int
id|reset_for_rollback
c_func
(paren
r_const
r_int
r_char
op_star
id|sha1
)paren
(brace
r_const
r_char
op_star
id|argv
(braket
l_int|4
)braket
suffix:semicolon
multiline_comment|/* reset --merge &lt;arg&gt; + NULL */
id|argv
(braket
l_int|0
)braket
op_assign
l_string|&quot;reset&quot;
suffix:semicolon
id|argv
(braket
l_int|1
)braket
op_assign
l_string|&quot;--merge&quot;
suffix:semicolon
id|argv
(braket
l_int|2
)braket
op_assign
id|sha1_to_hex
c_func
(paren
id|sha1
)paren
suffix:semicolon
id|argv
(braket
l_int|3
)braket
op_assign
l_int|NULL
suffix:semicolon
r_return
id|run_command_v_opt
c_func
(paren
id|argv
comma
id|RUN_GIT_CMD
)paren
suffix:semicolon
)brace
DECL|function|rollback_single_pick
r_static
r_int
id|rollback_single_pick
c_func
(paren
r_void
)paren
(brace
r_int
r_char
id|head_sha1
(braket
l_int|20
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|file_exists
c_func
(paren
id|git_path
c_func
(paren
l_string|&quot;CHERRY_PICK_HEAD&quot;
)paren
)paren
op_logical_and
op_logical_neg
id|file_exists
c_func
(paren
id|git_path
c_func
(paren
l_string|&quot;REVERT_HEAD&quot;
)paren
)paren
)paren
r_return
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;no cherry-pick or revert in progress&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|resolve_ref
c_func
(paren
l_string|&quot;HEAD&quot;
comma
id|head_sha1
comma
l_int|0
comma
l_int|NULL
)paren
)paren
r_return
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;cannot resolve HEAD&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|is_null_sha1
c_func
(paren
id|head_sha1
)paren
)paren
r_return
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;cannot abort from a branch yet to be born&quot;
)paren
)paren
suffix:semicolon
r_return
id|reset_for_rollback
c_func
(paren
id|head_sha1
)paren
suffix:semicolon
)brace
DECL|function|sequencer_rollback
r_static
r_int
id|sequencer_rollback
c_func
(paren
r_struct
id|replay_opts
op_star
id|opts
)paren
(brace
r_const
r_char
op_star
id|filename
suffix:semicolon
id|FILE
op_star
id|f
suffix:semicolon
r_int
r_char
id|sha1
(braket
l_int|20
)braket
suffix:semicolon
r_struct
id|strbuf
id|buf
op_assign
id|STRBUF_INIT
suffix:semicolon
id|filename
op_assign
id|git_path
c_func
(paren
id|SEQ_HEAD_FILE
)paren
suffix:semicolon
id|f
op_assign
id|fopen
c_func
(paren
id|filename
comma
l_string|&quot;r&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|f
op_logical_and
id|errno
op_eq
id|ENOENT
)paren
(brace
multiline_comment|/*&n;&t;&t; * There is no multiple-cherry-pick in progress.&n;&t;&t; * If CHERRY_PICK_HEAD or REVERT_HEAD indicates&n;&t;&t; * a single-cherry-pick in progress, abort that.&n;&t;&t; */
r_return
id|rollback_single_pick
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|f
)paren
r_return
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;cannot open %s: %s&quot;
)paren
comma
id|filename
comma
id|strerror
c_func
(paren
id|errno
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strbuf_getline
c_func
(paren
op_amp
id|buf
comma
id|f
comma
l_char|&squot;&bslash;n&squot;
)paren
)paren
(brace
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;cannot read %s: %s&quot;
)paren
comma
id|filename
comma
id|ferror
c_func
(paren
id|f
)paren
ques
c_cond
id|strerror
c_func
(paren
id|errno
)paren
suffix:colon
id|_
c_func
(paren
l_string|&quot;unexpected end of file&quot;
)paren
)paren
suffix:semicolon
id|fclose
c_func
(paren
id|f
)paren
suffix:semicolon
r_goto
id|fail
suffix:semicolon
)brace
id|fclose
c_func
(paren
id|f
)paren
suffix:semicolon
r_if
c_cond
(paren
id|get_sha1_hex
c_func
(paren
id|buf.buf
comma
id|sha1
)paren
op_logical_or
id|buf.buf
(braket
l_int|40
)braket
op_ne
l_char|&squot;&bslash;0&squot;
)paren
(brace
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;stored pre-cherry-pick HEAD file &squot;%s&squot; is corrupt&quot;
)paren
comma
id|filename
)paren
suffix:semicolon
r_goto
id|fail
suffix:semicolon
)brace
r_if
c_cond
(paren
id|reset_for_rollback
c_func
(paren
id|sha1
)paren
)paren
r_goto
id|fail
suffix:semicolon
id|remove_sequencer_state
c_func
(paren
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|buf
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|fail
suffix:colon
id|strbuf_release
c_func
(paren
op_amp
id|buf
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|save_todo
r_static
r_void
id|save_todo
c_func
(paren
r_struct
id|commit_list
op_star
id|todo_list
comma
r_struct
id|replay_opts
op_star
id|opts
)paren
(brace
r_const
r_char
op_star
id|todo_file
op_assign
id|git_path
c_func
(paren
id|SEQ_TODO_FILE
)paren
suffix:semicolon
r_static
r_struct
id|lock_file
id|todo_lock
suffix:semicolon
r_struct
id|strbuf
id|buf
op_assign
id|STRBUF_INIT
suffix:semicolon
r_int
id|fd
suffix:semicolon
id|fd
op_assign
id|hold_lock_file_for_update
c_func
(paren
op_amp
id|todo_lock
comma
id|todo_file
comma
id|LOCK_DIE_ON_ERROR
)paren
suffix:semicolon
r_if
c_cond
(paren
id|format_todo
c_func
(paren
op_amp
id|buf
comma
id|todo_list
comma
id|opts
)paren
OL
l_int|0
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Could not format %s.&quot;
)paren
comma
id|todo_file
)paren
suffix:semicolon
r_if
c_cond
(paren
id|write_in_full
c_func
(paren
id|fd
comma
id|buf.buf
comma
id|buf.len
)paren
OL
l_int|0
)paren
(brace
id|strbuf_release
c_func
(paren
op_amp
id|buf
)paren
suffix:semicolon
id|die_errno
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Could not write to %s&quot;
)paren
comma
id|todo_file
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|commit_lock_file
c_func
(paren
op_amp
id|todo_lock
)paren
OL
l_int|0
)paren
(brace
id|strbuf_release
c_func
(paren
op_amp
id|buf
)paren
suffix:semicolon
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Error wrapping up %s.&quot;
)paren
comma
id|todo_file
)paren
suffix:semicolon
)brace
id|strbuf_release
c_func
(paren
op_amp
id|buf
)paren
suffix:semicolon
)brace
DECL|function|save_opts
r_static
r_void
id|save_opts
c_func
(paren
r_struct
id|replay_opts
op_star
id|opts
)paren
(brace
r_const
r_char
op_star
id|opts_file
op_assign
id|git_path
c_func
(paren
id|SEQ_OPTS_FILE
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opts-&gt;no_commit
)paren
id|git_config_set_in_file
c_func
(paren
id|opts_file
comma
l_string|&quot;options.no-commit&quot;
comma
l_string|&quot;true&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opts-&gt;edit
)paren
id|git_config_set_in_file
c_func
(paren
id|opts_file
comma
l_string|&quot;options.edit&quot;
comma
l_string|&quot;true&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opts-&gt;signoff
)paren
id|git_config_set_in_file
c_func
(paren
id|opts_file
comma
l_string|&quot;options.signoff&quot;
comma
l_string|&quot;true&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opts-&gt;record_origin
)paren
id|git_config_set_in_file
c_func
(paren
id|opts_file
comma
l_string|&quot;options.record-origin&quot;
comma
l_string|&quot;true&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opts-&gt;allow_ff
)paren
id|git_config_set_in_file
c_func
(paren
id|opts_file
comma
l_string|&quot;options.allow-ff&quot;
comma
l_string|&quot;true&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opts-&gt;mainline
)paren
(brace
r_struct
id|strbuf
id|buf
op_assign
id|STRBUF_INIT
suffix:semicolon
id|strbuf_addf
c_func
(paren
op_amp
id|buf
comma
l_string|&quot;%d&quot;
comma
id|opts-&gt;mainline
)paren
suffix:semicolon
id|git_config_set_in_file
c_func
(paren
id|opts_file
comma
l_string|&quot;options.mainline&quot;
comma
id|buf.buf
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|buf
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|opts-&gt;strategy
)paren
id|git_config_set_in_file
c_func
(paren
id|opts_file
comma
l_string|&quot;options.strategy&quot;
comma
id|opts-&gt;strategy
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opts-&gt;xopts
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|opts-&gt;xopts_nr
suffix:semicolon
id|i
op_increment
)paren
id|git_config_set_multivar_in_file
c_func
(paren
id|opts_file
comma
l_string|&quot;options.strategy-option&quot;
comma
id|opts-&gt;xopts
(braket
id|i
)braket
comma
l_string|&quot;^$&quot;
comma
l_int|0
)paren
suffix:semicolon
)brace
)brace
DECL|function|pick_commits
r_static
r_int
id|pick_commits
c_func
(paren
r_struct
id|commit_list
op_star
id|todo_list
comma
r_struct
id|replay_opts
op_star
id|opts
)paren
(brace
r_struct
id|commit_list
op_star
id|cur
suffix:semicolon
r_int
id|res
suffix:semicolon
id|setenv
c_func
(paren
id|GIT_REFLOG_ACTION
comma
id|action_name
c_func
(paren
id|opts
)paren
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opts-&gt;allow_ff
)paren
m_assert
(paren
op_logical_neg
(paren
id|opts-&gt;signoff
op_logical_or
id|opts-&gt;no_commit
op_logical_or
id|opts-&gt;record_origin
op_logical_or
id|opts-&gt;edit
)paren
)paren
suffix:semicolon
id|read_and_refresh_cache
c_func
(paren
id|opts
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cur
op_assign
id|todo_list
suffix:semicolon
id|cur
suffix:semicolon
id|cur
op_assign
id|cur-&gt;next
)paren
(brace
id|save_todo
c_func
(paren
id|cur
comma
id|opts
)paren
suffix:semicolon
id|res
op_assign
id|do_pick_commit
c_func
(paren
id|cur-&gt;item
comma
id|opts
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
)paren
r_return
id|res
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Sequence of picks finished successfully; cleanup by&n;&t; * removing the .git/sequencer directory&n;&t; */
id|remove_sequencer_state
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|continue_single_pick
r_static
r_int
id|continue_single_pick
c_func
(paren
r_void
)paren
(brace
r_const
r_char
op_star
id|argv
(braket
)braket
op_assign
(brace
l_string|&quot;commit&quot;
comma
l_int|NULL
)brace
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|file_exists
c_func
(paren
id|git_path
c_func
(paren
l_string|&quot;CHERRY_PICK_HEAD&quot;
)paren
)paren
op_logical_and
op_logical_neg
id|file_exists
c_func
(paren
id|git_path
c_func
(paren
l_string|&quot;REVERT_HEAD&quot;
)paren
)paren
)paren
r_return
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;no cherry-pick or revert in progress&quot;
)paren
)paren
suffix:semicolon
r_return
id|run_command_v_opt
c_func
(paren
id|argv
comma
id|RUN_GIT_CMD
)paren
suffix:semicolon
)brace
DECL|function|sequencer_continue
r_static
r_int
id|sequencer_continue
c_func
(paren
r_struct
id|replay_opts
op_star
id|opts
)paren
(brace
r_struct
id|commit_list
op_star
id|todo_list
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|file_exists
c_func
(paren
id|git_path
c_func
(paren
id|SEQ_TODO_FILE
)paren
)paren
)paren
r_return
id|continue_single_pick
c_func
(paren
)paren
suffix:semicolon
id|read_populate_opts
c_func
(paren
op_amp
id|opts
)paren
suffix:semicolon
id|read_populate_todo
c_func
(paren
op_amp
id|todo_list
comma
id|opts
)paren
suffix:semicolon
multiline_comment|/* Verify that the conflict has been resolved */
r_if
c_cond
(paren
id|file_exists
c_func
(paren
id|git_path
c_func
(paren
l_string|&quot;CHERRY_PICK_HEAD&quot;
)paren
)paren
op_logical_or
id|file_exists
c_func
(paren
id|git_path
c_func
(paren
l_string|&quot;REVERT_HEAD&quot;
)paren
)paren
)paren
(brace
r_int
id|ret
op_assign
id|continue_single_pick
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ret
)paren
r_return
id|ret
suffix:semicolon
)brace
r_if
c_cond
(paren
id|index_differs_from
c_func
(paren
l_string|&quot;HEAD&quot;
comma
l_int|0
)paren
)paren
r_return
id|error_dirty_index
c_func
(paren
id|opts
)paren
suffix:semicolon
id|todo_list
op_assign
id|todo_list-&gt;next
suffix:semicolon
r_return
id|pick_commits
c_func
(paren
id|todo_list
comma
id|opts
)paren
suffix:semicolon
)brace
DECL|function|single_pick
r_static
r_int
id|single_pick
c_func
(paren
r_struct
id|commit
op_star
id|cmit
comma
r_struct
id|replay_opts
op_star
id|opts
)paren
(brace
id|setenv
c_func
(paren
id|GIT_REFLOG_ACTION
comma
id|action_name
c_func
(paren
id|opts
)paren
comma
l_int|0
)paren
suffix:semicolon
r_return
id|do_pick_commit
c_func
(paren
id|cmit
comma
id|opts
)paren
suffix:semicolon
)brace
DECL|function|pick_revisions
r_static
r_int
id|pick_revisions
c_func
(paren
r_struct
id|replay_opts
op_star
id|opts
)paren
(brace
r_struct
id|commit_list
op_star
id|todo_list
op_assign
l_int|NULL
suffix:semicolon
r_int
r_char
id|sha1
(braket
l_int|20
)braket
suffix:semicolon
r_if
c_cond
(paren
id|opts-&gt;subcommand
op_eq
id|REPLAY_NONE
)paren
m_assert
(paren
id|opts-&gt;revs
)paren
suffix:semicolon
id|read_and_refresh_cache
c_func
(paren
id|opts
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Decide what to do depending on the arguments; a fresh&n;&t; * cherry-pick should be handled differently from an existing&n;&t; * one that is being continued&n;&t; */
r_if
c_cond
(paren
id|opts-&gt;subcommand
op_eq
id|REPLAY_REMOVE_STATE
)paren
(brace
id|remove_sequencer_state
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|opts-&gt;subcommand
op_eq
id|REPLAY_ROLLBACK
)paren
r_return
id|sequencer_rollback
c_func
(paren
id|opts
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opts-&gt;subcommand
op_eq
id|REPLAY_CONTINUE
)paren
r_return
id|sequencer_continue
c_func
(paren
id|opts
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * If we were called as &quot;git cherry-pick &lt;commit&gt;&quot;, just&n;&t; * cherry-pick/revert it, set CHERRY_PICK_HEAD /&n;&t; * REVERT_HEAD, and don&squot;t touch the sequencer state.&n;&t; * This means it is possible to cherry-pick in the middle&n;&t; * of a cherry-pick sequence.&n;&t; */
r_if
c_cond
(paren
id|opts-&gt;revs-&gt;cmdline.nr
op_eq
l_int|1
op_logical_and
id|opts-&gt;revs-&gt;cmdline.rev-&gt;whence
op_eq
id|REV_CMD_REV
op_logical_and
id|opts-&gt;revs-&gt;no_walk
op_logical_and
op_logical_neg
id|opts-&gt;revs-&gt;cmdline.rev-&gt;flags
)paren
(brace
r_struct
id|commit
op_star
id|cmit
suffix:semicolon
r_if
c_cond
(paren
id|prepare_revision_walk
c_func
(paren
id|opts-&gt;revs
)paren
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;revision walk setup failed&quot;
)paren
)paren
suffix:semicolon
id|cmit
op_assign
id|get_revision
c_func
(paren
id|opts-&gt;revs
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cmit
op_logical_or
id|get_revision
c_func
(paren
id|opts-&gt;revs
)paren
)paren
id|die
c_func
(paren
l_string|&quot;BUG: expected exactly one commit from walk&quot;
)paren
suffix:semicolon
r_return
id|single_pick
c_func
(paren
id|cmit
comma
id|opts
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Start a new cherry-pick/ revert sequence; but&n;&t; * first, make sure that an existing one isn&squot;t in&n;&t; * progress&n;&t; */
id|walk_revs_populate_todo
c_func
(paren
op_amp
id|todo_list
comma
id|opts
)paren
suffix:semicolon
r_if
c_cond
(paren
id|create_seq_dir
c_func
(paren
)paren
OL
l_int|0
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|get_sha1
c_func
(paren
l_string|&quot;HEAD&quot;
comma
id|sha1
)paren
)paren
(brace
r_if
c_cond
(paren
id|opts-&gt;action
op_eq
id|REVERT
)paren
r_return
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Can&squot;t revert as initial commit&quot;
)paren
)paren
suffix:semicolon
r_return
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Can&squot;t cherry-pick into empty head&quot;
)paren
)paren
suffix:semicolon
)brace
id|save_head
c_func
(paren
id|sha1_to_hex
c_func
(paren
id|sha1
)paren
)paren
suffix:semicolon
id|save_opts
c_func
(paren
id|opts
)paren
suffix:semicolon
r_return
id|pick_commits
c_func
(paren
id|todo_list
comma
id|opts
)paren
suffix:semicolon
)brace
DECL|function|cmd_revert
r_int
id|cmd_revert
c_func
(paren
r_int
id|argc
comma
r_const
r_char
op_star
op_star
id|argv
comma
r_const
r_char
op_star
id|prefix
)paren
(brace
r_struct
id|replay_opts
id|opts
suffix:semicolon
r_int
id|res
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|opts
comma
l_int|0
comma
r_sizeof
(paren
id|opts
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|isatty
c_func
(paren
l_int|0
)paren
)paren
id|opts.edit
op_assign
l_int|1
suffix:semicolon
id|opts.action
op_assign
id|REVERT
suffix:semicolon
id|git_config
c_func
(paren
id|git_default_config
comma
l_int|NULL
)paren
suffix:semicolon
id|parse_args
c_func
(paren
id|argc
comma
id|argv
comma
op_amp
id|opts
)paren
suffix:semicolon
id|res
op_assign
id|pick_revisions
c_func
(paren
op_amp
id|opts
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
OL
l_int|0
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;revert failed&quot;
)paren
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
DECL|function|cmd_cherry_pick
r_int
id|cmd_cherry_pick
c_func
(paren
r_int
id|argc
comma
r_const
r_char
op_star
op_star
id|argv
comma
r_const
r_char
op_star
id|prefix
)paren
(brace
r_struct
id|replay_opts
id|opts
suffix:semicolon
r_int
id|res
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|opts
comma
l_int|0
comma
r_sizeof
(paren
id|opts
)paren
)paren
suffix:semicolon
id|opts.action
op_assign
id|CHERRY_PICK
suffix:semicolon
id|git_config
c_func
(paren
id|git_default_config
comma
l_int|NULL
)paren
suffix:semicolon
id|parse_args
c_func
(paren
id|argc
comma
id|argv
comma
op_amp
id|opts
)paren
suffix:semicolon
id|res
op_assign
id|pick_revisions
c_func
(paren
op_amp
id|opts
)paren
suffix:semicolon
r_if
c_cond
(paren
id|res
OL
l_int|0
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;cherry-pick failed&quot;
)paren
)paren
suffix:semicolon
r_return
id|res
suffix:semicolon
)brace
eof
