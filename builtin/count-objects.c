multiline_comment|/*&n; * Builtin &quot;git count-objects&quot;.&n; *&n; * Copyright (c) 2006 Junio C Hamano&n; */
macro_line|#include &quot;cache.h&quot;
macro_line|#include &quot;dir.h&quot;
macro_line|#include &quot;builtin.h&quot;
macro_line|#include &quot;parse-options.h&quot;
DECL|variable|garbage
r_static
r_int
r_int
id|garbage
suffix:semicolon
DECL|variable|size_garbage
r_static
id|off_t
id|size_garbage
suffix:semicolon
DECL|variable|verbose
r_static
r_int
id|verbose
suffix:semicolon
DECL|variable|loose
DECL|variable|packed
DECL|variable|packed_loose
r_static
r_int
r_int
id|loose
comma
id|packed
comma
id|packed_loose
suffix:semicolon
DECL|variable|loose_size
r_static
id|off_t
id|loose_size
suffix:semicolon
DECL|function|bits_to_msg
r_static
r_const
r_char
op_star
id|bits_to_msg
c_func
(paren
r_int
id|seen_bits
)paren
(brace
r_switch
c_cond
(paren
id|seen_bits
)paren
(brace
r_case
l_int|0
suffix:colon
r_return
l_string|&quot;no corresponding .idx or .pack&quot;
suffix:semicolon
r_case
id|PACKDIR_FILE_GARBAGE
suffix:colon
r_return
l_string|&quot;garbage found&quot;
suffix:semicolon
r_case
id|PACKDIR_FILE_PACK
suffix:colon
r_return
l_string|&quot;no corresponding .idx&quot;
suffix:semicolon
r_case
id|PACKDIR_FILE_IDX
suffix:colon
r_return
l_string|&quot;no corresponding .pack&quot;
suffix:semicolon
r_case
id|PACKDIR_FILE_PACK
op_or
id|PACKDIR_FILE_IDX
suffix:colon
r_default
suffix:colon
r_return
l_int|NULL
suffix:semicolon
)brace
)brace
DECL|function|real_report_garbage
r_static
r_void
id|real_report_garbage
c_func
(paren
r_int
id|seen_bits
comma
r_const
r_char
op_star
id|path
)paren
(brace
r_struct
id|stat
id|st
suffix:semicolon
r_const
r_char
op_star
id|desc
op_assign
id|bits_to_msg
c_func
(paren
id|seen_bits
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|desc
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|stat
c_func
(paren
id|path
comma
op_amp
id|st
)paren
)paren
id|size_garbage
op_add_assign
id|st.st_size
suffix:semicolon
id|warning
c_func
(paren
l_string|&quot;%s: %s&quot;
comma
id|desc
comma
id|path
)paren
suffix:semicolon
id|garbage
op_increment
suffix:semicolon
)brace
DECL|function|loose_garbage
r_static
r_void
id|loose_garbage
c_func
(paren
r_const
r_char
op_star
id|path
)paren
(brace
r_if
c_cond
(paren
id|verbose
)paren
id|report_garbage
c_func
(paren
id|PACKDIR_FILE_GARBAGE
comma
id|path
)paren
suffix:semicolon
)brace
DECL|function|count_loose
r_static
r_int
id|count_loose
c_func
(paren
r_const
r_int
r_char
op_star
id|sha1
comma
r_const
r_char
op_star
id|path
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|stat
id|st
suffix:semicolon
r_if
c_cond
(paren
id|lstat
c_func
(paren
id|path
comma
op_amp
id|st
)paren
op_logical_or
op_logical_neg
id|S_ISREG
c_func
(paren
id|st.st_mode
)paren
)paren
id|loose_garbage
c_func
(paren
id|path
)paren
suffix:semicolon
r_else
(brace
id|loose_size
op_add_assign
id|on_disk_bytes
c_func
(paren
id|st
)paren
suffix:semicolon
id|loose
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|verbose
op_logical_and
id|has_sha1_pack
c_func
(paren
id|sha1
)paren
)paren
id|packed_loose
op_increment
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|count_cruft
r_static
r_int
id|count_cruft
c_func
(paren
r_const
r_char
op_star
id|basename
comma
r_const
r_char
op_star
id|path
comma
r_void
op_star
id|data
)paren
(brace
id|loose_garbage
c_func
(paren
id|path
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|count_objects_usage
r_static
r_char
r_const
op_star
r_const
id|count_objects_usage
(braket
)braket
op_assign
(brace
id|N_
c_func
(paren
l_string|&quot;git count-objects [-v] [-H | --human-readable]&quot;
)paren
comma
l_int|NULL
)brace
suffix:semicolon
DECL|function|cmd_count_objects
r_int
id|cmd_count_objects
c_func
(paren
r_int
id|argc
comma
r_const
r_char
op_star
op_star
id|argv
comma
r_const
r_char
op_star
id|prefix
)paren
(brace
r_int
id|human_readable
op_assign
l_int|0
suffix:semicolon
r_struct
id|option
id|opts
(braket
)braket
op_assign
(brace
id|OPT__VERBOSE
c_func
(paren
op_amp
id|verbose
comma
id|N_
c_func
(paren
l_string|&quot;be verbose&quot;
)paren
)paren
comma
id|OPT_BOOL
c_func
(paren
l_char|&squot;H&squot;
comma
l_string|&quot;human-readable&quot;
comma
op_amp
id|human_readable
comma
id|N_
c_func
(paren
l_string|&quot;print sizes in human readable format&quot;
)paren
)paren
comma
id|OPT_END
c_func
(paren
)paren
comma
)brace
suffix:semicolon
id|argc
op_assign
id|parse_options
c_func
(paren
id|argc
comma
id|argv
comma
id|prefix
comma
id|opts
comma
id|count_objects_usage
comma
l_int|0
)paren
suffix:semicolon
multiline_comment|/* we do not take arguments other than flags for now */
r_if
c_cond
(paren
id|argc
)paren
id|usage_with_options
c_func
(paren
id|count_objects_usage
comma
id|opts
)paren
suffix:semicolon
r_if
c_cond
(paren
id|verbose
)paren
(brace
id|report_garbage
op_assign
id|real_report_garbage
suffix:semicolon
id|report_linked_checkout_garbage
c_func
(paren
)paren
suffix:semicolon
)brace
id|for_each_loose_file_in_objdir
c_func
(paren
id|get_object_directory
c_func
(paren
)paren
comma
id|count_loose
comma
id|count_cruft
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|verbose
)paren
(brace
r_struct
id|packed_git
op_star
id|p
suffix:semicolon
r_int
r_int
id|num_pack
op_assign
l_int|0
suffix:semicolon
id|off_t
id|size_pack
op_assign
l_int|0
suffix:semicolon
r_struct
id|strbuf
id|loose_buf
op_assign
id|STRBUF_INIT
suffix:semicolon
r_struct
id|strbuf
id|pack_buf
op_assign
id|STRBUF_INIT
suffix:semicolon
r_struct
id|strbuf
id|garbage_buf
op_assign
id|STRBUF_INIT
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|packed_git
)paren
id|prepare_packed_git
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|p
op_assign
id|packed_git
suffix:semicolon
id|p
suffix:semicolon
id|p
op_assign
id|p-&gt;next
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|p-&gt;pack_local
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|open_pack_index
c_func
(paren
id|p
)paren
)paren
r_continue
suffix:semicolon
id|packed
op_add_assign
id|p-&gt;num_objects
suffix:semicolon
id|size_pack
op_add_assign
id|p-&gt;pack_size
op_plus
id|p-&gt;index_size
suffix:semicolon
id|num_pack
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|human_readable
)paren
(brace
id|strbuf_humanise_bytes
c_func
(paren
op_amp
id|loose_buf
comma
id|loose_size
)paren
suffix:semicolon
id|strbuf_humanise_bytes
c_func
(paren
op_amp
id|pack_buf
comma
id|size_pack
)paren
suffix:semicolon
id|strbuf_humanise_bytes
c_func
(paren
op_amp
id|garbage_buf
comma
id|size_garbage
)paren
suffix:semicolon
)brace
r_else
(brace
id|strbuf_addf
c_func
(paren
op_amp
id|loose_buf
comma
l_string|&quot;%lu&quot;
comma
(paren
r_int
r_int
)paren
(paren
id|loose_size
op_div
l_int|1024
)paren
)paren
suffix:semicolon
id|strbuf_addf
c_func
(paren
op_amp
id|pack_buf
comma
l_string|&quot;%lu&quot;
comma
(paren
r_int
r_int
)paren
(paren
id|size_pack
op_div
l_int|1024
)paren
)paren
suffix:semicolon
id|strbuf_addf
c_func
(paren
op_amp
id|garbage_buf
comma
l_string|&quot;%lu&quot;
comma
(paren
r_int
r_int
)paren
(paren
id|size_garbage
op_div
l_int|1024
)paren
)paren
suffix:semicolon
)brace
id|printf
c_func
(paren
l_string|&quot;count: %lu&bslash;n&quot;
comma
id|loose
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;size: %s&bslash;n&quot;
comma
id|loose_buf.buf
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;in-pack: %lu&bslash;n&quot;
comma
id|packed
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;packs: %lu&bslash;n&quot;
comma
id|num_pack
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;size-pack: %s&bslash;n&quot;
comma
id|pack_buf.buf
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;prune-packable: %lu&bslash;n&quot;
comma
id|packed_loose
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;garbage: %lu&bslash;n&quot;
comma
id|garbage
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;size-garbage: %s&bslash;n&quot;
comma
id|garbage_buf.buf
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|loose_buf
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|pack_buf
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|garbage_buf
)paren
suffix:semicolon
)brace
r_else
(brace
r_struct
id|strbuf
id|buf
op_assign
id|STRBUF_INIT
suffix:semicolon
r_if
c_cond
(paren
id|human_readable
)paren
id|strbuf_humanise_bytes
c_func
(paren
op_amp
id|buf
comma
id|loose_size
)paren
suffix:semicolon
r_else
id|strbuf_addf
c_func
(paren
op_amp
id|buf
comma
l_string|&quot;%lu kilobytes&quot;
comma
(paren
r_int
r_int
)paren
(paren
id|loose_size
op_div
l_int|1024
)paren
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;%lu objects, %s&bslash;n&quot;
comma
id|loose
comma
id|buf.buf
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|buf
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
eof
