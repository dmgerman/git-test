multiline_comment|/*&n; * Builtin &quot;git pull&quot;&n; *&n; * Based on git-pull.sh by Junio C Hamano&n; *&n; * Fetch one or more remote refs and merge it/them into the current HEAD.&n; */
macro_line|#include &quot;cache.h&quot;
macro_line|#include &quot;builtin.h&quot;
macro_line|#include &quot;parse-options.h&quot;
macro_line|#include &quot;exec_cmd.h&quot;
macro_line|#include &quot;run-command.h&quot;
macro_line|#include &quot;sha1-array.h&quot;
macro_line|#include &quot;remote.h&quot;
macro_line|#include &quot;dir.h&quot;
macro_line|#include &quot;refs.h&quot;
DECL|variable|pull_usage
r_static
r_const
r_char
op_star
r_const
id|pull_usage
(braket
)braket
op_assign
(brace
id|N_
c_func
(paren
l_string|&quot;git pull [options] [&lt;repository&gt; [&lt;refspec&gt;...]]&quot;
)paren
comma
l_int|NULL
)brace
suffix:semicolon
multiline_comment|/* Shared options */
DECL|variable|opt_verbosity
r_static
r_int
id|opt_verbosity
suffix:semicolon
DECL|variable|opt_progress
r_static
r_char
op_star
id|opt_progress
suffix:semicolon
multiline_comment|/* Options passed to git-merge */
DECL|variable|opt_diffstat
r_static
r_char
op_star
id|opt_diffstat
suffix:semicolon
DECL|variable|opt_log
r_static
r_char
op_star
id|opt_log
suffix:semicolon
DECL|variable|opt_squash
r_static
r_char
op_star
id|opt_squash
suffix:semicolon
DECL|variable|opt_commit
r_static
r_char
op_star
id|opt_commit
suffix:semicolon
DECL|variable|opt_edit
r_static
r_char
op_star
id|opt_edit
suffix:semicolon
DECL|variable|opt_ff
r_static
r_char
op_star
id|opt_ff
suffix:semicolon
DECL|variable|opt_verify_signatures
r_static
r_char
op_star
id|opt_verify_signatures
suffix:semicolon
DECL|variable|opt_strategies
r_static
r_struct
id|argv_array
id|opt_strategies
op_assign
id|ARGV_ARRAY_INIT
suffix:semicolon
DECL|variable|opt_strategy_opts
r_static
r_struct
id|argv_array
id|opt_strategy_opts
op_assign
id|ARGV_ARRAY_INIT
suffix:semicolon
DECL|variable|opt_gpg_sign
r_static
r_char
op_star
id|opt_gpg_sign
suffix:semicolon
multiline_comment|/* Options passed to git-fetch */
DECL|variable|opt_all
r_static
r_char
op_star
id|opt_all
suffix:semicolon
DECL|variable|opt_append
r_static
r_char
op_star
id|opt_append
suffix:semicolon
DECL|variable|opt_upload_pack
r_static
r_char
op_star
id|opt_upload_pack
suffix:semicolon
DECL|variable|opt_force
r_static
r_int
id|opt_force
suffix:semicolon
DECL|variable|opt_tags
r_static
r_char
op_star
id|opt_tags
suffix:semicolon
DECL|variable|opt_prune
r_static
r_char
op_star
id|opt_prune
suffix:semicolon
DECL|variable|opt_recurse_submodules
r_static
r_char
op_star
id|opt_recurse_submodules
suffix:semicolon
DECL|variable|opt_dry_run
r_static
r_int
id|opt_dry_run
suffix:semicolon
DECL|variable|opt_keep
r_static
r_char
op_star
id|opt_keep
suffix:semicolon
DECL|variable|opt_depth
r_static
r_char
op_star
id|opt_depth
suffix:semicolon
DECL|variable|opt_unshallow
r_static
r_char
op_star
id|opt_unshallow
suffix:semicolon
DECL|variable|opt_update_shallow
r_static
r_char
op_star
id|opt_update_shallow
suffix:semicolon
DECL|variable|opt_refmap
r_static
r_char
op_star
id|opt_refmap
suffix:semicolon
DECL|variable|pull_options
r_static
r_struct
id|option
id|pull_options
(braket
)braket
op_assign
(brace
multiline_comment|/* Shared options */
id|OPT__VERBOSITY
c_func
(paren
op_amp
id|opt_verbosity
)paren
comma
id|OPT_PASSTHRU
c_func
(paren
l_int|0
comma
l_string|&quot;progress&quot;
comma
op_amp
id|opt_progress
comma
l_int|NULL
comma
id|N_
c_func
(paren
l_string|&quot;force progress reporting&quot;
)paren
comma
id|PARSE_OPT_NOARG
)paren
comma
multiline_comment|/* Options passed to git-merge */
id|OPT_GROUP
c_func
(paren
id|N_
c_func
(paren
l_string|&quot;Options related to merging&quot;
)paren
)paren
comma
id|OPT_PASSTHRU
c_func
(paren
l_char|&squot;n&squot;
comma
l_int|NULL
comma
op_amp
id|opt_diffstat
comma
l_int|NULL
comma
id|N_
c_func
(paren
l_string|&quot;do not show a diffstat at the end of the merge&quot;
)paren
comma
id|PARSE_OPT_NOARG
op_or
id|PARSE_OPT_NONEG
)paren
comma
id|OPT_PASSTHRU
c_func
(paren
l_int|0
comma
l_string|&quot;stat&quot;
comma
op_amp
id|opt_diffstat
comma
l_int|NULL
comma
id|N_
c_func
(paren
l_string|&quot;show a diffstat at the end of the merge&quot;
)paren
comma
id|PARSE_OPT_NOARG
)paren
comma
id|OPT_PASSTHRU
c_func
(paren
l_int|0
comma
l_string|&quot;summary&quot;
comma
op_amp
id|opt_diffstat
comma
l_int|NULL
comma
id|N_
c_func
(paren
l_string|&quot;(synonym to --stat)&quot;
)paren
comma
id|PARSE_OPT_NOARG
op_or
id|PARSE_OPT_HIDDEN
)paren
comma
id|OPT_PASSTHRU
c_func
(paren
l_int|0
comma
l_string|&quot;log&quot;
comma
op_amp
id|opt_log
comma
id|N_
c_func
(paren
l_string|&quot;n&quot;
)paren
comma
id|N_
c_func
(paren
l_string|&quot;add (at most &lt;n&gt;) entries from shortlog to merge commit message&quot;
)paren
comma
id|PARSE_OPT_OPTARG
)paren
comma
id|OPT_PASSTHRU
c_func
(paren
l_int|0
comma
l_string|&quot;squash&quot;
comma
op_amp
id|opt_squash
comma
l_int|NULL
comma
id|N_
c_func
(paren
l_string|&quot;create a single commit instead of doing a merge&quot;
)paren
comma
id|PARSE_OPT_NOARG
)paren
comma
id|OPT_PASSTHRU
c_func
(paren
l_int|0
comma
l_string|&quot;commit&quot;
comma
op_amp
id|opt_commit
comma
l_int|NULL
comma
id|N_
c_func
(paren
l_string|&quot;perform a commit if the merge succeeds (default)&quot;
)paren
comma
id|PARSE_OPT_NOARG
)paren
comma
id|OPT_PASSTHRU
c_func
(paren
l_int|0
comma
l_string|&quot;edit&quot;
comma
op_amp
id|opt_edit
comma
l_int|NULL
comma
id|N_
c_func
(paren
l_string|&quot;edit message before committing&quot;
)paren
comma
id|PARSE_OPT_NOARG
)paren
comma
id|OPT_PASSTHRU
c_func
(paren
l_int|0
comma
l_string|&quot;ff&quot;
comma
op_amp
id|opt_ff
comma
l_int|NULL
comma
id|N_
c_func
(paren
l_string|&quot;allow fast-forward&quot;
)paren
comma
id|PARSE_OPT_NOARG
)paren
comma
id|OPT_PASSTHRU
c_func
(paren
l_int|0
comma
l_string|&quot;ff-only&quot;
comma
op_amp
id|opt_ff
comma
l_int|NULL
comma
id|N_
c_func
(paren
l_string|&quot;abort if fast-forward is not possible&quot;
)paren
comma
id|PARSE_OPT_NOARG
op_or
id|PARSE_OPT_NONEG
)paren
comma
id|OPT_PASSTHRU
c_func
(paren
l_int|0
comma
l_string|&quot;verify-signatures&quot;
comma
op_amp
id|opt_verify_signatures
comma
l_int|NULL
comma
id|N_
c_func
(paren
l_string|&quot;verify that the named commit has a valid GPG signature&quot;
)paren
comma
id|PARSE_OPT_NOARG
)paren
comma
id|OPT_PASSTHRU_ARGV
c_func
(paren
l_char|&squot;s&squot;
comma
l_string|&quot;strategy&quot;
comma
op_amp
id|opt_strategies
comma
id|N_
c_func
(paren
l_string|&quot;strategy&quot;
)paren
comma
id|N_
c_func
(paren
l_string|&quot;merge strategy to use&quot;
)paren
comma
l_int|0
)paren
comma
id|OPT_PASSTHRU_ARGV
c_func
(paren
l_char|&squot;X&squot;
comma
l_string|&quot;strategy-option&quot;
comma
op_amp
id|opt_strategy_opts
comma
id|N_
c_func
(paren
l_string|&quot;option=value&quot;
)paren
comma
id|N_
c_func
(paren
l_string|&quot;option for selected merge strategy&quot;
)paren
comma
l_int|0
)paren
comma
id|OPT_PASSTHRU
c_func
(paren
l_char|&squot;S&squot;
comma
l_string|&quot;gpg-sign&quot;
comma
op_amp
id|opt_gpg_sign
comma
id|N_
c_func
(paren
l_string|&quot;key-id&quot;
)paren
comma
id|N_
c_func
(paren
l_string|&quot;GPG sign commit&quot;
)paren
comma
id|PARSE_OPT_OPTARG
)paren
comma
multiline_comment|/* Options passed to git-fetch */
id|OPT_GROUP
c_func
(paren
id|N_
c_func
(paren
l_string|&quot;Options related to fetching&quot;
)paren
)paren
comma
id|OPT_PASSTHRU
c_func
(paren
l_int|0
comma
l_string|&quot;all&quot;
comma
op_amp
id|opt_all
comma
l_int|NULL
comma
id|N_
c_func
(paren
l_string|&quot;fetch from all remotes&quot;
)paren
comma
id|PARSE_OPT_NOARG
)paren
comma
id|OPT_PASSTHRU
c_func
(paren
l_char|&squot;a&squot;
comma
l_string|&quot;append&quot;
comma
op_amp
id|opt_append
comma
l_int|NULL
comma
id|N_
c_func
(paren
l_string|&quot;append to .git/FETCH_HEAD instead of overwriting&quot;
)paren
comma
id|PARSE_OPT_NOARG
)paren
comma
id|OPT_PASSTHRU
c_func
(paren
l_int|0
comma
l_string|&quot;upload-pack&quot;
comma
op_amp
id|opt_upload_pack
comma
id|N_
c_func
(paren
l_string|&quot;path&quot;
)paren
comma
id|N_
c_func
(paren
l_string|&quot;path to upload pack on remote end&quot;
)paren
comma
l_int|0
)paren
comma
id|OPT__FORCE
c_func
(paren
op_amp
id|opt_force
comma
id|N_
c_func
(paren
l_string|&quot;force overwrite of local branch&quot;
)paren
)paren
comma
id|OPT_PASSTHRU
c_func
(paren
l_char|&squot;t&squot;
comma
l_string|&quot;tags&quot;
comma
op_amp
id|opt_tags
comma
l_int|NULL
comma
id|N_
c_func
(paren
l_string|&quot;fetch all tags and associated objects&quot;
)paren
comma
id|PARSE_OPT_NOARG
)paren
comma
id|OPT_PASSTHRU
c_func
(paren
l_char|&squot;p&squot;
comma
l_string|&quot;prune&quot;
comma
op_amp
id|opt_prune
comma
l_int|NULL
comma
id|N_
c_func
(paren
l_string|&quot;prune remote-tracking branches no longer on remote&quot;
)paren
comma
id|PARSE_OPT_NOARG
)paren
comma
id|OPT_PASSTHRU
c_func
(paren
l_int|0
comma
l_string|&quot;recurse-submodules&quot;
comma
op_amp
id|opt_recurse_submodules
comma
id|N_
c_func
(paren
l_string|&quot;on-demand&quot;
)paren
comma
id|N_
c_func
(paren
l_string|&quot;control recursive fetching of submodules&quot;
)paren
comma
id|PARSE_OPT_OPTARG
)paren
comma
id|OPT_BOOL
c_func
(paren
l_int|0
comma
l_string|&quot;dry-run&quot;
comma
op_amp
id|opt_dry_run
comma
id|N_
c_func
(paren
l_string|&quot;dry run&quot;
)paren
)paren
comma
id|OPT_PASSTHRU
c_func
(paren
l_char|&squot;k&squot;
comma
l_string|&quot;keep&quot;
comma
op_amp
id|opt_keep
comma
l_int|NULL
comma
id|N_
c_func
(paren
l_string|&quot;keep downloaded pack&quot;
)paren
comma
id|PARSE_OPT_NOARG
)paren
comma
id|OPT_PASSTHRU
c_func
(paren
l_int|0
comma
l_string|&quot;depth&quot;
comma
op_amp
id|opt_depth
comma
id|N_
c_func
(paren
l_string|&quot;depth&quot;
)paren
comma
id|N_
c_func
(paren
l_string|&quot;deepen history of shallow clone&quot;
)paren
comma
l_int|0
)paren
comma
id|OPT_PASSTHRU
c_func
(paren
l_int|0
comma
l_string|&quot;unshallow&quot;
comma
op_amp
id|opt_unshallow
comma
l_int|NULL
comma
id|N_
c_func
(paren
l_string|&quot;convert to a complete repository&quot;
)paren
comma
id|PARSE_OPT_NONEG
op_or
id|PARSE_OPT_NOARG
)paren
comma
id|OPT_PASSTHRU
c_func
(paren
l_int|0
comma
l_string|&quot;update-shallow&quot;
comma
op_amp
id|opt_update_shallow
comma
l_int|NULL
comma
id|N_
c_func
(paren
l_string|&quot;accept refs that update .git/shallow&quot;
)paren
comma
id|PARSE_OPT_NOARG
)paren
comma
id|OPT_PASSTHRU
c_func
(paren
l_int|0
comma
l_string|&quot;refmap&quot;
comma
op_amp
id|opt_refmap
comma
id|N_
c_func
(paren
l_string|&quot;refmap&quot;
)paren
comma
id|N_
c_func
(paren
l_string|&quot;specify fetch refmap&quot;
)paren
comma
id|PARSE_OPT_NONEG
)paren
comma
id|OPT_END
c_func
(paren
)paren
)brace
suffix:semicolon
multiline_comment|/**&n; * Pushes &quot;-q&quot; or &quot;-v&quot; switches into arr to match the opt_verbosity level.&n; */
DECL|function|argv_push_verbosity
r_static
r_void
id|argv_push_verbosity
c_func
(paren
r_struct
id|argv_array
op_star
id|arr
)paren
(brace
r_int
id|verbosity
suffix:semicolon
r_for
c_loop
(paren
id|verbosity
op_assign
id|opt_verbosity
suffix:semicolon
id|verbosity
OG
l_int|0
suffix:semicolon
id|verbosity
op_decrement
)paren
id|argv_array_push
c_func
(paren
id|arr
comma
l_string|&quot;-v&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|verbosity
op_assign
id|opt_verbosity
suffix:semicolon
id|verbosity
OL
l_int|0
suffix:semicolon
id|verbosity
op_increment
)paren
id|argv_array_push
c_func
(paren
id|arr
comma
l_string|&quot;-q&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * Pushes &quot;-f&quot; switches into arr to match the opt_force level.&n; */
DECL|function|argv_push_force
r_static
r_void
id|argv_push_force
c_func
(paren
r_struct
id|argv_array
op_star
id|arr
)paren
(brace
r_int
id|force
op_assign
id|opt_force
suffix:semicolon
r_while
c_loop
(paren
id|force
op_decrement
OG
l_int|0
)paren
id|argv_array_push
c_func
(paren
id|arr
comma
l_string|&quot;-f&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * If pull.ff is unset, returns NULL. If pull.ff is &quot;true&quot;, returns &quot;--ff&quot;. If&n; * pull.ff is &quot;false&quot;, returns &quot;--no-ff&quot;. If pull.ff is &quot;only&quot;, returns&n; * &quot;--ff-only&quot;. Otherwise, if pull.ff is set to an invalid value, die with an&n; * error.&n; */
DECL|function|config_get_ff
r_static
r_const
r_char
op_star
id|config_get_ff
c_func
(paren
r_void
)paren
(brace
r_const
r_char
op_star
id|value
suffix:semicolon
r_if
c_cond
(paren
id|git_config_get_value
c_func
(paren
l_string|&quot;pull.ff&quot;
comma
op_amp
id|value
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
r_switch
c_cond
(paren
id|git_config_maybe_bool
c_func
(paren
l_string|&quot;pull.ff&quot;
comma
id|value
)paren
)paren
(brace
r_case
l_int|0
suffix:colon
r_return
l_string|&quot;--no-ff&quot;
suffix:semicolon
r_case
l_int|1
suffix:colon
r_return
l_string|&quot;--ff&quot;
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|value
comma
l_string|&quot;only&quot;
)paren
)paren
r_return
l_string|&quot;--ff-only&quot;
suffix:semicolon
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Invalid value for pull.ff: %s&quot;
)paren
comma
id|value
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * Appends merge candidates from FETCH_HEAD that are not marked not-for-merge&n; * into merge_heads.&n; */
DECL|function|get_merge_heads
r_static
r_void
id|get_merge_heads
c_func
(paren
r_struct
id|sha1_array
op_star
id|merge_heads
)paren
(brace
r_const
r_char
op_star
id|filename
op_assign
id|git_path
c_func
(paren
l_string|&quot;FETCH_HEAD&quot;
)paren
suffix:semicolon
id|FILE
op_star
id|fp
suffix:semicolon
r_struct
id|strbuf
id|sb
op_assign
id|STRBUF_INIT
suffix:semicolon
r_int
r_char
id|sha1
(braket
id|GIT_SHA1_RAWSZ
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|fp
op_assign
id|fopen
c_func
(paren
id|filename
comma
l_string|&quot;r&quot;
)paren
)paren
)paren
id|die_errno
c_func
(paren
id|_
c_func
(paren
l_string|&quot;could not open &squot;%s&squot; for reading&quot;
)paren
comma
id|filename
)paren
suffix:semicolon
r_while
c_loop
(paren
id|strbuf_getline
c_func
(paren
op_amp
id|sb
comma
id|fp
comma
l_char|&squot;&bslash;n&squot;
)paren
op_ne
id|EOF
)paren
(brace
r_if
c_cond
(paren
id|get_sha1_hex
c_func
(paren
id|sb.buf
comma
id|sha1
)paren
)paren
r_continue
suffix:semicolon
multiline_comment|/* invalid line: does not start with SHA1 */
r_if
c_cond
(paren
id|starts_with
c_func
(paren
id|sb.buf
op_plus
id|GIT_SHA1_HEXSZ
comma
l_string|&quot;&bslash;tnot-for-merge&bslash;t&quot;
)paren
)paren
r_continue
suffix:semicolon
multiline_comment|/* ref is not-for-merge */
id|sha1_array_append
c_func
(paren
id|merge_heads
comma
id|sha1
)paren
suffix:semicolon
)brace
id|fclose
c_func
(paren
id|fp
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|sb
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * Used by die_no_merge_candidates() as a for_each_remote() callback to&n; * retrieve the name of the remote if the repository only has one remote.&n; */
DECL|function|get_only_remote
r_static
r_int
id|get_only_remote
c_func
(paren
r_struct
id|remote
op_star
id|remote
comma
r_void
op_star
id|cb_data
)paren
(brace
r_const
r_char
op_star
op_star
id|remote_name
op_assign
id|cb_data
suffix:semicolon
r_if
c_cond
(paren
op_star
id|remote_name
)paren
r_return
l_int|1
suffix:semicolon
op_star
id|remote_name
op_assign
id|remote-&gt;name
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; * Dies with the appropriate reason for why there are no merge candidates:&n; *&n; * 1. We fetched from a specific remote, and a refspec was given, but it ended&n; *    up not fetching anything. This is usually because the user provided a&n; *    wildcard refspec which had no matches on the remote end.&n; *&n; * 2. We fetched from a non-default remote, but didn&squot;t specify a branch to&n; *    merge. We can&squot;t use the configured one because it applies to the default&n; *    remote, thus the user must specify the branches to merge.&n; *&n; * 3. We fetched from the branch&squot;s or repo&squot;s default remote, but:&n; *&n; *    a. We are not on a branch, so there will never be a configured branch to&n; *       merge with.&n; *&n; *    b. We are on a branch, but there is no configured branch to merge with.&n; *&n; * 4. We fetched from the branch&squot;s or repo&squot;s default remote, but the configured&n; *    branch to merge didn&squot;t get fetched. (Either it doesn&squot;t exist, or wasn&squot;t&n; *    part of the configured fetch refspec.)&n; */
DECL|function|die_no_merge_candidates
r_static
r_void
id|NORETURN
id|die_no_merge_candidates
c_func
(paren
r_const
r_char
op_star
id|repo
comma
r_const
r_char
op_star
op_star
id|refspecs
)paren
(brace
r_struct
id|branch
op_star
id|curr_branch
op_assign
id|branch_get
c_func
(paren
l_string|&quot;HEAD&quot;
)paren
suffix:semicolon
r_const
r_char
op_star
id|remote
op_assign
id|curr_branch
ques
c_cond
id|curr_branch-&gt;remote_name
suffix:colon
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
op_star
id|refspecs
)paren
(brace
id|fprintf_ln
c_func
(paren
id|stderr
comma
id|_
c_func
(paren
l_string|&quot;There are no candidates for merging among the refs that you just fetched.&quot;
)paren
)paren
suffix:semicolon
id|fprintf_ln
c_func
(paren
id|stderr
comma
id|_
c_func
(paren
l_string|&quot;Generally this means that you provided a wildcard refspec which had no&bslash;n&quot;
l_string|&quot;matches on the remote end.&quot;
)paren
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|repo
op_logical_and
id|curr_branch
op_logical_and
(paren
op_logical_neg
id|remote
op_logical_or
id|strcmp
c_func
(paren
id|repo
comma
id|remote
)paren
)paren
)paren
(brace
id|fprintf_ln
c_func
(paren
id|stderr
comma
id|_
c_func
(paren
l_string|&quot;You asked to pull from the remote &squot;%s&squot;, but did not specify&bslash;n&quot;
l_string|&quot;a branch. Because this is not the default configured remote&bslash;n&quot;
l_string|&quot;for your current branch, you must specify a branch on the command line.&quot;
)paren
comma
id|repo
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|curr_branch
)paren
(brace
id|fprintf_ln
c_func
(paren
id|stderr
comma
id|_
c_func
(paren
l_string|&quot;You are not currently on a branch.&quot;
)paren
)paren
suffix:semicolon
id|fprintf_ln
c_func
(paren
id|stderr
comma
id|_
c_func
(paren
l_string|&quot;Please specify which branch you want to merge with.&quot;
)paren
)paren
suffix:semicolon
id|fprintf_ln
c_func
(paren
id|stderr
comma
id|_
c_func
(paren
l_string|&quot;See git-pull(1) for details.&quot;
)paren
)paren
suffix:semicolon
id|fprintf
c_func
(paren
id|stderr
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|fprintf_ln
c_func
(paren
id|stderr
comma
l_string|&quot;    git pull &lt;remote&gt; &lt;branch&gt;&quot;
)paren
suffix:semicolon
id|fprintf
c_func
(paren
id|stderr
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|curr_branch-&gt;merge_nr
)paren
(brace
r_const
r_char
op_star
id|remote_name
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|for_each_remote
c_func
(paren
id|get_only_remote
comma
op_amp
id|remote_name
)paren
op_logical_or
op_logical_neg
id|remote_name
)paren
id|remote_name
op_assign
l_string|&quot;&lt;remote&gt;&quot;
suffix:semicolon
id|fprintf_ln
c_func
(paren
id|stderr
comma
id|_
c_func
(paren
l_string|&quot;There is no tracking information for the current branch.&quot;
)paren
)paren
suffix:semicolon
id|fprintf_ln
c_func
(paren
id|stderr
comma
id|_
c_func
(paren
l_string|&quot;Please specify which branch you want to merge with.&quot;
)paren
)paren
suffix:semicolon
id|fprintf_ln
c_func
(paren
id|stderr
comma
id|_
c_func
(paren
l_string|&quot;See git-pull(1) for details.&quot;
)paren
)paren
suffix:semicolon
id|fprintf
c_func
(paren
id|stderr
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|fprintf_ln
c_func
(paren
id|stderr
comma
l_string|&quot;    git pull &lt;remote&gt; &lt;branch&gt;&quot;
)paren
suffix:semicolon
id|fprintf
c_func
(paren
id|stderr
comma
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
id|fprintf_ln
c_func
(paren
id|stderr
comma
id|_
c_func
(paren
l_string|&quot;If you wish to set tracking information for this branch you can do so with:&bslash;n&quot;
l_string|&quot;&bslash;n&quot;
l_string|&quot;    git branch --set-upstream-to=%s/&lt;branch&gt; %s&bslash;n&quot;
)paren
comma
id|remote_name
comma
id|curr_branch-&gt;name
)paren
suffix:semicolon
)brace
r_else
id|fprintf_ln
c_func
(paren
id|stderr
comma
id|_
c_func
(paren
l_string|&quot;Your configuration specifies to merge with the ref &squot;%s&squot;&bslash;n&quot;
l_string|&quot;from the remote, but no such ref was fetched.&quot;
)paren
comma
op_star
id|curr_branch-&gt;merge_name
)paren
suffix:semicolon
m_exit
(paren
l_int|1
)paren
suffix:semicolon
)brace
multiline_comment|/**&n; * Parses argv into [&lt;repo&gt; [&lt;refspecs&gt;...]], returning their values in `repo`&n; * as a string and `refspecs` as a null-terminated array of strings. If `repo`&n; * is not provided in argv, it is set to NULL.&n; */
DECL|function|parse_repo_refspecs
r_static
r_void
id|parse_repo_refspecs
c_func
(paren
r_int
id|argc
comma
r_const
r_char
op_star
op_star
id|argv
comma
r_const
r_char
op_star
op_star
id|repo
comma
r_const
r_char
op_star
op_star
op_star
id|refspecs
)paren
(brace
r_if
c_cond
(paren
id|argc
OG
l_int|0
)paren
(brace
op_star
id|repo
op_assign
op_star
id|argv
op_increment
suffix:semicolon
id|argc
op_decrement
suffix:semicolon
)brace
r_else
op_star
id|repo
op_assign
l_int|NULL
suffix:semicolon
op_star
id|refspecs
op_assign
id|argv
suffix:semicolon
)brace
multiline_comment|/**&n; * Runs git-fetch, returning its exit status. `repo` and `refspecs` are the&n; * repository and refspecs to fetch, or NULL if they are not provided.&n; */
DECL|function|run_fetch
r_static
r_int
id|run_fetch
c_func
(paren
r_const
r_char
op_star
id|repo
comma
r_const
r_char
op_star
op_star
id|refspecs
)paren
(brace
r_struct
id|argv_array
id|args
op_assign
id|ARGV_ARRAY_INIT
suffix:semicolon
r_int
id|ret
suffix:semicolon
id|argv_array_pushl
c_func
(paren
op_amp
id|args
comma
l_string|&quot;fetch&quot;
comma
l_string|&quot;--update-head-ok&quot;
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/* Shared options */
id|argv_push_verbosity
c_func
(paren
op_amp
id|args
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opt_progress
)paren
id|argv_array_push
c_func
(paren
op_amp
id|args
comma
id|opt_progress
)paren
suffix:semicolon
multiline_comment|/* Options passed to git-fetch */
r_if
c_cond
(paren
id|opt_all
)paren
id|argv_array_push
c_func
(paren
op_amp
id|args
comma
id|opt_all
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opt_append
)paren
id|argv_array_push
c_func
(paren
op_amp
id|args
comma
id|opt_append
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opt_upload_pack
)paren
id|argv_array_push
c_func
(paren
op_amp
id|args
comma
id|opt_upload_pack
)paren
suffix:semicolon
id|argv_push_force
c_func
(paren
op_amp
id|args
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opt_tags
)paren
id|argv_array_push
c_func
(paren
op_amp
id|args
comma
id|opt_tags
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opt_prune
)paren
id|argv_array_push
c_func
(paren
op_amp
id|args
comma
id|opt_prune
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opt_recurse_submodules
)paren
id|argv_array_push
c_func
(paren
op_amp
id|args
comma
id|opt_recurse_submodules
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opt_dry_run
)paren
id|argv_array_push
c_func
(paren
op_amp
id|args
comma
l_string|&quot;--dry-run&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opt_keep
)paren
id|argv_array_push
c_func
(paren
op_amp
id|args
comma
id|opt_keep
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opt_depth
)paren
id|argv_array_push
c_func
(paren
op_amp
id|args
comma
id|opt_depth
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opt_unshallow
)paren
id|argv_array_push
c_func
(paren
op_amp
id|args
comma
id|opt_unshallow
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opt_update_shallow
)paren
id|argv_array_push
c_func
(paren
op_amp
id|args
comma
id|opt_update_shallow
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opt_refmap
)paren
id|argv_array_push
c_func
(paren
op_amp
id|args
comma
id|opt_refmap
)paren
suffix:semicolon
r_if
c_cond
(paren
id|repo
)paren
(brace
id|argv_array_push
c_func
(paren
op_amp
id|args
comma
id|repo
)paren
suffix:semicolon
id|argv_array_pushv
c_func
(paren
op_amp
id|args
comma
id|refspecs
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_star
id|refspecs
)paren
id|die
c_func
(paren
l_string|&quot;BUG: refspecs without repo?&quot;
)paren
suffix:semicolon
id|ret
op_assign
id|run_command_v_opt
c_func
(paren
id|args.argv
comma
id|RUN_GIT_CMD
)paren
suffix:semicolon
id|argv_array_clear
c_func
(paren
op_amp
id|args
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
multiline_comment|/**&n; * &quot;Pulls into void&quot; by branching off merge_head.&n; */
DECL|function|pull_into_void
r_static
r_int
id|pull_into_void
c_func
(paren
r_const
r_int
r_char
op_star
id|merge_head
comma
r_const
r_int
r_char
op_star
id|curr_head
)paren
(brace
multiline_comment|/*&n;&t; * Two-way merge: we treat the index as based on an empty tree,&n;&t; * and try to fast-forward to HEAD. This ensures we will not lose&n;&t; * index/worktree changes that the user already made on the unborn&n;&t; * branch.&n;&t; */
r_if
c_cond
(paren
id|checkout_fast_forward
c_func
(paren
id|EMPTY_TREE_SHA1_BIN
comma
id|merge_head
comma
l_int|0
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|update_ref
c_func
(paren
l_string|&quot;initial pull&quot;
comma
l_string|&quot;HEAD&quot;
comma
id|merge_head
comma
id|curr_head
comma
l_int|0
comma
id|UPDATE_REFS_DIE_ON_ERR
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/**&n; * Runs git-merge, returning its exit status.&n; */
DECL|function|run_merge
r_static
r_int
id|run_merge
c_func
(paren
r_void
)paren
(brace
r_int
id|ret
suffix:semicolon
r_struct
id|argv_array
id|args
op_assign
id|ARGV_ARRAY_INIT
suffix:semicolon
id|argv_array_pushl
c_func
(paren
op_amp
id|args
comma
l_string|&quot;merge&quot;
comma
l_int|NULL
)paren
suffix:semicolon
multiline_comment|/* Shared options */
id|argv_push_verbosity
c_func
(paren
op_amp
id|args
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opt_progress
)paren
id|argv_array_push
c_func
(paren
op_amp
id|args
comma
id|opt_progress
)paren
suffix:semicolon
multiline_comment|/* Options passed to git-merge */
r_if
c_cond
(paren
id|opt_diffstat
)paren
id|argv_array_push
c_func
(paren
op_amp
id|args
comma
id|opt_diffstat
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opt_log
)paren
id|argv_array_push
c_func
(paren
op_amp
id|args
comma
id|opt_log
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opt_squash
)paren
id|argv_array_push
c_func
(paren
op_amp
id|args
comma
id|opt_squash
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opt_commit
)paren
id|argv_array_push
c_func
(paren
op_amp
id|args
comma
id|opt_commit
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opt_edit
)paren
id|argv_array_push
c_func
(paren
op_amp
id|args
comma
id|opt_edit
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opt_ff
)paren
id|argv_array_push
c_func
(paren
op_amp
id|args
comma
id|opt_ff
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opt_verify_signatures
)paren
id|argv_array_push
c_func
(paren
op_amp
id|args
comma
id|opt_verify_signatures
)paren
suffix:semicolon
id|argv_array_pushv
c_func
(paren
op_amp
id|args
comma
id|opt_strategies.argv
)paren
suffix:semicolon
id|argv_array_pushv
c_func
(paren
op_amp
id|args
comma
id|opt_strategy_opts.argv
)paren
suffix:semicolon
r_if
c_cond
(paren
id|opt_gpg_sign
)paren
id|argv_array_push
c_func
(paren
op_amp
id|args
comma
id|opt_gpg_sign
)paren
suffix:semicolon
id|argv_array_push
c_func
(paren
op_amp
id|args
comma
l_string|&quot;FETCH_HEAD&quot;
)paren
suffix:semicolon
id|ret
op_assign
id|run_command_v_opt
c_func
(paren
id|args.argv
comma
id|RUN_GIT_CMD
)paren
suffix:semicolon
id|argv_array_clear
c_func
(paren
op_amp
id|args
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|cmd_pull
r_int
id|cmd_pull
c_func
(paren
r_int
id|argc
comma
r_const
r_char
op_star
op_star
id|argv
comma
r_const
r_char
op_star
id|prefix
)paren
(brace
r_const
r_char
op_star
id|repo
comma
op_star
op_star
id|refspecs
suffix:semicolon
r_struct
id|sha1_array
id|merge_heads
op_assign
id|SHA1_ARRAY_INIT
suffix:semicolon
r_int
r_char
id|orig_head
(braket
id|GIT_SHA1_RAWSZ
)braket
comma
id|curr_head
(braket
id|GIT_SHA1_RAWSZ
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|getenv
c_func
(paren
l_string|&quot;_GIT_USE_BUILTIN_PULL&quot;
)paren
)paren
(brace
r_const
r_char
op_star
id|path
op_assign
id|mkpath
c_func
(paren
l_string|&quot;%s/git-pull&quot;
comma
id|git_exec_path
c_func
(paren
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sane_execvp
c_func
(paren
id|path
comma
(paren
r_char
op_star
op_star
)paren
id|argv
)paren
OL
l_int|0
)paren
id|die_errno
c_func
(paren
l_string|&quot;could not exec %s&quot;
comma
id|path
)paren
suffix:semicolon
)brace
id|argc
op_assign
id|parse_options
c_func
(paren
id|argc
comma
id|argv
comma
id|prefix
comma
id|pull_options
comma
id|pull_usage
comma
l_int|0
)paren
suffix:semicolon
id|parse_repo_refspecs
c_func
(paren
id|argc
comma
id|argv
comma
op_amp
id|repo
comma
op_amp
id|refspecs
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|opt_ff
)paren
id|opt_ff
op_assign
id|xstrdup_or_null
c_func
(paren
id|config_get_ff
c_func
(paren
)paren
)paren
suffix:semicolon
id|git_config
c_func
(paren
id|git_default_config
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|read_cache_unmerged
c_func
(paren
)paren
)paren
id|die_resolve_conflict
c_func
(paren
l_string|&quot;Pull&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|file_exists
c_func
(paren
id|git_path
c_func
(paren
l_string|&quot;MERGE_HEAD&quot;
)paren
)paren
)paren
id|die_conclude_merge
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|get_sha1
c_func
(paren
l_string|&quot;HEAD&quot;
comma
id|orig_head
)paren
)paren
id|hashclr
c_func
(paren
id|orig_head
)paren
suffix:semicolon
r_if
c_cond
(paren
id|run_fetch
c_func
(paren
id|repo
comma
id|refspecs
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|opt_dry_run
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|get_sha1
c_func
(paren
l_string|&quot;HEAD&quot;
comma
id|curr_head
)paren
)paren
id|hashclr
c_func
(paren
id|curr_head
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|is_null_sha1
c_func
(paren
id|orig_head
)paren
op_logical_and
op_logical_neg
id|is_null_sha1
c_func
(paren
id|curr_head
)paren
op_logical_and
id|hashcmp
c_func
(paren
id|orig_head
comma
id|curr_head
)paren
)paren
(brace
multiline_comment|/*&n;&t;&t; * The fetch involved updating the current branch.&n;&t;&t; *&n;&t;&t; * The working tree and the index file are still based on&n;&t;&t; * orig_head commit, but we are merging into curr_head.&n;&t;&t; * Update the working tree to match curr_head.&n;&t;&t; */
id|warning
c_func
(paren
id|_
c_func
(paren
l_string|&quot;fetch updated the current branch head.&bslash;n&quot;
l_string|&quot;fast-forwarding your working tree from&bslash;n&quot;
l_string|&quot;commit %s.&quot;
)paren
comma
id|sha1_to_hex
c_func
(paren
id|orig_head
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|checkout_fast_forward
c_func
(paren
id|orig_head
comma
id|curr_head
comma
l_int|0
)paren
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Cannot fast-forward your working tree.&bslash;n&quot;
l_string|&quot;After making sure that you saved anything precious from&bslash;n&quot;
l_string|&quot;$ git diff %s&bslash;n&quot;
l_string|&quot;output, run&bslash;n&quot;
l_string|&quot;$ git reset --hard&bslash;n&quot;
l_string|&quot;to recover.&quot;
)paren
comma
id|sha1_to_hex
c_func
(paren
id|orig_head
)paren
)paren
suffix:semicolon
)brace
id|get_merge_heads
c_func
(paren
op_amp
id|merge_heads
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|merge_heads.nr
)paren
id|die_no_merge_candidates
c_func
(paren
id|repo
comma
id|refspecs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|is_null_sha1
c_func
(paren
id|orig_head
)paren
)paren
(brace
r_if
c_cond
(paren
id|merge_heads.nr
OG
l_int|1
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Cannot merge multiple branches into empty head.&quot;
)paren
)paren
suffix:semicolon
r_return
id|pull_into_void
c_func
(paren
op_star
id|merge_heads.sha1
comma
id|curr_head
)paren
suffix:semicolon
)brace
r_else
r_return
id|run_merge
c_func
(paren
)paren
suffix:semicolon
)brace
eof
