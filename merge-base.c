macro_line|#include &quot;cache.h&quot;
macro_line|#include &quot;revision.h&quot;
multiline_comment|/*&n; * This is stupid. We could have much better heurstics, I bet.&n; */
DECL|function|better
r_static
r_int
id|better
c_func
(paren
r_struct
id|revision
op_star
r_new
comma
r_struct
id|revision
op_star
id|old
)paren
(brace
r_return
r_new
op_member_access_from_pointer
id|date
OG
id|old-&gt;date
suffix:semicolon
)brace
DECL|function|common_parent
r_static
r_struct
id|revision
op_star
id|common_parent
c_func
(paren
r_struct
id|revision
op_star
id|rev1
comma
r_struct
id|revision
op_star
id|rev2
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|revision
op_star
id|best
op_assign
l_int|NULL
suffix:semicolon
id|mark_reachable
c_func
(paren
id|rev1
comma
l_int|1
)paren
suffix:semicolon
id|mark_reachable
c_func
(paren
id|rev2
comma
l_int|2
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|nr_revs
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|revision
op_star
id|rev
op_assign
id|revs
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
(paren
id|rev-&gt;flags
op_amp
l_int|3
)paren
op_ne
l_int|3
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|best
)paren
(brace
id|best
op_assign
id|rev
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|better
c_func
(paren
id|rev
comma
id|best
)paren
)paren
id|best
op_assign
id|rev
suffix:semicolon
)brace
r_return
id|best
suffix:semicolon
)brace
DECL|function|main
r_int
id|main
c_func
(paren
r_int
id|argc
comma
r_char
op_star
op_star
id|argv
)paren
(brace
r_int
r_char
id|rev1
(braket
l_int|20
)braket
comma
id|rev2
(braket
l_int|20
)braket
suffix:semicolon
r_struct
id|revision
op_star
id|common
suffix:semicolon
r_if
c_cond
(paren
id|argc
op_ne
l_int|3
op_logical_or
id|get_sha1_hex
c_func
(paren
id|argv
(braket
l_int|1
)braket
comma
id|rev1
)paren
op_logical_or
id|get_sha1_hex
c_func
(paren
id|argv
(braket
l_int|2
)braket
comma
id|rev2
)paren
)paren
id|usage
c_func
(paren
l_string|&quot;merge-base &lt;commit1&gt; &lt;commit2&gt;&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * We will eventually want to include a revision cache file&n;&t; * that &quot;rev-tree.c&quot; has generated, since this is going to&n;&t; * otherwise be quite expensive for big trees..&n;&t; *&n;&t; * That&squot;s some time off, though, and in the meantime we know&n;&t; * that we have a solution to the eventual expense.&n;&t; */
id|parse_commit
c_func
(paren
id|rev1
)paren
suffix:semicolon
id|parse_commit
c_func
(paren
id|rev2
)paren
suffix:semicolon
id|common
op_assign
id|common_parent
c_func
(paren
id|lookup_rev
c_func
(paren
id|rev1
)paren
comma
id|lookup_rev
c_func
(paren
id|rev2
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|common
)paren
id|die
c_func
(paren
l_string|&quot;no common parent found&quot;
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|sha1_to_hex
c_func
(paren
id|common-&gt;sha1
)paren
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
eof
