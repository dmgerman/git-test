macro_line|#include &quot;cache.h&quot;
macro_line|#include &quot;submodule.h&quot;
macro_line|#include &quot;dir.h&quot;
macro_line|#include &quot;diff.h&quot;
macro_line|#include &quot;commit.h&quot;
macro_line|#include &quot;revision.h&quot;
macro_line|#include &quot;run-command.h&quot;
macro_line|#include &quot;diffcore.h&quot;
macro_line|#include &quot;refs.h&quot;
macro_line|#include &quot;string-list.h&quot;
macro_line|#include &quot;sha1-array.h&quot;
macro_line|#include &quot;argv-array.h&quot;
macro_line|#include &quot;blob.h&quot;
DECL|variable|config_name_for_path
r_static
r_struct
id|string_list
id|config_name_for_path
suffix:semicolon
DECL|variable|config_fetch_recurse_submodules_for_name
r_static
r_struct
id|string_list
id|config_fetch_recurse_submodules_for_name
suffix:semicolon
DECL|variable|config_ignore_for_name
r_static
r_struct
id|string_list
id|config_ignore_for_name
suffix:semicolon
DECL|variable|config_fetch_recurse_submodules
r_static
r_int
id|config_fetch_recurse_submodules
op_assign
id|RECURSE_SUBMODULES_ON_DEMAND
suffix:semicolon
DECL|variable|changed_submodule_paths
r_static
r_struct
id|string_list
id|changed_submodule_paths
suffix:semicolon
DECL|variable|initialized_fetch_ref_tips
r_static
r_int
id|initialized_fetch_ref_tips
suffix:semicolon
DECL|variable|ref_tips_before_fetch
r_static
r_struct
id|sha1_array
id|ref_tips_before_fetch
suffix:semicolon
DECL|variable|ref_tips_after_fetch
r_static
r_struct
id|sha1_array
id|ref_tips_after_fetch
suffix:semicolon
multiline_comment|/*&n; * The following flag is set if the .gitmodules file is unmerged. We then&n; * disable recursion for all submodules where .git/config doesn&squot;t have a&n; * matching config entry because we can&squot;t guess what might be configured in&n; * .gitmodules unless the user resolves the conflict. When a command line&n; * option is given (which always overrides configuration) this flag will be&n; * ignored.&n; */
DECL|variable|gitmodules_is_unmerged
r_static
r_int
id|gitmodules_is_unmerged
suffix:semicolon
multiline_comment|/*&n; * This flag is set if the .gitmodules file had unstaged modifications on&n; * startup. This must be checked before allowing modifications to the&n; * .gitmodules file with the intention to stage them later, because when&n; * continuing we would stage the modifications the user didn&squot;t stage herself&n; * too. That might change in a future version when we learn to stage the&n; * changes we do ourselves without staging any previous modifications.&n; */
DECL|variable|gitmodules_is_modified
r_static
r_int
id|gitmodules_is_modified
suffix:semicolon
DECL|function|is_staging_gitmodules_ok
r_int
id|is_staging_gitmodules_ok
c_func
(paren
r_void
)paren
(brace
r_return
op_logical_neg
id|gitmodules_is_modified
suffix:semicolon
)brace
multiline_comment|/*&n; * Try to update the &quot;path&quot; entry in the &quot;submodule.&lt;name&gt;&quot; section of the&n; * .gitmodules file. Return 0 only if a .gitmodules file was found, a section&n; * with the correct path=&lt;oldpath&gt; setting was found and we could update it.&n; */
DECL|function|update_path_in_gitmodules
r_int
id|update_path_in_gitmodules
c_func
(paren
r_const
r_char
op_star
id|oldpath
comma
r_const
r_char
op_star
id|newpath
)paren
(brace
r_struct
id|strbuf
id|entry
op_assign
id|STRBUF_INIT
suffix:semicolon
r_struct
id|string_list_item
op_star
id|path_option
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|file_exists
c_func
(paren
l_string|&quot;.gitmodules&quot;
)paren
)paren
multiline_comment|/* Do nothing without .gitmodules */
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|gitmodules_is_unmerged
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Cannot change unmerged .gitmodules, resolve merge conflicts first&quot;
)paren
)paren
suffix:semicolon
id|path_option
op_assign
id|unsorted_string_list_lookup
c_func
(paren
op_amp
id|config_name_for_path
comma
id|oldpath
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|path_option
)paren
(brace
id|warning
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Could not find section in .gitmodules where path=%s&quot;
)paren
comma
id|oldpath
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|strbuf_addstr
c_func
(paren
op_amp
id|entry
comma
l_string|&quot;submodule.&quot;
)paren
suffix:semicolon
id|strbuf_addstr
c_func
(paren
op_amp
id|entry
comma
id|path_option-&gt;util
)paren
suffix:semicolon
id|strbuf_addstr
c_func
(paren
op_amp
id|entry
comma
l_string|&quot;.path&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|git_config_set_in_file
c_func
(paren
l_string|&quot;.gitmodules&quot;
comma
id|entry.buf
comma
id|newpath
)paren
OL
l_int|0
)paren
(brace
multiline_comment|/* Maybe the user already did that, don&squot;t error out here */
id|warning
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Could not update .gitmodules entry %s&quot;
)paren
comma
id|entry.buf
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|entry
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|strbuf_release
c_func
(paren
op_amp
id|entry
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n; * Try to remove the &quot;submodule.&lt;name&gt;&quot; section from .gitmodules where the given&n; * path is configured. Return 0 only if a .gitmodules file was found, a section&n; * with the correct path=&lt;path&gt; setting was found and we could remove it.&n; */
DECL|function|remove_path_from_gitmodules
r_int
id|remove_path_from_gitmodules
c_func
(paren
r_const
r_char
op_star
id|path
)paren
(brace
r_struct
id|strbuf
id|sect
op_assign
id|STRBUF_INIT
suffix:semicolon
r_struct
id|string_list_item
op_star
id|path_option
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|file_exists
c_func
(paren
l_string|&quot;.gitmodules&quot;
)paren
)paren
multiline_comment|/* Do nothing without .gitmodules */
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|gitmodules_is_unmerged
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Cannot change unmerged .gitmodules, resolve merge conflicts first&quot;
)paren
)paren
suffix:semicolon
id|path_option
op_assign
id|unsorted_string_list_lookup
c_func
(paren
op_amp
id|config_name_for_path
comma
id|path
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|path_option
)paren
(brace
id|warning
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Could not find section in .gitmodules where path=%s&quot;
)paren
comma
id|path
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|strbuf_addstr
c_func
(paren
op_amp
id|sect
comma
l_string|&quot;submodule.&quot;
)paren
suffix:semicolon
id|strbuf_addstr
c_func
(paren
op_amp
id|sect
comma
id|path_option-&gt;util
)paren
suffix:semicolon
r_if
c_cond
(paren
id|git_config_rename_section_in_file
c_func
(paren
l_string|&quot;.gitmodules&quot;
comma
id|sect.buf
comma
l_int|NULL
)paren
OL
l_int|0
)paren
(brace
multiline_comment|/* Maybe the user already did that, don&squot;t error out here */
id|warning
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Could not remove .gitmodules entry for %s&quot;
)paren
comma
id|path
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|sect
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|strbuf_release
c_func
(paren
op_amp
id|sect
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|stage_updated_gitmodules
r_void
id|stage_updated_gitmodules
c_func
(paren
r_void
)paren
(brace
r_struct
id|strbuf
id|buf
op_assign
id|STRBUF_INIT
suffix:semicolon
r_struct
id|stat
id|st
suffix:semicolon
r_int
id|pos
suffix:semicolon
r_struct
id|cache_entry
op_star
id|ce
suffix:semicolon
r_int
id|namelen
op_assign
id|strlen
c_func
(paren
l_string|&quot;.gitmodules&quot;
)paren
suffix:semicolon
id|pos
op_assign
id|cache_name_pos
c_func
(paren
l_string|&quot;.gitmodules&quot;
comma
id|namelen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pos
OL
l_int|0
)paren
(brace
id|warning
c_func
(paren
id|_
c_func
(paren
l_string|&quot;could not find .gitmodules in index&quot;
)paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|ce
op_assign
id|active_cache
(braket
id|pos
)braket
suffix:semicolon
id|ce-&gt;ce_flags
op_assign
id|namelen
suffix:semicolon
r_if
c_cond
(paren
id|strbuf_read_file
c_func
(paren
op_amp
id|buf
comma
l_string|&quot;.gitmodules&quot;
comma
l_int|0
)paren
OL
l_int|0
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;reading updated .gitmodules failed&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lstat
c_func
(paren
l_string|&quot;.gitmodules&quot;
comma
op_amp
id|st
)paren
OL
l_int|0
)paren
id|die_errno
c_func
(paren
id|_
c_func
(paren
l_string|&quot;unable to stat updated .gitmodules&quot;
)paren
)paren
suffix:semicolon
id|fill_stat_cache_info
c_func
(paren
id|ce
comma
op_amp
id|st
)paren
suffix:semicolon
id|ce-&gt;ce_mode
op_assign
id|ce_mode_from_stat
c_func
(paren
id|ce
comma
id|st.st_mode
)paren
suffix:semicolon
r_if
c_cond
(paren
id|remove_cache_entry_at
c_func
(paren
id|pos
)paren
OL
l_int|0
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;unable to remove .gitmodules from index&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|write_sha1_file
c_func
(paren
id|buf.buf
comma
id|buf.len
comma
id|blob_type
comma
id|ce-&gt;sha1
)paren
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;adding updated .gitmodules failed&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|add_cache_entry
c_func
(paren
id|ce
comma
id|ADD_CACHE_OK_TO_ADD
op_or
id|ADD_CACHE_OK_TO_REPLACE
)paren
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;staging updated .gitmodules failed&quot;
)paren
)paren
suffix:semicolon
)brace
DECL|function|add_submodule_odb
r_static
r_int
id|add_submodule_odb
c_func
(paren
r_const
r_char
op_star
id|path
)paren
(brace
r_struct
id|strbuf
id|objects_directory
op_assign
id|STRBUF_INIT
suffix:semicolon
r_struct
id|alternate_object_database
op_star
id|alt_odb
suffix:semicolon
r_int
id|ret
op_assign
l_int|0
suffix:semicolon
r_const
r_char
op_star
id|git_dir
suffix:semicolon
id|strbuf_addf
c_func
(paren
op_amp
id|objects_directory
comma
l_string|&quot;%s/.git&quot;
comma
id|path
)paren
suffix:semicolon
id|git_dir
op_assign
id|read_gitfile
c_func
(paren
id|objects_directory.buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|git_dir
)paren
(brace
id|strbuf_reset
c_func
(paren
op_amp
id|objects_directory
)paren
suffix:semicolon
id|strbuf_addstr
c_func
(paren
op_amp
id|objects_directory
comma
id|git_dir
)paren
suffix:semicolon
)brace
id|strbuf_addstr
c_func
(paren
op_amp
id|objects_directory
comma
l_string|&quot;/objects/&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|is_directory
c_func
(paren
id|objects_directory.buf
)paren
)paren
(brace
id|ret
op_assign
l_int|1
suffix:semicolon
r_goto
id|done
suffix:semicolon
)brace
multiline_comment|/* avoid adding it twice */
r_for
c_loop
(paren
id|alt_odb
op_assign
id|alt_odb_list
suffix:semicolon
id|alt_odb
suffix:semicolon
id|alt_odb
op_assign
id|alt_odb-&gt;next
)paren
r_if
c_cond
(paren
id|alt_odb-&gt;name
id|alt_odb-&gt;base
op_eq
id|objects_directory.len
op_logical_and
op_logical_neg
id|strncmp
c_func
(paren
id|alt_odb-&gt;base
comma
id|objects_directory.buf
comma
id|objects_directory.len
)paren
)paren
r_goto
id|done
suffix:semicolon
id|alt_odb
op_assign
id|xmalloc
c_func
(paren
id|objects_directory.len
op_plus
l_int|42
op_plus
r_sizeof
(paren
op_star
id|alt_odb
)paren
)paren
suffix:semicolon
id|alt_odb-&gt;next
op_assign
id|alt_odb_list
suffix:semicolon
id|strcpy
c_func
(paren
id|alt_odb-&gt;base
comma
id|objects_directory.buf
)paren
suffix:semicolon
id|alt_odb-&gt;name
op_assign
id|alt_odb-&gt;base
op_plus
id|objects_directory.len
suffix:semicolon
id|alt_odb-&gt;name
(braket
l_int|2
)braket
op_assign
l_char|&squot;/&squot;
suffix:semicolon
id|alt_odb-&gt;name
(braket
l_int|40
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|alt_odb-&gt;name
(braket
l_int|41
)braket
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
id|alt_odb_list
op_assign
id|alt_odb
suffix:semicolon
multiline_comment|/* add possible alternates from the submodule */
id|read_info_alternates
c_func
(paren
id|objects_directory.buf
comma
l_int|0
)paren
suffix:semicolon
id|prepare_alt_odb
c_func
(paren
)paren
suffix:semicolon
id|done
suffix:colon
id|strbuf_release
c_func
(paren
op_amp
id|objects_directory
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|set_diffopt_flags_from_submodule_config
r_void
id|set_diffopt_flags_from_submodule_config
c_func
(paren
r_struct
id|diff_options
op_star
id|diffopt
comma
r_const
r_char
op_star
id|path
)paren
(brace
r_struct
id|string_list_item
op_star
id|path_option
comma
op_star
id|ignore_option
suffix:semicolon
id|path_option
op_assign
id|unsorted_string_list_lookup
c_func
(paren
op_amp
id|config_name_for_path
comma
id|path
)paren
suffix:semicolon
r_if
c_cond
(paren
id|path_option
)paren
(brace
id|ignore_option
op_assign
id|unsorted_string_list_lookup
c_func
(paren
op_amp
id|config_ignore_for_name
comma
id|path_option-&gt;util
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ignore_option
)paren
id|handle_ignore_submodules_arg
c_func
(paren
id|diffopt
comma
id|ignore_option-&gt;util
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|gitmodules_is_unmerged
)paren
id|DIFF_OPT_SET
c_func
(paren
id|diffopt
comma
id|IGNORE_SUBMODULES
)paren
suffix:semicolon
)brace
)brace
DECL|function|submodule_config
r_int
id|submodule_config
c_func
(paren
r_const
r_char
op_star
id|var
comma
r_const
r_char
op_star
id|value
comma
r_void
op_star
id|cb
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|prefixcmp
c_func
(paren
id|var
comma
l_string|&quot;submodule.&quot;
)paren
)paren
r_return
id|parse_submodule_config_option
c_func
(paren
id|var
comma
id|value
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|var
comma
l_string|&quot;fetch.recursesubmodules&quot;
)paren
)paren
(brace
id|config_fetch_recurse_submodules
op_assign
id|parse_fetch_recurse_submodules_arg
c_func
(paren
id|var
comma
id|value
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|gitmodules_config
r_void
id|gitmodules_config
c_func
(paren
r_void
)paren
(brace
r_const
r_char
op_star
id|work_tree
op_assign
id|get_git_work_tree
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|work_tree
)paren
(brace
r_struct
id|strbuf
id|gitmodules_path
op_assign
id|STRBUF_INIT
suffix:semicolon
r_int
id|pos
suffix:semicolon
id|strbuf_addstr
c_func
(paren
op_amp
id|gitmodules_path
comma
id|work_tree
)paren
suffix:semicolon
id|strbuf_addstr
c_func
(paren
op_amp
id|gitmodules_path
comma
l_string|&quot;/.gitmodules&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|read_cache
c_func
(paren
)paren
OL
l_int|0
)paren
id|die
c_func
(paren
l_string|&quot;index file corrupt&quot;
)paren
suffix:semicolon
id|pos
op_assign
id|cache_name_pos
c_func
(paren
l_string|&quot;.gitmodules&quot;
comma
l_int|11
)paren
suffix:semicolon
r_if
c_cond
(paren
id|pos
OL
l_int|0
)paren
(brace
multiline_comment|/* .gitmodules not found or isn&squot;t merged */
id|pos
op_assign
l_int|1
id|pos
suffix:semicolon
r_if
c_cond
(paren
id|active_nr
OG
id|pos
)paren
(brace
multiline_comment|/* there is a .gitmodules */
r_const
r_struct
id|cache_entry
op_star
id|ce
op_assign
id|active_cache
(braket
id|pos
)braket
suffix:semicolon
r_if
c_cond
(paren
id|ce_namelen
c_func
(paren
id|ce
)paren
op_eq
l_int|11
op_logical_and
op_logical_neg
id|memcmp
c_func
(paren
id|ce-&gt;name
comma
l_string|&quot;.gitmodules&quot;
comma
l_int|11
)paren
)paren
id|gitmodules_is_unmerged
op_assign
l_int|1
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|pos
OL
id|active_nr
)paren
(brace
r_struct
id|stat
id|st
suffix:semicolon
r_if
c_cond
(paren
id|lstat
c_func
(paren
l_string|&quot;.gitmodules&quot;
comma
op_amp
id|st
)paren
op_eq
l_int|0
op_logical_and
id|ce_match_stat
c_func
(paren
id|active_cache
(braket
id|pos
)braket
comma
op_amp
id|st
comma
l_int|0
)paren
op_amp
id|DATA_CHANGED
)paren
id|gitmodules_is_modified
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|gitmodules_is_unmerged
)paren
id|git_config_from_file
c_func
(paren
id|submodule_config
comma
id|gitmodules_path.buf
comma
l_int|NULL
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|gitmodules_path
)paren
suffix:semicolon
)brace
)brace
DECL|function|parse_submodule_config_option
r_int
id|parse_submodule_config_option
c_func
(paren
r_const
r_char
op_star
id|var
comma
r_const
r_char
op_star
id|value
)paren
(brace
r_struct
id|string_list_item
op_star
id|config
suffix:semicolon
r_const
r_char
op_star
id|name
comma
op_star
id|key
suffix:semicolon
r_int
id|namelen
suffix:semicolon
r_if
c_cond
(paren
id|parse_config_key
c_func
(paren
id|var
comma
l_string|&quot;submodule&quot;
comma
op_amp
id|name
comma
op_amp
id|namelen
comma
op_amp
id|key
)paren
OL
l_int|0
op_logical_or
op_logical_neg
id|name
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|key
comma
l_string|&quot;path&quot;
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|value
)paren
r_return
id|config_error_nonbool
c_func
(paren
id|var
)paren
suffix:semicolon
id|config
op_assign
id|unsorted_string_list_lookup
c_func
(paren
op_amp
id|config_name_for_path
comma
id|value
)paren
suffix:semicolon
r_if
c_cond
(paren
id|config
)paren
id|free
c_func
(paren
id|config-&gt;util
)paren
suffix:semicolon
r_else
id|config
op_assign
id|string_list_append
c_func
(paren
op_amp
id|config_name_for_path
comma
id|xstrdup
c_func
(paren
id|value
)paren
)paren
suffix:semicolon
id|config-&gt;util
op_assign
id|xmemdupz
c_func
(paren
id|name
comma
id|namelen
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|key
comma
l_string|&quot;fetchrecursesubmodules&quot;
)paren
)paren
(brace
r_char
op_star
id|name_cstr
op_assign
id|xmemdupz
c_func
(paren
id|name
comma
id|namelen
)paren
suffix:semicolon
id|config
op_assign
id|unsorted_string_list_lookup
c_func
(paren
op_amp
id|config_fetch_recurse_submodules_for_name
comma
id|name_cstr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|config
)paren
id|config
op_assign
id|string_list_append
c_func
(paren
op_amp
id|config_fetch_recurse_submodules_for_name
comma
id|name_cstr
)paren
suffix:semicolon
r_else
id|free
c_func
(paren
id|name_cstr
)paren
suffix:semicolon
id|config-&gt;util
op_assign
(paren
r_void
op_star
)paren
(paren
r_intptr
)paren
id|parse_fetch_recurse_submodules_arg
c_func
(paren
id|var
comma
id|value
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|key
comma
l_string|&quot;ignore&quot;
)paren
)paren
(brace
r_char
op_star
id|name_cstr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|value
)paren
r_return
id|config_error_nonbool
c_func
(paren
id|var
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|value
comma
l_string|&quot;untracked&quot;
)paren
op_logical_and
id|strcmp
c_func
(paren
id|value
comma
l_string|&quot;dirty&quot;
)paren
op_logical_and
id|strcmp
c_func
(paren
id|value
comma
l_string|&quot;all&quot;
)paren
op_logical_and
id|strcmp
c_func
(paren
id|value
comma
l_string|&quot;none&quot;
)paren
)paren
(brace
id|warning
c_func
(paren
l_string|&quot;Invalid parameter &bslash;&quot;%s&bslash;&quot; for config option &bslash;&quot;submodule.%s.ignore&bslash;&quot;&quot;
comma
id|value
comma
id|var
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|name_cstr
op_assign
id|xmemdupz
c_func
(paren
id|name
comma
id|namelen
)paren
suffix:semicolon
id|config
op_assign
id|unsorted_string_list_lookup
c_func
(paren
op_amp
id|config_ignore_for_name
comma
id|name_cstr
)paren
suffix:semicolon
r_if
c_cond
(paren
id|config
)paren
(brace
id|free
c_func
(paren
id|config-&gt;util
)paren
suffix:semicolon
id|free
c_func
(paren
id|name_cstr
)paren
suffix:semicolon
)brace
r_else
id|config
op_assign
id|string_list_append
c_func
(paren
op_amp
id|config_ignore_for_name
comma
id|name_cstr
)paren
suffix:semicolon
id|config-&gt;util
op_assign
id|xstrdup
c_func
(paren
id|value
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|handle_ignore_submodules_arg
r_void
id|handle_ignore_submodules_arg
c_func
(paren
r_struct
id|diff_options
op_star
id|diffopt
comma
r_const
r_char
op_star
id|arg
)paren
(brace
id|DIFF_OPT_CLR
c_func
(paren
id|diffopt
comma
id|IGNORE_SUBMODULES
)paren
suffix:semicolon
id|DIFF_OPT_CLR
c_func
(paren
id|diffopt
comma
id|IGNORE_UNTRACKED_IN_SUBMODULES
)paren
suffix:semicolon
id|DIFF_OPT_CLR
c_func
(paren
id|diffopt
comma
id|IGNORE_DIRTY_SUBMODULES
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|arg
comma
l_string|&quot;all&quot;
)paren
)paren
id|DIFF_OPT_SET
c_func
(paren
id|diffopt
comma
id|IGNORE_SUBMODULES
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|arg
comma
l_string|&quot;untracked&quot;
)paren
)paren
id|DIFF_OPT_SET
c_func
(paren
id|diffopt
comma
id|IGNORE_UNTRACKED_IN_SUBMODULES
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|arg
comma
l_string|&quot;dirty&quot;
)paren
)paren
id|DIFF_OPT_SET
c_func
(paren
id|diffopt
comma
id|IGNORE_DIRTY_SUBMODULES
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|arg
comma
l_string|&quot;none&quot;
)paren
)paren
id|die
c_func
(paren
l_string|&quot;bad --ignore-submodules argument: %s&quot;
comma
id|arg
)paren
suffix:semicolon
)brace
DECL|function|prepare_submodule_summary
r_static
r_int
id|prepare_submodule_summary
c_func
(paren
r_struct
id|rev_info
op_star
id|rev
comma
r_const
r_char
op_star
id|path
comma
r_struct
id|commit
op_star
id|left
comma
r_struct
id|commit
op_star
id|right
comma
r_int
op_star
id|fast_forward
comma
r_int
op_star
id|fast_backward
)paren
(brace
r_struct
id|commit_list
op_star
id|merge_bases
comma
op_star
id|list
suffix:semicolon
id|init_revisions
c_func
(paren
id|rev
comma
l_int|NULL
)paren
suffix:semicolon
id|setup_revisions
c_func
(paren
l_int|0
comma
l_int|NULL
comma
id|rev
comma
l_int|NULL
)paren
suffix:semicolon
id|rev-&gt;left_right
op_assign
l_int|1
suffix:semicolon
id|rev-&gt;first_parent_only
op_assign
l_int|1
suffix:semicolon
id|left-&gt;object.flags
op_or_assign
id|SYMMETRIC_LEFT
suffix:semicolon
id|add_pending_object
c_func
(paren
id|rev
comma
op_amp
id|left-&gt;object
comma
id|path
)paren
suffix:semicolon
id|add_pending_object
c_func
(paren
id|rev
comma
op_amp
id|right-&gt;object
comma
id|path
)paren
suffix:semicolon
id|merge_bases
op_assign
id|get_merge_bases
c_func
(paren
id|left
comma
id|right
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|merge_bases
)paren
(brace
r_if
c_cond
(paren
id|merge_bases-&gt;item
op_eq
id|left
)paren
op_star
id|fast_forward
op_assign
l_int|1
suffix:semicolon
r_else
r_if
c_cond
(paren
id|merge_bases-&gt;item
op_eq
id|right
)paren
op_star
id|fast_backward
op_assign
l_int|1
suffix:semicolon
)brace
r_for
c_loop
(paren
id|list
op_assign
id|merge_bases
suffix:semicolon
id|list
suffix:semicolon
id|list
op_assign
id|list-&gt;next
)paren
(brace
id|list-&gt;item-&gt;object.flags
op_or_assign
id|UNINTERESTING
suffix:semicolon
id|add_pending_object
c_func
(paren
id|rev
comma
op_amp
id|list-&gt;item-&gt;object
comma
id|sha1_to_hex
c_func
(paren
id|list-&gt;item-&gt;object.sha1
)paren
)paren
suffix:semicolon
)brace
r_return
id|prepare_revision_walk
c_func
(paren
id|rev
)paren
suffix:semicolon
)brace
DECL|function|print_submodule_summary
r_static
r_void
id|print_submodule_summary
c_func
(paren
r_struct
id|rev_info
op_star
id|rev
comma
id|FILE
op_star
id|f
comma
r_const
r_char
op_star
id|line_prefix
comma
r_const
r_char
op_star
id|del
comma
r_const
r_char
op_star
id|add
comma
r_const
r_char
op_star
id|reset
)paren
(brace
r_static
r_const
r_char
id|format
(braket
)braket
op_assign
l_string|&quot;  %m %s&quot;
suffix:semicolon
r_struct
id|strbuf
id|sb
op_assign
id|STRBUF_INIT
suffix:semicolon
r_struct
id|commit
op_star
id|commit
suffix:semicolon
r_while
c_loop
(paren
(paren
id|commit
op_assign
id|get_revision
c_func
(paren
id|rev
)paren
)paren
)paren
(brace
r_struct
id|pretty_print_context
id|ctx
op_assign
(brace
l_int|0
)brace
suffix:semicolon
id|ctx.date_mode
op_assign
id|rev-&gt;date_mode
suffix:semicolon
id|ctx.output_encoding
op_assign
id|get_log_output_encoding
c_func
(paren
)paren
suffix:semicolon
id|strbuf_setlen
c_func
(paren
op_amp
id|sb
comma
l_int|0
)paren
suffix:semicolon
id|strbuf_addstr
c_func
(paren
op_amp
id|sb
comma
id|line_prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|commit-&gt;object.flags
op_amp
id|SYMMETRIC_LEFT
)paren
(brace
r_if
c_cond
(paren
id|del
)paren
id|strbuf_addstr
c_func
(paren
op_amp
id|sb
comma
id|del
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|add
)paren
id|strbuf_addstr
c_func
(paren
op_amp
id|sb
comma
id|add
)paren
suffix:semicolon
id|format_commit_message
c_func
(paren
id|commit
comma
id|format
comma
op_amp
id|sb
comma
op_amp
id|ctx
)paren
suffix:semicolon
r_if
c_cond
(paren
id|reset
)paren
id|strbuf_addstr
c_func
(paren
op_amp
id|sb
comma
id|reset
)paren
suffix:semicolon
id|strbuf_addch
c_func
(paren
op_amp
id|sb
comma
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
id|fprintf
c_func
(paren
id|f
comma
l_string|&quot;%s&quot;
comma
id|sb.buf
)paren
suffix:semicolon
)brace
id|strbuf_release
c_func
(paren
op_amp
id|sb
)paren
suffix:semicolon
)brace
DECL|function|parse_fetch_recurse_submodules_arg
r_int
id|parse_fetch_recurse_submodules_arg
c_func
(paren
r_const
r_char
op_star
id|opt
comma
r_const
r_char
op_star
id|arg
)paren
(brace
r_switch
c_cond
(paren
id|git_config_maybe_bool
c_func
(paren
id|opt
comma
id|arg
)paren
)paren
(brace
r_case
l_int|1
suffix:colon
r_return
id|RECURSE_SUBMODULES_ON
suffix:semicolon
r_case
l_int|0
suffix:colon
r_return
id|RECURSE_SUBMODULES_OFF
suffix:semicolon
r_default
suffix:colon
(brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|arg
comma
l_string|&quot;on-demand&quot;
)paren
)paren
r_return
id|RECURSE_SUBMODULES_ON_DEMAND
suffix:semicolon
id|die
c_func
(paren
l_string|&quot;bad %s argument: %s&quot;
comma
id|opt
comma
id|arg
)paren
suffix:semicolon
)brace
)brace
DECL|function|show_submodule_summary
r_void
id|show_submodule_summary
c_func
(paren
id|FILE
op_star
id|f
comma
r_const
r_char
op_star
id|path
comma
r_const
r_char
op_star
id|line_prefix
comma
r_int
r_char
id|one
(braket
l_int|20
)braket
comma
r_int
r_char
id|two
(braket
l_int|20
)braket
comma
r_int
id|dirty_submodule
comma
r_const
r_char
op_star
id|meta
comma
r_const
r_char
op_star
id|del
comma
r_const
r_char
op_star
id|add
comma
r_const
r_char
op_star
id|reset
)paren
(brace
r_struct
id|rev_info
id|rev
suffix:semicolon
r_struct
id|commit
op_star
id|left
op_assign
l_int|NULL
comma
op_star
id|right
op_assign
l_int|NULL
suffix:semicolon
r_const
r_char
op_star
id|message
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|strbuf
id|sb
op_assign
id|STRBUF_INIT
suffix:semicolon
r_int
id|fast_forward
op_assign
l_int|0
comma
id|fast_backward
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|is_null_sha1
c_func
(paren
id|two
)paren
)paren
id|message
op_assign
l_string|&quot;(submodule deleted)&quot;
suffix:semicolon
r_else
r_if
c_cond
(paren
id|add_submodule_odb
c_func
(paren
id|path
)paren
)paren
id|message
op_assign
l_string|&quot;(not checked out)&quot;
suffix:semicolon
r_else
r_if
c_cond
(paren
id|is_null_sha1
c_func
(paren
id|one
)paren
)paren
id|message
op_assign
l_string|&quot;(new submodule)&quot;
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
(paren
id|left
op_assign
id|lookup_commit_reference
c_func
(paren
id|one
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|right
op_assign
id|lookup_commit_reference
c_func
(paren
id|two
)paren
)paren
)paren
id|message
op_assign
l_string|&quot;(commits not present)&quot;
suffix:semicolon
r_else
r_if
c_cond
(paren
id|prepare_submodule_summary
c_func
(paren
op_amp
id|rev
comma
id|path
comma
id|left
comma
id|right
comma
op_amp
id|fast_forward
comma
op_amp
id|fast_backward
)paren
)paren
id|message
op_assign
l_string|&quot;(revision walker failed)&quot;
suffix:semicolon
r_if
c_cond
(paren
id|dirty_submodule
op_amp
id|DIRTY_SUBMODULE_UNTRACKED
)paren
id|fprintf
c_func
(paren
id|f
comma
l_string|&quot;%sSubmodule %s contains untracked content&bslash;n&quot;
comma
id|line_prefix
comma
id|path
)paren
suffix:semicolon
r_if
c_cond
(paren
id|dirty_submodule
op_amp
id|DIRTY_SUBMODULE_MODIFIED
)paren
id|fprintf
c_func
(paren
id|f
comma
l_string|&quot;%sSubmodule %s contains modified content&bslash;n&quot;
comma
id|line_prefix
comma
id|path
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hashcmp
c_func
(paren
id|one
comma
id|two
)paren
)paren
(brace
id|strbuf_release
c_func
(paren
op_amp
id|sb
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|strbuf_addf
c_func
(paren
op_amp
id|sb
comma
l_string|&quot;%s%sSubmodule %s %s..&quot;
comma
id|line_prefix
comma
id|meta
comma
id|path
comma
id|find_unique_abbrev
c_func
(paren
id|one
comma
id|DEFAULT_ABBREV
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fast_backward
op_logical_and
op_logical_neg
id|fast_forward
)paren
id|strbuf_addch
c_func
(paren
op_amp
id|sb
comma
l_char|&squot;.&squot;
)paren
suffix:semicolon
id|strbuf_addf
c_func
(paren
op_amp
id|sb
comma
l_string|&quot;%s&quot;
comma
id|find_unique_abbrev
c_func
(paren
id|two
comma
id|DEFAULT_ABBREV
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|message
)paren
id|strbuf_addf
c_func
(paren
op_amp
id|sb
comma
l_string|&quot; %s%s&bslash;n&quot;
comma
id|message
comma
id|reset
)paren
suffix:semicolon
r_else
id|strbuf_addf
c_func
(paren
op_amp
id|sb
comma
l_string|&quot;%s:%s&bslash;n&quot;
comma
id|fast_backward
ques
c_cond
l_string|&quot; (rewind)&quot;
suffix:colon
l_string|&quot;&quot;
comma
id|reset
)paren
suffix:semicolon
id|fwrite
c_func
(paren
id|sb.buf
comma
id|sb.len
comma
l_int|1
comma
id|f
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|message
)paren
multiline_comment|/* only NULL if we succeeded in setting up the walk */
id|print_submodule_summary
c_func
(paren
op_amp
id|rev
comma
id|f
comma
id|line_prefix
comma
id|del
comma
id|add
comma
id|reset
)paren
suffix:semicolon
r_if
c_cond
(paren
id|left
)paren
id|clear_commit_marks
c_func
(paren
id|left
comma
op_complement
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|right
)paren
id|clear_commit_marks
c_func
(paren
id|right
comma
op_complement
l_int|0
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|sb
)paren
suffix:semicolon
)brace
DECL|function|set_config_fetch_recurse_submodules
r_void
id|set_config_fetch_recurse_submodules
c_func
(paren
r_int
id|value
)paren
(brace
id|config_fetch_recurse_submodules
op_assign
id|value
suffix:semicolon
)brace
DECL|function|has_remote
r_static
r_int
id|has_remote
c_func
(paren
r_const
r_char
op_star
id|refname
comma
r_const
r_int
r_char
op_star
id|sha1
comma
r_int
id|flags
comma
r_void
op_star
id|cb_data
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|submodule_needs_pushing
r_static
r_int
id|submodule_needs_pushing
c_func
(paren
r_const
r_char
op_star
id|path
comma
r_const
r_int
r_char
id|sha1
(braket
l_int|20
)braket
)paren
(brace
r_if
c_cond
(paren
id|add_submodule_odb
c_func
(paren
id|path
)paren
op_logical_or
op_logical_neg
id|lookup_commit_reference
c_func
(paren
id|sha1
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|for_each_remote_ref_submodule
c_func
(paren
id|path
comma
id|has_remote
comma
l_int|NULL
)paren
OG
l_int|0
)paren
(brace
r_struct
id|child_process
id|cp
suffix:semicolon
r_const
r_char
op_star
id|argv
(braket
)braket
op_assign
(brace
l_string|&quot;rev-list&quot;
comma
l_int|NULL
comma
l_string|&quot;--not&quot;
comma
l_string|&quot;--remotes&quot;
comma
l_string|&quot;-n&quot;
comma
l_string|&quot;1&quot;
comma
l_int|NULL
)brace
suffix:semicolon
r_struct
id|strbuf
id|buf
op_assign
id|STRBUF_INIT
suffix:semicolon
r_int
id|needs_pushing
op_assign
l_int|0
suffix:semicolon
id|argv
(braket
l_int|1
)braket
op_assign
id|sha1_to_hex
c_func
(paren
id|sha1
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|cp
comma
l_int|0
comma
r_sizeof
(paren
id|cp
)paren
)paren
suffix:semicolon
id|cp.argv
op_assign
id|argv
suffix:semicolon
id|cp.env
op_assign
id|local_repo_env
suffix:semicolon
id|cp.git_cmd
op_assign
l_int|1
suffix:semicolon
id|cp.no_stdin
op_assign
l_int|1
suffix:semicolon
id|cp.out
op_assign
l_int|1
suffix:semicolon
id|cp.dir
op_assign
id|path
suffix:semicolon
r_if
c_cond
(paren
id|start_command
c_func
(paren
op_amp
id|cp
)paren
)paren
id|die
c_func
(paren
l_string|&quot;Could not run &squot;git rev-list %s --not --remotes -n 1&squot; command in submodule %s&quot;
comma
id|sha1_to_hex
c_func
(paren
id|sha1
)paren
comma
id|path
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strbuf_read
c_func
(paren
op_amp
id|buf
comma
id|cp.out
comma
l_int|41
)paren
)paren
id|needs_pushing
op_assign
l_int|1
suffix:semicolon
id|finish_command
c_func
(paren
op_amp
id|cp
)paren
suffix:semicolon
id|close
c_func
(paren
id|cp.out
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|buf
)paren
suffix:semicolon
r_return
id|needs_pushing
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|collect_submodules_from_diff
r_static
r_void
id|collect_submodules_from_diff
c_func
(paren
r_struct
id|diff_queue_struct
op_star
id|q
comma
r_struct
id|diff_options
op_star
id|options
comma
r_void
op_star
id|data
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|string_list
op_star
id|needs_pushing
op_assign
id|data
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|q-&gt;nr
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|diff_filepair
op_star
id|p
op_assign
id|q-&gt;queue
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|S_ISGITLINK
c_func
(paren
id|p-&gt;two-&gt;mode
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|submodule_needs_pushing
c_func
(paren
id|p-&gt;two-&gt;path
comma
id|p-&gt;two-&gt;sha1
)paren
)paren
id|string_list_insert
c_func
(paren
id|needs_pushing
comma
id|p-&gt;two-&gt;path
)paren
suffix:semicolon
)brace
)brace
DECL|function|find_unpushed_submodule_commits
r_static
r_void
id|find_unpushed_submodule_commits
c_func
(paren
r_struct
id|commit
op_star
id|commit
comma
r_struct
id|string_list
op_star
id|needs_pushing
)paren
(brace
r_struct
id|rev_info
id|rev
suffix:semicolon
id|init_revisions
c_func
(paren
op_amp
id|rev
comma
l_int|NULL
)paren
suffix:semicolon
id|rev.diffopt.output_format
op_or_assign
id|DIFF_FORMAT_CALLBACK
suffix:semicolon
id|rev.diffopt.format_callback
op_assign
id|collect_submodules_from_diff
suffix:semicolon
id|rev.diffopt.format_callback_data
op_assign
id|needs_pushing
suffix:semicolon
id|diff_tree_combined_merge
c_func
(paren
id|commit
comma
l_int|1
comma
op_amp
id|rev
)paren
suffix:semicolon
)brace
DECL|function|find_unpushed_submodules
r_int
id|find_unpushed_submodules
c_func
(paren
r_int
r_char
id|new_sha1
(braket
l_int|20
)braket
comma
r_const
r_char
op_star
id|remotes_name
comma
r_struct
id|string_list
op_star
id|needs_pushing
)paren
(brace
r_struct
id|rev_info
id|rev
suffix:semicolon
r_struct
id|commit
op_star
id|commit
suffix:semicolon
r_const
r_char
op_star
id|argv
(braket
)braket
op_assign
(brace
l_int|NULL
comma
l_int|NULL
comma
l_string|&quot;--not&quot;
comma
l_string|&quot;NULL&quot;
comma
l_int|NULL
)brace
suffix:semicolon
r_int
id|argc
op_assign
id|ARRAY_SIZE
c_func
(paren
id|argv
)paren
l_int|1
suffix:semicolon
r_char
op_star
id|sha1_copy
suffix:semicolon
r_struct
id|strbuf
id|remotes_arg
op_assign
id|STRBUF_INIT
suffix:semicolon
id|strbuf_addf
c_func
(paren
op_amp
id|remotes_arg
comma
l_string|&quot;--remotes=%s&quot;
comma
id|remotes_name
)paren
suffix:semicolon
id|init_revisions
c_func
(paren
op_amp
id|rev
comma
l_int|NULL
)paren
suffix:semicolon
id|sha1_copy
op_assign
id|xstrdup
c_func
(paren
id|sha1_to_hex
c_func
(paren
id|new_sha1
)paren
)paren
suffix:semicolon
id|argv
(braket
l_int|1
)braket
op_assign
id|sha1_copy
suffix:semicolon
id|argv
(braket
l_int|3
)braket
op_assign
id|remotes_arg.buf
suffix:semicolon
id|setup_revisions
c_func
(paren
id|argc
comma
id|argv
comma
op_amp
id|rev
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prepare_revision_walk
c_func
(paren
op_amp
id|rev
)paren
)paren
id|die
c_func
(paren
l_string|&quot;revision walk setup failed&quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|commit
op_assign
id|get_revision
c_func
(paren
op_amp
id|rev
)paren
)paren
op_ne
l_int|NULL
)paren
id|find_unpushed_submodule_commits
c_func
(paren
id|commit
comma
id|needs_pushing
)paren
suffix:semicolon
id|reset_revision_walk
c_func
(paren
)paren
suffix:semicolon
id|free
c_func
(paren
id|sha1_copy
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|remotes_arg
)paren
suffix:semicolon
r_return
id|needs_pushing-&gt;nr
suffix:semicolon
)brace
DECL|function|push_submodule
r_static
r_int
id|push_submodule
c_func
(paren
r_const
r_char
op_star
id|path
)paren
(brace
r_if
c_cond
(paren
id|add_submodule_odb
c_func
(paren
id|path
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|for_each_remote_ref_submodule
c_func
(paren
id|path
comma
id|has_remote
comma
l_int|NULL
)paren
OG
l_int|0
)paren
(brace
r_struct
id|child_process
id|cp
suffix:semicolon
r_const
r_char
op_star
id|argv
(braket
)braket
op_assign
(brace
l_string|&quot;push&quot;
comma
l_int|NULL
)brace
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|cp
comma
l_int|0
comma
r_sizeof
(paren
id|cp
)paren
)paren
suffix:semicolon
id|cp.argv
op_assign
id|argv
suffix:semicolon
id|cp.env
op_assign
id|local_repo_env
suffix:semicolon
id|cp.git_cmd
op_assign
l_int|1
suffix:semicolon
id|cp.no_stdin
op_assign
l_int|1
suffix:semicolon
id|cp.dir
op_assign
id|path
suffix:semicolon
r_if
c_cond
(paren
id|run_command
c_func
(paren
op_amp
id|cp
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|close
c_func
(paren
id|cp.out
)paren
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|push_unpushed_submodules
r_int
id|push_unpushed_submodules
c_func
(paren
r_int
r_char
id|new_sha1
(braket
l_int|20
)braket
comma
r_const
r_char
op_star
id|remotes_name
)paren
(brace
r_int
id|i
comma
id|ret
op_assign
l_int|1
suffix:semicolon
r_struct
id|string_list
id|needs_pushing
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|needs_pushing
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|string_list
)paren
)paren
suffix:semicolon
id|needs_pushing.strdup_strings
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|find_unpushed_submodules
c_func
(paren
id|new_sha1
comma
id|remotes_name
comma
op_amp
id|needs_pushing
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|needs_pushing.nr
suffix:semicolon
id|i
op_increment
)paren
(brace
r_const
r_char
op_star
id|path
op_assign
id|needs_pushing.items
(braket
id|i
)braket
dot
id|string
suffix:semicolon
id|fprintf
c_func
(paren
id|stderr
comma
l_string|&quot;Pushing submodule &squot;%s&squot;&bslash;n&quot;
comma
id|path
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|push_submodule
c_func
(paren
id|path
)paren
)paren
(brace
id|fprintf
c_func
(paren
id|stderr
comma
l_string|&quot;Unable to push submodule &squot;%s&squot;&bslash;n&quot;
comma
id|path
)paren
suffix:semicolon
id|ret
op_assign
l_int|0
suffix:semicolon
)brace
)brace
id|string_list_clear
c_func
(paren
op_amp
id|needs_pushing
comma
l_int|0
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|is_submodule_commit_present
r_static
r_int
id|is_submodule_commit_present
c_func
(paren
r_const
r_char
op_star
id|path
comma
r_int
r_char
id|sha1
(braket
l_int|20
)braket
)paren
(brace
r_int
id|is_present
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|add_submodule_odb
c_func
(paren
id|path
)paren
op_logical_and
id|lookup_commit_reference
c_func
(paren
id|sha1
)paren
)paren
(brace
multiline_comment|/* Even if the submodule is checked out and the commit is&n;&t;&t; * present, make sure it is reachable from a ref. */
r_struct
id|child_process
id|cp
suffix:semicolon
r_const
r_char
op_star
id|argv
(braket
)braket
op_assign
(brace
l_string|&quot;rev-list&quot;
comma
l_string|&quot;-n&quot;
comma
l_string|&quot;1&quot;
comma
l_int|NULL
comma
l_string|&quot;--not&quot;
comma
l_string|&quot;--all&quot;
comma
l_int|NULL
)brace
suffix:semicolon
r_struct
id|strbuf
id|buf
op_assign
id|STRBUF_INIT
suffix:semicolon
id|argv
(braket
l_int|3
)braket
op_assign
id|sha1_to_hex
c_func
(paren
id|sha1
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|cp
comma
l_int|0
comma
r_sizeof
(paren
id|cp
)paren
)paren
suffix:semicolon
id|cp.argv
op_assign
id|argv
suffix:semicolon
id|cp.env
op_assign
id|local_repo_env
suffix:semicolon
id|cp.git_cmd
op_assign
l_int|1
suffix:semicolon
id|cp.no_stdin
op_assign
l_int|1
suffix:semicolon
id|cp.out
op_assign
l_int|1
suffix:semicolon
id|cp.dir
op_assign
id|path
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|run_command
c_func
(paren
op_amp
id|cp
)paren
op_logical_and
op_logical_neg
id|strbuf_read
c_func
(paren
op_amp
id|buf
comma
id|cp.out
comma
l_int|1024
)paren
)paren
id|is_present
op_assign
l_int|1
suffix:semicolon
id|close
c_func
(paren
id|cp.out
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|buf
)paren
suffix:semicolon
)brace
r_return
id|is_present
suffix:semicolon
)brace
DECL|function|submodule_collect_changed_cb
r_static
r_void
id|submodule_collect_changed_cb
c_func
(paren
r_struct
id|diff_queue_struct
op_star
id|q
comma
r_struct
id|diff_options
op_star
id|options
comma
r_void
op_star
id|data
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|q-&gt;nr
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|diff_filepair
op_star
id|p
op_assign
id|q-&gt;queue
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|S_ISGITLINK
c_func
(paren
id|p-&gt;two-&gt;mode
)paren
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|S_ISGITLINK
c_func
(paren
id|p-&gt;one-&gt;mode
)paren
)paren
(brace
multiline_comment|/* NEEDSWORK: We should honor the name configured in&n;&t;&t;&t; * the .gitmodules file of the commit we are examining&n;&t;&t;&t; * here to be able to correctly follow submodules&n;&t;&t;&t; * being moved around. */
r_struct
id|string_list_item
op_star
id|path
suffix:semicolon
id|path
op_assign
id|unsorted_string_list_lookup
c_func
(paren
op_amp
id|changed_submodule_paths
comma
id|p-&gt;two-&gt;path
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|path
op_logical_and
op_logical_neg
id|is_submodule_commit_present
c_func
(paren
id|p-&gt;two-&gt;path
comma
id|p-&gt;two-&gt;sha1
)paren
)paren
id|string_list_append
c_func
(paren
op_amp
id|changed_submodule_paths
comma
id|xstrdup
c_func
(paren
id|p-&gt;two-&gt;path
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
multiline_comment|/* Submodule is new or was moved here */
multiline_comment|/* NEEDSWORK: When the .git directories of submodules&n;&t;&t;&t; * live inside the superprojects .git directory some&n;&t;&t;&t; * day we should fetch new submodules directly into&n;&t;&t;&t; * that location too when config or options request&n;&t;&t;&t; * that so they can be checked out from there. */
r_continue
suffix:semicolon
)brace
)brace
)brace
DECL|function|add_sha1_to_array
r_static
r_int
id|add_sha1_to_array
c_func
(paren
r_const
r_char
op_star
id|ref
comma
r_const
r_int
r_char
op_star
id|sha1
comma
r_int
id|flags
comma
r_void
op_star
id|data
)paren
(brace
id|sha1_array_append
c_func
(paren
id|data
comma
id|sha1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|check_for_new_submodule_commits
r_void
id|check_for_new_submodule_commits
c_func
(paren
r_int
r_char
id|new_sha1
(braket
l_int|20
)braket
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|initialized_fetch_ref_tips
)paren
(brace
id|for_each_ref
c_func
(paren
id|add_sha1_to_array
comma
op_amp
id|ref_tips_before_fetch
)paren
suffix:semicolon
id|initialized_fetch_ref_tips
op_assign
l_int|1
suffix:semicolon
)brace
id|sha1_array_append
c_func
(paren
op_amp
id|ref_tips_after_fetch
comma
id|new_sha1
)paren
suffix:semicolon
)brace
DECL|function|add_sha1_to_argv
r_static
r_void
id|add_sha1_to_argv
c_func
(paren
r_const
r_int
r_char
id|sha1
(braket
l_int|20
)braket
comma
r_void
op_star
id|data
)paren
(brace
id|argv_array_push
c_func
(paren
id|data
comma
id|sha1_to_hex
c_func
(paren
id|sha1
)paren
)paren
suffix:semicolon
)brace
DECL|function|calculate_changed_submodule_paths
r_static
r_void
id|calculate_changed_submodule_paths
c_func
(paren
r_void
)paren
(brace
r_struct
id|rev_info
id|rev
suffix:semicolon
r_struct
id|commit
op_star
id|commit
suffix:semicolon
r_struct
id|argv_array
id|argv
op_assign
id|ARGV_ARRAY_INIT
suffix:semicolon
multiline_comment|/* No need to check if there are no submodules configured */
r_if
c_cond
(paren
op_logical_neg
id|config_name_for_path.nr
)paren
r_return
suffix:semicolon
id|init_revisions
c_func
(paren
op_amp
id|rev
comma
l_int|NULL
)paren
suffix:semicolon
id|argv_array_push
c_func
(paren
op_amp
id|argv
comma
l_string|&quot;--&quot;
)paren
suffix:semicolon
multiline_comment|/* argv[0] program name */
id|sha1_array_for_each_unique
c_func
(paren
op_amp
id|ref_tips_after_fetch
comma
id|add_sha1_to_argv
comma
op_amp
id|argv
)paren
suffix:semicolon
id|argv_array_push
c_func
(paren
op_amp
id|argv
comma
l_string|&quot;--not&quot;
)paren
suffix:semicolon
id|sha1_array_for_each_unique
c_func
(paren
op_amp
id|ref_tips_before_fetch
comma
id|add_sha1_to_argv
comma
op_amp
id|argv
)paren
suffix:semicolon
id|setup_revisions
c_func
(paren
id|argv.argc
comma
id|argv.argv
comma
op_amp
id|rev
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|prepare_revision_walk
c_func
(paren
op_amp
id|rev
)paren
)paren
id|die
c_func
(paren
l_string|&quot;revision walk setup failed&quot;
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Collect all submodules (whether checked out or not) for which new&n;&t; * commits have been recorded upstream in &quot;changed_submodule_paths&quot;.&n;&t; */
r_while
c_loop
(paren
(paren
id|commit
op_assign
id|get_revision
c_func
(paren
op_amp
id|rev
)paren
)paren
)paren
(brace
r_struct
id|commit_list
op_star
id|parent
op_assign
id|commit-&gt;parents
suffix:semicolon
r_while
c_loop
(paren
id|parent
)paren
(brace
r_struct
id|diff_options
id|diff_opts
suffix:semicolon
id|diff_setup
c_func
(paren
op_amp
id|diff_opts
)paren
suffix:semicolon
id|DIFF_OPT_SET
c_func
(paren
op_amp
id|diff_opts
comma
id|RECURSIVE
)paren
suffix:semicolon
id|diff_opts.output_format
op_or_assign
id|DIFF_FORMAT_CALLBACK
suffix:semicolon
id|diff_opts.format_callback
op_assign
id|submodule_collect_changed_cb
suffix:semicolon
id|diff_setup_done
c_func
(paren
op_amp
id|diff_opts
)paren
suffix:semicolon
id|diff_tree_sha1
c_func
(paren
id|parent-&gt;item-&gt;object.sha1
comma
id|commit-&gt;object.sha1
comma
l_string|&quot;&quot;
comma
op_amp
id|diff_opts
)paren
suffix:semicolon
id|diffcore_std
c_func
(paren
op_amp
id|diff_opts
)paren
suffix:semicolon
id|diff_flush
c_func
(paren
op_amp
id|diff_opts
)paren
suffix:semicolon
id|parent
op_assign
id|parent-&gt;next
suffix:semicolon
)brace
)brace
id|argv_array_clear
c_func
(paren
op_amp
id|argv
)paren
suffix:semicolon
id|sha1_array_clear
c_func
(paren
op_amp
id|ref_tips_before_fetch
)paren
suffix:semicolon
id|sha1_array_clear
c_func
(paren
op_amp
id|ref_tips_after_fetch
)paren
suffix:semicolon
id|initialized_fetch_ref_tips
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|fetch_populated_submodules
r_int
id|fetch_populated_submodules
c_func
(paren
r_const
r_struct
id|argv_array
op_star
id|options
comma
r_const
r_char
op_star
id|prefix
comma
r_int
id|command_line_option
comma
r_int
id|quiet
)paren
(brace
r_int
id|i
comma
id|result
op_assign
l_int|0
suffix:semicolon
r_struct
id|child_process
id|cp
suffix:semicolon
r_struct
id|argv_array
id|argv
op_assign
id|ARGV_ARRAY_INIT
suffix:semicolon
r_struct
id|string_list_item
op_star
id|name_for_path
suffix:semicolon
r_const
r_char
op_star
id|work_tree
op_assign
id|get_git_work_tree
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|work_tree
)paren
r_goto
id|out
suffix:semicolon
r_if
c_cond
(paren
id|read_cache
c_func
(paren
)paren
OL
l_int|0
)paren
id|die
c_func
(paren
l_string|&quot;index file corrupt&quot;
)paren
suffix:semicolon
id|argv_array_push
c_func
(paren
op_amp
id|argv
comma
l_string|&quot;fetch&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|options-&gt;argc
suffix:semicolon
id|i
op_increment
)paren
id|argv_array_push
c_func
(paren
op_amp
id|argv
comma
id|options-&gt;argv
(braket
id|i
)braket
)paren
suffix:semicolon
id|argv_array_push
c_func
(paren
op_amp
id|argv
comma
l_string|&quot;--recurse-submodules-default&quot;
)paren
suffix:semicolon
multiline_comment|/* default value, &quot;--submodule-prefix&quot; and its value are added later */
id|memset
c_func
(paren
op_amp
id|cp
comma
l_int|0
comma
r_sizeof
(paren
id|cp
)paren
)paren
suffix:semicolon
id|cp.env
op_assign
id|local_repo_env
suffix:semicolon
id|cp.git_cmd
op_assign
l_int|1
suffix:semicolon
id|cp.no_stdin
op_assign
l_int|1
suffix:semicolon
id|calculate_changed_submodule_paths
c_func
(paren
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|active_nr
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|strbuf
id|submodule_path
op_assign
id|STRBUF_INIT
suffix:semicolon
r_struct
id|strbuf
id|submodule_git_dir
op_assign
id|STRBUF_INIT
suffix:semicolon
r_struct
id|strbuf
id|submodule_prefix
op_assign
id|STRBUF_INIT
suffix:semicolon
r_const
r_struct
id|cache_entry
op_star
id|ce
op_assign
id|active_cache
(braket
id|i
)braket
suffix:semicolon
r_const
r_char
op_star
id|git_dir
comma
op_star
id|name
comma
op_star
id|default_argv
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|S_ISGITLINK
c_func
(paren
id|ce-&gt;ce_mode
)paren
)paren
r_continue
suffix:semicolon
id|name
op_assign
id|ce-&gt;name
suffix:semicolon
id|name_for_path
op_assign
id|unsorted_string_list_lookup
c_func
(paren
op_amp
id|config_name_for_path
comma
id|ce-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|name_for_path
)paren
id|name
op_assign
id|name_for_path-&gt;util
suffix:semicolon
id|default_argv
op_assign
l_string|&quot;yes&quot;
suffix:semicolon
r_if
c_cond
(paren
id|command_line_option
op_eq
id|RECURSE_SUBMODULES_DEFAULT
)paren
(brace
r_struct
id|string_list_item
op_star
id|fetch_recurse_submodules_option
suffix:semicolon
id|fetch_recurse_submodules_option
op_assign
id|unsorted_string_list_lookup
c_func
(paren
op_amp
id|config_fetch_recurse_submodules_for_name
comma
id|name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fetch_recurse_submodules_option
)paren
(brace
r_if
c_cond
(paren
(paren
r_intptr
)paren
id|fetch_recurse_submodules_option-&gt;util
op_eq
id|RECURSE_SUBMODULES_OFF
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
(paren
r_intptr
)paren
id|fetch_recurse_submodules_option-&gt;util
op_eq
id|RECURSE_SUBMODULES_ON_DEMAND
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|unsorted_string_list_lookup
c_func
(paren
op_amp
id|changed_submodule_paths
comma
id|ce-&gt;name
)paren
)paren
r_continue
suffix:semicolon
id|default_argv
op_assign
l_string|&quot;on-demand&quot;
suffix:semicolon
)brace
)brace
r_else
(brace
r_if
c_cond
(paren
(paren
id|config_fetch_recurse_submodules
op_eq
id|RECURSE_SUBMODULES_OFF
)paren
op_logical_or
id|gitmodules_is_unmerged
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|config_fetch_recurse_submodules
op_eq
id|RECURSE_SUBMODULES_ON_DEMAND
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|unsorted_string_list_lookup
c_func
(paren
op_amp
id|changed_submodule_paths
comma
id|ce-&gt;name
)paren
)paren
r_continue
suffix:semicolon
id|default_argv
op_assign
l_string|&quot;on-demand&quot;
suffix:semicolon
)brace
)brace
)brace
r_else
r_if
c_cond
(paren
id|command_line_option
op_eq
id|RECURSE_SUBMODULES_ON_DEMAND
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|unsorted_string_list_lookup
c_func
(paren
op_amp
id|changed_submodule_paths
comma
id|ce-&gt;name
)paren
)paren
r_continue
suffix:semicolon
id|default_argv
op_assign
l_string|&quot;on-demand&quot;
suffix:semicolon
)brace
id|strbuf_addf
c_func
(paren
op_amp
id|submodule_path
comma
l_string|&quot;%s/%s&quot;
comma
id|work_tree
comma
id|ce-&gt;name
)paren
suffix:semicolon
id|strbuf_addf
c_func
(paren
op_amp
id|submodule_git_dir
comma
l_string|&quot;%s/.git&quot;
comma
id|submodule_path.buf
)paren
suffix:semicolon
id|strbuf_addf
c_func
(paren
op_amp
id|submodule_prefix
comma
l_string|&quot;%s%s/&quot;
comma
id|prefix
comma
id|ce-&gt;name
)paren
suffix:semicolon
id|git_dir
op_assign
id|read_gitfile
c_func
(paren
id|submodule_git_dir.buf
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|git_dir
)paren
id|git_dir
op_assign
id|submodule_git_dir.buf
suffix:semicolon
r_if
c_cond
(paren
id|is_directory
c_func
(paren
id|git_dir
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|quiet
)paren
id|printf
c_func
(paren
l_string|&quot;Fetching submodule %s%s&bslash;n&quot;
comma
id|prefix
comma
id|ce-&gt;name
)paren
suffix:semicolon
id|cp.dir
op_assign
id|submodule_path.buf
suffix:semicolon
id|argv_array_push
c_func
(paren
op_amp
id|argv
comma
id|default_argv
)paren
suffix:semicolon
id|argv_array_push
c_func
(paren
op_amp
id|argv
comma
l_string|&quot;--submodule-prefix&quot;
)paren
suffix:semicolon
id|argv_array_push
c_func
(paren
op_amp
id|argv
comma
id|submodule_prefix.buf
)paren
suffix:semicolon
id|cp.argv
op_assign
id|argv.argv
suffix:semicolon
r_if
c_cond
(paren
id|run_command
c_func
(paren
op_amp
id|cp
)paren
)paren
id|result
op_assign
l_int|1
suffix:semicolon
id|argv_array_pop
c_func
(paren
op_amp
id|argv
)paren
suffix:semicolon
id|argv_array_pop
c_func
(paren
op_amp
id|argv
)paren
suffix:semicolon
id|argv_array_pop
c_func
(paren
op_amp
id|argv
)paren
suffix:semicolon
)brace
id|strbuf_release
c_func
(paren
op_amp
id|submodule_path
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|submodule_git_dir
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|submodule_prefix
)paren
suffix:semicolon
)brace
id|argv_array_clear
c_func
(paren
op_amp
id|argv
)paren
suffix:semicolon
id|out
suffix:colon
id|string_list_clear
c_func
(paren
op_amp
id|changed_submodule_paths
comma
l_int|1
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
DECL|function|is_submodule_modified
r_int
id|is_submodule_modified
c_func
(paren
r_const
r_char
op_star
id|path
comma
r_int
id|ignore_untracked
)paren
(brace
id|ssize_t
id|len
suffix:semicolon
r_struct
id|child_process
id|cp
suffix:semicolon
r_const
r_char
op_star
id|argv
(braket
)braket
op_assign
(brace
l_string|&quot;status&quot;
comma
l_string|&quot;--porcelain&quot;
comma
l_int|NULL
comma
l_int|NULL
comma
)brace
suffix:semicolon
r_struct
id|strbuf
id|buf
op_assign
id|STRBUF_INIT
suffix:semicolon
r_int
id|dirty_submodule
op_assign
l_int|0
suffix:semicolon
r_const
r_char
op_star
id|line
comma
op_star
id|next_line
suffix:semicolon
r_const
r_char
op_star
id|git_dir
suffix:semicolon
id|strbuf_addf
c_func
(paren
op_amp
id|buf
comma
l_string|&quot;%s/.git&quot;
comma
id|path
)paren
suffix:semicolon
id|git_dir
op_assign
id|read_gitfile
c_func
(paren
id|buf.buf
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|git_dir
)paren
id|git_dir
op_assign
id|buf.buf
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|is_directory
c_func
(paren
id|git_dir
)paren
)paren
(brace
id|strbuf_release
c_func
(paren
op_amp
id|buf
)paren
suffix:semicolon
multiline_comment|/* The submodule is not checked out, so it is not modified */
r_return
l_int|0
suffix:semicolon
)brace
id|strbuf_reset
c_func
(paren
op_amp
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ignore_untracked
)paren
id|argv
(braket
l_int|2
)braket
op_assign
l_string|&quot;-uno&quot;
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|cp
comma
l_int|0
comma
r_sizeof
(paren
id|cp
)paren
)paren
suffix:semicolon
id|cp.argv
op_assign
id|argv
suffix:semicolon
id|cp.env
op_assign
id|local_repo_env
suffix:semicolon
id|cp.git_cmd
op_assign
l_int|1
suffix:semicolon
id|cp.no_stdin
op_assign
l_int|1
suffix:semicolon
id|cp.out
op_assign
l_int|1
suffix:semicolon
id|cp.dir
op_assign
id|path
suffix:semicolon
r_if
c_cond
(paren
id|start_command
c_func
(paren
op_amp
id|cp
)paren
)paren
id|die
c_func
(paren
l_string|&quot;Could not run &squot;git status --porcelain&squot; in submodule %s&quot;
comma
id|path
)paren
suffix:semicolon
id|len
op_assign
id|strbuf_read
c_func
(paren
op_amp
id|buf
comma
id|cp.out
comma
l_int|1024
)paren
suffix:semicolon
id|line
op_assign
id|buf.buf
suffix:semicolon
r_while
c_loop
(paren
id|len
OG
l_int|2
)paren
(brace
r_if
c_cond
(paren
(paren
id|line
(braket
l_int|0
)braket
op_eq
l_char|&squot;?&squot;
)paren
op_logical_and
(paren
id|line
(braket
l_int|1
)braket
op_eq
l_char|&squot;?&squot;
)paren
)paren
(brace
id|dirty_submodule
op_or_assign
id|DIRTY_SUBMODULE_UNTRACKED
suffix:semicolon
r_if
c_cond
(paren
id|dirty_submodule
op_amp
id|DIRTY_SUBMODULE_MODIFIED
)paren
r_break
suffix:semicolon
)brace
r_else
(brace
id|dirty_submodule
op_or_assign
id|DIRTY_SUBMODULE_MODIFIED
suffix:semicolon
r_if
c_cond
(paren
id|ignore_untracked
op_logical_or
(paren
id|dirty_submodule
op_amp
id|DIRTY_SUBMODULE_UNTRACKED
)paren
)paren
r_break
suffix:semicolon
)brace
id|next_line
op_assign
id|strchr
c_func
(paren
id|line
comma
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|next_line
)paren
r_break
suffix:semicolon
id|next_line
op_increment
suffix:semicolon
id|len
op_sub_assign
(paren
id|next_line
id|line
)paren
suffix:semicolon
id|line
op_assign
id|next_line
suffix:semicolon
)brace
id|close
c_func
(paren
id|cp.out
)paren
suffix:semicolon
r_if
c_cond
(paren
id|finish_command
c_func
(paren
op_amp
id|cp
)paren
)paren
id|die
c_func
(paren
l_string|&quot;&squot;git status --porcelain&squot; failed in submodule %s&quot;
comma
id|path
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|buf
)paren
suffix:semicolon
r_return
id|dirty_submodule
suffix:semicolon
)brace
DECL|function|submodule_uses_gitfile
r_int
id|submodule_uses_gitfile
c_func
(paren
r_const
r_char
op_star
id|path
)paren
(brace
r_struct
id|child_process
id|cp
suffix:semicolon
r_const
r_char
op_star
id|argv
(braket
)braket
op_assign
(brace
l_string|&quot;submodule&quot;
comma
l_string|&quot;foreach&quot;
comma
l_string|&quot;--quiet&quot;
comma
l_string|&quot;--recursive&quot;
comma
l_string|&quot;test -f .git&quot;
comma
l_int|NULL
comma
)brace
suffix:semicolon
r_struct
id|strbuf
id|buf
op_assign
id|STRBUF_INIT
suffix:semicolon
r_const
r_char
op_star
id|git_dir
suffix:semicolon
id|strbuf_addf
c_func
(paren
op_amp
id|buf
comma
l_string|&quot;%s/.git&quot;
comma
id|path
)paren
suffix:semicolon
id|git_dir
op_assign
id|read_gitfile
c_func
(paren
id|buf.buf
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|git_dir
)paren
(brace
id|strbuf_release
c_func
(paren
op_amp
id|buf
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|strbuf_release
c_func
(paren
op_amp
id|buf
)paren
suffix:semicolon
multiline_comment|/* Now test that all nested submodules use a gitfile too */
id|memset
c_func
(paren
op_amp
id|cp
comma
l_int|0
comma
r_sizeof
(paren
id|cp
)paren
)paren
suffix:semicolon
id|cp.argv
op_assign
id|argv
suffix:semicolon
id|cp.env
op_assign
id|local_repo_env
suffix:semicolon
id|cp.git_cmd
op_assign
l_int|1
suffix:semicolon
id|cp.no_stdin
op_assign
l_int|1
suffix:semicolon
id|cp.no_stderr
op_assign
l_int|1
suffix:semicolon
id|cp.no_stdout
op_assign
l_int|1
suffix:semicolon
id|cp.dir
op_assign
id|path
suffix:semicolon
r_if
c_cond
(paren
id|run_command
c_func
(paren
op_amp
id|cp
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|ok_to_remove_submodule
r_int
id|ok_to_remove_submodule
c_func
(paren
r_const
r_char
op_star
id|path
)paren
(brace
r_struct
id|stat
id|st
suffix:semicolon
id|ssize_t
id|len
suffix:semicolon
r_struct
id|child_process
id|cp
suffix:semicolon
r_const
r_char
op_star
id|argv
(braket
)braket
op_assign
(brace
l_string|&quot;status&quot;
comma
l_string|&quot;--porcelain&quot;
comma
l_string|&quot;-u&quot;
comma
l_string|&quot;--ignore-submodules=none&quot;
comma
l_int|NULL
comma
)brace
suffix:semicolon
r_struct
id|strbuf
id|buf
op_assign
id|STRBUF_INIT
suffix:semicolon
r_int
id|ok_to_remove
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
(paren
id|lstat
c_func
(paren
id|path
comma
op_amp
id|st
)paren
OL
l_int|0
)paren
op_logical_or
id|is_empty_dir
c_func
(paren
id|path
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|submodule_uses_gitfile
c_func
(paren
id|path
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|cp
comma
l_int|0
comma
r_sizeof
(paren
id|cp
)paren
)paren
suffix:semicolon
id|cp.argv
op_assign
id|argv
suffix:semicolon
id|cp.env
op_assign
id|local_repo_env
suffix:semicolon
id|cp.git_cmd
op_assign
l_int|1
suffix:semicolon
id|cp.no_stdin
op_assign
l_int|1
suffix:semicolon
id|cp.out
op_assign
l_int|1
suffix:semicolon
id|cp.dir
op_assign
id|path
suffix:semicolon
r_if
c_cond
(paren
id|start_command
c_func
(paren
op_amp
id|cp
)paren
)paren
id|die
c_func
(paren
l_string|&quot;Could not run &squot;git status --porcelain -uall --ignore-submodules=none&squot; in submodule %s&quot;
comma
id|path
)paren
suffix:semicolon
id|len
op_assign
id|strbuf_read
c_func
(paren
op_amp
id|buf
comma
id|cp.out
comma
l_int|1024
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
OG
l_int|2
)paren
id|ok_to_remove
op_assign
l_int|0
suffix:semicolon
id|close
c_func
(paren
id|cp.out
)paren
suffix:semicolon
r_if
c_cond
(paren
id|finish_command
c_func
(paren
op_amp
id|cp
)paren
)paren
id|die
c_func
(paren
l_string|&quot;&squot;git status --porcelain -uall --ignore-submodules=none&squot; failed in submodule %s&quot;
comma
id|path
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|buf
)paren
suffix:semicolon
r_return
id|ok_to_remove
suffix:semicolon
)brace
DECL|function|find_first_merges
r_static
r_int
id|find_first_merges
c_func
(paren
r_struct
id|object_array
op_star
id|result
comma
r_const
r_char
op_star
id|path
comma
r_struct
id|commit
op_star
id|a
comma
r_struct
id|commit
op_star
id|b
)paren
(brace
r_int
id|i
comma
id|j
suffix:semicolon
r_struct
id|object_array
id|merges
op_assign
id|OBJECT_ARRAY_INIT
suffix:semicolon
r_struct
id|commit
op_star
id|commit
suffix:semicolon
r_int
id|contains_another
suffix:semicolon
r_char
id|merged_revision
(braket
l_int|42
)braket
suffix:semicolon
r_const
r_char
op_star
id|rev_args
(braket
)braket
op_assign
(brace
l_string|&quot;rev-list&quot;
comma
l_string|&quot;--merges&quot;
comma
l_string|&quot;--ancestry-path&quot;
comma
l_string|&quot;--all&quot;
comma
id|merged_revision
comma
l_int|NULL
)brace
suffix:semicolon
r_struct
id|rev_info
id|revs
suffix:semicolon
r_struct
id|setup_revision_opt
id|rev_opts
suffix:semicolon
id|memset
c_func
(paren
id|result
comma
l_int|0
comma
r_sizeof
(paren
r_struct
id|object_array
)paren
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|rev_opts
comma
l_int|0
comma
r_sizeof
(paren
id|rev_opts
)paren
)paren
suffix:semicolon
multiline_comment|/* get all revisions that merge commit a */
id|snprintf
c_func
(paren
id|merged_revision
comma
r_sizeof
(paren
id|merged_revision
)paren
comma
l_string|&quot;^%s&quot;
comma
id|sha1_to_hex
c_func
(paren
id|a-&gt;object.sha1
)paren
)paren
suffix:semicolon
id|init_revisions
c_func
(paren
op_amp
id|revs
comma
l_int|NULL
)paren
suffix:semicolon
id|rev_opts.submodule
op_assign
id|path
suffix:semicolon
id|setup_revisions
c_func
(paren
r_sizeof
(paren
id|rev_args
)paren
op_div
r_sizeof
(paren
r_char
op_star
)paren
op_minus
l_int|1
comma
id|rev_args
comma
op_amp
id|revs
comma
op_amp
id|rev_opts
)paren
suffix:semicolon
multiline_comment|/* save all revisions from the above list that contain b */
r_if
c_cond
(paren
id|prepare_revision_walk
c_func
(paren
op_amp
id|revs
)paren
)paren
id|die
c_func
(paren
l_string|&quot;revision walk setup failed&quot;
)paren
suffix:semicolon
r_while
c_loop
(paren
(paren
id|commit
op_assign
id|get_revision
c_func
(paren
op_amp
id|revs
)paren
)paren
op_ne
l_int|NULL
)paren
(brace
r_struct
id|object
op_star
id|o
op_assign
op_amp
(paren
id|commit-&gt;object
)paren
suffix:semicolon
r_if
c_cond
(paren
id|in_merge_bases
c_func
(paren
id|b
comma
id|commit
)paren
)paren
id|add_object_array
c_func
(paren
id|o
comma
l_int|NULL
comma
op_amp
id|merges
)paren
suffix:semicolon
)brace
id|reset_revision_walk
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* Now we&squot;ve got all merges that contain a and b. Prune all&n;&t; * merges that contain another found merge and save them in&n;&t; * result.&n;&t; */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|merges.nr
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|commit
op_star
id|m1
op_assign
(paren
r_struct
id|commit
op_star
)paren
id|merges.objects
(braket
id|i
)braket
dot
id|item
suffix:semicolon
id|contains_another
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
id|merges.nr
suffix:semicolon
id|j
op_increment
)paren
(brace
r_struct
id|commit
op_star
id|m2
op_assign
(paren
r_struct
id|commit
op_star
)paren
id|merges.objects
(braket
id|j
)braket
dot
id|item
suffix:semicolon
r_if
c_cond
(paren
id|i
op_ne
id|j
op_logical_and
id|in_merge_bases
c_func
(paren
id|m2
comma
id|m1
)paren
)paren
(brace
id|contains_another
op_assign
l_int|1
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|contains_another
)paren
id|add_object_array
c_func
(paren
id|merges.objects
(braket
id|i
)braket
dot
id|item
comma
l_int|NULL
comma
id|result
)paren
suffix:semicolon
)brace
id|free
c_func
(paren
id|merges.objects
)paren
suffix:semicolon
r_return
id|result-&gt;nr
suffix:semicolon
)brace
DECL|function|print_commit
r_static
r_void
id|print_commit
c_func
(paren
r_struct
id|commit
op_star
id|commit
)paren
(brace
r_struct
id|strbuf
id|sb
op_assign
id|STRBUF_INIT
suffix:semicolon
r_struct
id|pretty_print_context
id|ctx
op_assign
(brace
l_int|0
)brace
suffix:semicolon
id|ctx.date_mode
op_assign
id|DATE_NORMAL
suffix:semicolon
id|format_commit_message
c_func
(paren
id|commit
comma
l_string|&quot; %h: %m %s&quot;
comma
op_amp
id|sb
comma
op_amp
id|ctx
)paren
suffix:semicolon
id|fprintf
c_func
(paren
id|stderr
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|sb.buf
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|sb
)paren
suffix:semicolon
)brace
DECL|macro|MERGE_WARNING
mdefine_line|#define MERGE_WARNING(path, msg) &bslash;&n;&t;warning(&quot;Failed to merge submodule %s (%s)&quot;, path, msg);
DECL|function|merge_submodule
r_int
id|merge_submodule
c_func
(paren
r_int
r_char
id|result
(braket
l_int|20
)braket
comma
r_const
r_char
op_star
id|path
comma
r_const
r_int
r_char
id|base
(braket
l_int|20
)braket
comma
r_const
r_int
r_char
id|a
(braket
l_int|20
)braket
comma
r_const
r_int
r_char
id|b
(braket
l_int|20
)braket
comma
r_int
id|search
)paren
(brace
r_struct
id|commit
op_star
id|commit_base
comma
op_star
id|commit_a
comma
op_star
id|commit_b
suffix:semicolon
r_int
id|parent_count
suffix:semicolon
r_struct
id|object_array
id|merges
suffix:semicolon
r_int
id|i
suffix:semicolon
multiline_comment|/* store a in result in case we fail */
id|hashcpy
c_func
(paren
id|result
comma
id|a
)paren
suffix:semicolon
multiline_comment|/* we can not handle deletion conflicts */
r_if
c_cond
(paren
id|is_null_sha1
c_func
(paren
id|base
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|is_null_sha1
c_func
(paren
id|a
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|is_null_sha1
c_func
(paren
id|b
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|add_submodule_odb
c_func
(paren
id|path
)paren
)paren
(brace
id|MERGE_WARNING
c_func
(paren
id|path
comma
l_string|&quot;not checked out&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
(paren
id|commit_base
op_assign
id|lookup_commit_reference
c_func
(paren
id|base
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|commit_a
op_assign
id|lookup_commit_reference
c_func
(paren
id|a
)paren
)paren
op_logical_or
op_logical_neg
(paren
id|commit_b
op_assign
id|lookup_commit_reference
c_func
(paren
id|b
)paren
)paren
)paren
(brace
id|MERGE_WARNING
c_func
(paren
id|path
comma
l_string|&quot;commits not present&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* check whether both changes are forward */
r_if
c_cond
(paren
op_logical_neg
id|in_merge_bases
c_func
(paren
id|commit_base
comma
id|commit_a
)paren
op_logical_or
op_logical_neg
id|in_merge_bases
c_func
(paren
id|commit_base
comma
id|commit_b
)paren
)paren
(brace
id|MERGE_WARNING
c_func
(paren
id|path
comma
l_string|&quot;commits don&squot;t follow merge-base&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Case #1: a is contained in b or vice versa */
r_if
c_cond
(paren
id|in_merge_bases
c_func
(paren
id|commit_a
comma
id|commit_b
)paren
)paren
(brace
id|hashcpy
c_func
(paren
id|result
comma
id|b
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|in_merge_bases
c_func
(paren
id|commit_b
comma
id|commit_a
)paren
)paren
(brace
id|hashcpy
c_func
(paren
id|result
comma
id|a
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Case #2: There are one or more merges that contain a and b in&n;&t; * the submodule. If there is only one, then present it as a&n;&t; * suggestion to the user, but leave it marked unmerged so the&n;&t; * user needs to confirm the resolution.&n;&t; */
multiline_comment|/* Skip the search if makes no sense to the calling context.  */
r_if
c_cond
(paren
op_logical_neg
id|search
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* find commit which merges them */
id|parent_count
op_assign
id|find_first_merges
c_func
(paren
op_amp
id|merges
comma
id|path
comma
id|commit_a
comma
id|commit_b
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|parent_count
)paren
(brace
r_case
l_int|0
suffix:colon
id|MERGE_WARNING
c_func
(paren
id|path
comma
l_string|&quot;merge following commits not found&quot;
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
l_int|1
suffix:colon
id|MERGE_WARNING
c_func
(paren
id|path
comma
l_string|&quot;not fast-forward&quot;
)paren
suffix:semicolon
id|fprintf
c_func
(paren
id|stderr
comma
l_string|&quot;Found a possible merge resolution &quot;
l_string|&quot;for the submodule:&bslash;n&quot;
)paren
suffix:semicolon
id|print_commit
c_func
(paren
(paren
r_struct
id|commit
op_star
)paren
id|merges.objects
(braket
l_int|0
)braket
dot
id|item
)paren
suffix:semicolon
id|fprintf
c_func
(paren
id|stderr
comma
l_string|&quot;If this is correct simply add it to the index &quot;
l_string|&quot;for example&bslash;n&quot;
l_string|&quot;by using:&bslash;n&bslash;n&quot;
l_string|&quot;  git update-index --cacheinfo 160000 %s &bslash;&quot;%s&bslash;&quot;&bslash;n&bslash;n&quot;
l_string|&quot;which will accept this suggestion.&bslash;n&quot;
comma
id|sha1_to_hex
c_func
(paren
id|merges.objects
(braket
l_int|0
)braket
dot
id|item-&gt;sha1
)paren
comma
id|path
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|MERGE_WARNING
c_func
(paren
id|path
comma
l_string|&quot;multiple merges found&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|merges.nr
suffix:semicolon
id|i
op_increment
)paren
id|print_commit
c_func
(paren
(paren
r_struct
id|commit
op_star
)paren
id|merges.objects
(braket
id|i
)braket
dot
id|item
)paren
suffix:semicolon
)brace
id|free
c_func
(paren
id|merges.objects
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Update gitfile and core.worktree setting to connect work tree and git dir */
DECL|function|connect_work_tree_and_git_dir
r_void
id|connect_work_tree_and_git_dir
c_func
(paren
r_const
r_char
op_star
id|work_tree
comma
r_const
r_char
op_star
id|git_dir
)paren
(brace
r_struct
id|strbuf
id|file_name
op_assign
id|STRBUF_INIT
suffix:semicolon
r_struct
id|strbuf
id|rel_path
op_assign
id|STRBUF_INIT
suffix:semicolon
r_const
r_char
op_star
id|real_work_tree
op_assign
id|xstrdup
c_func
(paren
id|real_path
c_func
(paren
id|work_tree
)paren
)paren
suffix:semicolon
id|FILE
op_star
id|fp
suffix:semicolon
multiline_comment|/* Update gitfile */
id|strbuf_addf
c_func
(paren
op_amp
id|file_name
comma
l_string|&quot;%s/.git&quot;
comma
id|work_tree
)paren
suffix:semicolon
id|fp
op_assign
id|fopen
c_func
(paren
id|file_name.buf
comma
l_string|&quot;w&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fp
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Could not create git link %s&quot;
)paren
comma
id|file_name.buf
)paren
suffix:semicolon
id|fprintf
c_func
(paren
id|fp
comma
l_string|&quot;gitdir: %s&bslash;n&quot;
comma
id|relative_path
c_func
(paren
id|git_dir
comma
id|real_work_tree
comma
op_amp
id|rel_path
)paren
)paren
suffix:semicolon
id|fclose
c_func
(paren
id|fp
)paren
suffix:semicolon
multiline_comment|/* Update core.worktree setting */
id|strbuf_reset
c_func
(paren
op_amp
id|file_name
)paren
suffix:semicolon
id|strbuf_addf
c_func
(paren
op_amp
id|file_name
comma
l_string|&quot;%s/config&quot;
comma
id|git_dir
)paren
suffix:semicolon
r_if
c_cond
(paren
id|git_config_set_in_file
c_func
(paren
id|file_name.buf
comma
l_string|&quot;core.worktree&quot;
comma
id|relative_path
c_func
(paren
id|real_work_tree
comma
id|git_dir
comma
op_amp
id|rel_path
)paren
)paren
)paren
id|die
c_func
(paren
id|_
c_func
(paren
l_string|&quot;Could not set core.worktree in %s&quot;
)paren
comma
id|file_name.buf
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|file_name
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|rel_path
)paren
suffix:semicolon
id|free
c_func
(paren
(paren
r_void
op_star
)paren
id|real_work_tree
)paren
suffix:semicolon
)brace
eof
