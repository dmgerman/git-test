macro_line|#include &quot;cache.h&quot;
macro_line|#include &quot;diff.h&quot;
macro_line|#include &quot;diffcore.h&quot;
DECL|struct|linehash
r_struct
id|linehash
(brace
DECL|member|bytes
r_int
r_int
id|bytes
suffix:semicolon
DECL|member|hash
r_int
r_int
id|hash
suffix:semicolon
)brace
suffix:semicolon
DECL|function|hash_extended_line
r_static
r_int
r_int
id|hash_extended_line
c_func
(paren
r_const
r_int
r_char
op_star
op_star
id|buf_p
comma
r_int
r_int
id|left
)paren
(brace
multiline_comment|/* An extended line is zero or more whitespace letters (including LF)&n;&t; * followed by one non whitespace letter followed by zero or more&n;&t; * non LF, and terminated with by a LF (or EOF).&n;&t; */
r_const
r_int
r_char
op_star
id|bol
op_assign
op_star
id|buf_p
suffix:semicolon
r_const
r_int
r_char
op_star
id|buf
op_assign
id|bol
suffix:semicolon
r_int
r_int
id|hashval
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|left
)paren
(brace
r_int
id|c
op_assign
op_star
id|buf
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|c
)paren
r_goto
id|binary
suffix:semicolon
id|left
op_decrement
suffix:semicolon
r_if
c_cond
(paren
l_char|&squot; &squot;
OL
id|c
)paren
(brace
id|hashval
op_assign
id|c
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
r_while
c_loop
(paren
id|left
)paren
(brace
r_int
id|c
op_assign
op_star
id|buf
op_increment
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|c
)paren
r_goto
id|binary
suffix:semicolon
id|left
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|c
op_eq
l_char|&squot;&bslash;n&squot;
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
l_char|&squot; &squot;
OL
id|c
)paren
id|hashval
op_assign
id|hashval
op_star
l_int|11
op_plus
id|c
suffix:semicolon
)brace
op_star
id|buf_p
op_assign
id|buf
suffix:semicolon
r_return
id|hashval
suffix:semicolon
id|binary
suffix:colon
op_star
id|buf_p
op_assign
l_int|NULL
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|linehash_compare
r_static
r_int
id|linehash_compare
c_func
(paren
r_const
r_void
op_star
id|a_
comma
r_const
r_void
op_star
id|b_
)paren
(brace
r_struct
id|linehash
op_star
id|a
op_assign
(paren
r_struct
id|linehash
op_star
)paren
id|a_
suffix:semicolon
r_struct
id|linehash
op_star
id|b
op_assign
(paren
r_struct
id|linehash
op_star
)paren
id|b_
suffix:semicolon
r_if
c_cond
(paren
id|a-&gt;hash
OL
id|b-&gt;hash
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|a-&gt;hash
OG
id|b-&gt;hash
)paren
r_return
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|hash_lines
r_static
r_struct
id|linehash
op_star
id|hash_lines
c_func
(paren
r_const
r_int
r_char
op_star
id|buf
comma
r_int
r_int
id|size
)paren
(brace
r_const
r_int
r_char
op_star
id|eobuf
op_assign
id|buf
op_plus
id|size
suffix:semicolon
r_struct
id|linehash
op_star
id|line
op_assign
l_int|NULL
suffix:semicolon
r_int
id|alloc
op_assign
l_int|0
comma
id|used
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|buf
OL
id|eobuf
)paren
(brace
r_const
r_int
r_char
op_star
id|ptr
op_assign
id|buf
suffix:semicolon
r_int
r_int
id|hash
op_assign
id|hash_extended_line
c_func
(paren
op_amp
id|buf
comma
id|eobuf
op_minus
id|ptr
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buf
)paren
(brace
id|free
c_func
(paren
id|line
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
r_if
c_cond
(paren
id|alloc
op_le
id|used
)paren
(brace
id|alloc
op_assign
id|alloc_nr
c_func
(paren
id|alloc
)paren
suffix:semicolon
id|line
op_assign
id|xrealloc
c_func
(paren
id|line
comma
r_sizeof
(paren
op_star
id|line
)paren
op_star
id|alloc
)paren
suffix:semicolon
)brace
id|line
(braket
id|used
)braket
dot
id|bytes
op_assign
id|buf
id|ptr
suffix:semicolon
id|line
(braket
id|used
)braket
dot
id|hash
op_assign
id|hash
suffix:semicolon
id|used
op_increment
suffix:semicolon
)brace
id|qsort
c_func
(paren
id|line
comma
id|used
comma
r_sizeof
(paren
op_star
id|line
)paren
comma
id|linehash_compare
)paren
suffix:semicolon
multiline_comment|/* Terminate the list */
r_if
c_cond
(paren
id|alloc
op_le
id|used
)paren
id|line
op_assign
id|xrealloc
c_func
(paren
id|line
comma
r_sizeof
(paren
op_star
id|line
)paren
op_star
(paren
id|used
op_plus
l_int|1
)paren
)paren
suffix:semicolon
id|line
(braket
id|used
)braket
dot
id|bytes
op_assign
id|line
(braket
id|used
)braket
dot
id|hash
op_assign
l_int|0
suffix:semicolon
r_return
id|line
suffix:semicolon
)brace
DECL|function|diffcore_count_changes
r_int
id|diffcore_count_changes
c_func
(paren
r_void
op_star
id|src
comma
r_int
r_int
id|src_size
comma
r_void
op_star
id|dst
comma
r_int
r_int
id|dst_size
comma
r_int
r_int
id|delta_limit
comma
r_int
r_int
op_star
id|src_copied
comma
r_int
r_int
op_star
id|literal_added
)paren
(brace
r_struct
id|linehash
op_star
id|src_lines
comma
op_star
id|dst_lines
suffix:semicolon
r_int
r_int
id|sc
comma
id|la
suffix:semicolon
id|src_lines
op_assign
id|hash_lines
c_func
(paren
id|src
comma
id|src_size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|src_lines
)paren
r_return
l_int|1
suffix:semicolon
id|dst_lines
op_assign
id|hash_lines
c_func
(paren
id|dst
comma
id|dst_size
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|dst_lines
)paren
(brace
id|free
c_func
(paren
id|src_lines
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|sc
op_assign
id|la
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|src_lines-&gt;bytes
op_logical_and
id|dst_lines-&gt;bytes
)paren
(brace
r_int
id|cmp
op_assign
id|linehash_compare
c_func
(paren
id|src_lines
comma
id|dst_lines
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cmp
)paren
(brace
id|sc
op_add_assign
id|src_lines-&gt;bytes
suffix:semicolon
id|src_lines
op_increment
suffix:semicolon
id|dst_lines
op_increment
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|cmp
OL
l_int|0
)paren
(brace
id|src_lines
op_increment
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|la
op_add_assign
id|dst_lines-&gt;bytes
suffix:semicolon
id|dst_lines
op_increment
suffix:semicolon
)brace
r_while
c_loop
(paren
id|dst_lines-&gt;bytes
)paren
(brace
id|la
op_add_assign
id|dst_lines-&gt;bytes
suffix:semicolon
id|dst_lines
op_increment
suffix:semicolon
)brace
op_star
id|src_copied
op_assign
id|sc
suffix:semicolon
op_star
id|literal_added
op_assign
id|la
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
eof
