macro_line|#include &quot;git-compat-util.h&quot;
macro_line|#include &quot;progress.h&quot;
DECL|variable|progress_update
r_static
r_volatile
id|sig_atomic_t
id|progress_update
suffix:semicolon
DECL|function|progress_interval
r_static
r_void
id|progress_interval
c_func
(paren
r_int
id|signum
)paren
(brace
id|progress_update
op_assign
l_int|1
suffix:semicolon
)brace
DECL|function|set_progress_signal
r_static
r_void
id|set_progress_signal
c_func
(paren
r_void
)paren
(brace
r_struct
id|sigaction
id|sa
suffix:semicolon
r_struct
id|itimerval
id|v
suffix:semicolon
id|progress_update
op_assign
l_int|0
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|sa
comma
l_int|0
comma
r_sizeof
(paren
id|sa
)paren
)paren
suffix:semicolon
id|sa.sa_handler
op_assign
id|progress_interval
suffix:semicolon
id|sigemptyset
c_func
(paren
op_amp
id|sa.sa_mask
)paren
suffix:semicolon
id|sa.sa_flags
op_assign
id|SA_RESTART
suffix:semicolon
id|sigaction
c_func
(paren
id|SIGALRM
comma
op_amp
id|sa
comma
l_int|NULL
)paren
suffix:semicolon
id|v.it_interval.tv_sec
op_assign
l_int|1
suffix:semicolon
id|v.it_interval.tv_usec
op_assign
l_int|0
suffix:semicolon
id|v.it_value
op_assign
id|v.it_interval
suffix:semicolon
id|setitimer
c_func
(paren
id|ITIMER_REAL
comma
op_amp
id|v
comma
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|function|clear_progress_signal
r_static
r_void
id|clear_progress_signal
c_func
(paren
r_void
)paren
(brace
r_struct
id|itimerval
id|v
op_assign
(brace
(brace
l_int|0
comma
)brace
comma
)brace
suffix:semicolon
id|setitimer
c_func
(paren
id|ITIMER_REAL
comma
op_amp
id|v
comma
l_int|NULL
)paren
suffix:semicolon
id|signal
c_func
(paren
id|SIGALRM
comma
id|SIG_IGN
)paren
suffix:semicolon
id|progress_update
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|display_progress
r_int
id|display_progress
c_func
(paren
r_struct
id|progress
op_star
id|progress
comma
r_int
id|n
)paren
(brace
r_if
c_cond
(paren
id|progress-&gt;delay
)paren
(brace
r_char
id|buf
(braket
l_int|80
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|progress_update
op_logical_or
op_decrement
id|progress-&gt;delay
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|progress-&gt;total
)paren
(brace
r_int
id|percent
op_assign
id|n
op_star
l_int|100
op_div
id|progress-&gt;total
suffix:semicolon
r_if
c_cond
(paren
id|percent
OG
id|progress-&gt;delayed_percent_treshold
)paren
(brace
multiline_comment|/* inhibit this progress report entirely */
id|clear_progress_signal
c_func
(paren
)paren
suffix:semicolon
id|progress-&gt;delay
op_assign
l_int|1
suffix:semicolon
id|progress-&gt;total
op_assign
l_int|0
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|snprintf
c_func
(paren
id|buf
comma
r_sizeof
(paren
id|buf
)paren
comma
id|progress-&gt;delayed_title
comma
id|progress-&gt;total
)paren
)paren
id|fprintf
c_func
(paren
id|stderr
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|buf
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|progress-&gt;total
)paren
(brace
r_int
id|percent
op_assign
id|n
op_star
l_int|100
op_div
id|progress-&gt;total
suffix:semicolon
r_if
c_cond
(paren
id|percent
op_ne
id|progress-&gt;last_percent
op_logical_or
id|progress_update
)paren
(brace
id|progress-&gt;last_percent
op_assign
id|percent
suffix:semicolon
id|fprintf
c_func
(paren
id|stderr
comma
l_string|&quot;%s%4u%% (%u/%u) done&bslash;r&quot;
comma
id|progress-&gt;prefix
comma
id|percent
comma
id|n
comma
id|progress-&gt;total
)paren
suffix:semicolon
id|progress_update
op_assign
l_int|0
suffix:semicolon
id|progress-&gt;need_lf
op_assign
l_int|1
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|progress_update
)paren
(brace
id|fprintf
c_func
(paren
id|stderr
comma
l_string|&quot;%s%u&bslash;r&quot;
comma
id|progress-&gt;prefix
comma
id|n
)paren
suffix:semicolon
id|progress_update
op_assign
l_int|0
suffix:semicolon
id|progress-&gt;need_lf
op_assign
l_int|1
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|start_progress
r_void
id|start_progress
c_func
(paren
r_struct
id|progress
op_star
id|progress
comma
r_const
r_char
op_star
id|title
comma
r_const
r_char
op_star
id|prefix
comma
r_int
id|total
)paren
(brace
r_char
id|buf
(braket
l_int|80
)braket
suffix:semicolon
id|progress-&gt;prefix
op_assign
id|prefix
suffix:semicolon
id|progress-&gt;total
op_assign
id|total
suffix:semicolon
id|progress-&gt;last_percent
op_assign
l_int|1
suffix:semicolon
id|progress-&gt;delay
op_assign
l_int|0
suffix:semicolon
id|progress-&gt;need_lf
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|snprintf
c_func
(paren
id|buf
comma
r_sizeof
(paren
id|buf
)paren
comma
id|title
comma
id|total
)paren
)paren
id|fprintf
c_func
(paren
id|stderr
comma
l_string|&quot;%s&bslash;n&quot;
comma
id|buf
)paren
suffix:semicolon
id|set_progress_signal
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|start_progress_delay
r_void
id|start_progress_delay
c_func
(paren
r_struct
id|progress
op_star
id|progress
comma
r_const
r_char
op_star
id|title
comma
r_const
r_char
op_star
id|prefix
comma
r_int
id|total
comma
r_int
id|percent_treshold
comma
r_int
id|delay
)paren
(brace
id|progress-&gt;prefix
op_assign
id|prefix
suffix:semicolon
id|progress-&gt;total
op_assign
id|total
suffix:semicolon
id|progress-&gt;last_percent
op_assign
l_int|1
suffix:semicolon
id|progress-&gt;delayed_percent_treshold
op_assign
id|percent_treshold
suffix:semicolon
id|progress-&gt;delayed_title
op_assign
id|title
suffix:semicolon
id|progress-&gt;delay
op_assign
id|delay
suffix:semicolon
id|progress-&gt;need_lf
op_assign
l_int|0
suffix:semicolon
id|set_progress_signal
c_func
(paren
)paren
suffix:semicolon
)brace
DECL|function|stop_progress
r_void
id|stop_progress
c_func
(paren
r_struct
id|progress
op_star
id|progress
)paren
(brace
id|clear_progress_signal
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|progress-&gt;need_lf
)paren
id|fputc
c_func
(paren
l_char|&squot;&bslash;n&squot;
comma
id|stderr
)paren
suffix:semicolon
)brace
eof
