macro_line|#include &lt;assert.h&gt;
macro_line|#include &quot;cache.h&quot;
macro_line|#include &quot;refs.h&quot;
macro_line|#include &quot;tag.h&quot;
macro_line|#include &quot;commit.h&quot;
macro_line|#include &quot;tree.h&quot;
macro_line|#include &quot;blob.h&quot;
macro_line|#include &quot;epoch.h&quot;
macro_line|#include &quot;diff.h&quot;
DECL|macro|DEBUG
mdefine_line|#define DEBUG 0
DECL|variable|blame_lines
r_struct
id|commit
op_star
op_star
id|blame_lines
suffix:semicolon
DECL|variable|num_blame_lines
r_int
id|num_blame_lines
suffix:semicolon
DECL|struct|util_info
r_struct
id|util_info
(brace
DECL|member|line_map
r_int
op_star
id|line_map
suffix:semicolon
DECL|member|num_lines
r_int
id|num_lines
suffix:semicolon
DECL|member|sha1
r_int
r_char
id|sha1
(braket
l_int|20
)braket
suffix:semicolon
multiline_comment|/* blob sha, not commit! */
DECL|member|buf
r_char
op_star
id|buf
suffix:semicolon
DECL|member|size
r_int
r_int
id|size
suffix:semicolon
singleline_comment|//    const char* path;
)brace
suffix:semicolon
DECL|struct|chunk
r_struct
id|chunk
(brace
DECL|member|off1
DECL|member|len1
r_int
id|off1
comma
id|len1
suffix:semicolon
singleline_comment|// ---
DECL|member|off2
DECL|member|len2
r_int
id|off2
comma
id|len2
suffix:semicolon
singleline_comment|// +++
)brace
suffix:semicolon
DECL|struct|patch
r_struct
id|patch
(brace
DECL|member|chunks
r_struct
id|chunk
op_star
id|chunks
suffix:semicolon
DECL|member|num
r_int
id|num
suffix:semicolon
)brace
suffix:semicolon
r_static
r_void
id|get_blob
c_func
(paren
r_struct
id|commit
op_star
id|commit
)paren
suffix:semicolon
DECL|variable|num_get_patch
r_int
id|num_get_patch
op_assign
l_int|0
suffix:semicolon
DECL|variable|num_commits
r_int
id|num_commits
op_assign
l_int|0
suffix:semicolon
DECL|function|get_patch
r_struct
id|patch
op_star
id|get_patch
c_func
(paren
r_struct
id|commit
op_star
id|commit
comma
r_struct
id|commit
op_star
id|other
)paren
(brace
r_struct
id|patch
op_star
id|ret
op_assign
id|xmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|patch
)paren
)paren
suffix:semicolon
id|ret-&gt;chunks
op_assign
l_int|NULL
suffix:semicolon
id|ret-&gt;num
op_assign
l_int|0
suffix:semicolon
r_struct
id|util_info
op_star
id|info_c
op_assign
(paren
r_struct
id|util_info
op_star
)paren
id|commit-&gt;object.util
suffix:semicolon
r_struct
id|util_info
op_star
id|info_o
op_assign
(paren
r_struct
id|util_info
op_star
)paren
id|other-&gt;object.util
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|memcmp
c_func
(paren
id|info_c-&gt;sha1
comma
id|info_o-&gt;sha1
comma
l_int|20
)paren
)paren
(brace
r_return
id|ret
suffix:semicolon
)brace
id|get_blob
c_func
(paren
id|commit
)paren
suffix:semicolon
id|get_blob
c_func
(paren
id|other
)paren
suffix:semicolon
id|FILE
op_star
id|fout
op_assign
id|fopen
c_func
(paren
l_string|&quot;/tmp/git-blame-tmp1&quot;
comma
l_string|&quot;w&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fout
)paren
(brace
id|die
c_func
(paren
l_string|&quot;fopen tmp1 failed: %s&quot;
comma
id|strerror
c_func
(paren
id|errno
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fwrite
c_func
(paren
id|info_c-&gt;buf
comma
id|info_c-&gt;size
comma
l_int|1
comma
id|fout
)paren
op_ne
l_int|1
)paren
(brace
id|die
c_func
(paren
l_string|&quot;fwrite 1 failed: %s&quot;
comma
id|strerror
c_func
(paren
id|errno
)paren
)paren
suffix:semicolon
)brace
id|fclose
c_func
(paren
id|fout
)paren
suffix:semicolon
id|fout
op_assign
id|fopen
c_func
(paren
l_string|&quot;/tmp/git-blame-tmp2&quot;
comma
l_string|&quot;w&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fout
)paren
(brace
id|die
c_func
(paren
l_string|&quot;fopen tmp2 failed: %s&quot;
comma
id|strerror
c_func
(paren
id|errno
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fwrite
c_func
(paren
id|info_o-&gt;buf
comma
id|info_o-&gt;size
comma
l_int|1
comma
id|fout
)paren
op_ne
l_int|1
)paren
(brace
id|die
c_func
(paren
l_string|&quot;fwrite 2 failed: %s&quot;
comma
id|strerror
c_func
(paren
id|errno
)paren
)paren
suffix:semicolon
)brace
id|fclose
c_func
(paren
id|fout
)paren
suffix:semicolon
id|FILE
op_star
id|fin
op_assign
id|popen
c_func
(paren
l_string|&quot;diff -u0 /tmp/git-blame-tmp1 /tmp/git-blame-tmp2&quot;
comma
l_string|&quot;r&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fin
)paren
(brace
id|die
c_func
(paren
l_string|&quot;popen failed: %s&quot;
comma
id|strerror
c_func
(paren
id|errno
)paren
)paren
suffix:semicolon
)brace
r_char
id|buf
(braket
l_int|1024
)braket
suffix:semicolon
r_while
c_loop
(paren
id|fgets
c_func
(paren
id|buf
comma
r_sizeof
(paren
id|buf
)paren
comma
id|fin
)paren
)paren
(brace
r_if
c_cond
(paren
id|buf
(braket
l_int|0
)braket
op_ne
l_char|&squot;@&squot;
op_logical_or
id|buf
(braket
l_int|1
)braket
op_ne
l_char|&squot;@&squot;
)paren
(brace
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|DEBUG
)paren
(brace
id|printf
c_func
(paren
l_string|&quot;chunk line: %s&quot;
comma
id|buf
)paren
suffix:semicolon
)brace
id|ret-&gt;num
op_increment
suffix:semicolon
id|ret-&gt;chunks
op_assign
id|xrealloc
c_func
(paren
id|ret-&gt;chunks
comma
r_sizeof
(paren
r_struct
id|chunk
)paren
op_star
id|ret-&gt;num
)paren
suffix:semicolon
r_struct
id|chunk
op_star
id|chunk
op_assign
op_amp
id|ret-&gt;chunks
(braket
id|ret-&gt;num
op_minus
l_int|1
)braket
suffix:semicolon
m_assert
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|buf
comma
l_string|&quot;@@ -&quot;
comma
l_int|4
)paren
)paren
suffix:semicolon
r_char
op_star
id|start
op_assign
id|buf
op_plus
l_int|4
suffix:semicolon
r_char
op_star
id|sp
op_assign
id|index
c_func
(paren
id|start
comma
l_char|&squot; &squot;
)paren
suffix:semicolon
op_star
id|sp
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_if
c_cond
(paren
id|index
c_func
(paren
id|start
comma
l_char|&squot;,&squot;
)paren
)paren
(brace
r_int
id|ret
op_assign
id|sscanf
c_func
(paren
id|start
comma
l_string|&quot;%d,%d&quot;
comma
op_amp
id|chunk-&gt;off1
comma
op_amp
id|chunk-&gt;len1
)paren
suffix:semicolon
m_assert
(paren
id|ret
op_eq
l_int|2
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
id|ret
op_assign
id|sscanf
c_func
(paren
id|start
comma
l_string|&quot;%d&quot;
comma
op_amp
id|chunk-&gt;off1
)paren
suffix:semicolon
m_assert
(paren
id|ret
op_eq
l_int|1
)paren
suffix:semicolon
id|chunk-&gt;len1
op_assign
l_int|1
suffix:semicolon
)brace
op_star
id|sp
op_assign
l_char|&squot; &squot;
suffix:semicolon
id|start
op_assign
id|sp
op_plus
l_int|1
suffix:semicolon
id|sp
op_assign
id|index
c_func
(paren
id|start
comma
l_char|&squot; &squot;
)paren
suffix:semicolon
op_star
id|sp
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
r_if
c_cond
(paren
id|index
c_func
(paren
id|start
comma
l_char|&squot;,&squot;
)paren
)paren
(brace
r_int
id|ret
op_assign
id|sscanf
c_func
(paren
id|start
comma
l_string|&quot;%d,%d&quot;
comma
op_amp
id|chunk-&gt;off2
comma
op_amp
id|chunk-&gt;len2
)paren
suffix:semicolon
m_assert
(paren
id|ret
op_eq
l_int|2
)paren
suffix:semicolon
)brace
r_else
(brace
r_int
id|ret
op_assign
id|sscanf
c_func
(paren
id|start
comma
l_string|&quot;%d&quot;
comma
op_amp
id|chunk-&gt;off2
)paren
suffix:semicolon
m_assert
(paren
id|ret
op_eq
l_int|1
)paren
suffix:semicolon
id|chunk-&gt;len2
op_assign
l_int|1
suffix:semicolon
)brace
op_star
id|sp
op_assign
l_char|&squot; &squot;
suffix:semicolon
r_if
c_cond
(paren
id|chunk-&gt;off1
OG
l_int|0
)paren
(brace
id|chunk-&gt;off1
op_sub_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chunk-&gt;off2
OG
l_int|0
)paren
(brace
id|chunk-&gt;off2
op_sub_assign
l_int|1
suffix:semicolon
)brace
m_assert
(paren
id|chunk-&gt;off1
op_ge
l_int|0
)paren
suffix:semicolon
m_assert
(paren
id|chunk-&gt;off2
op_ge
l_int|0
)paren
suffix:semicolon
)brace
id|fclose
c_func
(paren
id|fin
)paren
suffix:semicolon
id|num_get_patch
op_increment
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|free_patch
r_void
id|free_patch
c_func
(paren
r_struct
id|patch
op_star
id|p
)paren
(brace
id|free
c_func
(paren
id|p-&gt;chunks
)paren
suffix:semicolon
id|free
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
r_static
r_int
id|get_blob_sha1_internal
c_func
(paren
r_int
r_char
op_star
id|sha1
comma
r_const
r_char
op_star
id|base
comma
r_int
id|baselen
comma
r_const
r_char
op_star
id|pathname
comma
r_int
id|mode
comma
r_int
id|stage
)paren
suffix:semicolon
DECL|variable|blob_sha1
r_static
r_int
r_char
id|blob_sha1
(braket
l_int|20
)braket
suffix:semicolon
DECL|function|get_blob_sha1
r_static
r_int
id|get_blob_sha1
c_func
(paren
r_struct
id|tree
op_star
id|t
comma
r_const
r_char
op_star
id|pathname
comma
r_int
r_char
op_star
id|sha1
)paren
(brace
r_const
r_char
op_star
id|pathspec
(braket
l_int|2
)braket
suffix:semicolon
id|pathspec
(braket
l_int|0
)braket
op_assign
id|pathname
suffix:semicolon
id|pathspec
(braket
l_int|1
)braket
op_assign
l_int|NULL
suffix:semicolon
id|memset
c_func
(paren
id|blob_sha1
comma
l_int|0
comma
r_sizeof
(paren
id|blob_sha1
)paren
)paren
suffix:semicolon
id|read_tree_recursive
c_func
(paren
id|t
comma
l_string|&quot;&quot;
comma
l_int|0
comma
l_int|0
comma
id|pathspec
comma
id|get_blob_sha1_internal
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|20
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|blob_sha1
(braket
id|i
)braket
op_ne
l_int|0
)paren
(brace
r_break
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|i
op_eq
l_int|20
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|sha1
comma
id|blob_sha1
comma
l_int|20
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|get_blob_sha1_internal
r_static
r_int
id|get_blob_sha1_internal
c_func
(paren
r_int
r_char
op_star
id|sha1
comma
r_const
r_char
op_star
id|base
comma
r_int
id|baselen
comma
r_const
r_char
op_star
id|pathname
comma
r_int
id|mode
comma
r_int
id|stage
)paren
(brace
singleline_comment|//    printf(&quot;Got blob: %s base: &squot;%s&squot; baselen: %d pathname: &squot;%s&squot; mode: %o stage: %d&bslash;n&quot;,
singleline_comment|//           sha1_to_hex(sha1), base, baselen, pathname, mode, stage);
r_if
c_cond
(paren
id|S_ISDIR
c_func
(paren
id|mode
)paren
)paren
(brace
r_return
id|READ_TREE_RECURSIVE
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|blob_sha1
comma
id|sha1
comma
l_int|20
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|get_blob
r_static
r_void
id|get_blob
c_func
(paren
r_struct
id|commit
op_star
id|commit
)paren
(brace
r_struct
id|util_info
op_star
id|info
op_assign
id|commit-&gt;object.util
suffix:semicolon
r_char
id|type
(braket
l_int|20
)braket
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;buf
)paren
(brace
r_return
suffix:semicolon
)brace
id|info-&gt;buf
op_assign
id|read_sha1_file
c_func
(paren
id|info-&gt;sha1
comma
id|type
comma
op_amp
id|info-&gt;size
)paren
suffix:semicolon
m_assert
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|type
comma
l_string|&quot;blob&quot;
)paren
)paren
suffix:semicolon
)brace
DECL|function|print_patch
r_void
id|print_patch
c_func
(paren
r_struct
id|patch
op_star
id|p
)paren
(brace
id|printf
c_func
(paren
l_string|&quot;Num chunks: %d&bslash;n&quot;
comma
id|p-&gt;num
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|p-&gt;num
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printf
c_func
(paren
l_string|&quot;%d,%d %d,%d&bslash;n&quot;
comma
id|p-&gt;chunks
(braket
id|i
)braket
dot
id|off1
comma
id|p-&gt;chunks
(braket
id|i
)braket
dot
id|len1
comma
id|p-&gt;chunks
(braket
id|i
)braket
dot
id|off2
comma
id|p-&gt;chunks
(braket
id|i
)braket
dot
id|len2
)paren
suffix:semicolon
)brace
)brace
singleline_comment|// p is a patch from commit to other.
DECL|function|fill_line_map
r_void
id|fill_line_map
c_func
(paren
r_struct
id|commit
op_star
id|commit
comma
r_struct
id|commit
op_star
id|other
comma
r_struct
id|patch
op_star
id|p
)paren
(brace
r_int
id|num_lines
op_assign
(paren
(paren
r_struct
id|util_info
op_star
)paren
id|commit-&gt;object.util
)paren
op_member_access_from_pointer
id|num_lines
suffix:semicolon
r_int
op_star
id|line_map
op_assign
(paren
(paren
r_struct
id|util_info
op_star
)paren
id|commit-&gt;object.util
)paren
op_member_access_from_pointer
id|line_map
suffix:semicolon
r_int
id|num_lines2
op_assign
(paren
(paren
r_struct
id|util_info
op_star
)paren
id|other-&gt;object.util
)paren
op_member_access_from_pointer
id|num_lines
suffix:semicolon
r_int
op_star
id|line_map2
op_assign
(paren
(paren
r_struct
id|util_info
op_star
)paren
id|other-&gt;object.util
)paren
op_member_access_from_pointer
id|line_map
suffix:semicolon
r_int
id|cur_chunk
op_assign
l_int|0
suffix:semicolon
r_int
id|i1
comma
id|i2
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;num
op_logical_and
id|DEBUG
)paren
(brace
id|print_patch
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i1
op_assign
l_int|0
suffix:semicolon
id|i1
OL
id|num_lines
suffix:semicolon
id|i1
op_increment
)paren
(brace
id|line_map
(braket
id|i1
)braket
op_assign
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|DEBUG
)paren
(brace
id|printf
c_func
(paren
l_string|&quot;num lines 1: %d num lines 2: %d&bslash;n&quot;
comma
id|num_lines
comma
id|num_lines2
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i1
op_assign
l_int|0
comma
id|i2
op_assign
l_int|0
suffix:semicolon
id|i1
OL
id|num_lines
suffix:semicolon
id|i1
op_increment
comma
id|i2
op_increment
)paren
(brace
r_if
c_cond
(paren
id|DEBUG
OG
l_int|1
)paren
(brace
id|printf
c_func
(paren
l_string|&quot;%d %d&bslash;n&quot;
comma
id|i1
comma
id|i2
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i2
op_ge
id|num_lines2
)paren
(brace
r_break
suffix:semicolon
)brace
id|line_map
(braket
id|i1
)braket
op_assign
id|line_map2
(braket
id|i2
)braket
suffix:semicolon
r_struct
id|chunk
op_star
id|chunk
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|cur_chunk
OL
id|p-&gt;num
)paren
(brace
id|chunk
op_assign
op_amp
id|p-&gt;chunks
(braket
id|cur_chunk
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chunk
op_logical_and
id|chunk-&gt;off1
op_eq
id|i1
)paren
(brace
id|i2
op_assign
id|chunk-&gt;off2
suffix:semicolon
r_if
c_cond
(paren
id|chunk-&gt;len1
OG
l_int|0
)paren
(brace
id|i1
op_add_assign
id|chunk-&gt;len1
op_minus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chunk-&gt;len2
OG
l_int|0
)paren
(brace
id|i2
op_add_assign
id|chunk-&gt;len2
op_minus
l_int|1
suffix:semicolon
)brace
id|cur_chunk
op_increment
suffix:semicolon
)brace
)brace
)brace
DECL|function|map_line
r_int
id|map_line
c_func
(paren
r_struct
id|commit
op_star
id|commit
comma
r_int
id|line
)paren
(brace
r_struct
id|util_info
op_star
id|info
op_assign
id|commit-&gt;object.util
suffix:semicolon
m_assert
(paren
id|line
op_ge
l_int|0
op_logical_and
id|line
OL
id|info-&gt;num_lines
)paren
suffix:semicolon
r_return
id|info-&gt;line_map
(braket
id|line
)braket
suffix:semicolon
)brace
DECL|function|fill_util_info
r_int
id|fill_util_info
c_func
(paren
r_struct
id|commit
op_star
id|commit
comma
r_const
r_char
op_star
id|path
)paren
(brace
r_if
c_cond
(paren
id|commit-&gt;object.util
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_struct
id|util_info
op_star
id|util
op_assign
id|xmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|util_info
)paren
)paren
suffix:semicolon
id|util-&gt;buf
op_assign
l_int|NULL
suffix:semicolon
id|util-&gt;size
op_assign
l_int|0
suffix:semicolon
id|util-&gt;num_lines
op_assign
l_int|1
suffix:semicolon
id|util-&gt;line_map
op_assign
l_int|NULL
suffix:semicolon
id|commit-&gt;object.util
op_assign
id|util
suffix:semicolon
r_if
c_cond
(paren
id|get_blob_sha1
c_func
(paren
id|commit-&gt;tree
comma
id|path
comma
id|util-&gt;sha1
)paren
)paren
(brace
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|alloc_line_map
r_void
id|alloc_line_map
c_func
(paren
r_struct
id|commit
op_star
id|commit
)paren
(brace
r_struct
id|util_info
op_star
id|util
op_assign
id|commit-&gt;object.util
suffix:semicolon
r_if
c_cond
(paren
id|util-&gt;line_map
)paren
(brace
r_return
suffix:semicolon
)brace
id|get_blob
c_func
(paren
id|commit
)paren
suffix:semicolon
r_int
id|i
suffix:semicolon
id|util-&gt;num_lines
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|util-&gt;size
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|util-&gt;buf
(braket
id|i
)braket
op_eq
l_char|&squot;&bslash;n&squot;
)paren
(brace
id|util-&gt;num_lines
op_increment
suffix:semicolon
)brace
)brace
id|util-&gt;line_map
op_assign
id|xmalloc
c_func
(paren
r_sizeof
(paren
r_int
)paren
op_star
id|util-&gt;num_lines
)paren
suffix:semicolon
)brace
DECL|function|copy_line_map
r_void
id|copy_line_map
c_func
(paren
r_struct
id|commit
op_star
id|dst
comma
r_struct
id|commit
op_star
id|src
)paren
(brace
r_struct
id|util_info
op_star
id|u_dst
op_assign
id|dst-&gt;object.util
suffix:semicolon
r_struct
id|util_info
op_star
id|u_src
op_assign
id|src-&gt;object.util
suffix:semicolon
id|u_dst-&gt;line_map
op_assign
id|u_src-&gt;line_map
suffix:semicolon
id|u_dst-&gt;num_lines
op_assign
id|u_src-&gt;num_lines
suffix:semicolon
id|u_dst-&gt;buf
op_assign
id|u_src-&gt;buf
suffix:semicolon
id|u_dst-&gt;size
op_assign
id|u_src-&gt;size
suffix:semicolon
)brace
DECL|function|process_commits
r_void
id|process_commits
c_func
(paren
r_struct
id|commit_list
op_star
id|list
comma
r_const
r_char
op_star
id|path
)paren
(brace
r_int
id|i
suffix:semicolon
r_while
c_loop
(paren
id|list
)paren
(brace
r_struct
id|commit
op_star
id|commit
op_assign
id|pop_commit
c_func
(paren
op_amp
id|list
)paren
suffix:semicolon
r_struct
id|commit_list
op_star
id|parents
suffix:semicolon
r_struct
id|util_info
op_star
id|info
suffix:semicolon
id|info
op_assign
id|commit-&gt;object.util
suffix:semicolon
id|num_commits
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|DEBUG
)paren
(brace
id|printf
c_func
(paren
l_string|&quot;&bslash;nProcessing commit: %d %s&bslash;n&quot;
comma
id|num_commits
comma
id|sha1_to_hex
c_func
(paren
id|commit-&gt;object.sha1
)paren
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|parents
op_assign
id|commit-&gt;parents
suffix:semicolon
id|parents
op_ne
l_int|NULL
suffix:semicolon
id|parents
op_assign
id|parents-&gt;next
)paren
(brace
r_struct
id|commit
op_star
id|parent
op_assign
id|parents-&gt;item
suffix:semicolon
r_if
c_cond
(paren
id|parse_commit
c_func
(paren
id|parent
)paren
OL
l_int|0
)paren
(brace
id|die
c_func
(paren
l_string|&quot;parse_commit error&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|DEBUG
)paren
(brace
id|printf
c_func
(paren
l_string|&quot;parent: %s&bslash;n&quot;
comma
id|sha1_to_hex
c_func
(paren
id|parent-&gt;object.sha1
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fill_util_info
c_func
(paren
id|parent
comma
id|path
)paren
)paren
(brace
r_continue
suffix:semicolon
)brace
singleline_comment|// Temporarily assign everything to the parent.
r_int
id|num_blame
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num_blame_lines
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|blame_lines
(braket
id|i
)braket
op_eq
id|commit
)paren
(brace
id|num_blame
op_increment
suffix:semicolon
id|blame_lines
(braket
id|i
)braket
op_assign
id|parent
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|num_blame
op_eq
l_int|0
)paren
(brace
r_continue
suffix:semicolon
)brace
r_struct
id|patch
op_star
id|patch
op_assign
id|get_patch
c_func
(paren
id|parent
comma
id|commit
)paren
suffix:semicolon
r_if
c_cond
(paren
id|patch-&gt;num
op_eq
l_int|0
)paren
(brace
id|copy_line_map
c_func
(paren
id|parent
comma
id|commit
)paren
suffix:semicolon
)brace
r_else
(brace
id|alloc_line_map
c_func
(paren
id|parent
)paren
suffix:semicolon
id|fill_line_map
c_func
(paren
id|parent
comma
id|commit
comma
id|patch
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|patch-&gt;num
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|l
suffix:semicolon
r_for
c_loop
(paren
id|l
op_assign
l_int|0
suffix:semicolon
id|l
OL
id|patch-&gt;chunks
(braket
id|i
)braket
dot
id|len2
suffix:semicolon
id|l
op_increment
)paren
(brace
r_int
id|mapped_line
op_assign
id|map_line
c_func
(paren
id|commit
comma
id|patch-&gt;chunks
(braket
id|i
)braket
dot
id|off2
op_plus
id|l
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mapped_line
op_ne
l_int|1
op_logical_and
id|blame_lines
(braket
id|mapped_line
)braket
op_eq
id|parent
)paren
(brace
id|blame_lines
(braket
id|mapped_line
)braket
op_assign
id|commit
suffix:semicolon
)brace
)brace
)brace
id|free_patch
c_func
(paren
id|patch
)paren
suffix:semicolon
)brace
)brace
)brace
DECL|macro|SEEN
mdefine_line|#define SEEN 1
DECL|function|get_commit_list
r_struct
id|commit_list
op_star
id|get_commit_list
c_func
(paren
r_struct
id|commit
op_star
id|commit
comma
r_const
r_char
op_star
id|pathname
)paren
(brace
r_struct
id|commit_list
op_star
id|ret
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|commit_list
op_star
id|process
op_assign
l_int|NULL
suffix:semicolon
r_int
r_char
id|sha1
(braket
l_int|20
)braket
suffix:semicolon
id|commit_list_insert
c_func
(paren
id|commit
comma
op_amp
id|process
)paren
suffix:semicolon
r_while
c_loop
(paren
id|process
)paren
(brace
r_struct
id|commit
op_star
id|com
op_assign
id|pop_commit
c_func
(paren
op_amp
id|process
)paren
suffix:semicolon
r_if
c_cond
(paren
id|com-&gt;object.flags
op_amp
id|SEEN
)paren
(brace
r_continue
suffix:semicolon
)brace
id|com-&gt;object.flags
op_or_assign
id|SEEN
suffix:semicolon
id|commit_list_insert
c_func
(paren
id|com
comma
op_amp
id|ret
)paren
suffix:semicolon
r_struct
id|commit_list
op_star
id|parents
suffix:semicolon
id|parse_commit
c_func
(paren
id|com
)paren
suffix:semicolon
r_for
c_loop
(paren
id|parents
op_assign
id|com-&gt;parents
suffix:semicolon
id|parents
op_ne
l_int|NULL
suffix:semicolon
id|parents
op_assign
id|parents-&gt;next
)paren
(brace
r_struct
id|commit
op_star
id|parent
op_assign
id|parents-&gt;item
suffix:semicolon
id|parse_commit
c_func
(paren
id|parent
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|get_blob_sha1
c_func
(paren
id|parent-&gt;tree
comma
id|pathname
comma
id|sha1
)paren
)paren
(brace
id|commit_list_insert
c_func
(paren
id|parent
comma
op_amp
id|process
)paren
suffix:semicolon
)brace
)brace
)brace
r_return
id|ret
suffix:semicolon
)brace
DECL|function|main
r_int
id|main
c_func
(paren
r_int
id|argc
comma
r_const
r_char
op_star
op_star
id|argv
)paren
(brace
r_int
r_char
id|sha1
(braket
l_int|20
)braket
suffix:semicolon
r_struct
id|commit
op_star
id|commit
suffix:semicolon
r_const
r_char
op_star
id|filename
suffix:semicolon
r_int
id|i
suffix:semicolon
id|setup_git_directory
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|argc
op_ne
l_int|3
)paren
id|die
c_func
(paren
l_string|&quot;Usage: blame commit-ish file&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|get_sha1
c_func
(paren
id|argv
(braket
l_int|1
)braket
comma
id|sha1
)paren
)paren
id|die
c_func
(paren
l_string|&quot;get_sha1 failed&quot;
)paren
suffix:semicolon
id|commit
op_assign
id|lookup_commit_reference
c_func
(paren
id|sha1
)paren
suffix:semicolon
id|filename
op_assign
id|argv
(braket
l_int|2
)braket
suffix:semicolon
r_struct
id|commit_list
op_star
id|list
op_assign
id|get_commit_list
c_func
(paren
id|commit
comma
id|filename
)paren
suffix:semicolon
id|sort_in_topological_order
c_func
(paren
op_amp
id|list
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fill_util_info
c_func
(paren
id|commit
comma
id|filename
)paren
)paren
(brace
id|printf
c_func
(paren
l_string|&quot;%s not found in %s&bslash;n&quot;
comma
id|filename
comma
id|argv
(braket
l_int|1
)braket
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
id|alloc_line_map
c_func
(paren
id|commit
)paren
suffix:semicolon
r_struct
id|util_info
op_star
id|util
op_assign
id|commit-&gt;object.util
suffix:semicolon
id|num_blame_lines
op_assign
id|util-&gt;num_lines
suffix:semicolon
id|blame_lines
op_assign
id|xmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|commit
op_star
)paren
op_star
id|num_blame_lines
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num_blame_lines
suffix:semicolon
id|i
op_increment
)paren
(brace
id|blame_lines
(braket
id|i
)braket
op_assign
id|commit
suffix:semicolon
(paren
(paren
r_struct
id|util_info
op_star
)paren
id|commit-&gt;object.util
)paren
op_member_access_from_pointer
id|line_map
(braket
id|i
)braket
op_assign
id|i
suffix:semicolon
)brace
id|process_commits
c_func
(paren
id|list
comma
id|filename
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num_blame_lines
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printf
c_func
(paren
l_string|&quot;%d %s&bslash;n&quot;
comma
id|i
op_plus
l_int|1
op_minus
l_int|1
comma
id|sha1_to_hex
c_func
(paren
id|blame_lines
(braket
id|i
)braket
op_member_access_from_pointer
id|object.sha1
)paren
)paren
suffix:semicolon
singleline_comment|//        printf(&quot;%d %s&bslash;n&quot;, i+1-1, find_unique_abbrev(blame_lines[i]-&gt;object.sha1, 6));
)brace
r_if
c_cond
(paren
id|DEBUG
)paren
(brace
id|printf
c_func
(paren
l_string|&quot;num get patch: %d&bslash;n&quot;
comma
id|num_get_patch
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;num commits: %d&bslash;n&quot;
comma
id|num_commits
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
eof
