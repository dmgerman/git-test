multiline_comment|/*&n; * Copyright (C) 2006, Fredrik Kuivinen &lt;freku045@student.liu.se&gt;&n; */
macro_line|#include &lt;assert.h&gt;
macro_line|#include &lt;time.h&gt;
macro_line|#include &lt;sys/time.h&gt;
macro_line|#include &lt;math.h&gt;
macro_line|#include &quot;cache.h&quot;
macro_line|#include &quot;refs.h&quot;
macro_line|#include &quot;tag.h&quot;
macro_line|#include &quot;commit.h&quot;
macro_line|#include &quot;tree.h&quot;
macro_line|#include &quot;blob.h&quot;
macro_line|#include &quot;diff.h&quot;
macro_line|#include &quot;diffcore.h&quot;
macro_line|#include &quot;revision.h&quot;
macro_line|#include &quot;xdiff-interface.h&quot;
DECL|macro|DEBUG
mdefine_line|#define DEBUG 0
DECL|variable|blame_usage
r_static
r_const
r_char
id|blame_usage
(braket
)braket
op_assign
l_string|&quot;git-blame [-c] [-l] [-t] [-S &lt;revs-file&gt;] [--] file [commit]&bslash;n&quot;
l_string|&quot;  -c, --compatibility Use the same output mode as git-annotate (Default: off)&bslash;n&quot;
l_string|&quot;  -l, --long          Show long commit SHA1 (Default: off)&bslash;n&quot;
l_string|&quot;  -t, --time          Show raw timestamp (Default: off)&bslash;n&quot;
l_string|&quot;  -S, --revs-file     Use revisions from revs-file instead of calling git-rev-list&bslash;n&quot;
l_string|&quot;  -h, --help          This message&quot;
suffix:semicolon
DECL|variable|blame_lines
r_static
r_struct
id|commit
op_star
op_star
id|blame_lines
suffix:semicolon
DECL|variable|num_blame_lines
r_static
r_int
id|num_blame_lines
suffix:semicolon
DECL|variable|blame_contents
r_static
r_char
op_star
id|blame_contents
suffix:semicolon
DECL|variable|blame_len
r_static
r_int
id|blame_len
suffix:semicolon
DECL|struct|util_info
r_struct
id|util_info
(brace
DECL|member|line_map
r_int
op_star
id|line_map
suffix:semicolon
DECL|member|sha1
r_int
r_char
id|sha1
(braket
l_int|20
)braket
suffix:semicolon
multiline_comment|/* blob sha, not commit! */
DECL|member|buf
r_char
op_star
id|buf
suffix:semicolon
DECL|member|size
r_int
r_int
id|size
suffix:semicolon
DECL|member|num_lines
r_int
id|num_lines
suffix:semicolon
DECL|member|pathname
r_const
r_char
op_star
id|pathname
suffix:semicolon
DECL|member|topo_data
r_void
op_star
id|topo_data
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|chunk
r_struct
id|chunk
(brace
DECL|member|off1
DECL|member|len1
r_int
id|off1
comma
id|len1
suffix:semicolon
multiline_comment|/* --- */
DECL|member|off2
DECL|member|len2
r_int
id|off2
comma
id|len2
suffix:semicolon
multiline_comment|/* +++ */
)brace
suffix:semicolon
DECL|struct|patch
r_struct
id|patch
(brace
DECL|member|chunks
r_struct
id|chunk
op_star
id|chunks
suffix:semicolon
DECL|member|num
r_int
id|num
suffix:semicolon
)brace
suffix:semicolon
r_static
r_void
id|get_blob
c_func
(paren
r_struct
id|commit
op_star
id|commit
)paren
suffix:semicolon
multiline_comment|/* Only used for statistics */
DECL|variable|num_get_patch
r_static
r_int
id|num_get_patch
suffix:semicolon
DECL|variable|num_commits
r_static
r_int
id|num_commits
suffix:semicolon
DECL|variable|patch_time
r_static
r_int
id|patch_time
suffix:semicolon
DECL|struct|blame_diff_state
r_struct
id|blame_diff_state
(brace
DECL|member|xm
r_struct
id|xdiff_emit_state
id|xm
suffix:semicolon
DECL|member|ret
r_struct
id|patch
op_star
id|ret
suffix:semicolon
)brace
suffix:semicolon
DECL|function|process_u0_diff
r_static
r_void
id|process_u0_diff
c_func
(paren
r_void
op_star
id|state_
comma
r_char
op_star
id|line
comma
r_int
r_int
id|len
)paren
(brace
r_struct
id|blame_diff_state
op_star
id|state
op_assign
id|state_
suffix:semicolon
r_struct
id|chunk
op_star
id|chunk
suffix:semicolon
r_if
c_cond
(paren
id|len
OL
l_int|4
op_logical_or
id|line
(braket
l_int|0
)braket
op_ne
l_char|&squot;@&squot;
op_logical_or
id|line
(braket
l_int|1
)braket
op_ne
l_char|&squot;@&squot;
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|DEBUG
)paren
id|printf
c_func
(paren
l_string|&quot;chunk line: %.*s&quot;
comma
(paren
r_int
)paren
id|len
comma
id|line
)paren
suffix:semicolon
id|state-&gt;ret-&gt;num
op_increment
suffix:semicolon
id|state-&gt;ret-&gt;chunks
op_assign
id|xrealloc
c_func
(paren
id|state-&gt;ret-&gt;chunks
comma
r_sizeof
(paren
r_struct
id|chunk
)paren
op_star
id|state-&gt;ret-&gt;num
)paren
suffix:semicolon
id|chunk
op_assign
op_amp
id|state-&gt;ret-&gt;chunks
(braket
id|state-&gt;ret-&gt;num
l_int|1
)braket
suffix:semicolon
m_assert
(paren
op_logical_neg
id|strncmp
c_func
(paren
id|line
comma
l_string|&quot;@@ -&quot;
comma
l_int|4
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|parse_hunk_header
c_func
(paren
id|line
comma
id|len
comma
op_amp
id|chunk-&gt;off1
comma
op_amp
id|chunk-&gt;len1
comma
op_amp
id|chunk-&gt;off2
comma
op_amp
id|chunk-&gt;len2
)paren
)paren
(brace
id|state-&gt;ret-&gt;num
op_decrement
suffix:semicolon
r_return
suffix:semicolon
)brace
r_if
c_cond
(paren
id|chunk-&gt;len1
op_eq
l_int|0
)paren
id|chunk-&gt;off1
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|chunk-&gt;len2
op_eq
l_int|0
)paren
id|chunk-&gt;off2
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|chunk-&gt;off1
OG
l_int|0
)paren
id|chunk-&gt;off1
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|chunk-&gt;off2
OG
l_int|0
)paren
id|chunk-&gt;off2
op_decrement
suffix:semicolon
m_assert
(paren
id|chunk-&gt;off1
op_ge
l_int|0
)paren
suffix:semicolon
m_assert
(paren
id|chunk-&gt;off2
op_ge
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|get_patch
r_static
r_struct
id|patch
op_star
id|get_patch
c_func
(paren
r_struct
id|commit
op_star
id|commit
comma
r_struct
id|commit
op_star
id|other
)paren
(brace
r_struct
id|blame_diff_state
id|state
suffix:semicolon
id|xpparam_t
id|xpp
suffix:semicolon
id|xdemitconf_t
id|xecfg
suffix:semicolon
id|mmfile_t
id|file_c
comma
id|file_o
suffix:semicolon
id|xdemitcb_t
id|ecb
suffix:semicolon
r_struct
id|util_info
op_star
id|info_c
op_assign
(paren
r_struct
id|util_info
op_star
)paren
id|commit-&gt;util
suffix:semicolon
r_struct
id|util_info
op_star
id|info_o
op_assign
(paren
r_struct
id|util_info
op_star
)paren
id|other-&gt;util
suffix:semicolon
r_struct
id|timeval
id|tv_start
comma
id|tv_end
suffix:semicolon
id|get_blob
c_func
(paren
id|commit
)paren
suffix:semicolon
id|file_c.ptr
op_assign
id|info_c-&gt;buf
suffix:semicolon
id|file_c.size
op_assign
id|info_c-&gt;size
suffix:semicolon
id|get_blob
c_func
(paren
id|other
)paren
suffix:semicolon
id|file_o.ptr
op_assign
id|info_o-&gt;buf
suffix:semicolon
id|file_o.size
op_assign
id|info_o-&gt;size
suffix:semicolon
id|gettimeofday
c_func
(paren
op_amp
id|tv_start
comma
l_int|NULL
)paren
suffix:semicolon
id|xpp.flags
op_assign
id|XDF_NEED_MINIMAL
suffix:semicolon
id|xecfg.ctxlen
op_assign
l_int|0
suffix:semicolon
id|xecfg.flags
op_assign
l_int|0
suffix:semicolon
id|ecb.outf
op_assign
id|xdiff_outf
suffix:semicolon
id|ecb.priv
op_assign
op_amp
id|state
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|state
comma
l_int|0
comma
r_sizeof
(paren
id|state
)paren
)paren
suffix:semicolon
id|state.xm.consume
op_assign
id|process_u0_diff
suffix:semicolon
id|state.ret
op_assign
id|xmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|patch
)paren
)paren
suffix:semicolon
id|state.ret-&gt;chunks
op_assign
l_int|NULL
suffix:semicolon
id|state.ret-&gt;num
op_assign
l_int|0
suffix:semicolon
id|xdl_diff
c_func
(paren
op_amp
id|file_c
comma
op_amp
id|file_o
comma
op_amp
id|xpp
comma
op_amp
id|xecfg
comma
op_amp
id|ecb
)paren
suffix:semicolon
id|gettimeofday
c_func
(paren
op_amp
id|tv_end
comma
l_int|NULL
)paren
suffix:semicolon
id|patch_time
op_add_assign
l_int|1000000
op_star
(paren
id|tv_end.tv_sec
id|tv_start.tv_sec
)paren
op_plus
id|tv_end.tv_usec
id|tv_start.tv_usec
suffix:semicolon
id|num_get_patch
op_increment
suffix:semicolon
r_return
id|state.ret
suffix:semicolon
)brace
DECL|function|free_patch
r_static
r_void
id|free_patch
c_func
(paren
r_struct
id|patch
op_star
id|p
)paren
(brace
id|free
c_func
(paren
id|p-&gt;chunks
)paren
suffix:semicolon
id|free
c_func
(paren
id|p
)paren
suffix:semicolon
)brace
r_static
r_int
id|get_blob_sha1_internal
c_func
(paren
r_const
r_int
r_char
op_star
id|sha1
comma
r_const
r_char
op_star
id|base
comma
r_int
id|baselen
comma
r_const
r_char
op_star
id|pathname
comma
r_int
id|mode
comma
r_int
id|stage
)paren
suffix:semicolon
DECL|variable|blob_sha1
r_static
r_int
r_char
id|blob_sha1
(braket
l_int|20
)braket
suffix:semicolon
DECL|variable|blame_file
r_static
r_const
r_char
op_star
id|blame_file
suffix:semicolon
DECL|function|get_blob_sha1
r_static
r_int
id|get_blob_sha1
c_func
(paren
r_struct
id|tree
op_star
id|t
comma
r_const
r_char
op_star
id|pathname
comma
r_int
r_char
op_star
id|sha1
)paren
(brace
r_const
r_char
op_star
id|pathspec
(braket
l_int|2
)braket
suffix:semicolon
id|blame_file
op_assign
id|pathname
suffix:semicolon
id|pathspec
(braket
l_int|0
)braket
op_assign
id|pathname
suffix:semicolon
id|pathspec
(braket
l_int|1
)braket
op_assign
l_int|NULL
suffix:semicolon
id|hashclr
c_func
(paren
id|blob_sha1
)paren
suffix:semicolon
id|read_tree_recursive
c_func
(paren
id|t
comma
l_string|&quot;&quot;
comma
l_int|0
comma
l_int|0
comma
id|pathspec
comma
id|get_blob_sha1_internal
)paren
suffix:semicolon
r_if
c_cond
(paren
id|is_null_sha1
c_func
(paren
id|blob_sha1
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|hashcpy
c_func
(paren
id|sha1
comma
id|blob_sha1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|get_blob_sha1_internal
r_static
r_int
id|get_blob_sha1_internal
c_func
(paren
r_const
r_int
r_char
op_star
id|sha1
comma
r_const
r_char
op_star
id|base
comma
r_int
id|baselen
comma
r_const
r_char
op_star
id|pathname
comma
r_int
id|mode
comma
r_int
id|stage
)paren
(brace
r_if
c_cond
(paren
id|S_ISDIR
c_func
(paren
id|mode
)paren
)paren
r_return
id|READ_TREE_RECURSIVE
suffix:semicolon
r_if
c_cond
(paren
id|strncmp
c_func
(paren
id|blame_file
comma
id|base
comma
id|baselen
)paren
op_logical_or
id|strcmp
c_func
(paren
id|blame_file
op_plus
id|baselen
comma
id|pathname
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|hashcpy
c_func
(paren
id|blob_sha1
comma
id|sha1
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|get_blob
r_static
r_void
id|get_blob
c_func
(paren
r_struct
id|commit
op_star
id|commit
)paren
(brace
r_struct
id|util_info
op_star
id|info
op_assign
id|commit-&gt;util
suffix:semicolon
r_char
id|type
(braket
l_int|20
)braket
suffix:semicolon
r_if
c_cond
(paren
id|info-&gt;buf
)paren
r_return
suffix:semicolon
id|info-&gt;buf
op_assign
id|read_sha1_file
c_func
(paren
id|info-&gt;sha1
comma
id|type
comma
op_amp
id|info-&gt;size
)paren
suffix:semicolon
m_assert
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|type
comma
id|blob_type
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* For debugging only */
DECL|function|print_patch
r_static
r_void
id|print_patch
c_func
(paren
r_struct
id|patch
op_star
id|p
)paren
(brace
r_int
id|i
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;Num chunks: %d&bslash;n&quot;
comma
id|p-&gt;num
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|p-&gt;num
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printf
c_func
(paren
l_string|&quot;%d,%d %d,%d&bslash;n&quot;
comma
id|p-&gt;chunks
(braket
id|i
)braket
dot
id|off1
comma
id|p-&gt;chunks
(braket
id|i
)braket
dot
id|len1
comma
id|p-&gt;chunks
(braket
id|i
)braket
dot
id|off2
comma
id|p-&gt;chunks
(braket
id|i
)braket
dot
id|len2
)paren
suffix:semicolon
)brace
)brace
macro_line|#if DEBUG
multiline_comment|/* For debugging only */
DECL|function|print_map
r_static
r_void
id|print_map
c_func
(paren
r_struct
id|commit
op_star
id|cmit
comma
r_struct
id|commit
op_star
id|other
)paren
(brace
r_struct
id|util_info
op_star
id|util
op_assign
id|cmit-&gt;util
suffix:semicolon
r_struct
id|util_info
op_star
id|util2
op_assign
id|other-&gt;util
suffix:semicolon
r_int
id|i
suffix:semicolon
r_int
id|max
op_assign
id|util-&gt;num_lines
OG
id|util2-&gt;num_lines
ques
c_cond
id|util-&gt;num_lines
suffix:colon
id|util2-&gt;num_lines
suffix:semicolon
r_int
id|num
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|max
suffix:semicolon
id|i
op_increment
)paren
(brace
id|printf
c_func
(paren
l_string|&quot;i: %d &quot;
comma
id|i
)paren
suffix:semicolon
id|num
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
id|util-&gt;num_lines
)paren
(brace
id|num
op_assign
id|util-&gt;line_map
(braket
id|i
)braket
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;%d&bslash;t&quot;
comma
id|num
)paren
suffix:semicolon
)brace
r_else
id|printf
c_func
(paren
l_string|&quot;&bslash;t&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
id|util2-&gt;num_lines
)paren
(brace
r_int
id|num2
op_assign
id|util2-&gt;line_map
(braket
id|i
)braket
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;%d&bslash;t&quot;
comma
id|num2
)paren
suffix:semicolon
r_if
c_cond
(paren
id|num
op_ne
l_int|1
op_logical_and
id|num2
op_ne
id|num
)paren
id|printf
c_func
(paren
l_string|&quot;---&quot;
)paren
suffix:semicolon
)brace
r_else
id|printf
c_func
(paren
l_string|&quot;&bslash;t&quot;
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
)brace
)brace
macro_line|#endif
multiline_comment|/* p is a patch from commit to other. */
DECL|function|fill_line_map
r_static
r_void
id|fill_line_map
c_func
(paren
r_struct
id|commit
op_star
id|commit
comma
r_struct
id|commit
op_star
id|other
comma
r_struct
id|patch
op_star
id|p
)paren
(brace
r_struct
id|util_info
op_star
id|util
op_assign
id|commit-&gt;util
suffix:semicolon
r_struct
id|util_info
op_star
id|util2
op_assign
id|other-&gt;util
suffix:semicolon
r_int
op_star
id|map
op_assign
id|util-&gt;line_map
suffix:semicolon
r_int
op_star
id|map2
op_assign
id|util2-&gt;line_map
suffix:semicolon
r_int
id|cur_chunk
op_assign
l_int|0
suffix:semicolon
r_int
id|i1
comma
id|i2
suffix:semicolon
r_if
c_cond
(paren
id|DEBUG
)paren
(brace
r_if
c_cond
(paren
id|p-&gt;num
)paren
id|print_patch
c_func
(paren
id|p
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;num lines 1: %d num lines 2: %d&bslash;n&quot;
comma
id|util-&gt;num_lines
comma
id|util2-&gt;num_lines
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i1
op_assign
l_int|0
comma
id|i2
op_assign
l_int|0
suffix:semicolon
id|i1
OL
id|util-&gt;num_lines
suffix:semicolon
id|i1
op_increment
comma
id|i2
op_increment
)paren
(brace
r_struct
id|chunk
op_star
id|chunk
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|cur_chunk
OL
id|p-&gt;num
)paren
id|chunk
op_assign
op_amp
id|p-&gt;chunks
(braket
id|cur_chunk
)braket
suffix:semicolon
r_if
c_cond
(paren
id|chunk
op_logical_and
id|chunk-&gt;off1
op_eq
id|i1
)paren
(brace
r_if
c_cond
(paren
id|DEBUG
op_logical_and
id|i2
op_ne
id|chunk-&gt;off2
)paren
id|printf
c_func
(paren
l_string|&quot;i2: %d off2: %d&bslash;n&quot;
comma
id|i2
comma
id|chunk-&gt;off2
)paren
suffix:semicolon
m_assert
(paren
id|i2
op_eq
id|chunk-&gt;off2
)paren
suffix:semicolon
id|i1
op_decrement
suffix:semicolon
id|i2
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|chunk-&gt;len1
OG
l_int|0
)paren
id|i1
op_add_assign
id|chunk-&gt;len1
suffix:semicolon
r_if
c_cond
(paren
id|chunk-&gt;len2
OG
l_int|0
)paren
id|i2
op_add_assign
id|chunk-&gt;len2
suffix:semicolon
id|cur_chunk
op_increment
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|i2
op_ge
id|util2-&gt;num_lines
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|map
(braket
id|i1
)braket
op_ne
id|map2
(braket
id|i2
)braket
op_logical_and
id|map
(braket
id|i1
)braket
op_ne
l_int|1
)paren
(brace
r_if
c_cond
(paren
id|DEBUG
)paren
id|printf
c_func
(paren
l_string|&quot;map: i1: %d %d %p i2: %d %d %p&bslash;n&quot;
comma
id|i1
comma
id|map
(braket
id|i1
)braket
comma
(paren
r_void
op_star
)paren
(paren
id|i1
op_ne
l_int|1
ques
c_cond
id|blame_lines
(braket
id|map
(braket
id|i1
)braket
)braket
suffix:colon
l_int|NULL
)paren
comma
id|i2
comma
id|map2
(braket
id|i2
)braket
comma
(paren
r_void
op_star
)paren
(paren
id|i2
op_ne
l_int|1
ques
c_cond
id|blame_lines
(braket
id|map2
(braket
id|i2
)braket
)braket
suffix:colon
l_int|NULL
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|map2
(braket
id|i2
)braket
op_ne
l_int|1
op_logical_and
id|blame_lines
(braket
id|map
(braket
id|i1
)braket
)braket
op_logical_and
op_logical_neg
id|blame_lines
(braket
id|map2
(braket
id|i2
)braket
)braket
)paren
id|map
(braket
id|i1
)braket
op_assign
id|map2
(braket
id|i2
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
id|map
(braket
id|i1
)braket
op_eq
l_int|1
op_logical_and
id|map2
(braket
id|i2
)braket
op_ne
l_int|1
)paren
id|map
(braket
id|i1
)braket
op_assign
id|map2
(braket
id|i2
)braket
suffix:semicolon
)brace
r_if
c_cond
(paren
id|DEBUG
OG
l_int|1
)paren
id|printf
c_func
(paren
l_string|&quot;l1: %d l2: %d i1: %d i2: %d&bslash;n&quot;
comma
id|map
(braket
id|i1
)braket
comma
id|map2
(braket
id|i2
)braket
comma
id|i1
comma
id|i2
)paren
suffix:semicolon
)brace
)brace
DECL|function|map_line
r_static
r_int
id|map_line
c_func
(paren
r_struct
id|commit
op_star
id|commit
comma
r_int
id|line
)paren
(brace
r_struct
id|util_info
op_star
id|info
op_assign
id|commit-&gt;util
suffix:semicolon
m_assert
(paren
id|line
op_ge
l_int|0
op_logical_and
id|line
OL
id|info-&gt;num_lines
)paren
suffix:semicolon
r_return
id|info-&gt;line_map
(braket
id|line
)braket
suffix:semicolon
)brace
DECL|function|get_util
r_static
r_struct
id|util_info
op_star
id|get_util
c_func
(paren
r_struct
id|commit
op_star
id|commit
)paren
(brace
r_struct
id|util_info
op_star
id|util
op_assign
id|commit-&gt;util
suffix:semicolon
r_if
c_cond
(paren
id|util
)paren
r_return
id|util
suffix:semicolon
id|util
op_assign
id|xmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|util_info
)paren
)paren
suffix:semicolon
id|util-&gt;buf
op_assign
l_int|NULL
suffix:semicolon
id|util-&gt;size
op_assign
l_int|0
suffix:semicolon
id|util-&gt;line_map
op_assign
l_int|NULL
suffix:semicolon
id|util-&gt;num_lines
op_assign
l_int|1
suffix:semicolon
id|util-&gt;pathname
op_assign
l_int|NULL
suffix:semicolon
id|commit-&gt;util
op_assign
id|util
suffix:semicolon
r_return
id|util
suffix:semicolon
)brace
DECL|function|fill_util_info
r_static
r_int
id|fill_util_info
c_func
(paren
r_struct
id|commit
op_star
id|commit
)paren
(brace
r_struct
id|util_info
op_star
id|util
op_assign
id|commit-&gt;util
suffix:semicolon
m_assert
(paren
id|util
)paren
suffix:semicolon
m_assert
(paren
id|util-&gt;pathname
)paren
suffix:semicolon
r_return
op_logical_neg
op_logical_neg
id|get_blob_sha1
c_func
(paren
id|commit-&gt;tree
comma
id|util-&gt;pathname
comma
id|util-&gt;sha1
)paren
suffix:semicolon
)brace
DECL|function|alloc_line_map
r_static
r_void
id|alloc_line_map
c_func
(paren
r_struct
id|commit
op_star
id|commit
)paren
(brace
r_struct
id|util_info
op_star
id|util
op_assign
id|commit-&gt;util
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|util-&gt;line_map
)paren
r_return
suffix:semicolon
id|get_blob
c_func
(paren
id|commit
)paren
suffix:semicolon
id|util-&gt;num_lines
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|util-&gt;size
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|util-&gt;buf
(braket
id|i
)braket
op_eq
l_char|&squot;&bslash;n&squot;
)paren
id|util-&gt;num_lines
op_increment
suffix:semicolon
)brace
r_if
c_cond
(paren
id|util-&gt;buf
(braket
id|util-&gt;size
l_int|1
)braket
op_ne
l_char|&squot;&bslash;n&squot;
)paren
id|util-&gt;num_lines
op_increment
suffix:semicolon
id|util-&gt;line_map
op_assign
id|xmalloc
c_func
(paren
r_sizeof
(paren
r_int
)paren
op_star
id|util-&gt;num_lines
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|util-&gt;num_lines
suffix:semicolon
id|i
op_increment
)paren
id|util-&gt;line_map
(braket
id|i
)braket
op_assign
l_int|1
suffix:semicolon
)brace
DECL|function|init_first_commit
r_static
r_void
id|init_first_commit
c_func
(paren
r_struct
id|commit
op_star
id|commit
comma
r_const
r_char
op_star
id|filename
)paren
(brace
r_struct
id|util_info
op_star
id|util
op_assign
id|commit-&gt;util
suffix:semicolon
r_int
id|i
suffix:semicolon
id|util-&gt;pathname
op_assign
id|filename
suffix:semicolon
r_if
c_cond
(paren
id|fill_util_info
c_func
(paren
id|commit
)paren
)paren
id|die
c_func
(paren
l_string|&quot;fill_util_info failed&quot;
)paren
suffix:semicolon
id|alloc_line_map
c_func
(paren
id|commit
)paren
suffix:semicolon
id|util
op_assign
id|commit-&gt;util
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|util-&gt;num_lines
suffix:semicolon
id|i
op_increment
)paren
id|util-&gt;line_map
(braket
id|i
)braket
op_assign
id|i
suffix:semicolon
)brace
DECL|function|process_commits
r_static
r_void
id|process_commits
c_func
(paren
r_struct
id|rev_info
op_star
id|rev
comma
r_const
r_char
op_star
id|path
comma
r_struct
id|commit
op_star
op_star
id|initial
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|util_info
op_star
id|util
suffix:semicolon
r_int
id|lines_left
suffix:semicolon
r_int
op_star
id|blame_p
suffix:semicolon
r_int
op_star
id|new_lines
suffix:semicolon
r_int
id|new_lines_len
suffix:semicolon
r_struct
id|commit
op_star
id|commit
op_assign
id|get_revision
c_func
(paren
id|rev
)paren
suffix:semicolon
m_assert
(paren
id|commit
)paren
suffix:semicolon
id|init_first_commit
c_func
(paren
id|commit
comma
id|path
)paren
suffix:semicolon
id|util
op_assign
id|commit-&gt;util
suffix:semicolon
id|num_blame_lines
op_assign
id|util-&gt;num_lines
suffix:semicolon
id|blame_lines
op_assign
id|xmalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|commit
op_star
)paren
op_star
id|num_blame_lines
)paren
suffix:semicolon
id|blame_contents
op_assign
id|util-&gt;buf
suffix:semicolon
id|blame_len
op_assign
id|util-&gt;size
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num_blame_lines
suffix:semicolon
id|i
op_increment
)paren
id|blame_lines
(braket
id|i
)braket
op_assign
l_int|NULL
suffix:semicolon
id|lines_left
op_assign
id|num_blame_lines
suffix:semicolon
id|blame_p
op_assign
id|xmalloc
c_func
(paren
r_sizeof
(paren
r_int
)paren
op_star
id|num_blame_lines
)paren
suffix:semicolon
id|new_lines
op_assign
id|xmalloc
c_func
(paren
r_sizeof
(paren
r_int
)paren
op_star
id|num_blame_lines
)paren
suffix:semicolon
r_do
(brace
r_struct
id|commit_list
op_star
id|parents
suffix:semicolon
r_int
id|num_parents
suffix:semicolon
r_struct
id|util_info
op_star
id|util
suffix:semicolon
r_if
c_cond
(paren
id|DEBUG
)paren
id|printf
c_func
(paren
l_string|&quot;&bslash;nProcessing commit: %d %s&bslash;n&quot;
comma
id|num_commits
comma
id|sha1_to_hex
c_func
(paren
id|commit-&gt;object.sha1
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|lines_left
op_eq
l_int|0
)paren
r_return
suffix:semicolon
id|num_commits
op_increment
suffix:semicolon
id|memset
c_func
(paren
id|blame_p
comma
l_int|0
comma
r_sizeof
(paren
r_int
)paren
op_star
id|num_blame_lines
)paren
suffix:semicolon
id|new_lines_len
op_assign
l_int|0
suffix:semicolon
id|num_parents
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|parents
op_assign
id|commit-&gt;parents
suffix:semicolon
id|parents
op_ne
l_int|NULL
suffix:semicolon
id|parents
op_assign
id|parents-&gt;next
)paren
id|num_parents
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|num_parents
op_eq
l_int|0
)paren
op_star
id|initial
op_assign
id|commit
suffix:semicolon
r_if
c_cond
(paren
id|fill_util_info
c_func
(paren
id|commit
)paren
)paren
r_continue
suffix:semicolon
id|alloc_line_map
c_func
(paren
id|commit
)paren
suffix:semicolon
id|util
op_assign
id|commit-&gt;util
suffix:semicolon
r_for
c_loop
(paren
id|parents
op_assign
id|commit-&gt;parents
suffix:semicolon
id|parents
op_ne
l_int|NULL
suffix:semicolon
id|parents
op_assign
id|parents-&gt;next
)paren
(brace
r_struct
id|commit
op_star
id|parent
op_assign
id|parents-&gt;item
suffix:semicolon
r_struct
id|patch
op_star
id|patch
suffix:semicolon
r_if
c_cond
(paren
id|parse_commit
c_func
(paren
id|parent
)paren
OL
l_int|0
)paren
id|die
c_func
(paren
l_string|&quot;parse_commit error&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|DEBUG
)paren
id|printf
c_func
(paren
l_string|&quot;parent: %s&bslash;n&quot;
comma
id|sha1_to_hex
c_func
(paren
id|parent-&gt;object.sha1
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fill_util_info
c_func
(paren
id|parent
)paren
)paren
(brace
id|num_parents
op_decrement
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|patch
op_assign
id|get_patch
c_func
(paren
id|parent
comma
id|commit
)paren
suffix:semicolon
id|alloc_line_map
c_func
(paren
id|parent
)paren
suffix:semicolon
id|fill_line_map
c_func
(paren
id|parent
comma
id|commit
comma
id|patch
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|patch-&gt;num
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|l
suffix:semicolon
r_for
c_loop
(paren
id|l
op_assign
l_int|0
suffix:semicolon
id|l
OL
id|patch-&gt;chunks
(braket
id|i
)braket
dot
id|len2
suffix:semicolon
id|l
op_increment
)paren
(brace
r_int
id|mapped_line
op_assign
id|map_line
c_func
(paren
id|commit
comma
id|patch-&gt;chunks
(braket
id|i
)braket
dot
id|off2
op_plus
id|l
)paren
suffix:semicolon
r_if
c_cond
(paren
id|mapped_line
op_ne
l_int|1
)paren
(brace
id|blame_p
(braket
id|mapped_line
)braket
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|blame_p
(braket
id|mapped_line
)braket
op_eq
id|num_parents
)paren
id|new_lines
(braket
id|new_lines_len
op_increment
)braket
op_assign
id|mapped_line
suffix:semicolon
)brace
)brace
)brace
id|free_patch
c_func
(paren
id|patch
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|DEBUG
)paren
id|printf
c_func
(paren
l_string|&quot;parents: %d&bslash;n&quot;
comma
id|num_parents
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|new_lines_len
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|mapped_line
op_assign
id|new_lines
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|blame_lines
(braket
id|mapped_line
)braket
op_eq
l_int|NULL
)paren
(brace
id|blame_lines
(braket
id|mapped_line
)braket
op_assign
id|commit
suffix:semicolon
id|lines_left
op_decrement
suffix:semicolon
r_if
c_cond
(paren
id|DEBUG
)paren
id|printf
c_func
(paren
l_string|&quot;blame: mapped: %d i: %d&bslash;n&quot;
comma
id|mapped_line
comma
id|i
)paren
suffix:semicolon
)brace
)brace
)brace
r_while
c_loop
(paren
(paren
id|commit
op_assign
id|get_revision
c_func
(paren
id|rev
)paren
)paren
op_ne
l_int|NULL
)paren
suffix:semicolon
)brace
DECL|function|compare_tree_path
r_static
r_int
id|compare_tree_path
c_func
(paren
r_struct
id|rev_info
op_star
id|revs
comma
r_struct
id|commit
op_star
id|c1
comma
r_struct
id|commit
op_star
id|c2
)paren
(brace
r_int
id|ret
suffix:semicolon
r_const
r_char
op_star
id|paths
(braket
l_int|2
)braket
suffix:semicolon
r_struct
id|util_info
op_star
id|util
op_assign
id|c2-&gt;util
suffix:semicolon
id|paths
(braket
l_int|0
)braket
op_assign
id|util-&gt;pathname
suffix:semicolon
id|paths
(braket
l_int|1
)braket
op_assign
l_int|NULL
suffix:semicolon
id|diff_tree_setup_paths
c_func
(paren
id|get_pathspec
c_func
(paren
id|revs-&gt;prefix
comma
id|paths
)paren
comma
op_amp
id|revs-&gt;pruning
)paren
suffix:semicolon
id|ret
op_assign
id|rev_compare_tree
c_func
(paren
id|revs
comma
id|c1-&gt;tree
comma
id|c2-&gt;tree
)paren
suffix:semicolon
id|diff_tree_release_paths
c_func
(paren
op_amp
id|revs-&gt;pruning
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|same_tree_as_empty_path
r_static
r_int
id|same_tree_as_empty_path
c_func
(paren
r_struct
id|rev_info
op_star
id|revs
comma
r_struct
id|tree
op_star
id|t1
comma
r_const
r_char
op_star
id|path
)paren
(brace
r_int
id|ret
suffix:semicolon
r_const
r_char
op_star
id|paths
(braket
l_int|2
)braket
suffix:semicolon
id|paths
(braket
l_int|0
)braket
op_assign
id|path
suffix:semicolon
id|paths
(braket
l_int|1
)braket
op_assign
l_int|NULL
suffix:semicolon
id|diff_tree_setup_paths
c_func
(paren
id|get_pathspec
c_func
(paren
id|revs-&gt;prefix
comma
id|paths
)paren
comma
op_amp
id|revs-&gt;pruning
)paren
suffix:semicolon
id|ret
op_assign
id|rev_same_tree_as_empty
c_func
(paren
id|revs
comma
id|t1
)paren
suffix:semicolon
id|diff_tree_release_paths
c_func
(paren
op_amp
id|revs-&gt;pruning
)paren
suffix:semicolon
r_return
id|ret
suffix:semicolon
)brace
DECL|function|find_rename
r_static
r_const
r_char
op_star
id|find_rename
c_func
(paren
r_struct
id|commit
op_star
id|commit
comma
r_struct
id|commit
op_star
id|parent
)paren
(brace
r_struct
id|util_info
op_star
id|cutil
op_assign
id|commit-&gt;util
suffix:semicolon
r_struct
id|diff_options
id|diff_opts
suffix:semicolon
r_const
r_char
op_star
id|paths
(braket
l_int|1
)braket
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
id|DEBUG
)paren
(brace
id|printf
c_func
(paren
l_string|&quot;find_rename commit: %s &quot;
comma
id|sha1_to_hex
c_func
(paren
id|commit-&gt;object.sha1
)paren
)paren
suffix:semicolon
id|puts
c_func
(paren
id|sha1_to_hex
c_func
(paren
id|parent-&gt;object.sha1
)paren
)paren
suffix:semicolon
)brace
id|diff_setup
c_func
(paren
op_amp
id|diff_opts
)paren
suffix:semicolon
id|diff_opts.recursive
op_assign
l_int|1
suffix:semicolon
id|diff_opts.detect_rename
op_assign
id|DIFF_DETECT_RENAME
suffix:semicolon
id|paths
(braket
l_int|0
)braket
op_assign
l_int|NULL
suffix:semicolon
id|diff_tree_setup_paths
c_func
(paren
id|paths
comma
op_amp
id|diff_opts
)paren
suffix:semicolon
r_if
c_cond
(paren
id|diff_setup_done
c_func
(paren
op_amp
id|diff_opts
)paren
OL
l_int|0
)paren
id|die
c_func
(paren
l_string|&quot;diff_setup_done failed&quot;
)paren
suffix:semicolon
id|diff_tree_sha1
c_func
(paren
id|commit-&gt;tree-&gt;object.sha1
comma
id|parent-&gt;tree-&gt;object.sha1
comma
l_string|&quot;&quot;
comma
op_amp
id|diff_opts
)paren
suffix:semicolon
id|diffcore_std
c_func
(paren
op_amp
id|diff_opts
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|diff_queued_diff.nr
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|diff_filepair
op_star
id|p
op_assign
id|diff_queued_diff.queue
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;status
op_eq
l_char|&squot;R&squot;
op_logical_and
op_logical_neg
id|strcmp
c_func
(paren
id|p-&gt;one-&gt;path
comma
id|cutil-&gt;pathname
)paren
)paren
(brace
r_if
c_cond
(paren
id|DEBUG
)paren
id|printf
c_func
(paren
l_string|&quot;rename %s -&gt; %s&bslash;n&quot;
comma
id|p-&gt;one-&gt;path
comma
id|p-&gt;two-&gt;path
)paren
suffix:semicolon
r_return
id|p-&gt;two-&gt;path
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|simplify_commit
r_static
r_void
id|simplify_commit
c_func
(paren
r_struct
id|rev_info
op_star
id|revs
comma
r_struct
id|commit
op_star
id|commit
)paren
(brace
r_struct
id|commit_list
op_star
op_star
id|pp
comma
op_star
id|parent
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|commit-&gt;tree
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|commit-&gt;parents
)paren
(brace
r_struct
id|util_info
op_star
id|util
op_assign
id|commit-&gt;util
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|same_tree_as_empty_path
c_func
(paren
id|revs
comma
id|commit-&gt;tree
comma
id|util-&gt;pathname
)paren
)paren
id|commit-&gt;object.flags
op_or_assign
id|TREECHANGE
suffix:semicolon
r_return
suffix:semicolon
)brace
id|pp
op_assign
op_amp
id|commit-&gt;parents
suffix:semicolon
r_while
c_loop
(paren
(paren
id|parent
op_assign
op_star
id|pp
)paren
op_ne
l_int|NULL
)paren
(brace
r_struct
id|commit
op_star
id|p
op_assign
id|parent-&gt;item
suffix:semicolon
r_if
c_cond
(paren
id|p-&gt;object.flags
op_amp
id|UNINTERESTING
)paren
(brace
id|pp
op_assign
op_amp
id|parent-&gt;next
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|parse_commit
c_func
(paren
id|p
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|compare_tree_path
c_func
(paren
id|revs
comma
id|p
comma
id|commit
)paren
)paren
(brace
r_case
id|REV_TREE_SAME
suffix:colon
id|parent-&gt;next
op_assign
l_int|NULL
suffix:semicolon
id|commit-&gt;parents
op_assign
id|parent
suffix:semicolon
id|get_util
c_func
(paren
id|p
)paren
op_member_access_from_pointer
id|pathname
op_assign
id|get_util
c_func
(paren
id|commit
)paren
op_member_access_from_pointer
id|pathname
suffix:semicolon
r_return
suffix:semicolon
r_case
id|REV_TREE_NEW
suffix:colon
(brace
r_struct
id|util_info
op_star
id|util
op_assign
id|commit-&gt;util
suffix:semicolon
r_if
c_cond
(paren
id|revs-&gt;remove_empty_trees
op_logical_and
id|same_tree_as_empty_path
c_func
(paren
id|revs
comma
id|p-&gt;tree
comma
id|util-&gt;pathname
)paren
)paren
(brace
r_const
r_char
op_star
id|new_name
op_assign
id|find_rename
c_func
(paren
id|commit
comma
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
id|new_name
)paren
(brace
r_struct
id|util_info
op_star
id|putil
op_assign
id|get_util
c_func
(paren
id|p
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|putil-&gt;pathname
)paren
id|putil-&gt;pathname
op_assign
id|xstrdup
c_func
(paren
id|new_name
)paren
suffix:semicolon
)brace
r_else
(brace
op_star
id|pp
op_assign
id|parent-&gt;next
suffix:semicolon
r_continue
suffix:semicolon
)brace
)brace
)brace
multiline_comment|/* fallthrough */
r_case
id|REV_TREE_DIFFERENT
suffix:colon
id|pp
op_assign
op_amp
id|parent-&gt;next
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|get_util
c_func
(paren
id|p
)paren
op_member_access_from_pointer
id|pathname
)paren
id|get_util
c_func
(paren
id|p
)paren
op_member_access_from_pointer
id|pathname
op_assign
id|get_util
c_func
(paren
id|commit
)paren
op_member_access_from_pointer
id|pathname
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|die
c_func
(paren
l_string|&quot;bad tree compare for commit %s&quot;
comma
id|sha1_to_hex
c_func
(paren
id|commit-&gt;object.sha1
)paren
)paren
suffix:semicolon
)brace
id|commit-&gt;object.flags
op_or_assign
id|TREECHANGE
suffix:semicolon
)brace
DECL|struct|commit_info
r_struct
id|commit_info
(brace
DECL|member|author
r_char
op_star
id|author
suffix:semicolon
DECL|member|author_mail
r_char
op_star
id|author_mail
suffix:semicolon
DECL|member|author_time
r_int
r_int
id|author_time
suffix:semicolon
DECL|member|author_tz
r_char
op_star
id|author_tz
suffix:semicolon
)brace
suffix:semicolon
DECL|function|get_commit_info
r_static
r_void
id|get_commit_info
c_func
(paren
r_struct
id|commit
op_star
id|commit
comma
r_struct
id|commit_info
op_star
id|ret
)paren
(brace
r_int
id|len
suffix:semicolon
r_char
op_star
id|tmp
suffix:semicolon
r_static
r_char
id|author_buf
(braket
l_int|1024
)braket
suffix:semicolon
id|tmp
op_assign
id|strstr
c_func
(paren
id|commit-&gt;buffer
comma
l_string|&quot;&bslash;nauthor &quot;
)paren
op_plus
l_int|8
suffix:semicolon
id|len
op_assign
id|strchr
c_func
(paren
id|tmp
comma
l_char|&squot;&bslash;n&squot;
)paren
id|tmp
suffix:semicolon
id|ret-&gt;author
op_assign
id|author_buf
suffix:semicolon
id|memcpy
c_func
(paren
id|ret-&gt;author
comma
id|tmp
comma
id|len
)paren
suffix:semicolon
id|tmp
op_assign
id|ret-&gt;author
suffix:semicolon
id|tmp
op_add_assign
id|len
suffix:semicolon
op_star
id|tmp
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
op_star
id|tmp
op_ne
l_char|&squot; &squot;
)paren
id|tmp
op_decrement
suffix:semicolon
id|ret-&gt;author_tz
op_assign
id|tmp
op_plus
l_int|1
suffix:semicolon
op_star
id|tmp
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
op_star
id|tmp
op_ne
l_char|&squot; &squot;
)paren
id|tmp
op_decrement
suffix:semicolon
id|ret-&gt;author_time
op_assign
id|strtoul
c_func
(paren
id|tmp
comma
l_int|NULL
comma
l_int|10
)paren
suffix:semicolon
op_star
id|tmp
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
op_star
id|tmp
op_ne
l_char|&squot; &squot;
)paren
id|tmp
op_decrement
suffix:semicolon
id|ret-&gt;author_mail
op_assign
id|tmp
op_plus
l_int|1
suffix:semicolon
op_star
id|tmp
op_assign
l_int|0
suffix:semicolon
)brace
DECL|function|format_time
r_static
r_const
r_char
op_star
id|format_time
c_func
(paren
r_int
r_int
id|time
comma
r_const
r_char
op_star
id|tz_str
comma
r_int
id|show_raw_time
)paren
(brace
r_static
r_char
id|time_buf
(braket
l_int|128
)braket
suffix:semicolon
id|time_t
id|t
op_assign
id|time
suffix:semicolon
r_int
id|minutes
comma
id|tz
suffix:semicolon
r_struct
id|tm
op_star
id|tm
suffix:semicolon
r_if
c_cond
(paren
id|show_raw_time
)paren
(brace
id|sprintf
c_func
(paren
id|time_buf
comma
l_string|&quot;%lu %s&quot;
comma
id|time
comma
id|tz_str
)paren
suffix:semicolon
r_return
id|time_buf
suffix:semicolon
)brace
id|tz
op_assign
id|atoi
c_func
(paren
id|tz_str
)paren
suffix:semicolon
id|minutes
op_assign
id|tz
OL
l_int|0
ques
c_cond
id|tz
suffix:colon
id|tz
suffix:semicolon
id|minutes
op_assign
(paren
id|minutes
op_div
l_int|100
)paren
op_star
l_int|60
op_plus
(paren
id|minutes
op_mod
l_int|100
)paren
suffix:semicolon
id|minutes
op_assign
id|tz
OL
l_int|0
ques
c_cond
id|minutes
suffix:colon
id|minutes
suffix:semicolon
id|t
op_assign
id|time
op_plus
id|minutes
op_star
l_int|60
suffix:semicolon
id|tm
op_assign
id|gmtime
c_func
(paren
op_amp
id|t
)paren
suffix:semicolon
id|strftime
c_func
(paren
id|time_buf
comma
r_sizeof
(paren
id|time_buf
)paren
comma
l_string|&quot;%Y-%m-%d %H:%M:%S &quot;
comma
id|tm
)paren
suffix:semicolon
id|strcat
c_func
(paren
id|time_buf
comma
id|tz_str
)paren
suffix:semicolon
r_return
id|time_buf
suffix:semicolon
)brace
DECL|function|topo_setter
r_static
r_void
id|topo_setter
c_func
(paren
r_struct
id|commit
op_star
id|c
comma
r_void
op_star
id|data
)paren
(brace
r_struct
id|util_info
op_star
id|util
op_assign
id|c-&gt;util
suffix:semicolon
id|util-&gt;topo_data
op_assign
id|data
suffix:semicolon
)brace
DECL|function|topo_getter
r_static
r_void
op_star
id|topo_getter
c_func
(paren
r_struct
id|commit
op_star
id|c
)paren
(brace
r_struct
id|util_info
op_star
id|util
op_assign
id|c-&gt;util
suffix:semicolon
r_return
id|util-&gt;topo_data
suffix:semicolon
)brace
DECL|function|read_ancestry
r_static
r_int
id|read_ancestry
c_func
(paren
r_const
r_char
op_star
id|graft_file
comma
r_int
r_char
op_star
op_star
id|start_sha1
)paren
(brace
id|FILE
op_star
id|fp
op_assign
id|fopen
c_func
(paren
id|graft_file
comma
l_string|&quot;r&quot;
)paren
suffix:semicolon
r_char
id|buf
(braket
l_int|1024
)braket
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fp
)paren
r_return
l_int|1
suffix:semicolon
r_while
c_loop
(paren
id|fgets
c_func
(paren
id|buf
comma
r_sizeof
(paren
id|buf
)paren
comma
id|fp
)paren
)paren
(brace
multiline_comment|/* The format is just &quot;Commit Parent1 Parent2 ...&bslash;n&quot; */
r_int
id|len
op_assign
id|strlen
c_func
(paren
id|buf
)paren
suffix:semicolon
r_struct
id|commit_graft
op_star
id|graft
op_assign
id|read_graft_line
c_func
(paren
id|buf
comma
id|len
)paren
suffix:semicolon
id|register_commit_graft
c_func
(paren
id|graft
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_star
id|start_sha1
)paren
op_star
id|start_sha1
op_assign
id|graft-&gt;sha1
suffix:semicolon
)brace
id|fclose
c_func
(paren
id|fp
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|main
r_int
id|main
c_func
(paren
r_int
id|argc
comma
r_const
r_char
op_star
op_star
id|argv
)paren
(brace
r_int
id|i
suffix:semicolon
r_struct
id|commit
op_star
id|initial
op_assign
l_int|NULL
suffix:semicolon
r_int
r_char
id|sha1
(braket
l_int|20
)braket
comma
op_star
id|sha1_p
op_assign
l_int|NULL
suffix:semicolon
r_const
r_char
op_star
id|filename
op_assign
l_int|NULL
comma
op_star
id|commit
op_assign
l_int|NULL
suffix:semicolon
r_char
id|filename_buf
(braket
l_int|256
)braket
suffix:semicolon
r_int
id|sha1_len
op_assign
l_int|8
suffix:semicolon
r_int
id|compatibility
op_assign
l_int|0
suffix:semicolon
r_int
id|show_raw_time
op_assign
l_int|0
suffix:semicolon
r_int
id|options
op_assign
l_int|1
suffix:semicolon
r_struct
id|commit
op_star
id|start_commit
suffix:semicolon
r_const
r_char
op_star
id|args
(braket
l_int|10
)braket
suffix:semicolon
r_struct
id|rev_info
id|rev
suffix:semicolon
r_struct
id|commit_info
id|ci
suffix:semicolon
r_const
r_char
op_star
id|buf
suffix:semicolon
r_int
id|max_digits
suffix:semicolon
r_int
id|longest_file
comma
id|longest_author
suffix:semicolon
r_int
id|show_name
op_assign
l_int|0
suffix:semicolon
r_const
r_char
op_star
id|prefix
op_assign
id|setup_git_directory
c_func
(paren
)paren
suffix:semicolon
id|git_config
c_func
(paren
id|git_default_config
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|argc
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|options
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|argv
(braket
id|i
)braket
comma
l_string|&quot;-h&quot;
)paren
op_logical_or
op_logical_neg
id|strcmp
c_func
(paren
id|argv
(braket
id|i
)braket
comma
l_string|&quot;--help&quot;
)paren
)paren
id|usage
c_func
(paren
id|blame_usage
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|argv
(braket
id|i
)braket
comma
l_string|&quot;-l&quot;
)paren
op_logical_or
op_logical_neg
id|strcmp
c_func
(paren
id|argv
(braket
id|i
)braket
comma
l_string|&quot;--long&quot;
)paren
)paren
(brace
id|sha1_len
op_assign
l_int|40
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|argv
(braket
id|i
)braket
comma
l_string|&quot;-c&quot;
)paren
op_logical_or
op_logical_neg
id|strcmp
c_func
(paren
id|argv
(braket
id|i
)braket
comma
l_string|&quot;--compatibility&quot;
)paren
)paren
(brace
id|compatibility
op_assign
l_int|1
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|argv
(braket
id|i
)braket
comma
l_string|&quot;-t&quot;
)paren
op_logical_or
op_logical_neg
id|strcmp
c_func
(paren
id|argv
(braket
id|i
)braket
comma
l_string|&quot;--time&quot;
)paren
)paren
(brace
id|show_raw_time
op_assign
l_int|1
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|argv
(braket
id|i
)braket
comma
l_string|&quot;-S&quot;
)paren
)paren
(brace
r_if
c_cond
(paren
id|i
op_plus
l_int|1
OL
id|argc
op_logical_and
op_logical_neg
id|read_ancestry
c_func
(paren
id|argv
(braket
id|i
op_plus
l_int|1
)braket
comma
op_amp
id|sha1_p
)paren
)paren
(brace
id|compatibility
op_assign
l_int|1
suffix:semicolon
id|i
op_increment
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|usage
c_func
(paren
id|blame_usage
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|argv
(braket
id|i
)braket
comma
l_string|&quot;-f&quot;
)paren
op_logical_or
op_logical_neg
id|strcmp
c_func
(paren
id|argv
(braket
id|i
)braket
comma
l_string|&quot;--show-name&quot;
)paren
)paren
(brace
id|show_name
op_assign
l_int|1
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|argv
(braket
id|i
)braket
comma
l_string|&quot;--&quot;
)paren
)paren
(brace
id|options
op_assign
l_int|0
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_if
c_cond
(paren
id|argv
(braket
id|i
)braket
(braket
l_int|0
)braket
op_eq
l_char|&squot;-&squot;
)paren
id|usage
c_func
(paren
id|blame_usage
)paren
suffix:semicolon
id|options
op_assign
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|options
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|filename
)paren
id|filename
op_assign
id|argv
(braket
id|i
)braket
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|commit
)paren
id|commit
op_assign
id|argv
(braket
id|i
)braket
suffix:semicolon
r_else
id|usage
c_func
(paren
id|blame_usage
)paren
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|filename
)paren
id|usage
c_func
(paren
id|blame_usage
)paren
suffix:semicolon
r_if
c_cond
(paren
id|commit
op_logical_and
id|sha1_p
)paren
id|usage
c_func
(paren
id|blame_usage
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|commit
)paren
id|commit
op_assign
l_string|&quot;HEAD&quot;
suffix:semicolon
r_if
c_cond
(paren
id|prefix
)paren
id|sprintf
c_func
(paren
id|filename_buf
comma
l_string|&quot;%s%s&quot;
comma
id|prefix
comma
id|filename
)paren
suffix:semicolon
r_else
id|strcpy
c_func
(paren
id|filename_buf
comma
id|filename
)paren
suffix:semicolon
id|filename
op_assign
id|filename_buf
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|sha1_p
)paren
(brace
r_if
c_cond
(paren
id|get_sha1
c_func
(paren
id|commit
comma
id|sha1
)paren
)paren
id|die
c_func
(paren
l_string|&quot;get_sha1 failed, commit &squot;%s&squot; not found&quot;
comma
id|commit
)paren
suffix:semicolon
id|sha1_p
op_assign
id|sha1
suffix:semicolon
)brace
id|start_commit
op_assign
id|lookup_commit_reference
c_func
(paren
id|sha1_p
)paren
suffix:semicolon
id|get_util
c_func
(paren
id|start_commit
)paren
op_member_access_from_pointer
id|pathname
op_assign
id|filename
suffix:semicolon
r_if
c_cond
(paren
id|fill_util_info
c_func
(paren
id|start_commit
)paren
)paren
(brace
id|printf
c_func
(paren
l_string|&quot;%s not found in %s&bslash;n&quot;
comma
id|filename
comma
id|commit
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|init_revisions
c_func
(paren
op_amp
id|rev
comma
id|setup_git_directory
c_func
(paren
)paren
)paren
suffix:semicolon
id|rev.remove_empty_trees
op_assign
l_int|1
suffix:semicolon
id|rev.topo_order
op_assign
l_int|1
suffix:semicolon
id|rev.prune_fn
op_assign
id|simplify_commit
suffix:semicolon
id|rev.topo_setter
op_assign
id|topo_setter
suffix:semicolon
id|rev.topo_getter
op_assign
id|topo_getter
suffix:semicolon
id|rev.parents
op_assign
l_int|1
suffix:semicolon
id|rev.limited
op_assign
l_int|1
suffix:semicolon
id|commit_list_insert
c_func
(paren
id|start_commit
comma
op_amp
id|rev.commits
)paren
suffix:semicolon
id|args
(braket
l_int|0
)braket
op_assign
id|filename
suffix:semicolon
id|args
(braket
l_int|1
)braket
op_assign
l_int|NULL
suffix:semicolon
id|diff_tree_setup_paths
c_func
(paren
id|args
comma
op_amp
id|rev.pruning
)paren
suffix:semicolon
id|prepare_revision_walk
c_func
(paren
op_amp
id|rev
)paren
suffix:semicolon
id|process_commits
c_func
(paren
op_amp
id|rev
comma
id|filename
comma
op_amp
id|initial
)paren
suffix:semicolon
id|buf
op_assign
id|blame_contents
suffix:semicolon
r_for
c_loop
(paren
id|max_digits
op_assign
l_int|1
comma
id|i
op_assign
l_int|10
suffix:semicolon
id|i
op_le
id|num_blame_lines
op_plus
l_int|1
suffix:semicolon
id|max_digits
op_increment
)paren
id|i
op_mul_assign
l_int|10
suffix:semicolon
id|longest_file
op_assign
l_int|0
suffix:semicolon
id|longest_author
op_assign
l_int|0
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num_blame_lines
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|commit
op_star
id|c
op_assign
id|blame_lines
(braket
id|i
)braket
suffix:semicolon
r_struct
id|util_info
op_star
id|u
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|c
)paren
id|c
op_assign
id|initial
suffix:semicolon
id|u
op_assign
id|c-&gt;util
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|show_name
op_logical_and
id|strcmp
c_func
(paren
id|filename
comma
id|u-&gt;pathname
)paren
)paren
id|show_name
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|longest_file
OL
id|strlen
c_func
(paren
id|u-&gt;pathname
)paren
)paren
id|longest_file
op_assign
id|strlen
c_func
(paren
id|u-&gt;pathname
)paren
suffix:semicolon
id|get_commit_info
c_func
(paren
id|c
comma
op_amp
id|ci
)paren
suffix:semicolon
r_if
c_cond
(paren
id|longest_author
OL
id|strlen
c_func
(paren
id|ci.author
)paren
)paren
id|longest_author
op_assign
id|strlen
c_func
(paren
id|ci.author
)paren
suffix:semicolon
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|num_blame_lines
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|commit
op_star
id|c
op_assign
id|blame_lines
(braket
id|i
)braket
suffix:semicolon
r_struct
id|util_info
op_star
id|u
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|c
)paren
id|c
op_assign
id|initial
suffix:semicolon
id|u
op_assign
id|c-&gt;util
suffix:semicolon
id|get_commit_info
c_func
(paren
id|c
comma
op_amp
id|ci
)paren
suffix:semicolon
id|fwrite
c_func
(paren
id|sha1_to_hex
c_func
(paren
id|c-&gt;object.sha1
)paren
comma
id|sha1_len
comma
l_int|1
comma
id|stdout
)paren
suffix:semicolon
r_if
c_cond
(paren
id|compatibility
)paren
(brace
id|printf
c_func
(paren
l_string|&quot;&bslash;t(%10s&bslash;t%10s&bslash;t%d)&quot;
comma
id|ci.author
comma
id|format_time
c_func
(paren
id|ci.author_time
comma
id|ci.author_tz
comma
id|show_raw_time
)paren
comma
id|i
op_plus
l_int|1
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|show_name
)paren
id|printf
c_func
(paren
l_string|&quot; %-*.*s&quot;
comma
id|longest_file
comma
id|longest_file
comma
id|u-&gt;pathname
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot; (%-*.*s %10s %*d) &quot;
comma
id|longest_author
comma
id|longest_author
comma
id|ci.author
comma
id|format_time
c_func
(paren
id|ci.author_time
comma
id|ci.author_tz
comma
id|show_raw_time
)paren
comma
id|max_digits
comma
id|i
op_plus
l_int|1
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|i
op_eq
id|num_blame_lines
l_int|1
)paren
(brace
id|fwrite
c_func
(paren
id|buf
comma
id|blame_len
(paren
id|buf
id|blame_contents
)paren
comma
l_int|1
comma
id|stdout
)paren
suffix:semicolon
r_if
c_cond
(paren
id|blame_contents
(braket
id|blame_len
op_minus
l_int|1
)braket
op_ne
l_char|&squot;&bslash;n&squot;
)paren
id|putc
c_func
(paren
l_char|&squot;&bslash;n&squot;
comma
id|stdout
)paren
suffix:semicolon
)brace
r_else
(brace
r_char
op_star
id|next_buf
op_assign
id|strchr
c_func
(paren
id|buf
comma
l_char|&squot;&bslash;n&squot;
)paren
op_plus
l_int|1
suffix:semicolon
id|fwrite
c_func
(paren
id|buf
comma
id|next_buf
id|buf
comma
l_int|1
comma
id|stdout
)paren
suffix:semicolon
id|buf
op_assign
id|next_buf
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|DEBUG
)paren
(brace
id|printf
c_func
(paren
l_string|&quot;num get patch: %d&bslash;n&quot;
comma
id|num_get_patch
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;num commits: %d&bslash;n&quot;
comma
id|num_commits
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;patch time: %f&bslash;n&quot;
comma
id|patch_time
op_div
l_float|1000000.0
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;initial: %s&bslash;n&quot;
comma
id|sha1_to_hex
c_func
(paren
id|initial-&gt;object.sha1
)paren
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
eof
