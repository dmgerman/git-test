macro_line|#include &quot;cache.h&quot;
macro_line|#include &quot;string-list.h&quot;
macro_line|#include &quot;run-command.h&quot;
macro_line|#include &quot;commit.h&quot;
macro_line|#include &quot;trailer.h&quot;
multiline_comment|/*&n; * Copyright (c) 2013, 2014 Christian Couder &lt;chriscool@tuxfamily.org&gt;&n; */
DECL|enum|action_where
DECL|enumerator|WHERE_END
DECL|enumerator|WHERE_AFTER
DECL|enumerator|WHERE_BEFORE
DECL|enumerator|WHERE_START
r_enum
id|action_where
(brace
id|WHERE_END
comma
id|WHERE_AFTER
comma
id|WHERE_BEFORE
comma
id|WHERE_START
)brace
suffix:semicolon
DECL|enum|action_if_exists
DECL|enumerator|EXISTS_ADD_IF_DIFFERENT_NEIGHBOR
DECL|enumerator|EXISTS_ADD_IF_DIFFERENT
r_enum
id|action_if_exists
(brace
id|EXISTS_ADD_IF_DIFFERENT_NEIGHBOR
comma
id|EXISTS_ADD_IF_DIFFERENT
comma
DECL|enumerator|EXISTS_ADD
DECL|enumerator|EXISTS_REPLACE
DECL|enumerator|EXISTS_DO_NOTHING
id|EXISTS_ADD
comma
id|EXISTS_REPLACE
comma
id|EXISTS_DO_NOTHING
)brace
suffix:semicolon
DECL|enum|action_if_missing
DECL|enumerator|MISSING_ADD
DECL|enumerator|MISSING_DO_NOTHING
r_enum
id|action_if_missing
(brace
id|MISSING_ADD
comma
id|MISSING_DO_NOTHING
)brace
suffix:semicolon
DECL|struct|conf_info
r_struct
id|conf_info
(brace
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|member|key
r_char
op_star
id|key
suffix:semicolon
DECL|member|command
r_char
op_star
id|command
suffix:semicolon
DECL|member|where
r_enum
id|action_where
id|where
suffix:semicolon
DECL|member|if_exists
r_enum
id|action_if_exists
id|if_exists
suffix:semicolon
DECL|member|if_missing
r_enum
id|action_if_missing
id|if_missing
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|default_conf_info
r_static
r_struct
id|conf_info
id|default_conf_info
suffix:semicolon
DECL|struct|trailer_item
r_struct
id|trailer_item
(brace
DECL|member|previous
r_struct
id|trailer_item
op_star
id|previous
suffix:semicolon
DECL|member|next
r_struct
id|trailer_item
op_star
id|next
suffix:semicolon
DECL|member|token
r_const
r_char
op_star
id|token
suffix:semicolon
DECL|member|value
r_const
r_char
op_star
id|value
suffix:semicolon
DECL|member|conf
r_struct
id|conf_info
id|conf
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|first_conf_item
r_static
r_struct
id|trailer_item
op_star
id|first_conf_item
suffix:semicolon
DECL|variable|separators
r_static
r_char
op_star
id|separators
op_assign
l_string|&quot;:&quot;
suffix:semicolon
DECL|macro|TRAILER_ARG_STRING
mdefine_line|#define TRAILER_ARG_STRING &quot;$ARG&quot;
DECL|function|after_or_end
r_static
r_int
id|after_or_end
c_func
(paren
r_enum
id|action_where
id|where
)paren
(brace
r_return
(paren
id|where
op_eq
id|WHERE_AFTER
)paren
op_logical_or
(paren
id|where
op_eq
id|WHERE_END
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Return the length of the string not including any final&n; * punctuation. E.g., the input &quot;Signed-off-by:&quot; would return&n; * 13, stripping the trailing punctuation but retaining&n; * internal punctuation.&n; */
DECL|function|token_len_without_separator
r_static
r_int
id|token_len_without_separator
c_func
(paren
r_const
r_char
op_star
id|token
comma
r_int
id|len
)paren
(brace
r_while
c_loop
(paren
id|len
OG
l_int|0
op_logical_and
op_logical_neg
id|isalnum
c_func
(paren
id|token
(braket
id|len
l_int|1
)braket
)paren
)paren
id|len
op_decrement
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
DECL|function|same_token
r_static
r_int
id|same_token
c_func
(paren
r_struct
id|trailer_item
op_star
id|a
comma
r_struct
id|trailer_item
op_star
id|b
)paren
(brace
r_int
id|a_len
op_assign
id|token_len_without_separator
c_func
(paren
id|a-&gt;token
comma
id|strlen
c_func
(paren
id|a-&gt;token
)paren
)paren
suffix:semicolon
r_int
id|b_len
op_assign
id|token_len_without_separator
c_func
(paren
id|b-&gt;token
comma
id|strlen
c_func
(paren
id|b-&gt;token
)paren
)paren
suffix:semicolon
r_int
id|min_len
op_assign
(paren
id|a_len
OG
id|b_len
)paren
ques
c_cond
id|b_len
suffix:colon
id|a_len
suffix:semicolon
r_return
op_logical_neg
id|strncasecmp
c_func
(paren
id|a-&gt;token
comma
id|b-&gt;token
comma
id|min_len
)paren
suffix:semicolon
)brace
DECL|function|same_value
r_static
r_int
id|same_value
c_func
(paren
r_struct
id|trailer_item
op_star
id|a
comma
r_struct
id|trailer_item
op_star
id|b
)paren
(brace
r_return
op_logical_neg
id|strcasecmp
c_func
(paren
id|a-&gt;value
comma
id|b-&gt;value
)paren
suffix:semicolon
)brace
DECL|function|same_trailer
r_static
r_int
id|same_trailer
c_func
(paren
r_struct
id|trailer_item
op_star
id|a
comma
r_struct
id|trailer_item
op_star
id|b
)paren
(brace
r_return
id|same_token
c_func
(paren
id|a
comma
id|b
)paren
op_logical_and
id|same_value
c_func
(paren
id|a
comma
id|b
)paren
suffix:semicolon
)brace
DECL|function|contains_only_spaces
r_static
r_inline
r_int
id|contains_only_spaces
c_func
(paren
r_const
r_char
op_star
id|str
)paren
(brace
r_const
r_char
op_star
id|s
op_assign
id|str
suffix:semicolon
r_while
c_loop
(paren
op_star
id|s
op_logical_and
id|isspace
c_func
(paren
op_star
id|s
)paren
)paren
id|s
op_increment
suffix:semicolon
r_return
op_logical_neg
op_star
id|s
suffix:semicolon
)brace
DECL|function|strbuf_replace
r_static
r_inline
r_void
id|strbuf_replace
c_func
(paren
r_struct
id|strbuf
op_star
id|sb
comma
r_const
r_char
op_star
id|a
comma
r_const
r_char
op_star
id|b
)paren
(brace
r_const
r_char
op_star
id|ptr
op_assign
id|strstr
c_func
(paren
id|sb-&gt;buf
comma
id|a
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ptr
)paren
id|strbuf_splice
c_func
(paren
id|sb
comma
id|ptr
id|sb-&gt;buf
comma
id|strlen
c_func
(paren
id|a
)paren
comma
id|b
comma
id|strlen
c_func
(paren
id|b
)paren
)paren
suffix:semicolon
)brace
DECL|function|free_trailer_item
r_static
r_void
id|free_trailer_item
c_func
(paren
r_struct
id|trailer_item
op_star
id|item
)paren
(brace
id|free
c_func
(paren
id|item-&gt;conf.name
)paren
suffix:semicolon
id|free
c_func
(paren
id|item-&gt;conf.key
)paren
suffix:semicolon
id|free
c_func
(paren
id|item-&gt;conf.command
)paren
suffix:semicolon
id|free
c_func
(paren
(paren
r_char
op_star
)paren
id|item-&gt;token
)paren
suffix:semicolon
id|free
c_func
(paren
(paren
r_char
op_star
)paren
id|item-&gt;value
)paren
suffix:semicolon
id|free
c_func
(paren
id|item
)paren
suffix:semicolon
)brace
DECL|function|last_non_space_char
r_static
r_char
id|last_non_space_char
c_func
(paren
r_const
r_char
op_star
id|s
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|strlen
c_func
(paren
id|s
)paren
l_int|1
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
r_if
c_cond
(paren
op_logical_neg
id|isspace
c_func
(paren
id|s
(braket
id|i
)braket
)paren
)paren
r_return
id|s
(braket
id|i
)braket
suffix:semicolon
r_return
l_char|&squot;&bslash;0&squot;
suffix:semicolon
)brace
DECL|function|print_tok_val
r_static
r_void
id|print_tok_val
c_func
(paren
r_const
r_char
op_star
id|tok
comma
r_const
r_char
op_star
id|val
)paren
(brace
r_char
id|c
op_assign
id|last_non_space_char
c_func
(paren
id|tok
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|c
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
id|strchr
c_func
(paren
id|separators
comma
id|c
)paren
)paren
id|printf
c_func
(paren
l_string|&quot;%s%s&bslash;n&quot;
comma
id|tok
comma
id|val
)paren
suffix:semicolon
r_else
id|printf
c_func
(paren
l_string|&quot;%s%c %s&bslash;n&quot;
comma
id|tok
comma
id|separators
(braket
l_int|0
)braket
comma
id|val
)paren
suffix:semicolon
)brace
DECL|function|print_all
r_static
r_void
id|print_all
c_func
(paren
r_struct
id|trailer_item
op_star
id|first
comma
r_int
id|trim_empty
)paren
(brace
r_struct
id|trailer_item
op_star
id|item
suffix:semicolon
r_for
c_loop
(paren
id|item
op_assign
id|first
suffix:semicolon
id|item
suffix:semicolon
id|item
op_assign
id|item-&gt;next
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|trim_empty
op_logical_or
id|strlen
c_func
(paren
id|item-&gt;value
)paren
OG
l_int|0
)paren
id|print_tok_val
c_func
(paren
id|item-&gt;token
comma
id|item-&gt;value
)paren
suffix:semicolon
)brace
)brace
DECL|function|update_last
r_static
r_void
id|update_last
c_func
(paren
r_struct
id|trailer_item
op_star
op_star
id|last
)paren
(brace
r_if
c_cond
(paren
op_star
id|last
)paren
r_while
c_loop
(paren
(paren
op_star
id|last
)paren
op_member_access_from_pointer
id|next
op_ne
l_int|NULL
)paren
op_star
id|last
op_assign
(paren
op_star
id|last
)paren
op_member_access_from_pointer
id|next
suffix:semicolon
)brace
DECL|function|update_first
r_static
r_void
id|update_first
c_func
(paren
r_struct
id|trailer_item
op_star
op_star
id|first
)paren
(brace
r_if
c_cond
(paren
op_star
id|first
)paren
r_while
c_loop
(paren
(paren
op_star
id|first
)paren
op_member_access_from_pointer
id|previous
op_ne
l_int|NULL
)paren
op_star
id|first
op_assign
(paren
op_star
id|first
)paren
op_member_access_from_pointer
id|previous
suffix:semicolon
)brace
DECL|function|add_arg_to_input_list
r_static
r_void
id|add_arg_to_input_list
c_func
(paren
r_struct
id|trailer_item
op_star
id|on_tok
comma
r_struct
id|trailer_item
op_star
id|arg_tok
comma
r_struct
id|trailer_item
op_star
op_star
id|first
comma
r_struct
id|trailer_item
op_star
op_star
id|last
)paren
(brace
r_if
c_cond
(paren
id|after_or_end
c_func
(paren
id|arg_tok-&gt;conf.where
)paren
)paren
(brace
id|arg_tok-&gt;next
op_assign
id|on_tok-&gt;next
suffix:semicolon
id|on_tok-&gt;next
op_assign
id|arg_tok
suffix:semicolon
id|arg_tok-&gt;previous
op_assign
id|on_tok
suffix:semicolon
r_if
c_cond
(paren
id|arg_tok-&gt;next
)paren
id|arg_tok-&gt;next-&gt;previous
op_assign
id|arg_tok
suffix:semicolon
id|update_last
c_func
(paren
id|last
)paren
suffix:semicolon
)brace
r_else
(brace
id|arg_tok-&gt;previous
op_assign
id|on_tok-&gt;previous
suffix:semicolon
id|on_tok-&gt;previous
op_assign
id|arg_tok
suffix:semicolon
id|arg_tok-&gt;next
op_assign
id|on_tok
suffix:semicolon
r_if
c_cond
(paren
id|arg_tok-&gt;previous
)paren
id|arg_tok-&gt;previous-&gt;next
op_assign
id|arg_tok
suffix:semicolon
id|update_first
c_func
(paren
id|first
)paren
suffix:semicolon
)brace
)brace
DECL|function|check_if_different
r_static
r_int
id|check_if_different
c_func
(paren
r_struct
id|trailer_item
op_star
id|in_tok
comma
r_struct
id|trailer_item
op_star
id|arg_tok
comma
r_int
id|check_all
)paren
(brace
r_enum
id|action_where
id|where
op_assign
id|arg_tok-&gt;conf.where
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
op_logical_neg
id|in_tok
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|same_trailer
c_func
(paren
id|in_tok
comma
id|arg_tok
)paren
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t;&t; * if we want to add a trailer after another one,&n;&t;&t; * we have to check those before this one&n;&t;&t; */
id|in_tok
op_assign
id|after_or_end
c_func
(paren
id|where
)paren
ques
c_cond
id|in_tok-&gt;previous
suffix:colon
id|in_tok-&gt;next
suffix:semicolon
)brace
r_while
c_loop
(paren
id|check_all
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|remove_from_list
r_static
r_void
id|remove_from_list
c_func
(paren
r_struct
id|trailer_item
op_star
id|item
comma
r_struct
id|trailer_item
op_star
op_star
id|first
comma
r_struct
id|trailer_item
op_star
op_star
id|last
)paren
(brace
r_struct
id|trailer_item
op_star
id|next
op_assign
id|item-&gt;next
suffix:semicolon
r_struct
id|trailer_item
op_star
id|previous
op_assign
id|item-&gt;previous
suffix:semicolon
r_if
c_cond
(paren
id|next
)paren
(brace
id|item-&gt;next-&gt;previous
op_assign
id|previous
suffix:semicolon
id|item-&gt;next
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|last
)paren
op_star
id|last
op_assign
id|previous
suffix:semicolon
r_if
c_cond
(paren
id|previous
)paren
(brace
id|item-&gt;previous-&gt;next
op_assign
id|next
suffix:semicolon
id|item-&gt;previous
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|first
)paren
op_star
id|first
op_assign
id|next
suffix:semicolon
)brace
DECL|function|remove_first
r_static
r_struct
id|trailer_item
op_star
id|remove_first
c_func
(paren
r_struct
id|trailer_item
op_star
op_star
id|first
)paren
(brace
r_struct
id|trailer_item
op_star
id|item
op_assign
op_star
id|first
suffix:semicolon
op_star
id|first
op_assign
id|item-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|item-&gt;next
)paren
(brace
id|item-&gt;next-&gt;previous
op_assign
l_int|NULL
suffix:semicolon
id|item-&gt;next
op_assign
l_int|NULL
suffix:semicolon
)brace
r_return
id|item
suffix:semicolon
)brace
DECL|function|read_from_command
r_static
r_int
id|read_from_command
c_func
(paren
r_struct
id|child_process
op_star
id|cp
comma
r_struct
id|strbuf
op_star
id|buf
)paren
(brace
r_if
c_cond
(paren
id|run_command
c_func
(paren
id|cp
)paren
)paren
r_return
id|error
c_func
(paren
l_string|&quot;running trailer command &squot;%s&squot; failed&quot;
comma
id|cp-&gt;argv
(braket
l_int|0
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strbuf_read
c_func
(paren
id|buf
comma
id|cp-&gt;out
comma
l_int|1024
)paren
OL
l_int|1
)paren
r_return
id|error
c_func
(paren
l_string|&quot;reading from trailer command &squot;%s&squot; failed&quot;
comma
id|cp-&gt;argv
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|strbuf_trim
c_func
(paren
id|buf
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|apply_command
r_static
r_const
r_char
op_star
id|apply_command
c_func
(paren
r_const
r_char
op_star
id|command
comma
r_const
r_char
op_star
id|arg
)paren
(brace
r_struct
id|strbuf
id|cmd
op_assign
id|STRBUF_INIT
suffix:semicolon
r_struct
id|strbuf
id|buf
op_assign
id|STRBUF_INIT
suffix:semicolon
r_struct
id|child_process
id|cp
op_assign
id|CHILD_PROCESS_INIT
suffix:semicolon
r_const
r_char
op_star
id|argv
(braket
)braket
op_assign
(brace
l_int|NULL
comma
l_int|NULL
)brace
suffix:semicolon
r_const
r_char
op_star
id|result
suffix:semicolon
id|strbuf_addstr
c_func
(paren
op_amp
id|cmd
comma
id|command
)paren
suffix:semicolon
r_if
c_cond
(paren
id|arg
)paren
id|strbuf_replace
c_func
(paren
op_amp
id|cmd
comma
id|TRAILER_ARG_STRING
comma
id|arg
)paren
suffix:semicolon
id|argv
(braket
l_int|0
)braket
op_assign
id|cmd.buf
suffix:semicolon
id|cp.argv
op_assign
id|argv
suffix:semicolon
id|cp.env
op_assign
id|local_repo_env
suffix:semicolon
id|cp.no_stdin
op_assign
l_int|1
suffix:semicolon
id|cp.out
op_assign
l_int|1
suffix:semicolon
id|cp.use_shell
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|read_from_command
c_func
(paren
op_amp
id|cp
comma
op_amp
id|buf
)paren
)paren
(brace
id|strbuf_release
c_func
(paren
op_amp
id|buf
)paren
suffix:semicolon
id|result
op_assign
id|xstrdup
c_func
(paren
l_string|&quot;&quot;
)paren
suffix:semicolon
)brace
r_else
id|result
op_assign
id|strbuf_detach
c_func
(paren
op_amp
id|buf
comma
l_int|NULL
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|cmd
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
DECL|function|apply_item_command
r_static
r_void
id|apply_item_command
c_func
(paren
r_struct
id|trailer_item
op_star
id|in_tok
comma
r_struct
id|trailer_item
op_star
id|arg_tok
)paren
(brace
r_if
c_cond
(paren
id|arg_tok-&gt;conf.command
)paren
(brace
r_const
r_char
op_star
id|arg
suffix:semicolon
r_if
c_cond
(paren
id|arg_tok-&gt;value
op_logical_and
id|arg_tok-&gt;value
(braket
l_int|0
)braket
)paren
(brace
id|arg
op_assign
id|arg_tok-&gt;value
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|in_tok
op_logical_and
id|in_tok-&gt;value
)paren
id|arg
op_assign
id|xstrdup
c_func
(paren
id|in_tok-&gt;value
)paren
suffix:semicolon
r_else
id|arg
op_assign
id|xstrdup
c_func
(paren
l_string|&quot;&quot;
)paren
suffix:semicolon
)brace
id|arg_tok-&gt;value
op_assign
id|apply_command
c_func
(paren
id|arg_tok-&gt;conf.command
comma
id|arg
)paren
suffix:semicolon
id|free
c_func
(paren
(paren
r_char
op_star
)paren
id|arg
)paren
suffix:semicolon
)brace
)brace
DECL|function|apply_arg_if_exists
r_static
r_void
id|apply_arg_if_exists
c_func
(paren
r_struct
id|trailer_item
op_star
id|in_tok
comma
r_struct
id|trailer_item
op_star
id|arg_tok
comma
r_struct
id|trailer_item
op_star
id|on_tok
comma
r_struct
id|trailer_item
op_star
op_star
id|in_tok_first
comma
r_struct
id|trailer_item
op_star
op_star
id|in_tok_last
)paren
(brace
r_switch
c_cond
(paren
id|arg_tok-&gt;conf.if_exists
)paren
(brace
r_case
id|EXISTS_DO_NOTHING
suffix:colon
id|free_trailer_item
c_func
(paren
id|arg_tok
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EXISTS_REPLACE
suffix:colon
id|apply_item_command
c_func
(paren
id|in_tok
comma
id|arg_tok
)paren
suffix:semicolon
id|add_arg_to_input_list
c_func
(paren
id|on_tok
comma
id|arg_tok
comma
id|in_tok_first
comma
id|in_tok_last
)paren
suffix:semicolon
id|remove_from_list
c_func
(paren
id|in_tok
comma
id|in_tok_first
comma
id|in_tok_last
)paren
suffix:semicolon
id|free_trailer_item
c_func
(paren
id|in_tok
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EXISTS_ADD
suffix:colon
id|apply_item_command
c_func
(paren
id|in_tok
comma
id|arg_tok
)paren
suffix:semicolon
id|add_arg_to_input_list
c_func
(paren
id|on_tok
comma
id|arg_tok
comma
id|in_tok_first
comma
id|in_tok_last
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EXISTS_ADD_IF_DIFFERENT
suffix:colon
id|apply_item_command
c_func
(paren
id|in_tok
comma
id|arg_tok
)paren
suffix:semicolon
r_if
c_cond
(paren
id|check_if_different
c_func
(paren
id|in_tok
comma
id|arg_tok
comma
l_int|1
)paren
)paren
id|add_arg_to_input_list
c_func
(paren
id|on_tok
comma
id|arg_tok
comma
id|in_tok_first
comma
id|in_tok_last
)paren
suffix:semicolon
r_else
id|free_trailer_item
c_func
(paren
id|arg_tok
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EXISTS_ADD_IF_DIFFERENT_NEIGHBOR
suffix:colon
id|apply_item_command
c_func
(paren
id|in_tok
comma
id|arg_tok
)paren
suffix:semicolon
r_if
c_cond
(paren
id|check_if_different
c_func
(paren
id|on_tok
comma
id|arg_tok
comma
l_int|0
)paren
)paren
id|add_arg_to_input_list
c_func
(paren
id|on_tok
comma
id|arg_tok
comma
id|in_tok_first
comma
id|in_tok_last
)paren
suffix:semicolon
r_else
id|free_trailer_item
c_func
(paren
id|arg_tok
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|apply_arg_if_missing
r_static
r_void
id|apply_arg_if_missing
c_func
(paren
r_struct
id|trailer_item
op_star
op_star
id|in_tok_first
comma
r_struct
id|trailer_item
op_star
op_star
id|in_tok_last
comma
r_struct
id|trailer_item
op_star
id|arg_tok
)paren
(brace
r_struct
id|trailer_item
op_star
op_star
id|in_tok
suffix:semicolon
r_enum
id|action_where
id|where
suffix:semicolon
r_switch
c_cond
(paren
id|arg_tok-&gt;conf.if_missing
)paren
(brace
r_case
id|MISSING_DO_NOTHING
suffix:colon
id|free_trailer_item
c_func
(paren
id|arg_tok
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MISSING_ADD
suffix:colon
id|where
op_assign
id|arg_tok-&gt;conf.where
suffix:semicolon
id|in_tok
op_assign
id|after_or_end
c_func
(paren
id|where
)paren
ques
c_cond
id|in_tok_last
suffix:colon
id|in_tok_first
suffix:semicolon
id|apply_item_command
c_func
(paren
l_int|NULL
comma
id|arg_tok
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|in_tok
)paren
(brace
id|add_arg_to_input_list
c_func
(paren
op_star
id|in_tok
comma
id|arg_tok
comma
id|in_tok_first
comma
id|in_tok_last
)paren
suffix:semicolon
)brace
r_else
(brace
op_star
id|in_tok_first
op_assign
id|arg_tok
suffix:semicolon
op_star
id|in_tok_last
op_assign
id|arg_tok
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
)brace
DECL|function|find_same_and_apply_arg
r_static
r_int
id|find_same_and_apply_arg
c_func
(paren
r_struct
id|trailer_item
op_star
op_star
id|in_tok_first
comma
r_struct
id|trailer_item
op_star
op_star
id|in_tok_last
comma
r_struct
id|trailer_item
op_star
id|arg_tok
)paren
(brace
r_struct
id|trailer_item
op_star
id|in_tok
suffix:semicolon
r_struct
id|trailer_item
op_star
id|on_tok
suffix:semicolon
r_struct
id|trailer_item
op_star
id|following_tok
suffix:semicolon
r_enum
id|action_where
id|where
op_assign
id|arg_tok-&gt;conf.where
suffix:semicolon
r_int
id|middle
op_assign
(paren
id|where
op_eq
id|WHERE_AFTER
)paren
op_logical_or
(paren
id|where
op_eq
id|WHERE_BEFORE
)paren
suffix:semicolon
r_int
id|backwards
op_assign
id|after_or_end
c_func
(paren
id|where
)paren
suffix:semicolon
r_struct
id|trailer_item
op_star
id|start_tok
op_assign
id|backwards
ques
c_cond
op_star
id|in_tok_last
suffix:colon
op_star
id|in_tok_first
suffix:semicolon
r_for
c_loop
(paren
id|in_tok
op_assign
id|start_tok
suffix:semicolon
id|in_tok
suffix:semicolon
id|in_tok
op_assign
id|following_tok
)paren
(brace
id|following_tok
op_assign
id|backwards
ques
c_cond
id|in_tok-&gt;previous
suffix:colon
id|in_tok-&gt;next
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|same_token
c_func
(paren
id|in_tok
comma
id|arg_tok
)paren
)paren
r_continue
suffix:semicolon
id|on_tok
op_assign
id|middle
ques
c_cond
id|in_tok
suffix:colon
id|start_tok
suffix:semicolon
id|apply_arg_if_exists
c_func
(paren
id|in_tok
comma
id|arg_tok
comma
id|on_tok
comma
id|in_tok_first
comma
id|in_tok_last
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|process_trailers_lists
r_static
r_void
id|process_trailers_lists
c_func
(paren
r_struct
id|trailer_item
op_star
op_star
id|in_tok_first
comma
r_struct
id|trailer_item
op_star
op_star
id|in_tok_last
comma
r_struct
id|trailer_item
op_star
op_star
id|arg_tok_first
)paren
(brace
r_struct
id|trailer_item
op_star
id|arg_tok
suffix:semicolon
r_struct
id|trailer_item
op_star
id|next_arg
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_star
id|arg_tok_first
)paren
r_return
suffix:semicolon
r_for
c_loop
(paren
id|arg_tok
op_assign
op_star
id|arg_tok_first
suffix:semicolon
id|arg_tok
suffix:semicolon
id|arg_tok
op_assign
id|next_arg
)paren
(brace
r_int
id|applied
op_assign
l_int|0
suffix:semicolon
id|next_arg
op_assign
id|arg_tok-&gt;next
suffix:semicolon
id|remove_from_list
c_func
(paren
id|arg_tok
comma
id|arg_tok_first
comma
l_int|NULL
)paren
suffix:semicolon
id|applied
op_assign
id|find_same_and_apply_arg
c_func
(paren
id|in_tok_first
comma
id|in_tok_last
comma
id|arg_tok
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|applied
)paren
id|apply_arg_if_missing
c_func
(paren
id|in_tok_first
comma
id|in_tok_last
comma
id|arg_tok
)paren
suffix:semicolon
)brace
)brace
DECL|function|set_where
r_static
r_int
id|set_where
c_func
(paren
r_struct
id|conf_info
op_star
id|item
comma
r_const
r_char
op_star
id|value
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcasecmp
c_func
(paren
l_string|&quot;after&quot;
comma
id|value
)paren
)paren
id|item-&gt;where
op_assign
id|WHERE_AFTER
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcasecmp
c_func
(paren
l_string|&quot;before&quot;
comma
id|value
)paren
)paren
id|item-&gt;where
op_assign
id|WHERE_BEFORE
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcasecmp
c_func
(paren
l_string|&quot;end&quot;
comma
id|value
)paren
)paren
id|item-&gt;where
op_assign
id|WHERE_END
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcasecmp
c_func
(paren
l_string|&quot;start&quot;
comma
id|value
)paren
)paren
id|item-&gt;where
op_assign
id|WHERE_START
suffix:semicolon
r_else
r_return
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|set_if_exists
r_static
r_int
id|set_if_exists
c_func
(paren
r_struct
id|conf_info
op_star
id|item
comma
r_const
r_char
op_star
id|value
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcasecmp
c_func
(paren
l_string|&quot;addIfDifferent&quot;
comma
id|value
)paren
)paren
id|item-&gt;if_exists
op_assign
id|EXISTS_ADD_IF_DIFFERENT
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcasecmp
c_func
(paren
l_string|&quot;addIfDifferentNeighbor&quot;
comma
id|value
)paren
)paren
id|item-&gt;if_exists
op_assign
id|EXISTS_ADD_IF_DIFFERENT_NEIGHBOR
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcasecmp
c_func
(paren
l_string|&quot;add&quot;
comma
id|value
)paren
)paren
id|item-&gt;if_exists
op_assign
id|EXISTS_ADD
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcasecmp
c_func
(paren
l_string|&quot;replace&quot;
comma
id|value
)paren
)paren
id|item-&gt;if_exists
op_assign
id|EXISTS_REPLACE
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcasecmp
c_func
(paren
l_string|&quot;doNothing&quot;
comma
id|value
)paren
)paren
id|item-&gt;if_exists
op_assign
id|EXISTS_DO_NOTHING
suffix:semicolon
r_else
r_return
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|set_if_missing
r_static
r_int
id|set_if_missing
c_func
(paren
r_struct
id|conf_info
op_star
id|item
comma
r_const
r_char
op_star
id|value
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcasecmp
c_func
(paren
l_string|&quot;doNothing&quot;
comma
id|value
)paren
)paren
id|item-&gt;if_missing
op_assign
id|MISSING_DO_NOTHING
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcasecmp
c_func
(paren
l_string|&quot;add&quot;
comma
id|value
)paren
)paren
id|item-&gt;if_missing
op_assign
id|MISSING_ADD
suffix:semicolon
r_else
r_return
l_int|1
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|duplicate_conf
r_static
r_void
id|duplicate_conf
c_func
(paren
r_struct
id|conf_info
op_star
id|dst
comma
r_struct
id|conf_info
op_star
id|src
)paren
(brace
op_star
id|dst
op_assign
op_star
id|src
suffix:semicolon
r_if
c_cond
(paren
id|src-&gt;name
)paren
id|dst-&gt;name
op_assign
id|xstrdup
c_func
(paren
id|src-&gt;name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|src-&gt;key
)paren
id|dst-&gt;key
op_assign
id|xstrdup
c_func
(paren
id|src-&gt;key
)paren
suffix:semicolon
r_if
c_cond
(paren
id|src-&gt;command
)paren
id|dst-&gt;command
op_assign
id|xstrdup
c_func
(paren
id|src-&gt;command
)paren
suffix:semicolon
)brace
DECL|function|get_conf_item
r_static
r_struct
id|trailer_item
op_star
id|get_conf_item
c_func
(paren
r_const
r_char
op_star
id|name
)paren
(brace
r_struct
id|trailer_item
op_star
id|item
suffix:semicolon
r_struct
id|trailer_item
op_star
id|previous
suffix:semicolon
multiline_comment|/* Look up item with same name */
r_for
c_loop
(paren
id|previous
op_assign
l_int|NULL
comma
id|item
op_assign
id|first_conf_item
suffix:semicolon
id|item
suffix:semicolon
id|previous
op_assign
id|item
comma
id|item
op_assign
id|item-&gt;next
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcasecmp
c_func
(paren
id|item-&gt;conf.name
comma
id|name
)paren
)paren
r_return
id|item
suffix:semicolon
)brace
multiline_comment|/* Item does not already exists, create it */
id|item
op_assign
id|xcalloc
c_func
(paren
r_sizeof
(paren
r_struct
id|trailer_item
)paren
comma
l_int|1
)paren
suffix:semicolon
id|duplicate_conf
c_func
(paren
op_amp
id|item-&gt;conf
comma
op_amp
id|default_conf_info
)paren
suffix:semicolon
id|item-&gt;conf.name
op_assign
id|xstrdup
c_func
(paren
id|name
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|previous
)paren
id|first_conf_item
op_assign
id|item
suffix:semicolon
r_else
(brace
id|previous-&gt;next
op_assign
id|item
suffix:semicolon
id|item-&gt;previous
op_assign
id|previous
suffix:semicolon
)brace
r_return
id|item
suffix:semicolon
)brace
DECL|enum|trailer_info_type
DECL|enumerator|TRAILER_KEY
DECL|enumerator|TRAILER_COMMAND
DECL|enumerator|TRAILER_WHERE
r_enum
id|trailer_info_type
(brace
id|TRAILER_KEY
comma
id|TRAILER_COMMAND
comma
id|TRAILER_WHERE
comma
DECL|enumerator|TRAILER_IF_EXISTS
DECL|enumerator|TRAILER_IF_MISSING
id|TRAILER_IF_EXISTS
comma
id|TRAILER_IF_MISSING
)brace
suffix:semicolon
r_static
r_struct
(brace
DECL|member|name
r_const
r_char
op_star
id|name
suffix:semicolon
DECL|member|type
r_enum
id|trailer_info_type
id|type
suffix:semicolon
DECL|variable|trailer_config_items
)brace
id|trailer_config_items
(braket
)braket
op_assign
(brace
(brace
l_string|&quot;key&quot;
comma
id|TRAILER_KEY
)brace
comma
(brace
l_string|&quot;command&quot;
comma
id|TRAILER_COMMAND
)brace
comma
(brace
l_string|&quot;where&quot;
comma
id|TRAILER_WHERE
)brace
comma
(brace
l_string|&quot;ifexists&quot;
comma
id|TRAILER_IF_EXISTS
)brace
comma
(brace
l_string|&quot;ifmissing&quot;
comma
id|TRAILER_IF_MISSING
)brace
)brace
suffix:semicolon
DECL|function|git_trailer_default_config
r_static
r_int
id|git_trailer_default_config
c_func
(paren
r_const
r_char
op_star
id|conf_key
comma
r_const
r_char
op_star
id|value
comma
r_void
op_star
id|cb
)paren
(brace
r_const
r_char
op_star
id|trailer_item
comma
op_star
id|variable_name
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skip_prefix
c_func
(paren
id|conf_key
comma
l_string|&quot;trailer.&quot;
comma
op_amp
id|trailer_item
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|variable_name
op_assign
id|strrchr
c_func
(paren
id|trailer_item
comma
l_char|&squot;.&squot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|variable_name
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|trailer_item
comma
l_string|&quot;where&quot;
)paren
)paren
(brace
r_if
c_cond
(paren
id|set_where
c_func
(paren
op_amp
id|default_conf_info
comma
id|value
)paren
OL
l_int|0
)paren
id|warning
c_func
(paren
id|_
c_func
(paren
l_string|&quot;unknown value &squot;%s&squot; for key &squot;%s&squot;&quot;
)paren
comma
id|value
comma
id|conf_key
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|trailer_item
comma
l_string|&quot;ifexists&quot;
)paren
)paren
(brace
r_if
c_cond
(paren
id|set_if_exists
c_func
(paren
op_amp
id|default_conf_info
comma
id|value
)paren
OL
l_int|0
)paren
id|warning
c_func
(paren
id|_
c_func
(paren
l_string|&quot;unknown value &squot;%s&squot; for key &squot;%s&squot;&quot;
)paren
comma
id|value
comma
id|conf_key
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|trailer_item
comma
l_string|&quot;ifmissing&quot;
)paren
)paren
(brace
r_if
c_cond
(paren
id|set_if_missing
c_func
(paren
op_amp
id|default_conf_info
comma
id|value
)paren
OL
l_int|0
)paren
id|warning
c_func
(paren
id|_
c_func
(paren
l_string|&quot;unknown value &squot;%s&squot; for key &squot;%s&squot;&quot;
)paren
comma
id|value
comma
id|conf_key
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|trailer_item
comma
l_string|&quot;separators&quot;
)paren
)paren
(brace
id|separators
op_assign
id|xstrdup
c_func
(paren
id|value
)paren
suffix:semicolon
)brace
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|git_trailer_config
r_static
r_int
id|git_trailer_config
c_func
(paren
r_const
r_char
op_star
id|conf_key
comma
r_const
r_char
op_star
id|value
comma
r_void
op_star
id|cb
)paren
(brace
r_const
r_char
op_star
id|trailer_item
comma
op_star
id|variable_name
suffix:semicolon
r_struct
id|trailer_item
op_star
id|item
suffix:semicolon
r_struct
id|conf_info
op_star
id|conf
suffix:semicolon
r_char
op_star
id|name
op_assign
l_int|NULL
suffix:semicolon
r_enum
id|trailer_info_type
id|type
suffix:semicolon
r_int
id|i
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|skip_prefix
c_func
(paren
id|conf_key
comma
l_string|&quot;trailer.&quot;
comma
op_amp
id|trailer_item
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|variable_name
op_assign
id|strrchr
c_func
(paren
id|trailer_item
comma
l_char|&squot;.&squot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|variable_name
)paren
r_return
l_int|0
suffix:semicolon
id|variable_name
op_increment
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|ARRAY_SIZE
c_func
(paren
id|trailer_config_items
)paren
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|trailer_config_items
(braket
id|i
)braket
dot
id|name
comma
id|variable_name
)paren
)paren
r_continue
suffix:semicolon
id|name
op_assign
id|xstrndup
c_func
(paren
id|trailer_item
comma
id|variable_name
id|trailer_item
l_int|1
)paren
suffix:semicolon
id|type
op_assign
id|trailer_config_items
(braket
id|i
)braket
dot
id|type
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|name
)paren
r_return
l_int|0
suffix:semicolon
id|item
op_assign
id|get_conf_item
c_func
(paren
id|name
)paren
suffix:semicolon
id|conf
op_assign
op_amp
id|item-&gt;conf
suffix:semicolon
id|free
c_func
(paren
id|name
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|type
)paren
(brace
r_case
id|TRAILER_KEY
suffix:colon
r_if
c_cond
(paren
id|conf-&gt;key
)paren
id|warning
c_func
(paren
id|_
c_func
(paren
l_string|&quot;more than one %s&quot;
)paren
comma
id|conf_key
)paren
suffix:semicolon
id|conf-&gt;key
op_assign
id|xstrdup
c_func
(paren
id|value
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TRAILER_COMMAND
suffix:colon
r_if
c_cond
(paren
id|conf-&gt;command
)paren
id|warning
c_func
(paren
id|_
c_func
(paren
l_string|&quot;more than one %s&quot;
)paren
comma
id|conf_key
)paren
suffix:semicolon
id|conf-&gt;command
op_assign
id|xstrdup
c_func
(paren
id|value
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TRAILER_WHERE
suffix:colon
r_if
c_cond
(paren
id|set_where
c_func
(paren
id|conf
comma
id|value
)paren
)paren
id|warning
c_func
(paren
id|_
c_func
(paren
l_string|&quot;unknown value &squot;%s&squot; for key &squot;%s&squot;&quot;
)paren
comma
id|value
comma
id|conf_key
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TRAILER_IF_EXISTS
suffix:colon
r_if
c_cond
(paren
id|set_if_exists
c_func
(paren
id|conf
comma
id|value
)paren
)paren
id|warning
c_func
(paren
id|_
c_func
(paren
l_string|&quot;unknown value &squot;%s&squot; for key &squot;%s&squot;&quot;
)paren
comma
id|value
comma
id|conf_key
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|TRAILER_IF_MISSING
suffix:colon
r_if
c_cond
(paren
id|set_if_missing
c_func
(paren
id|conf
comma
id|value
)paren
)paren
id|warning
c_func
(paren
id|_
c_func
(paren
l_string|&quot;unknown value &squot;%s&squot; for key &squot;%s&squot;&quot;
)paren
comma
id|value
comma
id|conf_key
)paren
suffix:semicolon
r_break
suffix:semicolon
r_default
suffix:colon
id|die
c_func
(paren
l_string|&quot;internal bug in trailer.c&quot;
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|parse_trailer
r_static
r_int
id|parse_trailer
c_func
(paren
r_struct
id|strbuf
op_star
id|tok
comma
r_struct
id|strbuf
op_star
id|val
comma
r_const
r_char
op_star
id|trailer
)paren
(brace
r_int
id|len
suffix:semicolon
r_struct
id|strbuf
id|seps
op_assign
id|STRBUF_INIT
suffix:semicolon
id|strbuf_addstr
c_func
(paren
op_amp
id|seps
comma
id|separators
)paren
suffix:semicolon
id|strbuf_addch
c_func
(paren
op_amp
id|seps
comma
l_char|&squot;=&squot;
)paren
suffix:semicolon
id|len
op_assign
id|strcspn
c_func
(paren
id|trailer
comma
id|seps.buf
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|seps
)paren
suffix:semicolon
r_if
c_cond
(paren
id|len
op_eq
l_int|0
)paren
(brace
r_int
id|l
op_assign
id|strlen
c_func
(paren
id|trailer
)paren
suffix:semicolon
r_while
c_loop
(paren
id|l
OG
l_int|0
op_logical_and
id|isspace
c_func
(paren
id|trailer
(braket
id|l
l_int|1
)braket
)paren
)paren
id|l
op_decrement
suffix:semicolon
r_return
id|error
c_func
(paren
id|_
c_func
(paren
l_string|&quot;empty trailer token in trailer &squot;%.*s&squot;&quot;
)paren
comma
id|l
comma
id|trailer
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|len
OL
id|strlen
c_func
(paren
id|trailer
)paren
)paren
(brace
id|strbuf_add
c_func
(paren
id|tok
comma
id|trailer
comma
id|len
)paren
suffix:semicolon
id|strbuf_trim
c_func
(paren
id|tok
)paren
suffix:semicolon
id|strbuf_addstr
c_func
(paren
id|val
comma
id|trailer
op_plus
id|len
op_plus
l_int|1
)paren
suffix:semicolon
id|strbuf_trim
c_func
(paren
id|val
)paren
suffix:semicolon
)brace
r_else
(brace
id|strbuf_addstr
c_func
(paren
id|tok
comma
id|trailer
)paren
suffix:semicolon
id|strbuf_trim
c_func
(paren
id|tok
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|token_from_item
r_static
r_const
r_char
op_star
id|token_from_item
c_func
(paren
r_struct
id|trailer_item
op_star
id|item
comma
r_char
op_star
id|tok
)paren
(brace
r_if
c_cond
(paren
id|item-&gt;conf.key
)paren
r_return
id|item-&gt;conf.key
suffix:semicolon
r_if
c_cond
(paren
id|tok
)paren
r_return
id|tok
suffix:semicolon
r_return
id|item-&gt;conf.name
suffix:semicolon
)brace
DECL|function|new_trailer_item
r_static
r_struct
id|trailer_item
op_star
id|new_trailer_item
c_func
(paren
r_struct
id|trailer_item
op_star
id|conf_item
comma
r_char
op_star
id|tok
comma
r_char
op_star
id|val
)paren
(brace
r_struct
id|trailer_item
op_star
r_new
op_assign
id|xcalloc
c_func
(paren
r_sizeof
(paren
op_star
r_new
)paren
comma
l_int|1
)paren
suffix:semicolon
r_new
op_member_access_from_pointer
id|value
op_assign
id|val
ques
c_cond
id|val
suffix:colon
id|xstrdup
c_func
(paren
l_string|&quot;&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|conf_item
)paren
(brace
id|duplicate_conf
c_func
(paren
op_amp
r_new
op_member_access_from_pointer
id|conf
comma
op_amp
id|conf_item-&gt;conf
)paren
suffix:semicolon
r_new
op_member_access_from_pointer
id|token
op_assign
id|xstrdup
c_func
(paren
id|token_from_item
c_func
(paren
id|conf_item
comma
id|tok
)paren
)paren
suffix:semicolon
id|free
c_func
(paren
id|tok
)paren
suffix:semicolon
)brace
r_else
(brace
id|duplicate_conf
c_func
(paren
op_amp
r_new
op_member_access_from_pointer
id|conf
comma
op_amp
id|default_conf_info
)paren
suffix:semicolon
r_new
op_member_access_from_pointer
id|token
op_assign
id|tok
suffix:semicolon
)brace
r_return
r_new
suffix:semicolon
)brace
DECL|function|token_matches_item
r_static
r_int
id|token_matches_item
c_func
(paren
r_const
r_char
op_star
id|tok
comma
r_struct
id|trailer_item
op_star
id|item
comma
r_int
id|tok_len
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strncasecmp
c_func
(paren
id|tok
comma
id|item-&gt;conf.name
comma
id|tok_len
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_return
id|item-&gt;conf.key
ques
c_cond
op_logical_neg
id|strncasecmp
c_func
(paren
id|tok
comma
id|item-&gt;conf.key
comma
id|tok_len
)paren
suffix:colon
l_int|0
suffix:semicolon
)brace
DECL|function|create_trailer_item
r_static
r_struct
id|trailer_item
op_star
id|create_trailer_item
c_func
(paren
r_const
r_char
op_star
id|string
)paren
(brace
r_struct
id|strbuf
id|tok
op_assign
id|STRBUF_INIT
suffix:semicolon
r_struct
id|strbuf
id|val
op_assign
id|STRBUF_INIT
suffix:semicolon
r_struct
id|trailer_item
op_star
id|item
suffix:semicolon
r_int
id|tok_len
suffix:semicolon
r_if
c_cond
(paren
id|parse_trailer
c_func
(paren
op_amp
id|tok
comma
op_amp
id|val
comma
id|string
)paren
)paren
r_return
l_int|NULL
suffix:semicolon
id|tok_len
op_assign
id|token_len_without_separator
c_func
(paren
id|tok.buf
comma
id|tok.len
)paren
suffix:semicolon
multiline_comment|/* Lookup if the token matches something in the config */
r_for
c_loop
(paren
id|item
op_assign
id|first_conf_item
suffix:semicolon
id|item
suffix:semicolon
id|item
op_assign
id|item-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|token_matches_item
c_func
(paren
id|tok.buf
comma
id|item
comma
id|tok_len
)paren
)paren
r_return
id|new_trailer_item
c_func
(paren
id|item
comma
id|strbuf_detach
c_func
(paren
op_amp
id|tok
comma
l_int|NULL
)paren
comma
id|strbuf_detach
c_func
(paren
op_amp
id|val
comma
l_int|NULL
)paren
)paren
suffix:semicolon
)brace
r_return
id|new_trailer_item
c_func
(paren
l_int|NULL
comma
id|strbuf_detach
c_func
(paren
op_amp
id|tok
comma
l_int|NULL
)paren
comma
id|strbuf_detach
c_func
(paren
op_amp
id|val
comma
l_int|NULL
)paren
)paren
suffix:semicolon
)brace
DECL|function|add_trailer_item
r_static
r_void
id|add_trailer_item
c_func
(paren
r_struct
id|trailer_item
op_star
op_star
id|first
comma
r_struct
id|trailer_item
op_star
op_star
id|last
comma
r_struct
id|trailer_item
op_star
r_new
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
r_new
)paren
r_return
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_star
id|last
)paren
(brace
op_star
id|first
op_assign
r_new
suffix:semicolon
op_star
id|last
op_assign
r_new
suffix:semicolon
)brace
r_else
(brace
(paren
op_star
id|last
)paren
op_member_access_from_pointer
id|next
op_assign
r_new
suffix:semicolon
r_new
op_member_access_from_pointer
id|previous
op_assign
op_star
id|last
suffix:semicolon
op_star
id|last
op_assign
r_new
suffix:semicolon
)brace
)brace
DECL|function|process_command_line_args
r_static
r_struct
id|trailer_item
op_star
id|process_command_line_args
c_func
(paren
r_struct
id|string_list
op_star
id|trailers
)paren
(brace
r_struct
id|trailer_item
op_star
id|arg_tok_first
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|trailer_item
op_star
id|arg_tok_last
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|string_list_item
op_star
id|tr
suffix:semicolon
r_struct
id|trailer_item
op_star
id|item
suffix:semicolon
multiline_comment|/* Add a trailer item for each configured trailer with a command */
r_for
c_loop
(paren
id|item
op_assign
id|first_conf_item
suffix:semicolon
id|item
suffix:semicolon
id|item
op_assign
id|item-&gt;next
)paren
(brace
r_if
c_cond
(paren
id|item-&gt;conf.command
)paren
(brace
r_struct
id|trailer_item
op_star
r_new
op_assign
id|new_trailer_item
c_func
(paren
id|item
comma
l_int|NULL
comma
l_int|NULL
)paren
suffix:semicolon
id|add_trailer_item
c_func
(paren
op_amp
id|arg_tok_first
comma
op_amp
id|arg_tok_last
comma
r_new
)paren
suffix:semicolon
)brace
)brace
multiline_comment|/* Add a trailer item for each trailer on the command line */
id|for_each_string_list_item
c_func
(paren
id|tr
comma
id|trailers
)paren
(brace
r_struct
id|trailer_item
op_star
r_new
op_assign
id|create_trailer_item
c_func
(paren
id|tr-&gt;string
)paren
suffix:semicolon
id|add_trailer_item
c_func
(paren
op_amp
id|arg_tok_first
comma
op_amp
id|arg_tok_last
comma
r_new
)paren
suffix:semicolon
)brace
r_return
id|arg_tok_first
suffix:semicolon
)brace
DECL|function|read_input_file
r_static
r_struct
id|strbuf
op_star
op_star
id|read_input_file
c_func
(paren
r_const
r_char
op_star
id|file
)paren
(brace
r_struct
id|strbuf
op_star
op_star
id|lines
suffix:semicolon
r_struct
id|strbuf
id|sb
op_assign
id|STRBUF_INIT
suffix:semicolon
r_if
c_cond
(paren
id|file
)paren
(brace
r_if
c_cond
(paren
id|strbuf_read_file
c_func
(paren
op_amp
id|sb
comma
id|file
comma
l_int|0
)paren
OL
l_int|0
)paren
id|die_errno
c_func
(paren
id|_
c_func
(paren
l_string|&quot;could not read input file &squot;%s&squot;&quot;
)paren
comma
id|file
)paren
suffix:semicolon
)brace
r_else
(brace
r_if
c_cond
(paren
id|strbuf_read
c_func
(paren
op_amp
id|sb
comma
id|fileno
c_func
(paren
id|stdin
)paren
comma
l_int|0
)paren
OL
l_int|0
)paren
id|die_errno
c_func
(paren
id|_
c_func
(paren
l_string|&quot;could not read from stdin&quot;
)paren
)paren
suffix:semicolon
)brace
id|lines
op_assign
id|strbuf_split
c_func
(paren
op_amp
id|sb
comma
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|sb
)paren
suffix:semicolon
r_return
id|lines
suffix:semicolon
)brace
multiline_comment|/*&n; * Return the (0 based) index of the start of the patch or the line&n; * count if there is no patch in the message.&n; */
DECL|function|find_patch_start
r_static
r_int
id|find_patch_start
c_func
(paren
r_struct
id|strbuf
op_star
op_star
id|lines
comma
r_int
id|count
)paren
(brace
r_int
id|i
suffix:semicolon
multiline_comment|/* Get the start of the patch part if any */
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|count
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|starts_with
c_func
(paren
id|lines
(braket
id|i
)braket
op_member_access_from_pointer
id|buf
comma
l_string|&quot;---&quot;
)paren
)paren
r_return
id|i
suffix:semicolon
)brace
r_return
id|count
suffix:semicolon
)brace
multiline_comment|/*&n; * Return the (0 based) index of the first trailer line or count if&n; * there are no trailers. Trailers are searched only in the lines from&n; * index (count - 1) down to index 0.&n; */
DECL|function|find_trailer_start
r_static
r_int
id|find_trailer_start
c_func
(paren
r_struct
id|strbuf
op_star
op_star
id|lines
comma
r_int
id|count
)paren
(brace
r_int
id|start
comma
id|only_spaces
op_assign
l_int|1
suffix:semicolon
multiline_comment|/*&n;&t; * Get the start of the trailers by looking starting from the end&n;&t; * for a line with only spaces before lines with one separator.&n;&t; */
r_for
c_loop
(paren
id|start
op_assign
id|count
l_int|1
suffix:semicolon
id|start
op_ge
l_int|0
suffix:semicolon
id|start
op_decrement
)paren
(brace
r_if
c_cond
(paren
id|lines
(braket
id|start
)braket
op_member_access_from_pointer
id|buf
(braket
l_int|0
)braket
op_eq
id|comment_line_char
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
id|contains_only_spaces
c_func
(paren
id|lines
(braket
id|start
)braket
op_member_access_from_pointer
id|buf
)paren
)paren
(brace
r_if
c_cond
(paren
id|only_spaces
)paren
r_continue
suffix:semicolon
r_return
id|start
op_plus
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|strcspn
c_func
(paren
id|lines
(braket
id|start
)braket
op_member_access_from_pointer
id|buf
comma
id|separators
)paren
OL
id|lines
(braket
id|start
)braket
op_member_access_from_pointer
id|len
)paren
(brace
r_if
c_cond
(paren
id|only_spaces
)paren
id|only_spaces
op_assign
l_int|0
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_return
id|count
suffix:semicolon
)brace
r_return
id|only_spaces
ques
c_cond
id|count
suffix:colon
l_int|0
suffix:semicolon
)brace
multiline_comment|/* Get the index of the end of the trailers */
DECL|function|find_trailer_end
r_static
r_int
id|find_trailer_end
c_func
(paren
r_struct
id|strbuf
op_star
op_star
id|lines
comma
r_int
id|patch_start
)paren
(brace
r_struct
id|strbuf
id|sb
op_assign
id|STRBUF_INIT
suffix:semicolon
r_int
id|i
comma
id|ignore_bytes
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|patch_start
suffix:semicolon
id|i
op_increment
)paren
id|strbuf_addbuf
c_func
(paren
op_amp
id|sb
comma
id|lines
(braket
id|i
)braket
)paren
suffix:semicolon
id|ignore_bytes
op_assign
id|ignore_non_trailer
c_func
(paren
op_amp
id|sb
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|sb
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|patch_start
l_int|1
suffix:semicolon
id|i
op_ge
l_int|0
op_logical_and
id|ignore_bytes
OG
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
id|ignore_bytes
op_sub_assign
id|lines
(braket
id|i
)braket
op_member_access_from_pointer
id|len
suffix:semicolon
r_return
id|i
op_plus
l_int|1
suffix:semicolon
)brace
DECL|function|has_blank_line_before
r_static
r_int
id|has_blank_line_before
c_func
(paren
r_struct
id|strbuf
op_star
op_star
id|lines
comma
r_int
id|start
)paren
(brace
r_for
c_loop
(paren
suffix:semicolon
id|start
op_ge
l_int|0
suffix:semicolon
id|start
op_decrement
)paren
(brace
r_if
c_cond
(paren
id|lines
(braket
id|start
)braket
op_member_access_from_pointer
id|buf
(braket
l_int|0
)braket
op_eq
id|comment_line_char
)paren
r_continue
suffix:semicolon
r_return
id|contains_only_spaces
c_func
(paren
id|lines
(braket
id|start
)braket
op_member_access_from_pointer
id|buf
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|print_lines
r_static
r_void
id|print_lines
c_func
(paren
r_struct
id|strbuf
op_star
op_star
id|lines
comma
r_int
id|start
comma
r_int
id|end
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|start
suffix:semicolon
id|lines
(braket
id|i
)braket
op_logical_and
id|i
OL
id|end
suffix:semicolon
id|i
op_increment
)paren
id|printf
c_func
(paren
l_string|&quot;%s&quot;
comma
id|lines
(braket
id|i
)braket
op_member_access_from_pointer
id|buf
)paren
suffix:semicolon
)brace
DECL|function|process_input_file
r_static
r_int
id|process_input_file
c_func
(paren
r_struct
id|strbuf
op_star
op_star
id|lines
comma
r_struct
id|trailer_item
op_star
op_star
id|in_tok_first
comma
r_struct
id|trailer_item
op_star
op_star
id|in_tok_last
)paren
(brace
r_int
id|count
op_assign
l_int|0
suffix:semicolon
r_int
id|patch_start
comma
id|trailer_start
comma
id|trailer_end
comma
id|i
suffix:semicolon
multiline_comment|/* Get the line count */
r_while
c_loop
(paren
id|lines
(braket
id|count
)braket
)paren
id|count
op_increment
suffix:semicolon
id|patch_start
op_assign
id|find_patch_start
c_func
(paren
id|lines
comma
id|count
)paren
suffix:semicolon
id|trailer_end
op_assign
id|find_trailer_end
c_func
(paren
id|lines
comma
id|patch_start
)paren
suffix:semicolon
id|trailer_start
op_assign
id|find_trailer_start
c_func
(paren
id|lines
comma
id|trailer_end
)paren
suffix:semicolon
multiline_comment|/* Print lines before the trailers as is */
id|print_lines
c_func
(paren
id|lines
comma
l_int|0
comma
id|trailer_start
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|has_blank_line_before
c_func
(paren
id|lines
comma
id|trailer_start
l_int|1
)paren
)paren
id|printf
c_func
(paren
l_string|&quot;&bslash;n&quot;
)paren
suffix:semicolon
multiline_comment|/* Parse trailer lines */
r_for
c_loop
(paren
id|i
op_assign
id|trailer_start
suffix:semicolon
id|i
OL
id|trailer_end
suffix:semicolon
id|i
op_increment
)paren
(brace
r_if
c_cond
(paren
id|lines
(braket
id|i
)braket
op_member_access_from_pointer
id|buf
(braket
l_int|0
)braket
op_ne
id|comment_line_char
)paren
(brace
r_struct
id|trailer_item
op_star
r_new
op_assign
id|create_trailer_item
c_func
(paren
id|lines
(braket
id|i
)braket
op_member_access_from_pointer
id|buf
)paren
suffix:semicolon
id|add_trailer_item
c_func
(paren
id|in_tok_first
comma
id|in_tok_last
comma
r_new
)paren
suffix:semicolon
)brace
)brace
r_return
id|trailer_end
suffix:semicolon
)brace
DECL|function|free_all
r_static
r_void
id|free_all
c_func
(paren
r_struct
id|trailer_item
op_star
op_star
id|first
)paren
(brace
r_while
c_loop
(paren
op_star
id|first
)paren
(brace
r_struct
id|trailer_item
op_star
id|item
op_assign
id|remove_first
c_func
(paren
id|first
)paren
suffix:semicolon
id|free_trailer_item
c_func
(paren
id|item
)paren
suffix:semicolon
)brace
)brace
DECL|function|process_trailers
r_void
id|process_trailers
c_func
(paren
r_const
r_char
op_star
id|file
comma
r_int
id|trim_empty
comma
r_struct
id|string_list
op_star
id|trailers
)paren
(brace
r_struct
id|trailer_item
op_star
id|in_tok_first
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|trailer_item
op_star
id|in_tok_last
op_assign
l_int|NULL
suffix:semicolon
r_struct
id|trailer_item
op_star
id|arg_tok_first
suffix:semicolon
r_struct
id|strbuf
op_star
op_star
id|lines
suffix:semicolon
r_int
id|trailer_end
suffix:semicolon
multiline_comment|/* Default config must be setup first */
id|git_config
c_func
(paren
id|git_trailer_default_config
comma
l_int|NULL
)paren
suffix:semicolon
id|git_config
c_func
(paren
id|git_trailer_config
comma
l_int|NULL
)paren
suffix:semicolon
id|lines
op_assign
id|read_input_file
c_func
(paren
id|file
)paren
suffix:semicolon
multiline_comment|/* Print the lines before the trailers */
id|trailer_end
op_assign
id|process_input_file
c_func
(paren
id|lines
comma
op_amp
id|in_tok_first
comma
op_amp
id|in_tok_last
)paren
suffix:semicolon
id|arg_tok_first
op_assign
id|process_command_line_args
c_func
(paren
id|trailers
)paren
suffix:semicolon
id|process_trailers_lists
c_func
(paren
op_amp
id|in_tok_first
comma
op_amp
id|in_tok_last
comma
op_amp
id|arg_tok_first
)paren
suffix:semicolon
id|print_all
c_func
(paren
id|in_tok_first
comma
id|trim_empty
)paren
suffix:semicolon
id|free_all
c_func
(paren
op_amp
id|in_tok_first
)paren
suffix:semicolon
multiline_comment|/* Print the lines after the trailers as is */
id|print_lines
c_func
(paren
id|lines
comma
id|trailer_end
comma
id|INT_MAX
)paren
suffix:semicolon
id|strbuf_list_free
c_func
(paren
id|lines
)paren
suffix:semicolon
)brace
eof
