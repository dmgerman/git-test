macro_line|#include &quot;cache.h&quot;
multiline_comment|/*&n; * Copyright (c) 2013, 2014 Christian Couder &lt;chriscool@tuxfamily.org&gt;&n; */
DECL|enum|action_where
DECL|enumerator|WHERE_END
DECL|enumerator|WHERE_AFTER
DECL|enumerator|WHERE_BEFORE
DECL|enumerator|WHERE_START
r_enum
id|action_where
(brace
id|WHERE_END
comma
id|WHERE_AFTER
comma
id|WHERE_BEFORE
comma
id|WHERE_START
)brace
suffix:semicolon
DECL|enum|action_if_exists
DECL|enumerator|EXISTS_ADD_IF_DIFFERENT_NEIGHBOR
DECL|enumerator|EXISTS_ADD_IF_DIFFERENT
r_enum
id|action_if_exists
(brace
id|EXISTS_ADD_IF_DIFFERENT_NEIGHBOR
comma
id|EXISTS_ADD_IF_DIFFERENT
comma
DECL|enumerator|EXISTS_ADD
DECL|enumerator|EXISTS_REPLACE
DECL|enumerator|EXISTS_DO_NOTHING
id|EXISTS_ADD
comma
id|EXISTS_REPLACE
comma
id|EXISTS_DO_NOTHING
)brace
suffix:semicolon
DECL|enum|action_if_missing
DECL|enumerator|MISSING_ADD
DECL|enumerator|MISSING_DO_NOTHING
r_enum
id|action_if_missing
(brace
id|MISSING_ADD
comma
id|MISSING_DO_NOTHING
)brace
suffix:semicolon
DECL|struct|conf_info
r_struct
id|conf_info
(brace
DECL|member|name
r_char
op_star
id|name
suffix:semicolon
DECL|member|key
r_char
op_star
id|key
suffix:semicolon
DECL|member|command
r_char
op_star
id|command
suffix:semicolon
DECL|member|where
r_enum
id|action_where
id|where
suffix:semicolon
DECL|member|if_exists
r_enum
id|action_if_exists
id|if_exists
suffix:semicolon
DECL|member|if_missing
r_enum
id|action_if_missing
id|if_missing
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|default_conf_info
r_static
r_struct
id|conf_info
id|default_conf_info
suffix:semicolon
DECL|struct|trailer_item
r_struct
id|trailer_item
(brace
DECL|member|previous
r_struct
id|trailer_item
op_star
id|previous
suffix:semicolon
DECL|member|next
r_struct
id|trailer_item
op_star
id|next
suffix:semicolon
DECL|member|token
r_const
r_char
op_star
id|token
suffix:semicolon
DECL|member|value
r_const
r_char
op_star
id|value
suffix:semicolon
DECL|member|conf
r_struct
id|conf_info
id|conf
suffix:semicolon
)brace
suffix:semicolon
DECL|variable|first_conf_item
r_static
r_struct
id|trailer_item
op_star
id|first_conf_item
suffix:semicolon
DECL|variable|separators
r_static
r_char
op_star
id|separators
op_assign
l_string|&quot;:&quot;
suffix:semicolon
DECL|function|after_or_end
r_static
r_int
id|after_or_end
c_func
(paren
r_enum
id|action_where
id|where
)paren
(brace
r_return
(paren
id|where
op_eq
id|WHERE_AFTER
)paren
op_logical_or
(paren
id|where
op_eq
id|WHERE_END
)paren
suffix:semicolon
)brace
multiline_comment|/*&n; * Return the length of the string not including any final&n; * punctuation. E.g., the input &quot;Signed-off-by:&quot; would return&n; * 13, stripping the trailing punctuation but retaining&n; * internal punctuation.&n; */
DECL|function|token_len_without_separator
r_static
r_int
id|token_len_without_separator
c_func
(paren
r_const
r_char
op_star
id|token
comma
r_int
id|len
)paren
(brace
r_while
c_loop
(paren
id|len
OG
l_int|0
op_logical_and
op_logical_neg
id|isalnum
c_func
(paren
id|token
(braket
id|len
l_int|1
)braket
)paren
)paren
id|len
op_decrement
suffix:semicolon
r_return
id|len
suffix:semicolon
)brace
DECL|function|same_token
r_static
r_int
id|same_token
c_func
(paren
r_struct
id|trailer_item
op_star
id|a
comma
r_struct
id|trailer_item
op_star
id|b
)paren
(brace
r_int
id|a_len
op_assign
id|token_len_without_separator
c_func
(paren
id|a-&gt;token
comma
id|strlen
c_func
(paren
id|a-&gt;token
)paren
)paren
suffix:semicolon
r_int
id|b_len
op_assign
id|token_len_without_separator
c_func
(paren
id|b-&gt;token
comma
id|strlen
c_func
(paren
id|b-&gt;token
)paren
)paren
suffix:semicolon
r_int
id|min_len
op_assign
(paren
id|a_len
OG
id|b_len
)paren
ques
c_cond
id|b_len
suffix:colon
id|a_len
suffix:semicolon
r_return
op_logical_neg
id|strncasecmp
c_func
(paren
id|a-&gt;token
comma
id|b-&gt;token
comma
id|min_len
)paren
suffix:semicolon
)brace
DECL|function|same_value
r_static
r_int
id|same_value
c_func
(paren
r_struct
id|trailer_item
op_star
id|a
comma
r_struct
id|trailer_item
op_star
id|b
)paren
(brace
r_return
op_logical_neg
id|strcasecmp
c_func
(paren
id|a-&gt;value
comma
id|b-&gt;value
)paren
suffix:semicolon
)brace
DECL|function|same_trailer
r_static
r_int
id|same_trailer
c_func
(paren
r_struct
id|trailer_item
op_star
id|a
comma
r_struct
id|trailer_item
op_star
id|b
)paren
(brace
r_return
id|same_token
c_func
(paren
id|a
comma
id|b
)paren
op_logical_and
id|same_value
c_func
(paren
id|a
comma
id|b
)paren
suffix:semicolon
)brace
DECL|function|free_trailer_item
r_static
r_void
id|free_trailer_item
c_func
(paren
r_struct
id|trailer_item
op_star
id|item
)paren
(brace
id|free
c_func
(paren
id|item-&gt;conf.name
)paren
suffix:semicolon
id|free
c_func
(paren
id|item-&gt;conf.key
)paren
suffix:semicolon
id|free
c_func
(paren
id|item-&gt;conf.command
)paren
suffix:semicolon
id|free
c_func
(paren
(paren
r_char
op_star
)paren
id|item-&gt;token
)paren
suffix:semicolon
id|free
c_func
(paren
(paren
r_char
op_star
)paren
id|item-&gt;value
)paren
suffix:semicolon
id|free
c_func
(paren
id|item
)paren
suffix:semicolon
)brace
DECL|function|update_last
r_static
r_void
id|update_last
c_func
(paren
r_struct
id|trailer_item
op_star
op_star
id|last
)paren
(brace
r_if
c_cond
(paren
op_star
id|last
)paren
r_while
c_loop
(paren
(paren
op_star
id|last
)paren
op_member_access_from_pointer
id|next
op_ne
l_int|NULL
)paren
op_star
id|last
op_assign
(paren
op_star
id|last
)paren
op_member_access_from_pointer
id|next
suffix:semicolon
)brace
DECL|function|update_first
r_static
r_void
id|update_first
c_func
(paren
r_struct
id|trailer_item
op_star
op_star
id|first
)paren
(brace
r_if
c_cond
(paren
op_star
id|first
)paren
r_while
c_loop
(paren
(paren
op_star
id|first
)paren
op_member_access_from_pointer
id|previous
op_ne
l_int|NULL
)paren
op_star
id|first
op_assign
(paren
op_star
id|first
)paren
op_member_access_from_pointer
id|previous
suffix:semicolon
)brace
DECL|function|add_arg_to_input_list
r_static
r_void
id|add_arg_to_input_list
c_func
(paren
r_struct
id|trailer_item
op_star
id|on_tok
comma
r_struct
id|trailer_item
op_star
id|arg_tok
comma
r_struct
id|trailer_item
op_star
op_star
id|first
comma
r_struct
id|trailer_item
op_star
op_star
id|last
)paren
(brace
r_if
c_cond
(paren
id|after_or_end
c_func
(paren
id|arg_tok-&gt;conf.where
)paren
)paren
(brace
id|arg_tok-&gt;next
op_assign
id|on_tok-&gt;next
suffix:semicolon
id|on_tok-&gt;next
op_assign
id|arg_tok
suffix:semicolon
id|arg_tok-&gt;previous
op_assign
id|on_tok
suffix:semicolon
r_if
c_cond
(paren
id|arg_tok-&gt;next
)paren
id|arg_tok-&gt;next-&gt;previous
op_assign
id|arg_tok
suffix:semicolon
id|update_last
c_func
(paren
id|last
)paren
suffix:semicolon
)brace
r_else
(brace
id|arg_tok-&gt;previous
op_assign
id|on_tok-&gt;previous
suffix:semicolon
id|on_tok-&gt;previous
op_assign
id|arg_tok
suffix:semicolon
id|arg_tok-&gt;next
op_assign
id|on_tok
suffix:semicolon
r_if
c_cond
(paren
id|arg_tok-&gt;previous
)paren
id|arg_tok-&gt;previous-&gt;next
op_assign
id|arg_tok
suffix:semicolon
id|update_first
c_func
(paren
id|first
)paren
suffix:semicolon
)brace
)brace
DECL|function|check_if_different
r_static
r_int
id|check_if_different
c_func
(paren
r_struct
id|trailer_item
op_star
id|in_tok
comma
r_struct
id|trailer_item
op_star
id|arg_tok
comma
r_int
id|check_all
)paren
(brace
r_enum
id|action_where
id|where
op_assign
id|arg_tok-&gt;conf.where
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
op_logical_neg
id|in_tok
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|same_trailer
c_func
(paren
id|in_tok
comma
id|arg_tok
)paren
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/*&n;&t;&t; * if we want to add a trailer after another one,&n;&t;&t; * we have to check those before this one&n;&t;&t; */
id|in_tok
op_assign
id|after_or_end
c_func
(paren
id|where
)paren
ques
c_cond
id|in_tok-&gt;previous
suffix:colon
id|in_tok-&gt;next
suffix:semicolon
)brace
r_while
c_loop
(paren
id|check_all
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|remove_from_list
r_static
r_void
id|remove_from_list
c_func
(paren
r_struct
id|trailer_item
op_star
id|item
comma
r_struct
id|trailer_item
op_star
op_star
id|first
comma
r_struct
id|trailer_item
op_star
op_star
id|last
)paren
(brace
r_struct
id|trailer_item
op_star
id|next
op_assign
id|item-&gt;next
suffix:semicolon
r_struct
id|trailer_item
op_star
id|previous
op_assign
id|item-&gt;previous
suffix:semicolon
r_if
c_cond
(paren
id|next
)paren
(brace
id|item-&gt;next-&gt;previous
op_assign
id|previous
suffix:semicolon
id|item-&gt;next
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|last
)paren
op_star
id|last
op_assign
id|previous
suffix:semicolon
r_if
c_cond
(paren
id|previous
)paren
(brace
id|item-&gt;previous-&gt;next
op_assign
id|next
suffix:semicolon
id|item-&gt;previous
op_assign
l_int|NULL
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|first
)paren
op_star
id|first
op_assign
id|next
suffix:semicolon
)brace
DECL|function|remove_first
r_static
r_struct
id|trailer_item
op_star
id|remove_first
c_func
(paren
r_struct
id|trailer_item
op_star
op_star
id|first
)paren
(brace
r_struct
id|trailer_item
op_star
id|item
op_assign
op_star
id|first
suffix:semicolon
op_star
id|first
op_assign
id|item-&gt;next
suffix:semicolon
r_if
c_cond
(paren
id|item-&gt;next
)paren
(brace
id|item-&gt;next-&gt;previous
op_assign
l_int|NULL
suffix:semicolon
id|item-&gt;next
op_assign
l_int|NULL
suffix:semicolon
)brace
r_return
id|item
suffix:semicolon
)brace
DECL|function|apply_arg_if_exists
r_static
r_void
id|apply_arg_if_exists
c_func
(paren
r_struct
id|trailer_item
op_star
id|in_tok
comma
r_struct
id|trailer_item
op_star
id|arg_tok
comma
r_struct
id|trailer_item
op_star
id|on_tok
comma
r_struct
id|trailer_item
op_star
op_star
id|in_tok_first
comma
r_struct
id|trailer_item
op_star
op_star
id|in_tok_last
)paren
(brace
r_switch
c_cond
(paren
id|arg_tok-&gt;conf.if_exists
)paren
(brace
r_case
id|EXISTS_DO_NOTHING
suffix:colon
id|free_trailer_item
c_func
(paren
id|arg_tok
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EXISTS_REPLACE
suffix:colon
id|add_arg_to_input_list
c_func
(paren
id|on_tok
comma
id|arg_tok
comma
id|in_tok_first
comma
id|in_tok_last
)paren
suffix:semicolon
id|remove_from_list
c_func
(paren
id|in_tok
comma
id|in_tok_first
comma
id|in_tok_last
)paren
suffix:semicolon
id|free_trailer_item
c_func
(paren
id|in_tok
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EXISTS_ADD
suffix:colon
id|add_arg_to_input_list
c_func
(paren
id|on_tok
comma
id|arg_tok
comma
id|in_tok_first
comma
id|in_tok_last
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EXISTS_ADD_IF_DIFFERENT
suffix:colon
r_if
c_cond
(paren
id|check_if_different
c_func
(paren
id|in_tok
comma
id|arg_tok
comma
l_int|1
)paren
)paren
id|add_arg_to_input_list
c_func
(paren
id|on_tok
comma
id|arg_tok
comma
id|in_tok_first
comma
id|in_tok_last
)paren
suffix:semicolon
r_else
id|free_trailer_item
c_func
(paren
id|arg_tok
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|EXISTS_ADD_IF_DIFFERENT_NEIGHBOR
suffix:colon
r_if
c_cond
(paren
id|check_if_different
c_func
(paren
id|on_tok
comma
id|arg_tok
comma
l_int|0
)paren
)paren
id|add_arg_to_input_list
c_func
(paren
id|on_tok
comma
id|arg_tok
comma
id|in_tok_first
comma
id|in_tok_last
)paren
suffix:semicolon
r_else
id|free_trailer_item
c_func
(paren
id|arg_tok
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|apply_arg_if_missing
r_static
r_void
id|apply_arg_if_missing
c_func
(paren
r_struct
id|trailer_item
op_star
op_star
id|in_tok_first
comma
r_struct
id|trailer_item
op_star
op_star
id|in_tok_last
comma
r_struct
id|trailer_item
op_star
id|arg_tok
)paren
(brace
r_struct
id|trailer_item
op_star
op_star
id|in_tok
suffix:semicolon
r_enum
id|action_where
id|where
suffix:semicolon
r_switch
c_cond
(paren
id|arg_tok-&gt;conf.if_missing
)paren
(brace
r_case
id|MISSING_DO_NOTHING
suffix:colon
id|free_trailer_item
c_func
(paren
id|arg_tok
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|MISSING_ADD
suffix:colon
id|where
op_assign
id|arg_tok-&gt;conf.where
suffix:semicolon
id|in_tok
op_assign
id|after_or_end
c_func
(paren
id|where
)paren
ques
c_cond
id|in_tok_last
suffix:colon
id|in_tok_first
suffix:semicolon
r_if
c_cond
(paren
op_star
id|in_tok
)paren
(brace
id|add_arg_to_input_list
c_func
(paren
op_star
id|in_tok
comma
id|arg_tok
comma
id|in_tok_first
comma
id|in_tok_last
)paren
suffix:semicolon
)brace
r_else
(brace
op_star
id|in_tok_first
op_assign
id|arg_tok
suffix:semicolon
op_star
id|in_tok_last
op_assign
id|arg_tok
suffix:semicolon
)brace
r_break
suffix:semicolon
)brace
)brace
DECL|function|find_same_and_apply_arg
r_static
r_int
id|find_same_and_apply_arg
c_func
(paren
r_struct
id|trailer_item
op_star
op_star
id|in_tok_first
comma
r_struct
id|trailer_item
op_star
op_star
id|in_tok_last
comma
r_struct
id|trailer_item
op_star
id|arg_tok
)paren
(brace
r_struct
id|trailer_item
op_star
id|in_tok
suffix:semicolon
r_struct
id|trailer_item
op_star
id|on_tok
suffix:semicolon
r_struct
id|trailer_item
op_star
id|following_tok
suffix:semicolon
r_enum
id|action_where
id|where
op_assign
id|arg_tok-&gt;conf.where
suffix:semicolon
r_int
id|middle
op_assign
(paren
id|where
op_eq
id|WHERE_AFTER
)paren
op_logical_or
(paren
id|where
op_eq
id|WHERE_BEFORE
)paren
suffix:semicolon
r_int
id|backwards
op_assign
id|after_or_end
c_func
(paren
id|where
)paren
suffix:semicolon
r_struct
id|trailer_item
op_star
id|start_tok
op_assign
id|backwards
ques
c_cond
op_star
id|in_tok_last
suffix:colon
op_star
id|in_tok_first
suffix:semicolon
r_for
c_loop
(paren
id|in_tok
op_assign
id|start_tok
suffix:semicolon
id|in_tok
suffix:semicolon
id|in_tok
op_assign
id|following_tok
)paren
(brace
id|following_tok
op_assign
id|backwards
ques
c_cond
id|in_tok-&gt;previous
suffix:colon
id|in_tok-&gt;next
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|same_token
c_func
(paren
id|in_tok
comma
id|arg_tok
)paren
)paren
r_continue
suffix:semicolon
id|on_tok
op_assign
id|middle
ques
c_cond
id|in_tok
suffix:colon
id|start_tok
suffix:semicolon
id|apply_arg_if_exists
c_func
(paren
id|in_tok
comma
id|arg_tok
comma
id|on_tok
comma
id|in_tok_first
comma
id|in_tok_last
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|process_trailers_lists
r_static
r_void
id|process_trailers_lists
c_func
(paren
r_struct
id|trailer_item
op_star
op_star
id|in_tok_first
comma
r_struct
id|trailer_item
op_star
op_star
id|in_tok_last
comma
r_struct
id|trailer_item
op_star
op_star
id|arg_tok_first
)paren
(brace
r_struct
id|trailer_item
op_star
id|arg_tok
suffix:semicolon
r_struct
id|trailer_item
op_star
id|next_arg
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
op_star
id|arg_tok_first
)paren
r_return
suffix:semicolon
r_for
c_loop
(paren
id|arg_tok
op_assign
op_star
id|arg_tok_first
suffix:semicolon
id|arg_tok
suffix:semicolon
id|arg_tok
op_assign
id|next_arg
)paren
(brace
r_int
id|applied
op_assign
l_int|0
suffix:semicolon
id|next_arg
op_assign
id|arg_tok-&gt;next
suffix:semicolon
id|remove_from_list
c_func
(paren
id|arg_tok
comma
id|arg_tok_first
comma
l_int|NULL
)paren
suffix:semicolon
id|applied
op_assign
id|find_same_and_apply_arg
c_func
(paren
id|in_tok_first
comma
id|in_tok_last
comma
id|arg_tok
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|applied
)paren
id|apply_arg_if_missing
c_func
(paren
id|in_tok_first
comma
id|in_tok_last
comma
id|arg_tok
)paren
suffix:semicolon
)brace
)brace
eof
