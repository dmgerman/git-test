macro_line|#include &quot;cache.h&quot;
macro_line|#include &quot;unix-socket.h&quot;
DECL|function|unix_stream_socket
r_static
r_int
id|unix_stream_socket
c_func
(paren
r_void
)paren
(brace
r_int
id|fd
op_assign
id|socket
c_func
(paren
id|AF_UNIX
comma
id|SOCK_STREAM
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fd
OL
l_int|0
)paren
id|die_errno
c_func
(paren
l_string|&quot;unable to create socket&quot;
)paren
suffix:semicolon
r_return
id|fd
suffix:semicolon
)brace
DECL|function|unix_sockaddr_init
r_static
r_void
id|unix_sockaddr_init
c_func
(paren
r_struct
id|sockaddr_un
op_star
id|sa
comma
r_const
r_char
op_star
id|path
)paren
(brace
r_int
id|size
op_assign
id|strlen
c_func
(paren
id|path
)paren
op_plus
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|size
OG
r_sizeof
(paren
id|sa-&gt;sun_path
)paren
)paren
id|die
c_func
(paren
l_string|&quot;socket path is too long to fit in sockaddr&quot;
)paren
suffix:semicolon
id|memset
c_func
(paren
id|sa
comma
l_int|0
comma
r_sizeof
(paren
op_star
id|sa
)paren
)paren
suffix:semicolon
id|sa-&gt;sun_family
op_assign
id|AF_UNIX
suffix:semicolon
id|memcpy
c_func
(paren
id|sa-&gt;sun_path
comma
id|path
comma
id|size
)paren
suffix:semicolon
)brace
DECL|function|unix_stream_connect
r_int
id|unix_stream_connect
c_func
(paren
r_const
r_char
op_star
id|path
)paren
(brace
r_int
id|fd
suffix:semicolon
r_struct
id|sockaddr_un
id|sa
suffix:semicolon
id|unix_sockaddr_init
c_func
(paren
op_amp
id|sa
comma
id|path
)paren
suffix:semicolon
id|fd
op_assign
id|unix_stream_socket
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|connect
c_func
(paren
id|fd
comma
(paren
r_struct
id|sockaddr
op_star
)paren
op_amp
id|sa
comma
r_sizeof
(paren
id|sa
)paren
)paren
OL
l_int|0
)paren
(brace
id|close
c_func
(paren
id|fd
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_return
id|fd
suffix:semicolon
)brace
DECL|function|unix_stream_listen
r_int
id|unix_stream_listen
c_func
(paren
r_const
r_char
op_star
id|path
)paren
(brace
r_int
id|fd
suffix:semicolon
r_struct
id|sockaddr_un
id|sa
suffix:semicolon
id|unix_sockaddr_init
c_func
(paren
op_amp
id|sa
comma
id|path
)paren
suffix:semicolon
id|fd
op_assign
id|unix_stream_socket
c_func
(paren
)paren
suffix:semicolon
id|unlink
c_func
(paren
id|path
)paren
suffix:semicolon
r_if
c_cond
(paren
id|bind
c_func
(paren
id|fd
comma
(paren
r_struct
id|sockaddr
op_star
)paren
op_amp
id|sa
comma
r_sizeof
(paren
id|sa
)paren
)paren
OL
l_int|0
)paren
(brace
id|close
c_func
(paren
id|fd
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
id|listen
c_func
(paren
id|fd
comma
l_int|5
)paren
OL
l_int|0
)paren
(brace
id|close
c_func
(paren
id|fd
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_return
id|fd
suffix:semicolon
)brace
eof
