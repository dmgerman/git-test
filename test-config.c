macro_line|#include &quot;cache.h&quot;
macro_line|#include &quot;string-list.h&quot;
multiline_comment|/*&n; * This program exposes the C API of the configuration mechanism&n; * as a set of simple commands in order to facilitate testing.&n; *&n; * Reads stdin and prints result of command to stdout:&n; *&n; * get_value -&gt; prints the value with highest priority for the entered key&n; *&n; * get_value_multi -&gt; prints all values for the entered key in increasing order&n; *&t;&t;     of priority&n; *&n; * get_int -&gt; print integer value for the entered key or die&n; *&n; * get_bool -&gt; print bool value for the entered key or die&n; *&n; * get_string -&gt; print string value for the entered key or die&n; *&n; * configset_get_value -&gt; returns value with the highest priority for the entered key&n; * &t;&t;&t;from a config_set constructed from files entered as arguments.&n; *&n; * configset_get_value_multi -&gt; returns value_list for the entered key sorted in&n; * &t;&t;&t;&t;ascending order of priority from a config_set&n; * &t;&t;&t;&t;constructed from files entered as arguments.&n; *&n; * Examples:&n; *&n; * To print the value with highest priority for key &quot;foo.bAr Baz.rock&quot;:&n; * &t;test-config get_value &quot;foo.bAr Baz.rock&quot;&n; *&n; */
DECL|function|main
r_int
id|main
c_func
(paren
r_int
id|argc
comma
r_char
op_star
op_star
id|argv
)paren
(brace
r_int
id|i
comma
id|val
suffix:semicolon
r_const
r_char
op_star
id|v
suffix:semicolon
r_const
r_struct
id|string_list
op_star
id|strptr
suffix:semicolon
r_struct
id|config_set
id|cs
suffix:semicolon
id|git_configset_init
c_func
(paren
op_amp
id|cs
)paren
suffix:semicolon
r_if
c_cond
(paren
id|argc
OL
l_int|2
)paren
(brace
id|fprintf
c_func
(paren
id|stderr
comma
l_string|&quot;Please, provide a command name on the command-line&bslash;n&quot;
)paren
suffix:semicolon
r_goto
id|exit1
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|argc
op_eq
l_int|3
op_logical_and
op_logical_neg
id|strcmp
c_func
(paren
id|argv
(braket
l_int|1
)braket
comma
l_string|&quot;get_value&quot;
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|git_config_get_value
c_func
(paren
id|argv
(braket
l_int|2
)braket
comma
op_amp
id|v
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|v
)paren
id|printf
c_func
(paren
l_string|&quot;(NULL)&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|printf
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|v
)paren
suffix:semicolon
r_goto
id|exit0
suffix:semicolon
)brace
r_else
(brace
id|printf
c_func
(paren
l_string|&quot;Value not found for &bslash;&quot;%s&bslash;&quot;&bslash;n&quot;
comma
id|argv
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_goto
id|exit1
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|argc
op_eq
l_int|3
op_logical_and
op_logical_neg
id|strcmp
c_func
(paren
id|argv
(braket
l_int|1
)braket
comma
l_string|&quot;get_value_multi&quot;
)paren
)paren
(brace
id|strptr
op_assign
id|git_config_get_value_multi
c_func
(paren
id|argv
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strptr
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|strptr-&gt;nr
suffix:semicolon
id|i
op_increment
)paren
(brace
id|v
op_assign
id|strptr-&gt;items
(braket
id|i
)braket
dot
id|string
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|v
)paren
id|printf
c_func
(paren
l_string|&quot;(NULL)&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|printf
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|v
)paren
suffix:semicolon
)brace
r_goto
id|exit0
suffix:semicolon
)brace
r_else
(brace
id|printf
c_func
(paren
l_string|&quot;Value not found for &bslash;&quot;%s&bslash;&quot;&bslash;n&quot;
comma
id|argv
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_goto
id|exit1
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|argc
op_eq
l_int|3
op_logical_and
op_logical_neg
id|strcmp
c_func
(paren
id|argv
(braket
l_int|1
)braket
comma
l_string|&quot;get_int&quot;
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|git_config_get_int
c_func
(paren
id|argv
(braket
l_int|2
)braket
comma
op_amp
id|val
)paren
)paren
(brace
id|printf
c_func
(paren
l_string|&quot;%d&bslash;n&quot;
comma
id|val
)paren
suffix:semicolon
r_goto
id|exit0
suffix:semicolon
)brace
r_else
(brace
id|printf
c_func
(paren
l_string|&quot;Value not found for &bslash;&quot;%s&bslash;&quot;&bslash;n&quot;
comma
id|argv
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_goto
id|exit1
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|argc
op_eq
l_int|3
op_logical_and
op_logical_neg
id|strcmp
c_func
(paren
id|argv
(braket
l_int|1
)braket
comma
l_string|&quot;get_bool&quot;
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|git_config_get_bool
c_func
(paren
id|argv
(braket
l_int|2
)braket
comma
op_amp
id|val
)paren
)paren
(brace
id|printf
c_func
(paren
l_string|&quot;%d&bslash;n&quot;
comma
id|val
)paren
suffix:semicolon
r_goto
id|exit0
suffix:semicolon
)brace
r_else
(brace
id|printf
c_func
(paren
l_string|&quot;Value not found for &bslash;&quot;%s&bslash;&quot;&bslash;n&quot;
comma
id|argv
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_goto
id|exit1
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
id|argc
op_eq
l_int|3
op_logical_and
op_logical_neg
id|strcmp
c_func
(paren
id|argv
(braket
l_int|1
)braket
comma
l_string|&quot;get_string&quot;
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|git_config_get_string_const
c_func
(paren
id|argv
(braket
l_int|2
)braket
comma
op_amp
id|v
)paren
)paren
(brace
id|printf
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|v
)paren
suffix:semicolon
r_goto
id|exit0
suffix:semicolon
)brace
r_else
(brace
id|printf
c_func
(paren
l_string|&quot;Value not found for &bslash;&quot;%s&bslash;&quot;&bslash;n&quot;
comma
id|argv
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_goto
id|exit1
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|argv
(braket
l_int|1
)braket
comma
l_string|&quot;configset_get_value&quot;
)paren
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|3
suffix:semicolon
id|i
OL
id|argc
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|git_configset_add_file
c_func
(paren
op_amp
id|cs
comma
id|argv
(braket
id|i
)braket
)paren
)paren
)paren
(brace
id|fprintf
c_func
(paren
id|stderr
comma
l_string|&quot;Error (%d) reading configuration file %s.&bslash;n&quot;
comma
id|err
comma
id|argv
(braket
id|i
)braket
)paren
suffix:semicolon
r_goto
id|exit2
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
op_logical_neg
id|git_configset_get_value
c_func
(paren
op_amp
id|cs
comma
id|argv
(braket
l_int|2
)braket
comma
op_amp
id|v
)paren
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|v
)paren
id|printf
c_func
(paren
l_string|&quot;(NULL)&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|printf
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|v
)paren
suffix:semicolon
r_goto
id|exit0
suffix:semicolon
)brace
r_else
(brace
id|printf
c_func
(paren
l_string|&quot;Value not found for &bslash;&quot;%s&bslash;&quot;&bslash;n&quot;
comma
id|argv
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_goto
id|exit1
suffix:semicolon
)brace
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|argv
(braket
l_int|1
)braket
comma
l_string|&quot;configset_get_value_multi&quot;
)paren
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|3
suffix:semicolon
id|i
OL
id|argc
suffix:semicolon
id|i
op_increment
)paren
(brace
r_int
id|err
suffix:semicolon
r_if
c_cond
(paren
(paren
id|err
op_assign
id|git_configset_add_file
c_func
(paren
op_amp
id|cs
comma
id|argv
(braket
id|i
)braket
)paren
)paren
)paren
(brace
id|fprintf
c_func
(paren
id|stderr
comma
l_string|&quot;Error (%d) reading configuration file %s.&bslash;n&quot;
comma
id|err
comma
id|argv
(braket
id|i
)braket
)paren
suffix:semicolon
r_goto
id|exit2
suffix:semicolon
)brace
)brace
id|strptr
op_assign
id|git_configset_get_value_multi
c_func
(paren
op_amp
id|cs
comma
id|argv
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strptr
)paren
(brace
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|strptr-&gt;nr
suffix:semicolon
id|i
op_increment
)paren
(brace
id|v
op_assign
id|strptr-&gt;items
(braket
id|i
)braket
dot
id|string
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|v
)paren
id|printf
c_func
(paren
l_string|&quot;(NULL)&bslash;n&quot;
)paren
suffix:semicolon
r_else
id|printf
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|v
)paren
suffix:semicolon
)brace
r_goto
id|exit0
suffix:semicolon
)brace
r_else
(brace
id|printf
c_func
(paren
l_string|&quot;Value not found for &bslash;&quot;%s&bslash;&quot;&bslash;n&quot;
comma
id|argv
(braket
l_int|2
)braket
)paren
suffix:semicolon
r_goto
id|exit1
suffix:semicolon
)brace
)brace
id|die
c_func
(paren
l_string|&quot;%s: Please check the syntax and the function name&quot;
comma
id|argv
(braket
l_int|0
)braket
)paren
suffix:semicolon
id|exit0
suffix:colon
id|git_configset_clear
c_func
(paren
op_amp
id|cs
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
id|exit1
suffix:colon
id|git_configset_clear
c_func
(paren
op_amp
id|cs
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
id|exit2
suffix:colon
id|git_configset_clear
c_func
(paren
op_amp
id|cs
)paren
suffix:semicolon
r_return
l_int|2
suffix:semicolon
)brace
eof
