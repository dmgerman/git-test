multiline_comment|/*&n; *&n; * Copyright (C) 1999 David Mazieres (dm@uun.org)&n; *&n; * This program is free software; you can redistribute it and/or&n; * modify it under the terms of the GNU General Public License as&n; * published by the Free Software Foundation; either version 2, or (at&n; * your option) any later version.&n; *&n; * This program is distributed in the hope that it will be useful, but&n; * WITHOUT ANY WARRANTY; without even the implied warranty of&n; * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU&n; * General Public License for more details.&n; *&n; * You should have received a copy of the GNU General Public License&n; * along with this program; if not, write to the Free Software&n; * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307&n; * USA&n; *&n; */
multiline_comment|/* Faster generic_fls */
multiline_comment|/* (c) 2002, D.Phillips and Sistina Software */
macro_line|#include &quot;rabinpoly.h&quot;
DECL|macro|MSB64
mdefine_line|#define MSB64 0x8000000000000000ULL
DECL|function|fls8
r_static
r_inline
r_int
id|fls8
c_func
(paren
r_int
id|n
)paren
(brace
r_return
id|n
op_amp
l_int|0xf0
ques
c_cond
id|n
op_amp
l_int|0xc0
ques
c_cond
(paren
id|n
op_rshift
l_int|7
)paren
op_plus
l_int|7
suffix:colon
(paren
id|n
op_rshift
l_int|5
)paren
op_plus
l_int|5
suffix:colon
id|n
op_amp
l_int|0x0c
ques
c_cond
(paren
id|n
op_rshift
l_int|3
)paren
op_plus
l_int|3
suffix:colon
id|n
(paren
(paren
id|n
op_plus
l_int|1
)paren
op_rshift
l_int|2
)paren
suffix:semicolon
)brace
DECL|function|fls16
r_static
r_inline
r_int
id|fls16
c_func
(paren
r_int
id|n
)paren
(brace
r_return
id|n
op_amp
l_int|0xff00
ques
c_cond
id|fls8
c_func
(paren
id|n
op_rshift
l_int|8
)paren
op_plus
l_int|8
suffix:colon
id|fls8
c_func
(paren
id|n
)paren
suffix:semicolon
)brace
DECL|function|fls32
r_static
r_inline
r_int
id|fls32
c_func
(paren
r_int
id|n
)paren
(brace
r_return
id|n
op_amp
l_int|0xffff0000
ques
c_cond
id|fls16
c_func
(paren
id|n
op_rshift
l_int|16
)paren
op_plus
l_int|16
suffix:colon
id|fls16
c_func
(paren
id|n
)paren
suffix:semicolon
)brace
DECL|function|fls64
r_static
r_inline
r_int
id|fls64
c_func
(paren
r_int
r_int
r_int
id|n
)paren
multiline_comment|/* should be u64 */
(brace
r_return
id|n
op_amp
l_int|0xffffffff00000000ULL
ques
c_cond
id|fls32
c_func
(paren
id|n
op_rshift
l_int|32
)paren
op_plus
l_int|32
suffix:colon
id|fls32
c_func
(paren
id|n
)paren
suffix:semicolon
)brace
r_static
id|u_int64_t
id|polymod
(paren
id|u_int64_t
id|nh
comma
id|u_int64_t
id|nl
comma
id|u_int64_t
id|d
)paren
suffix:semicolon
r_static
r_void
id|polymult
(paren
id|u_int64_t
op_star
id|php
comma
id|u_int64_t
op_star
id|plp
comma
id|u_int64_t
id|x
comma
id|u_int64_t
id|y
)paren
suffix:semicolon
r_static
id|u_int64_t
id|polymmult
(paren
id|u_int64_t
id|x
comma
id|u_int64_t
id|y
comma
id|u_int64_t
id|d
)paren
suffix:semicolon
DECL|variable|poly
r_static
id|u_int64_t
id|poly
op_assign
l_int|0xb15e234bd3792f63ull
suffix:semicolon
singleline_comment|// Actual polynomial
DECL|variable|T
r_static
id|u_int64_t
id|T
(braket
l_int|256
)braket
suffix:semicolon
singleline_comment|// Lookup table for mod
DECL|variable|shift
r_static
r_int
id|shift
suffix:semicolon
DECL|function|append8
id|u_int64_t
id|append8
(paren
id|u_int64_t
id|p
comma
id|u_char
id|m
)paren
(brace
r_return
(paren
(paren
id|p
op_lshift
l_int|8
)paren
op_or
id|m
)paren
op_xor
id|T
(braket
id|p
op_rshift
id|shift
)braket
suffix:semicolon
)brace
r_static
id|u_int64_t
DECL|function|polymod
id|polymod
(paren
id|u_int64_t
id|nh
comma
id|u_int64_t
id|nl
comma
id|u_int64_t
id|d
)paren
(brace
r_int
id|i
comma
id|k
suffix:semicolon
m_assert
(paren
id|d
)paren
suffix:semicolon
id|k
op_assign
id|fls64
(paren
id|d
)paren
l_int|1
suffix:semicolon
id|d
op_lshift_assign
l_int|63
id|k
suffix:semicolon
r_if
c_cond
(paren
id|nh
)paren
(brace
r_if
c_cond
(paren
id|nh
op_amp
id|MSB64
)paren
id|nh
op_xor_assign
id|d
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|62
suffix:semicolon
id|i
op_ge
l_int|0
suffix:semicolon
id|i
op_decrement
)paren
r_if
c_cond
(paren
id|nh
op_amp
l_int|1ULL
op_lshift
id|i
)paren
(brace
id|nh
op_xor_assign
id|d
op_rshift
(paren
l_int|63
id|i
)paren
suffix:semicolon
id|nl
op_xor_assign
id|d
op_lshift
(paren
id|i
op_plus
l_int|1
)paren
suffix:semicolon
)brace
)brace
r_for
c_loop
(paren
id|i
op_assign
l_int|63
suffix:semicolon
id|i
op_ge
id|k
suffix:semicolon
id|i
op_decrement
)paren
r_if
c_cond
(paren
id|nl
op_amp
l_int|1ULL
op_lshift
id|i
)paren
id|nl
op_xor_assign
id|d
op_rshift
(paren
l_int|63
id|i
)paren
suffix:semicolon
r_return
id|nl
suffix:semicolon
)brace
r_static
r_void
DECL|function|polymult
id|polymult
(paren
id|u_int64_t
op_star
id|php
comma
id|u_int64_t
op_star
id|plp
comma
id|u_int64_t
id|x
comma
id|u_int64_t
id|y
)paren
(brace
r_int
id|i
suffix:semicolon
id|u_int64_t
id|ph
op_assign
l_int|0
comma
id|pl
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|x
op_amp
l_int|1
)paren
id|pl
op_assign
id|y
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
l_int|64
suffix:semicolon
id|i
op_increment
)paren
r_if
c_cond
(paren
id|x
op_amp
(paren
l_int|1ULL
op_lshift
id|i
)paren
)paren
(brace
id|ph
op_xor_assign
id|y
op_rshift
(paren
l_int|64
id|i
)paren
suffix:semicolon
id|pl
op_xor_assign
id|y
op_lshift
id|i
suffix:semicolon
)brace
r_if
c_cond
(paren
id|php
)paren
op_star
id|php
op_assign
id|ph
suffix:semicolon
r_if
c_cond
(paren
id|plp
)paren
op_star
id|plp
op_assign
id|pl
suffix:semicolon
)brace
r_static
id|u_int64_t
DECL|function|polymmult
id|polymmult
(paren
id|u_int64_t
id|x
comma
id|u_int64_t
id|y
comma
id|u_int64_t
id|d
)paren
(brace
id|u_int64_t
id|h
comma
id|l
suffix:semicolon
id|polymult
(paren
op_amp
id|h
comma
op_amp
id|l
comma
id|x
comma
id|y
)paren
suffix:semicolon
r_return
id|polymod
(paren
id|h
comma
id|l
comma
id|d
)paren
suffix:semicolon
)brace
DECL|variable|size
r_static
r_int
id|size
op_assign
id|RABIN_WINDOW_SIZE
suffix:semicolon
DECL|variable|fingerprint
r_static
id|u_int64_t
id|fingerprint
op_assign
l_int|0
suffix:semicolon
DECL|variable|bufpos
r_static
r_int
id|bufpos
op_assign
l_int|1
suffix:semicolon
DECL|variable|U
r_static
id|u_int64_t
id|U
(braket
l_int|256
)braket
suffix:semicolon
DECL|variable|buf
r_static
id|u_char
id|buf
(braket
id|RABIN_WINDOW_SIZE
)braket
suffix:semicolon
DECL|function|rabin_init
r_void
id|rabin_init
(paren
)paren
(brace
id|u_int64_t
id|sizeshift
op_assign
l_int|1
suffix:semicolon
id|u_int64_t
id|T1
suffix:semicolon
r_int
id|xshift
suffix:semicolon
r_int
id|i
comma
id|j
suffix:semicolon
m_assert
(paren
id|poly
op_ge
l_int|0x100
)paren
suffix:semicolon
id|xshift
op_assign
id|fls64
(paren
id|poly
)paren
l_int|1
suffix:semicolon
id|shift
op_assign
id|xshift
l_int|8
suffix:semicolon
id|T1
op_assign
id|polymod
(paren
l_int|0
comma
l_int|1ULL
op_lshift
id|xshift
comma
id|poly
)paren
suffix:semicolon
r_for
c_loop
(paren
id|j
op_assign
l_int|0
suffix:semicolon
id|j
OL
l_int|256
suffix:semicolon
id|j
op_increment
)paren
id|T
(braket
id|j
)braket
op_assign
id|polymmult
(paren
id|j
comma
id|T1
comma
id|poly
)paren
op_or
(paren
(paren
id|u_int64_t
)paren
id|j
op_lshift
id|xshift
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|1
suffix:semicolon
id|i
OL
id|size
suffix:semicolon
id|i
op_increment
)paren
id|sizeshift
op_assign
id|append8
(paren
id|sizeshift
comma
l_int|0
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
l_int|256
suffix:semicolon
id|i
op_increment
)paren
id|U
(braket
id|i
)braket
op_assign
id|polymmult
(paren
id|i
comma
id|sizeshift
comma
id|poly
)paren
suffix:semicolon
id|bzero
(paren
id|buf
comma
r_sizeof
(paren
id|buf
)paren
)paren
suffix:semicolon
)brace
r_void
DECL|function|rabin_reset
id|rabin_reset
(paren
)paren
(brace
id|rabin_init
c_func
(paren
)paren
suffix:semicolon
id|fingerprint
op_assign
l_int|0
suffix:semicolon
id|bzero
(paren
id|buf
comma
r_sizeof
(paren
id|buf
)paren
)paren
suffix:semicolon
)brace
id|u_int64_t
DECL|function|rabin_slide8
id|rabin_slide8
(paren
id|u_char
id|m
)paren
(brace
id|u_char
id|om
suffix:semicolon
r_if
c_cond
(paren
op_increment
id|bufpos
op_ge
id|size
)paren
id|bufpos
op_assign
l_int|0
suffix:semicolon
id|om
op_assign
id|buf
(braket
id|bufpos
)braket
suffix:semicolon
id|buf
(braket
id|bufpos
)braket
op_assign
id|m
suffix:semicolon
id|fingerprint
op_assign
id|append8
(paren
id|fingerprint
op_xor
id|U
(braket
id|om
)braket
comma
id|m
)paren
suffix:semicolon
r_return
id|fingerprint
suffix:semicolon
)brace
eof
