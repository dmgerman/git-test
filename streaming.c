multiline_comment|/*&n; * Copyright (c) 2011, Google Inc.&n; */
macro_line|#include &quot;cache.h&quot;
macro_line|#include &quot;streaming.h&quot;
DECL|enum|input_source
r_enum
id|input_source
(brace
DECL|enumerator|stream_error
id|stream_error
op_assign
l_int|1
comma
DECL|enumerator|incore
id|incore
op_assign
l_int|0
comma
DECL|enumerator|loose
id|loose
op_assign
l_int|1
comma
DECL|enumerator|pack_non_delta
id|pack_non_delta
op_assign
l_int|2
)brace
suffix:semicolon
DECL|typedef|open_istream_fn
r_typedef
r_int
(paren
op_star
id|open_istream_fn
)paren
(paren
r_struct
id|git_istream
op_star
comma
r_struct
id|object_info
op_star
comma
r_const
r_int
r_char
op_star
comma
r_enum
id|object_type
op_star
)paren
suffix:semicolon
DECL|typedef|close_istream_fn
r_typedef
r_int
(paren
op_star
id|close_istream_fn
)paren
(paren
r_struct
id|git_istream
op_star
)paren
suffix:semicolon
DECL|typedef|read_istream_fn
r_typedef
id|ssize_t
(paren
op_star
id|read_istream_fn
)paren
(paren
r_struct
id|git_istream
op_star
comma
r_char
op_star
comma
r_int
)paren
suffix:semicolon
DECL|struct|stream_vtbl
r_struct
id|stream_vtbl
(brace
DECL|member|close
id|close_istream_fn
id|close
suffix:semicolon
DECL|member|read
id|read_istream_fn
id|read
suffix:semicolon
)brace
suffix:semicolon
DECL|macro|open_method_decl
mdefine_line|#define open_method_decl(name) &bslash;&n;&t;int open_istream_ ##name &bslash;&n;&t;(struct git_istream *st, struct object_info *oi, &bslash;&n;&t; const unsigned char *sha1, &bslash;&n;&t; enum object_type *type)
DECL|macro|close_method_decl
mdefine_line|#define close_method_decl(name) &bslash;&n;&t;int close_istream_ ##name &bslash;&n;&t;(struct git_istream *st)
DECL|macro|read_method_decl
mdefine_line|#define read_method_decl(name) &bslash;&n;&t;ssize_t read_istream_ ##name &bslash;&n;&t;(struct git_istream *st, char *buf, size_t sz)
multiline_comment|/* forward declaration */
r_static
id|open_method_decl
c_func
(paren
id|incore
)paren
suffix:semicolon
r_static
id|open_method_decl
c_func
(paren
id|loose
)paren
suffix:semicolon
r_static
id|open_method_decl
c_func
(paren
id|pack_non_delta
)paren
suffix:semicolon
r_static
r_struct
id|git_istream
op_star
id|attach_stream_filter
c_func
(paren
r_struct
id|git_istream
op_star
id|st
comma
r_struct
id|stream_filter
op_star
id|filter
)paren
suffix:semicolon
DECL|variable|open_istream_tbl
r_static
id|open_istream_fn
id|open_istream_tbl
(braket
)braket
op_assign
(brace
id|open_istream_incore
comma
id|open_istream_loose
comma
id|open_istream_pack_non_delta
comma
)brace
suffix:semicolon
DECL|macro|FILTER_BUFFER
mdefine_line|#define FILTER_BUFFER (1024*16)
DECL|struct|filtered_istream
r_struct
id|filtered_istream
(brace
DECL|member|upstream
r_struct
id|git_istream
op_star
id|upstream
suffix:semicolon
DECL|member|filter
r_struct
id|stream_filter
op_star
id|filter
suffix:semicolon
DECL|member|ibuf
r_char
id|ibuf
(braket
id|FILTER_BUFFER
)braket
suffix:semicolon
DECL|member|obuf
r_char
id|obuf
(braket
id|FILTER_BUFFER
)braket
suffix:semicolon
DECL|member|i_end
DECL|member|i_ptr
r_int
id|i_end
comma
id|i_ptr
suffix:semicolon
DECL|member|o_end
DECL|member|o_ptr
r_int
id|o_end
comma
id|o_ptr
suffix:semicolon
DECL|member|input_finished
r_int
id|input_finished
suffix:semicolon
)brace
suffix:semicolon
DECL|struct|git_istream
r_struct
id|git_istream
(brace
DECL|member|vtbl
r_const
r_struct
id|stream_vtbl
op_star
id|vtbl
suffix:semicolon
DECL|member|size
r_int
r_int
id|size
suffix:semicolon
multiline_comment|/* inflated size of full object */
DECL|member|z
id|git_zstream
id|z
suffix:semicolon
DECL|enumerator|z_unused
DECL|enumerator|z_used
DECL|enumerator|z_done
DECL|enumerator|z_error
DECL|member|z_state
r_enum
(brace
id|z_unused
comma
id|z_used
comma
id|z_done
comma
id|z_error
)brace
id|z_state
suffix:semicolon
r_union
(brace
r_struct
(brace
DECL|member|buf
r_char
op_star
id|buf
suffix:semicolon
multiline_comment|/* from read_object() */
DECL|member|read_ptr
r_int
r_int
id|read_ptr
suffix:semicolon
DECL|member|incore
)brace
id|incore
suffix:semicolon
r_struct
(brace
DECL|member|mapped
r_void
op_star
id|mapped
suffix:semicolon
DECL|member|mapsize
r_int
r_int
id|mapsize
suffix:semicolon
DECL|member|hdr
r_char
id|hdr
(braket
l_int|32
)braket
suffix:semicolon
DECL|member|hdr_avail
r_int
id|hdr_avail
suffix:semicolon
DECL|member|hdr_used
r_int
id|hdr_used
suffix:semicolon
DECL|member|loose
)brace
id|loose
suffix:semicolon
r_struct
(brace
DECL|member|pack
r_struct
id|packed_git
op_star
id|pack
suffix:semicolon
DECL|member|pos
id|off_t
id|pos
suffix:semicolon
DECL|member|in_pack
)brace
id|in_pack
suffix:semicolon
DECL|member|filtered
r_struct
id|filtered_istream
id|filtered
suffix:semicolon
DECL|member|u
)brace
id|u
suffix:semicolon
)brace
suffix:semicolon
DECL|function|close_istream
r_int
id|close_istream
c_func
(paren
r_struct
id|git_istream
op_star
id|st
)paren
(brace
r_int
id|r
op_assign
id|st-&gt;vtbl
op_member_access_from_pointer
id|close
c_func
(paren
id|st
)paren
suffix:semicolon
id|free
c_func
(paren
id|st
)paren
suffix:semicolon
r_return
id|r
suffix:semicolon
)brace
DECL|function|read_istream
id|ssize_t
id|read_istream
c_func
(paren
r_struct
id|git_istream
op_star
id|st
comma
r_void
op_star
id|buf
comma
r_int
id|sz
)paren
(brace
r_return
id|st-&gt;vtbl
op_member_access_from_pointer
id|read
c_func
(paren
id|st
comma
id|buf
comma
id|sz
)paren
suffix:semicolon
)brace
DECL|function|istream_source
r_static
r_enum
id|input_source
id|istream_source
c_func
(paren
r_const
r_int
r_char
op_star
id|sha1
comma
r_enum
id|object_type
op_star
id|type
comma
r_struct
id|object_info
op_star
id|oi
)paren
(brace
r_int
r_int
id|size
suffix:semicolon
r_int
id|status
suffix:semicolon
id|oi-&gt;sizep
op_assign
op_amp
id|size
suffix:semicolon
id|status
op_assign
id|sha1_object_info_extended
c_func
(paren
id|sha1
comma
id|oi
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
OL
l_int|0
)paren
r_return
id|stream_error
suffix:semicolon
op_star
id|type
op_assign
id|status
suffix:semicolon
r_switch
c_cond
(paren
id|oi-&gt;whence
)paren
(brace
r_case
id|OI_LOOSE
suffix:colon
r_return
id|loose
suffix:semicolon
r_case
id|OI_PACKED
suffix:colon
r_if
c_cond
(paren
op_logical_neg
id|oi-&gt;u.packed.is_delta
op_logical_and
id|big_file_threshold
op_le
id|size
)paren
r_return
id|pack_non_delta
suffix:semicolon
multiline_comment|/* fallthru */
r_default
suffix:colon
r_return
id|incore
suffix:semicolon
)brace
)brace
DECL|function|open_istream
r_struct
id|git_istream
op_star
id|open_istream
c_func
(paren
r_const
r_int
r_char
op_star
id|sha1
comma
r_enum
id|object_type
op_star
id|type
comma
r_int
r_int
op_star
id|size
comma
r_struct
id|stream_filter
op_star
id|filter
)paren
(brace
r_struct
id|git_istream
op_star
id|st
suffix:semicolon
r_struct
id|object_info
id|oi
suffix:semicolon
r_const
r_int
r_char
op_star
id|real
op_assign
id|lookup_replace_object
c_func
(paren
id|sha1
)paren
suffix:semicolon
r_enum
id|input_source
id|src
op_assign
id|istream_source
c_func
(paren
id|real
comma
id|type
comma
op_amp
id|oi
)paren
suffix:semicolon
r_if
c_cond
(paren
id|src
OL
l_int|0
)paren
r_return
l_int|NULL
suffix:semicolon
id|st
op_assign
id|xmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|st
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|open_istream_tbl
(braket
id|src
)braket
(paren
id|st
comma
op_amp
id|oi
comma
id|real
comma
id|type
)paren
)paren
(brace
r_if
c_cond
(paren
id|open_istream_incore
c_func
(paren
id|st
comma
op_amp
id|oi
comma
id|real
comma
id|type
)paren
)paren
(brace
id|free
c_func
(paren
id|st
)paren
suffix:semicolon
r_return
l_int|NULL
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|st
op_logical_and
id|filter
)paren
(brace
multiline_comment|/* Add &quot;&amp;&amp; !is_null_stream_filter(filter)&quot; for performance */
r_struct
id|git_istream
op_star
id|nst
op_assign
id|attach_stream_filter
c_func
(paren
id|st
comma
id|filter
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|nst
)paren
id|close_istream
c_func
(paren
id|st
)paren
suffix:semicolon
id|st
op_assign
id|nst
suffix:semicolon
)brace
op_star
id|size
op_assign
id|st-&gt;size
suffix:semicolon
r_return
id|st
suffix:semicolon
)brace
multiline_comment|/*****************************************************************&n; *&n; * Common helpers&n; *&n; *****************************************************************/
DECL|function|close_deflated_stream
r_static
r_void
id|close_deflated_stream
c_func
(paren
r_struct
id|git_istream
op_star
id|st
)paren
(brace
r_if
c_cond
(paren
id|st-&gt;z_state
op_eq
id|z_used
)paren
id|git_inflate_end
c_func
(paren
op_amp
id|st-&gt;z
)paren
suffix:semicolon
)brace
multiline_comment|/*****************************************************************&n; *&n; * Filtered stream&n; *&n; *****************************************************************/
DECL|function|close_method_decl
r_static
id|close_method_decl
c_func
(paren
id|filtered
)paren
(brace
id|free_stream_filter
c_func
(paren
id|st-&gt;u.filtered.filter
)paren
suffix:semicolon
r_return
id|close_istream
c_func
(paren
id|st-&gt;u.filtered.upstream
)paren
suffix:semicolon
)brace
DECL|function|read_method_decl
r_static
id|read_method_decl
c_func
(paren
id|filtered
)paren
(brace
r_struct
id|filtered_istream
op_star
id|fs
op_assign
op_amp
(paren
id|st-&gt;u.filtered
)paren
suffix:semicolon
r_int
id|filled
op_assign
l_int|0
suffix:semicolon
r_while
c_loop
(paren
id|sz
)paren
(brace
multiline_comment|/* do we already have filtered output? */
r_if
c_cond
(paren
id|fs-&gt;o_ptr
OL
id|fs-&gt;o_end
)paren
(brace
r_int
id|to_move
op_assign
id|fs-&gt;o_end
id|fs-&gt;o_ptr
suffix:semicolon
r_if
c_cond
(paren
id|sz
OL
id|to_move
)paren
id|to_move
op_assign
id|sz
suffix:semicolon
id|memcpy
c_func
(paren
id|buf
op_plus
id|filled
comma
id|fs-&gt;obuf
op_plus
id|fs-&gt;o_ptr
comma
id|to_move
)paren
suffix:semicolon
id|fs-&gt;o_ptr
op_add_assign
id|to_move
suffix:semicolon
id|sz
op_sub_assign
id|to_move
suffix:semicolon
id|filled
op_add_assign
id|to_move
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|fs-&gt;o_end
op_assign
id|fs-&gt;o_ptr
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* do we have anything to feed the filter with? */
r_if
c_cond
(paren
id|fs-&gt;i_ptr
OL
id|fs-&gt;i_end
)paren
(brace
r_int
id|to_feed
op_assign
id|fs-&gt;i_end
id|fs-&gt;i_ptr
suffix:semicolon
r_int
id|to_receive
op_assign
id|FILTER_BUFFER
suffix:semicolon
r_if
c_cond
(paren
id|stream_filter
c_func
(paren
id|fs-&gt;filter
comma
id|fs-&gt;ibuf
op_plus
id|fs-&gt;i_ptr
comma
op_amp
id|to_feed
comma
id|fs-&gt;obuf
comma
op_amp
id|to_receive
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|fs-&gt;i_ptr
op_assign
id|fs-&gt;i_end
id|to_feed
suffix:semicolon
id|fs-&gt;o_end
op_assign
id|FILTER_BUFFER
id|to_receive
suffix:semicolon
r_continue
suffix:semicolon
)brace
multiline_comment|/* tell the filter to drain upon no more input */
r_if
c_cond
(paren
id|fs-&gt;input_finished
)paren
(brace
r_int
id|to_receive
op_assign
id|FILTER_BUFFER
suffix:semicolon
r_if
c_cond
(paren
id|stream_filter
c_func
(paren
id|fs-&gt;filter
comma
l_int|NULL
comma
l_int|NULL
comma
id|fs-&gt;obuf
comma
op_amp
id|to_receive
)paren
)paren
r_return
l_int|1
suffix:semicolon
id|fs-&gt;o_end
op_assign
id|FILTER_BUFFER
id|to_receive
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fs-&gt;o_end
)paren
r_break
suffix:semicolon
r_continue
suffix:semicolon
)brace
id|fs-&gt;i_end
op_assign
id|fs-&gt;i_ptr
op_assign
l_int|0
suffix:semicolon
multiline_comment|/* refill the input from the upstream */
r_if
c_cond
(paren
op_logical_neg
id|fs-&gt;input_finished
)paren
(brace
id|fs-&gt;i_end
op_assign
id|read_istream
c_func
(paren
id|fs-&gt;upstream
comma
id|fs-&gt;ibuf
comma
id|FILTER_BUFFER
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fs-&gt;i_end
OL
l_int|0
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|fs-&gt;i_end
)paren
r_continue
suffix:semicolon
)brace
id|fs-&gt;input_finished
op_assign
l_int|1
suffix:semicolon
)brace
r_return
id|filled
suffix:semicolon
)brace
DECL|variable|filtered_vtbl
r_static
r_struct
id|stream_vtbl
id|filtered_vtbl
op_assign
(brace
id|close_istream_filtered
comma
id|read_istream_filtered
comma
)brace
suffix:semicolon
DECL|function|attach_stream_filter
r_static
r_struct
id|git_istream
op_star
id|attach_stream_filter
c_func
(paren
r_struct
id|git_istream
op_star
id|st
comma
r_struct
id|stream_filter
op_star
id|filter
)paren
(brace
r_struct
id|git_istream
op_star
id|ifs
op_assign
id|xmalloc
c_func
(paren
r_sizeof
(paren
op_star
id|ifs
)paren
)paren
suffix:semicolon
r_struct
id|filtered_istream
op_star
id|fs
op_assign
op_amp
(paren
id|ifs-&gt;u.filtered
)paren
suffix:semicolon
id|ifs-&gt;vtbl
op_assign
op_amp
id|filtered_vtbl
suffix:semicolon
id|fs-&gt;upstream
op_assign
id|st
suffix:semicolon
id|fs-&gt;filter
op_assign
id|filter
suffix:semicolon
id|fs-&gt;i_end
op_assign
id|fs-&gt;i_ptr
op_assign
l_int|0
suffix:semicolon
id|fs-&gt;o_end
op_assign
id|fs-&gt;o_ptr
op_assign
l_int|0
suffix:semicolon
id|fs-&gt;input_finished
op_assign
l_int|0
suffix:semicolon
id|ifs-&gt;size
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* unknown */
r_return
id|ifs
suffix:semicolon
)brace
multiline_comment|/*****************************************************************&n; *&n; * Loose object stream&n; *&n; *****************************************************************/
DECL|function|read_method_decl
r_static
id|read_method_decl
c_func
(paren
id|loose
)paren
(brace
r_int
id|total_read
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|st-&gt;z_state
)paren
(brace
r_case
id|z_done
suffix:colon
r_return
l_int|0
suffix:semicolon
r_case
id|z_error
suffix:colon
r_return
l_int|1
suffix:semicolon
r_default
suffix:colon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|st-&gt;u.loose.hdr_used
OL
id|st-&gt;u.loose.hdr_avail
)paren
(brace
r_int
id|to_copy
op_assign
id|st-&gt;u.loose.hdr_avail
id|st-&gt;u.loose.hdr_used
suffix:semicolon
r_if
c_cond
(paren
id|sz
OL
id|to_copy
)paren
id|to_copy
op_assign
id|sz
suffix:semicolon
id|memcpy
c_func
(paren
id|buf
comma
id|st-&gt;u.loose.hdr
op_plus
id|st-&gt;u.loose.hdr_used
comma
id|to_copy
)paren
suffix:semicolon
id|st-&gt;u.loose.hdr_used
op_add_assign
id|to_copy
suffix:semicolon
id|total_read
op_add_assign
id|to_copy
suffix:semicolon
)brace
r_while
c_loop
(paren
id|total_read
OL
id|sz
)paren
(brace
r_int
id|status
suffix:semicolon
id|st-&gt;z.next_out
op_assign
(paren
r_int
r_char
op_star
)paren
id|buf
op_plus
id|total_read
suffix:semicolon
id|st-&gt;z.avail_out
op_assign
id|sz
id|total_read
suffix:semicolon
id|status
op_assign
id|git_inflate
c_func
(paren
op_amp
id|st-&gt;z
comma
id|Z_FINISH
)paren
suffix:semicolon
id|total_read
op_assign
id|st-&gt;z.next_out
(paren
r_int
r_char
op_star
)paren
id|buf
suffix:semicolon
r_if
c_cond
(paren
id|status
op_eq
id|Z_STREAM_END
)paren
(brace
id|git_inflate_end
c_func
(paren
op_amp
id|st-&gt;z
)paren
suffix:semicolon
id|st-&gt;z_state
op_assign
id|z_done
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_ne
id|Z_OK
op_logical_and
id|status
op_ne
id|Z_BUF_ERROR
)paren
(brace
id|git_inflate_end
c_func
(paren
op_amp
id|st-&gt;z
)paren
suffix:semicolon
id|st-&gt;z_state
op_assign
id|z_error
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_return
id|total_read
suffix:semicolon
)brace
DECL|function|close_method_decl
r_static
id|close_method_decl
c_func
(paren
id|loose
)paren
(brace
id|close_deflated_stream
c_func
(paren
id|st
)paren
suffix:semicolon
id|munmap
c_func
(paren
id|st-&gt;u.loose.mapped
comma
id|st-&gt;u.loose.mapsize
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|loose_vtbl
r_static
r_struct
id|stream_vtbl
id|loose_vtbl
op_assign
(brace
id|close_istream_loose
comma
id|read_istream_loose
comma
)brace
suffix:semicolon
DECL|function|open_method_decl
r_static
id|open_method_decl
c_func
(paren
id|loose
)paren
(brace
id|st-&gt;u.loose.mapped
op_assign
id|map_sha1_file
c_func
(paren
id|sha1
comma
op_amp
id|st-&gt;u.loose.mapsize
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|st-&gt;u.loose.mapped
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|unpack_sha1_header
c_func
(paren
op_amp
id|st-&gt;z
comma
id|st-&gt;u.loose.mapped
comma
id|st-&gt;u.loose.mapsize
comma
id|st-&gt;u.loose.hdr
comma
r_sizeof
(paren
id|st-&gt;u.loose.hdr
)paren
)paren
OL
l_int|0
)paren
(brace
id|git_inflate_end
c_func
(paren
op_amp
id|st-&gt;z
)paren
suffix:semicolon
id|munmap
c_func
(paren
id|st-&gt;u.loose.mapped
comma
id|st-&gt;u.loose.mapsize
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|parse_sha1_header
c_func
(paren
id|st-&gt;u.loose.hdr
comma
op_amp
id|st-&gt;size
)paren
suffix:semicolon
id|st-&gt;u.loose.hdr_used
op_assign
id|strlen
c_func
(paren
id|st-&gt;u.loose.hdr
)paren
op_plus
l_int|1
suffix:semicolon
id|st-&gt;u.loose.hdr_avail
op_assign
id|st-&gt;z.total_out
suffix:semicolon
id|st-&gt;z_state
op_assign
id|z_used
suffix:semicolon
id|st-&gt;vtbl
op_assign
op_amp
id|loose_vtbl
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*****************************************************************&n; *&n; * Non-delta packed object stream&n; *&n; *****************************************************************/
DECL|function|read_method_decl
r_static
id|read_method_decl
c_func
(paren
id|pack_non_delta
)paren
(brace
r_int
id|total_read
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|st-&gt;z_state
)paren
(brace
r_case
id|z_unused
suffix:colon
id|memset
c_func
(paren
op_amp
id|st-&gt;z
comma
l_int|0
comma
r_sizeof
(paren
id|st-&gt;z
)paren
)paren
suffix:semicolon
id|git_inflate_init
c_func
(paren
op_amp
id|st-&gt;z
)paren
suffix:semicolon
id|st-&gt;z_state
op_assign
id|z_used
suffix:semicolon
r_break
suffix:semicolon
r_case
id|z_done
suffix:colon
r_return
l_int|0
suffix:semicolon
r_case
id|z_error
suffix:colon
r_return
l_int|1
suffix:semicolon
r_case
id|z_used
suffix:colon
r_break
suffix:semicolon
)brace
r_while
c_loop
(paren
id|total_read
OL
id|sz
)paren
(brace
r_int
id|status
suffix:semicolon
r_struct
id|pack_window
op_star
id|window
op_assign
l_int|NULL
suffix:semicolon
r_int
r_char
op_star
id|mapped
suffix:semicolon
id|mapped
op_assign
id|use_pack
c_func
(paren
id|st-&gt;u.in_pack.pack
comma
op_amp
id|window
comma
id|st-&gt;u.in_pack.pos
comma
op_amp
id|st-&gt;z.avail_in
)paren
suffix:semicolon
id|st-&gt;z.next_out
op_assign
(paren
r_int
r_char
op_star
)paren
id|buf
op_plus
id|total_read
suffix:semicolon
id|st-&gt;z.avail_out
op_assign
id|sz
id|total_read
suffix:semicolon
id|st-&gt;z.next_in
op_assign
id|mapped
suffix:semicolon
id|status
op_assign
id|git_inflate
c_func
(paren
op_amp
id|st-&gt;z
comma
id|Z_FINISH
)paren
suffix:semicolon
id|st-&gt;u.in_pack.pos
op_add_assign
id|st-&gt;z.next_in
id|mapped
suffix:semicolon
id|total_read
op_assign
id|st-&gt;z.next_out
(paren
r_int
r_char
op_star
)paren
id|buf
suffix:semicolon
id|unuse_pack
c_func
(paren
op_amp
id|window
)paren
suffix:semicolon
r_if
c_cond
(paren
id|status
op_eq
id|Z_STREAM_END
)paren
(brace
id|git_inflate_end
c_func
(paren
op_amp
id|st-&gt;z
)paren
suffix:semicolon
id|st-&gt;z_state
op_assign
id|z_done
suffix:semicolon
r_break
suffix:semicolon
)brace
r_if
c_cond
(paren
id|status
op_ne
id|Z_OK
op_logical_and
id|status
op_ne
id|Z_BUF_ERROR
)paren
(brace
id|git_inflate_end
c_func
(paren
op_amp
id|st-&gt;z
)paren
suffix:semicolon
id|st-&gt;z_state
op_assign
id|z_error
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
)brace
r_return
id|total_read
suffix:semicolon
)brace
DECL|function|close_method_decl
r_static
id|close_method_decl
c_func
(paren
id|pack_non_delta
)paren
(brace
id|close_deflated_stream
c_func
(paren
id|st
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|pack_non_delta_vtbl
r_static
r_struct
id|stream_vtbl
id|pack_non_delta_vtbl
op_assign
(brace
id|close_istream_pack_non_delta
comma
id|read_istream_pack_non_delta
comma
)brace
suffix:semicolon
DECL|function|open_method_decl
r_static
id|open_method_decl
c_func
(paren
id|pack_non_delta
)paren
(brace
r_struct
id|pack_window
op_star
id|window
suffix:semicolon
r_enum
id|object_type
id|in_pack_type
suffix:semicolon
id|st-&gt;u.in_pack.pack
op_assign
id|oi-&gt;u.packed.pack
suffix:semicolon
id|st-&gt;u.in_pack.pos
op_assign
id|oi-&gt;u.packed.offset
suffix:semicolon
id|window
op_assign
l_int|NULL
suffix:semicolon
id|in_pack_type
op_assign
id|unpack_object_header
c_func
(paren
id|st-&gt;u.in_pack.pack
comma
op_amp
id|window
comma
op_amp
id|st-&gt;u.in_pack.pos
comma
op_amp
id|st-&gt;size
)paren
suffix:semicolon
id|unuse_pack
c_func
(paren
op_amp
id|window
)paren
suffix:semicolon
r_switch
c_cond
(paren
id|in_pack_type
)paren
(brace
r_default
suffix:colon
r_return
l_int|1
suffix:semicolon
multiline_comment|/* we do not do deltas for now */
r_case
id|OBJ_COMMIT
suffix:colon
r_case
id|OBJ_TREE
suffix:colon
r_case
id|OBJ_BLOB
suffix:colon
r_case
id|OBJ_TAG
suffix:colon
r_break
suffix:semicolon
)brace
id|st-&gt;z_state
op_assign
id|z_unused
suffix:semicolon
id|st-&gt;vtbl
op_assign
op_amp
id|pack_non_delta_vtbl
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*****************************************************************&n; *&n; * In-core stream&n; *&n; *****************************************************************/
DECL|function|close_method_decl
r_static
id|close_method_decl
c_func
(paren
id|incore
)paren
(brace
id|free
c_func
(paren
id|st-&gt;u.incore.buf
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|read_method_decl
r_static
id|read_method_decl
c_func
(paren
id|incore
)paren
(brace
r_int
id|read_size
op_assign
id|sz
suffix:semicolon
r_int
id|remainder
op_assign
id|st-&gt;size
id|st-&gt;u.incore.read_ptr
suffix:semicolon
r_if
c_cond
(paren
id|remainder
op_le
id|read_size
)paren
id|read_size
op_assign
id|remainder
suffix:semicolon
r_if
c_cond
(paren
id|read_size
)paren
(brace
id|memcpy
c_func
(paren
id|buf
comma
id|st-&gt;u.incore.buf
op_plus
id|st-&gt;u.incore.read_ptr
comma
id|read_size
)paren
suffix:semicolon
id|st-&gt;u.incore.read_ptr
op_add_assign
id|read_size
suffix:semicolon
)brace
r_return
id|read_size
suffix:semicolon
)brace
DECL|variable|incore_vtbl
r_static
r_struct
id|stream_vtbl
id|incore_vtbl
op_assign
(brace
id|close_istream_incore
comma
id|read_istream_incore
comma
)brace
suffix:semicolon
DECL|function|open_method_decl
r_static
id|open_method_decl
c_func
(paren
id|incore
)paren
(brace
id|st-&gt;u.incore.buf
op_assign
id|read_sha1_file_extended
c_func
(paren
id|sha1
comma
id|type
comma
op_amp
id|st-&gt;size
comma
l_int|0
)paren
suffix:semicolon
id|st-&gt;u.incore.read_ptr
op_assign
l_int|0
suffix:semicolon
id|st-&gt;vtbl
op_assign
op_amp
id|incore_vtbl
suffix:semicolon
r_return
id|st-&gt;u.incore.buf
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
)brace
multiline_comment|/****************************************************************&n; * Users of streaming interface&n; ****************************************************************/
DECL|function|stream_blob_to_fd
r_int
id|stream_blob_to_fd
c_func
(paren
r_int
id|fd
comma
r_int
r_const
r_char
op_star
id|sha1
comma
r_struct
id|stream_filter
op_star
id|filter
comma
r_int
id|can_seek
)paren
(brace
r_struct
id|git_istream
op_star
id|st
suffix:semicolon
r_enum
id|object_type
id|type
suffix:semicolon
r_int
r_int
id|sz
suffix:semicolon
id|ssize_t
id|kept
op_assign
l_int|0
suffix:semicolon
r_int
id|result
op_assign
l_int|1
suffix:semicolon
id|st
op_assign
id|open_istream
c_func
(paren
id|sha1
comma
op_amp
id|type
comma
op_amp
id|sz
comma
id|filter
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|st
)paren
r_return
id|result
suffix:semicolon
r_if
c_cond
(paren
id|type
op_ne
id|OBJ_BLOB
)paren
r_goto
id|close_and_exit
suffix:semicolon
r_for
c_loop
(paren
suffix:semicolon
suffix:semicolon
)paren
(brace
r_char
id|buf
(braket
l_int|1024
op_star
l_int|16
)braket
suffix:semicolon
id|ssize_t
id|wrote
comma
id|holeto
suffix:semicolon
id|ssize_t
id|readlen
op_assign
id|read_istream
c_func
(paren
id|st
comma
id|buf
comma
r_sizeof
(paren
id|buf
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|readlen
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|can_seek
op_logical_and
r_sizeof
(paren
id|buf
)paren
op_eq
id|readlen
)paren
(brace
r_for
c_loop
(paren
id|holeto
op_assign
l_int|0
suffix:semicolon
id|holeto
OL
id|readlen
suffix:semicolon
id|holeto
op_increment
)paren
r_if
c_cond
(paren
id|buf
(braket
id|holeto
)braket
)paren
r_break
suffix:semicolon
r_if
c_cond
(paren
id|readlen
op_eq
id|holeto
)paren
(brace
id|kept
op_add_assign
id|holeto
suffix:semicolon
r_continue
suffix:semicolon
)brace
)brace
r_if
c_cond
(paren
id|kept
op_logical_and
id|lseek
c_func
(paren
id|fd
comma
id|kept
comma
id|SEEK_CUR
)paren
op_eq
(paren
id|off_t
)paren
l_int|1
)paren
r_goto
id|close_and_exit
suffix:semicolon
r_else
id|kept
op_assign
l_int|0
suffix:semicolon
id|wrote
op_assign
id|write_in_full
c_func
(paren
id|fd
comma
id|buf
comma
id|readlen
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wrote
op_ne
id|readlen
)paren
r_goto
id|close_and_exit
suffix:semicolon
)brace
r_if
c_cond
(paren
id|kept
op_logical_and
(paren
id|lseek
c_func
(paren
id|fd
comma
id|kept
l_int|1
comma
id|SEEK_CUR
)paren
op_eq
(paren
id|off_t
)paren
l_int|1
op_logical_or
id|write
c_func
(paren
id|fd
comma
l_string|&quot;&quot;
comma
l_int|1
)paren
op_ne
l_int|1
)paren
)paren
r_goto
id|close_and_exit
suffix:semicolon
id|result
op_assign
l_int|0
suffix:semicolon
id|close_and_exit
suffix:colon
id|close_istream
c_func
(paren
id|st
)paren
suffix:semicolon
r_return
id|result
suffix:semicolon
)brace
eof
