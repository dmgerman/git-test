multiline_comment|/*&n; * Builtin &quot;git commit&quot;&n; *&n; * Copyright (c) 2007 Kristian H&oslash;gsberg &lt;krh@redhat.com&gt;&n; * Based on git-commit.sh by Junio C Hamano and Linus Torvalds&n; */
macro_line|#include &quot;cache.h&quot;
macro_line|#include &quot;cache-tree.h&quot;
macro_line|#include &quot;color.h&quot;
macro_line|#include &quot;dir.h&quot;
macro_line|#include &quot;builtin.h&quot;
macro_line|#include &quot;diff.h&quot;
macro_line|#include &quot;diffcore.h&quot;
macro_line|#include &quot;commit.h&quot;
macro_line|#include &quot;revision.h&quot;
macro_line|#include &quot;wt-status.h&quot;
macro_line|#include &quot;run-command.h&quot;
macro_line|#include &quot;refs.h&quot;
macro_line|#include &quot;log-tree.h&quot;
macro_line|#include &quot;strbuf.h&quot;
macro_line|#include &quot;utf8.h&quot;
macro_line|#include &quot;parse-options.h&quot;
macro_line|#include &quot;string-list.h&quot;
macro_line|#include &quot;rerere.h&quot;
macro_line|#include &quot;unpack-trees.h&quot;
DECL|variable|builtin_commit_usage
r_static
r_const
r_char
op_star
r_const
id|builtin_commit_usage
(braket
)braket
op_assign
(brace
l_string|&quot;git commit [options] [--] &lt;filepattern&gt;...&quot;
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|builtin_status_usage
r_static
r_const
r_char
op_star
r_const
id|builtin_status_usage
(braket
)braket
op_assign
(brace
l_string|&quot;git status [options] [--] &lt;filepattern&gt;...&quot;
comma
l_int|NULL
)brace
suffix:semicolon
DECL|variable|head_sha1
DECL|variable|merge_head_sha1
r_static
r_int
r_char
id|head_sha1
(braket
l_int|20
)braket
comma
id|merge_head_sha1
(braket
l_int|20
)braket
suffix:semicolon
DECL|variable|use_message_buffer
r_static
r_char
op_star
id|use_message_buffer
suffix:semicolon
DECL|variable|commit_editmsg
r_static
r_const
r_char
id|commit_editmsg
(braket
)braket
op_assign
l_string|&quot;COMMIT_EDITMSG&quot;
suffix:semicolon
DECL|variable|index_lock
r_static
r_struct
id|lock_file
id|index_lock
suffix:semicolon
multiline_comment|/* real index */
DECL|variable|false_lock
r_static
r_struct
id|lock_file
id|false_lock
suffix:semicolon
multiline_comment|/* used only for partial commits */
r_static
r_enum
(brace
DECL|enumerator|COMMIT_AS_IS
id|COMMIT_AS_IS
op_assign
l_int|1
comma
DECL|enumerator|COMMIT_NORMAL
id|COMMIT_NORMAL
comma
DECL|enumerator|COMMIT_PARTIAL
id|COMMIT_PARTIAL
comma
DECL|variable|commit_style
)brace
id|commit_style
suffix:semicolon
DECL|variable|logfile
DECL|variable|force_author
r_static
r_char
op_star
id|logfile
comma
op_star
id|force_author
suffix:semicolon
DECL|variable|template_file
r_static
r_const
r_char
op_star
id|template_file
suffix:semicolon
DECL|variable|edit_message
DECL|variable|use_message
r_static
r_char
op_star
id|edit_message
comma
op_star
id|use_message
suffix:semicolon
DECL|variable|author_name
DECL|variable|author_email
DECL|variable|author_date
r_static
r_char
op_star
id|author_name
comma
op_star
id|author_email
comma
op_star
id|author_date
suffix:semicolon
DECL|variable|all
DECL|variable|edit_flag
DECL|variable|also
DECL|variable|interactive
DECL|variable|only
DECL|variable|amend
DECL|variable|signoff
r_static
r_int
id|all
comma
id|edit_flag
comma
id|also
comma
id|interactive
comma
id|only
comma
id|amend
comma
id|signoff
suffix:semicolon
DECL|variable|quiet
DECL|variable|verbose
DECL|variable|no_verify
DECL|variable|allow_empty
r_static
r_int
id|quiet
comma
id|verbose
comma
id|no_verify
comma
id|allow_empty
suffix:semicolon
DECL|variable|untracked_files_arg
r_static
r_char
op_star
id|untracked_files_arg
suffix:semicolon
multiline_comment|/*&n; * The default commit message cleanup mode will remove the lines&n; * beginning with # (shell comments) and leading and trailing&n; * whitespaces (empty lines or containing only whitespaces)&n; * if editor is used, and only the whitespaces if the message&n; * is specified explicitly.&n; */
r_static
r_enum
(brace
DECL|enumerator|CLEANUP_SPACE
id|CLEANUP_SPACE
comma
DECL|enumerator|CLEANUP_NONE
id|CLEANUP_NONE
comma
DECL|enumerator|CLEANUP_ALL
id|CLEANUP_ALL
comma
DECL|variable|cleanup_mode
)brace
id|cleanup_mode
suffix:semicolon
DECL|variable|cleanup_arg
r_static
r_char
op_star
id|cleanup_arg
suffix:semicolon
DECL|variable|use_editor
DECL|variable|initial_commit
DECL|variable|in_merge
r_static
r_int
id|use_editor
op_assign
l_int|1
comma
id|initial_commit
comma
id|in_merge
suffix:semicolon
DECL|variable|only_include_assumed
r_static
r_const
r_char
op_star
id|only_include_assumed
suffix:semicolon
DECL|variable|message
r_static
r_struct
id|strbuf
id|message
op_assign
id|STRBUF_INIT
suffix:semicolon
DECL|function|opt_parse_m
r_static
r_int
id|opt_parse_m
c_func
(paren
r_const
r_struct
id|option
op_star
id|opt
comma
r_const
r_char
op_star
id|arg
comma
r_int
id|unset
)paren
(brace
r_struct
id|strbuf
op_star
id|buf
op_assign
id|opt-&gt;value
suffix:semicolon
r_if
c_cond
(paren
id|unset
)paren
id|strbuf_setlen
c_func
(paren
id|buf
comma
l_int|0
)paren
suffix:semicolon
r_else
(brace
id|strbuf_addstr
c_func
(paren
id|buf
comma
id|arg
)paren
suffix:semicolon
id|strbuf_addstr
c_func
(paren
id|buf
comma
l_string|&quot;&bslash;n&bslash;n&quot;
)paren
suffix:semicolon
)brace
r_return
l_int|0
suffix:semicolon
)brace
DECL|variable|builtin_commit_options
r_static
r_struct
id|option
id|builtin_commit_options
(braket
)braket
op_assign
(brace
id|OPT__QUIET
c_func
(paren
op_amp
id|quiet
)paren
comma
id|OPT__VERBOSE
c_func
(paren
op_amp
id|verbose
)paren
comma
id|OPT_GROUP
c_func
(paren
l_string|&quot;Commit message options&quot;
)paren
comma
id|OPT_STRING
c_func
(paren
l_char|&squot;F&squot;
comma
l_string|&quot;file&quot;
comma
op_amp
id|logfile
comma
l_string|&quot;FILE&quot;
comma
l_string|&quot;read log from file&quot;
)paren
comma
id|OPT_STRING
c_func
(paren
l_int|0
comma
l_string|&quot;author&quot;
comma
op_amp
id|force_author
comma
l_string|&quot;AUTHOR&quot;
comma
l_string|&quot;override author for commit&quot;
)paren
comma
id|OPT_CALLBACK
c_func
(paren
l_char|&squot;m&squot;
comma
l_string|&quot;message&quot;
comma
op_amp
id|message
comma
l_string|&quot;MESSAGE&quot;
comma
l_string|&quot;specify commit message&quot;
comma
id|opt_parse_m
)paren
comma
id|OPT_STRING
c_func
(paren
l_char|&squot;c&squot;
comma
l_string|&quot;reedit-message&quot;
comma
op_amp
id|edit_message
comma
l_string|&quot;COMMIT&quot;
comma
l_string|&quot;reuse and edit message from specified commit &quot;
)paren
comma
id|OPT_STRING
c_func
(paren
l_char|&squot;C&squot;
comma
l_string|&quot;reuse-message&quot;
comma
op_amp
id|use_message
comma
l_string|&quot;COMMIT&quot;
comma
l_string|&quot;reuse message from specified commit&quot;
)paren
comma
id|OPT_BOOLEAN
c_func
(paren
l_char|&squot;s&squot;
comma
l_string|&quot;signoff&quot;
comma
op_amp
id|signoff
comma
l_string|&quot;add Signed-off-by:&quot;
)paren
comma
id|OPT_STRING
c_func
(paren
l_char|&squot;t&squot;
comma
l_string|&quot;template&quot;
comma
op_amp
id|template_file
comma
l_string|&quot;FILE&quot;
comma
l_string|&quot;use specified template file&quot;
)paren
comma
id|OPT_BOOLEAN
c_func
(paren
l_char|&squot;e&squot;
comma
l_string|&quot;edit&quot;
comma
op_amp
id|edit_flag
comma
l_string|&quot;force edit of commit&quot;
)paren
comma
id|OPT_GROUP
c_func
(paren
l_string|&quot;Commit contents options&quot;
)paren
comma
id|OPT_BOOLEAN
c_func
(paren
l_char|&squot;a&squot;
comma
l_string|&quot;all&quot;
comma
op_amp
id|all
comma
l_string|&quot;commit all changed files&quot;
)paren
comma
id|OPT_BOOLEAN
c_func
(paren
l_char|&squot;i&squot;
comma
l_string|&quot;include&quot;
comma
op_amp
id|also
comma
l_string|&quot;add specified files to index for commit&quot;
)paren
comma
id|OPT_BOOLEAN
c_func
(paren
l_int|0
comma
l_string|&quot;interactive&quot;
comma
op_amp
id|interactive
comma
l_string|&quot;interactively add files&quot;
)paren
comma
id|OPT_BOOLEAN
c_func
(paren
l_char|&squot;o&squot;
comma
l_string|&quot;only&quot;
comma
op_amp
id|only
comma
l_string|&quot;commit only specified files&quot;
)paren
comma
id|OPT_BOOLEAN
c_func
(paren
l_char|&squot;n&squot;
comma
l_string|&quot;no-verify&quot;
comma
op_amp
id|no_verify
comma
l_string|&quot;bypass pre-commit hook&quot;
)paren
comma
id|OPT_BOOLEAN
c_func
(paren
l_int|0
comma
l_string|&quot;amend&quot;
comma
op_amp
id|amend
comma
l_string|&quot;amend previous commit&quot;
)paren
comma
(brace
id|OPTION_STRING
comma
l_char|&squot;u&squot;
comma
l_string|&quot;untracked-files&quot;
comma
op_amp
id|untracked_files_arg
comma
l_string|&quot;mode&quot;
comma
l_string|&quot;show untracked files, optional modes: all, normal, no. (Default: all)&quot;
comma
id|PARSE_OPT_OPTARG
comma
l_int|NULL
comma
(paren
r_intptr
)paren
l_string|&quot;all&quot;
)brace
comma
id|OPT_BOOLEAN
c_func
(paren
l_int|0
comma
l_string|&quot;allow-empty&quot;
comma
op_amp
id|allow_empty
comma
l_string|&quot;ok to record an empty change&quot;
)paren
comma
id|OPT_STRING
c_func
(paren
l_int|0
comma
l_string|&quot;cleanup&quot;
comma
op_amp
id|cleanup_arg
comma
l_string|&quot;default&quot;
comma
l_string|&quot;how to strip spaces and #comments from message&quot;
)paren
comma
id|OPT_END
c_func
(paren
)paren
)brace
suffix:semicolon
DECL|function|rollback_index_files
r_static
r_void
id|rollback_index_files
c_func
(paren
r_void
)paren
(brace
r_switch
c_cond
(paren
id|commit_style
)paren
(brace
r_case
id|COMMIT_AS_IS
suffix:colon
r_break
suffix:semicolon
multiline_comment|/* nothing to do */
r_case
id|COMMIT_NORMAL
suffix:colon
id|rollback_lock_file
c_func
(paren
op_amp
id|index_lock
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|COMMIT_PARTIAL
suffix:colon
id|rollback_lock_file
c_func
(paren
op_amp
id|index_lock
)paren
suffix:semicolon
id|rollback_lock_file
c_func
(paren
op_amp
id|false_lock
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
)brace
DECL|function|commit_index_files
r_static
r_int
id|commit_index_files
c_func
(paren
r_void
)paren
(brace
r_int
id|err
op_assign
l_int|0
suffix:semicolon
r_switch
c_cond
(paren
id|commit_style
)paren
(brace
r_case
id|COMMIT_AS_IS
suffix:colon
r_break
suffix:semicolon
multiline_comment|/* nothing to do */
r_case
id|COMMIT_NORMAL
suffix:colon
id|err
op_assign
id|commit_lock_file
c_func
(paren
op_amp
id|index_lock
)paren
suffix:semicolon
r_break
suffix:semicolon
r_case
id|COMMIT_PARTIAL
suffix:colon
id|err
op_assign
id|commit_lock_file
c_func
(paren
op_amp
id|index_lock
)paren
suffix:semicolon
id|rollback_lock_file
c_func
(paren
op_amp
id|false_lock
)paren
suffix:semicolon
r_break
suffix:semicolon
)brace
r_return
id|err
suffix:semicolon
)brace
multiline_comment|/*&n; * Take a union of paths in the index and the named tree (typically, &quot;HEAD&quot;),&n; * and return the paths that match the given pattern in list.&n; */
DECL|function|list_paths
r_static
r_int
id|list_paths
c_func
(paren
r_struct
id|string_list
op_star
id|list
comma
r_const
r_char
op_star
id|with_tree
comma
r_const
r_char
op_star
id|prefix
comma
r_const
r_char
op_star
op_star
id|pattern
)paren
(brace
r_int
id|i
suffix:semicolon
r_char
op_star
id|m
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|pattern
(braket
id|i
)braket
suffix:semicolon
id|i
op_increment
)paren
suffix:semicolon
id|m
op_assign
id|xcalloc
c_func
(paren
l_int|1
comma
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|with_tree
)paren
id|overlay_tree_on_cache
c_func
(paren
id|with_tree
comma
id|prefix
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|active_nr
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|cache_entry
op_star
id|ce
op_assign
id|active_cache
(braket
id|i
)braket
suffix:semicolon
r_if
c_cond
(paren
id|ce-&gt;ce_flags
op_amp
id|CE_UPDATE
)paren
r_continue
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|pathspec_match
c_func
(paren
id|pattern
comma
id|m
comma
id|ce-&gt;name
comma
l_int|0
)paren
)paren
r_continue
suffix:semicolon
id|string_list_insert
c_func
(paren
id|ce-&gt;name
comma
id|list
)paren
suffix:semicolon
)brace
r_return
id|report_path_error
c_func
(paren
id|m
comma
id|pattern
comma
id|prefix
ques
c_cond
id|strlen
c_func
(paren
id|prefix
)paren
suffix:colon
l_int|0
)paren
suffix:semicolon
)brace
DECL|function|add_remove_files
r_static
r_void
id|add_remove_files
c_func
(paren
r_struct
id|string_list
op_star
id|list
)paren
(brace
r_int
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|list-&gt;nr
suffix:semicolon
id|i
op_increment
)paren
(brace
r_struct
id|stat
id|st
suffix:semicolon
r_struct
id|string_list_item
op_star
id|p
op_assign
op_amp
(paren
id|list-&gt;items
(braket
id|i
)braket
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|lstat
c_func
(paren
id|p-&gt;string
comma
op_amp
id|st
)paren
)paren
(brace
r_if
c_cond
(paren
id|add_to_cache
c_func
(paren
id|p-&gt;string
comma
op_amp
id|st
comma
l_int|0
)paren
)paren
id|die
c_func
(paren
l_string|&quot;updating files failed&quot;
)paren
suffix:semicolon
)brace
r_else
id|remove_file_from_cache
c_func
(paren
id|p-&gt;string
)paren
suffix:semicolon
)brace
)brace
DECL|function|create_base_index
r_static
r_void
id|create_base_index
c_func
(paren
r_void
)paren
(brace
r_struct
id|tree
op_star
id|tree
suffix:semicolon
r_struct
id|unpack_trees_options
id|opts
suffix:semicolon
r_struct
id|tree_desc
id|t
suffix:semicolon
r_if
c_cond
(paren
id|initial_commit
)paren
(brace
id|discard_cache
c_func
(paren
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
id|memset
c_func
(paren
op_amp
id|opts
comma
l_int|0
comma
r_sizeof
(paren
id|opts
)paren
)paren
suffix:semicolon
id|opts.head_idx
op_assign
l_int|1
suffix:semicolon
id|opts.index_only
op_assign
l_int|1
suffix:semicolon
id|opts.merge
op_assign
l_int|1
suffix:semicolon
id|opts.src_index
op_assign
op_amp
id|the_index
suffix:semicolon
id|opts.dst_index
op_assign
op_amp
id|the_index
suffix:semicolon
id|opts.fn
op_assign
id|oneway_merge
suffix:semicolon
id|tree
op_assign
id|parse_tree_indirect
c_func
(paren
id|head_sha1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|tree
)paren
id|die
c_func
(paren
l_string|&quot;failed to unpack HEAD tree object&quot;
)paren
suffix:semicolon
id|parse_tree
c_func
(paren
id|tree
)paren
suffix:semicolon
id|init_tree_desc
c_func
(paren
op_amp
id|t
comma
id|tree-&gt;buffer
comma
id|tree-&gt;size
)paren
suffix:semicolon
r_if
c_cond
(paren
id|unpack_trees
c_func
(paren
l_int|1
comma
op_amp
id|t
comma
op_amp
id|opts
)paren
)paren
m_exit
(paren
l_int|128
)paren
suffix:semicolon
multiline_comment|/* We&squot;ve already reported the error, finish dying */
)brace
DECL|function|prepare_index
r_static
r_char
op_star
id|prepare_index
c_func
(paren
r_int
id|argc
comma
r_const
r_char
op_star
op_star
id|argv
comma
r_const
r_char
op_star
id|prefix
)paren
(brace
r_int
id|fd
suffix:semicolon
r_struct
id|string_list
id|partial
suffix:semicolon
r_const
r_char
op_star
op_star
id|pathspec
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|interactive
)paren
(brace
id|interactive_add
c_func
(paren
id|argc
comma
id|argv
comma
id|prefix
)paren
suffix:semicolon
r_if
c_cond
(paren
id|read_cache
c_func
(paren
)paren
OL
l_int|0
)paren
id|die
c_func
(paren
l_string|&quot;index file corrupt&quot;
)paren
suffix:semicolon
id|commit_style
op_assign
id|COMMIT_AS_IS
suffix:semicolon
r_return
id|get_index_file
c_func
(paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|read_cache
c_func
(paren
)paren
OL
l_int|0
)paren
id|die
c_func
(paren
l_string|&quot;index file corrupt&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_star
id|argv
)paren
id|pathspec
op_assign
id|get_pathspec
c_func
(paren
id|prefix
comma
id|argv
)paren
suffix:semicolon
multiline_comment|/*&n;&t; * Non partial, non as-is commit.&n;&t; *&n;&t; * (1) get the real index;&n;&t; * (2) update the_index as necessary;&n;&t; * (3) write the_index out to the real index (still locked);&n;&t; * (4) return the name of the locked index file.&n;&t; *&n;&t; * The caller should run hooks on the locked real index, and&n;&t; * (A) if all goes well, commit the real index;&n;&t; * (B) on failure, rollback the real index.&n;&t; */
r_if
c_cond
(paren
id|all
op_logical_or
(paren
id|also
op_logical_and
id|pathspec
op_logical_and
op_star
id|pathspec
)paren
)paren
(brace
r_int
id|fd
op_assign
id|hold_locked_index
c_func
(paren
op_amp
id|index_lock
comma
l_int|1
)paren
suffix:semicolon
id|add_files_to_cache
c_func
(paren
id|also
ques
c_cond
id|prefix
suffix:colon
l_int|NULL
comma
id|pathspec
comma
l_int|0
)paren
suffix:semicolon
id|refresh_cache
c_func
(paren
id|REFRESH_QUIET
)paren
suffix:semicolon
r_if
c_cond
(paren
id|write_cache
c_func
(paren
id|fd
comma
id|active_cache
comma
id|active_nr
)paren
op_logical_or
id|close_lock_file
c_func
(paren
op_amp
id|index_lock
)paren
)paren
id|die
c_func
(paren
l_string|&quot;unable to write new_index file&quot;
)paren
suffix:semicolon
id|commit_style
op_assign
id|COMMIT_NORMAL
suffix:semicolon
r_return
id|index_lock.filename
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * As-is commit.&n;&t; *&n;&t; * (1) return the name of the real index file.&n;&t; *&n;&t; * The caller should run hooks on the real index, and run&n;&t; * hooks on the real index, and create commit from the_index.&n;&t; * We still need to refresh the index here.&n;&t; */
r_if
c_cond
(paren
op_logical_neg
id|pathspec
op_logical_or
op_logical_neg
op_star
id|pathspec
)paren
(brace
id|fd
op_assign
id|hold_locked_index
c_func
(paren
op_amp
id|index_lock
comma
l_int|1
)paren
suffix:semicolon
id|refresh_cache
c_func
(paren
id|REFRESH_QUIET
)paren
suffix:semicolon
r_if
c_cond
(paren
id|write_cache
c_func
(paren
id|fd
comma
id|active_cache
comma
id|active_nr
)paren
op_logical_or
id|commit_locked_index
c_func
(paren
op_amp
id|index_lock
)paren
)paren
id|die
c_func
(paren
l_string|&quot;unable to write new_index file&quot;
)paren
suffix:semicolon
id|commit_style
op_assign
id|COMMIT_AS_IS
suffix:semicolon
r_return
id|get_index_file
c_func
(paren
)paren
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * A partial commit.&n;&t; *&n;&t; * (0) find the set of affected paths;&n;&t; * (1) get lock on the real index file;&n;&t; * (2) update the_index with the given paths;&n;&t; * (3) write the_index out to the real index (still locked);&n;&t; * (4) get lock on the false index file;&n;&t; * (5) reset the_index from HEAD;&n;&t; * (6) update the_index the same way as (2);&n;&t; * (7) write the_index out to the false index file;&n;&t; * (8) return the name of the false index file (still locked);&n;&t; *&n;&t; * The caller should run hooks on the locked false index, and&n;&t; * create commit from it.  Then&n;&t; * (A) if all goes well, commit the real index;&n;&t; * (B) on failure, rollback the real index;&n;&t; * In either case, rollback the false index.&n;&t; */
id|commit_style
op_assign
id|COMMIT_PARTIAL
suffix:semicolon
r_if
c_cond
(paren
id|file_exists
c_func
(paren
id|git_path
c_func
(paren
l_string|&quot;MERGE_HEAD&quot;
)paren
)paren
)paren
id|die
c_func
(paren
l_string|&quot;cannot do a partial commit during a merge.&quot;
)paren
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|partial
comma
l_int|0
comma
r_sizeof
(paren
id|partial
)paren
)paren
suffix:semicolon
id|partial.strdup_strings
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|list_paths
c_func
(paren
op_amp
id|partial
comma
id|initial_commit
ques
c_cond
l_int|NULL
suffix:colon
l_string|&quot;HEAD&quot;
comma
id|prefix
comma
id|pathspec
)paren
)paren
m_exit
(paren
l_int|1
)paren
suffix:semicolon
id|discard_cache
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|read_cache
c_func
(paren
)paren
OL
l_int|0
)paren
id|die
c_func
(paren
l_string|&quot;cannot read the index&quot;
)paren
suffix:semicolon
id|fd
op_assign
id|hold_locked_index
c_func
(paren
op_amp
id|index_lock
comma
l_int|1
)paren
suffix:semicolon
id|add_remove_files
c_func
(paren
op_amp
id|partial
)paren
suffix:semicolon
id|refresh_cache
c_func
(paren
id|REFRESH_QUIET
)paren
suffix:semicolon
r_if
c_cond
(paren
id|write_cache
c_func
(paren
id|fd
comma
id|active_cache
comma
id|active_nr
)paren
op_logical_or
id|close_lock_file
c_func
(paren
op_amp
id|index_lock
)paren
)paren
id|die
c_func
(paren
l_string|&quot;unable to write new_index file&quot;
)paren
suffix:semicolon
id|fd
op_assign
id|hold_lock_file_for_update
c_func
(paren
op_amp
id|false_lock
comma
id|git_path
c_func
(paren
l_string|&quot;next-index-%d&quot;
comma
id|getpid
c_func
(paren
)paren
)paren
comma
l_int|1
)paren
suffix:semicolon
id|create_base_index
c_func
(paren
)paren
suffix:semicolon
id|add_remove_files
c_func
(paren
op_amp
id|partial
)paren
suffix:semicolon
id|refresh_cache
c_func
(paren
id|REFRESH_QUIET
)paren
suffix:semicolon
r_if
c_cond
(paren
id|write_cache
c_func
(paren
id|fd
comma
id|active_cache
comma
id|active_nr
)paren
op_logical_or
id|close_lock_file
c_func
(paren
op_amp
id|false_lock
)paren
)paren
id|die
c_func
(paren
l_string|&quot;unable to write temporary index file&quot;
)paren
suffix:semicolon
id|discard_cache
c_func
(paren
)paren
suffix:semicolon
id|read_cache_from
c_func
(paren
id|false_lock.filename
)paren
suffix:semicolon
r_return
id|false_lock.filename
suffix:semicolon
)brace
DECL|function|run_status
r_static
r_int
id|run_status
c_func
(paren
id|FILE
op_star
id|fp
comma
r_const
r_char
op_star
id|index_file
comma
r_const
r_char
op_star
id|prefix
comma
r_int
id|nowarn
)paren
(brace
r_struct
id|wt_status
id|s
suffix:semicolon
id|wt_status_prepare
c_func
(paren
op_amp
id|s
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wt_status_relative_paths
)paren
id|s.prefix
op_assign
id|prefix
suffix:semicolon
r_if
c_cond
(paren
id|amend
)paren
(brace
id|s.amend
op_assign
l_int|1
suffix:semicolon
id|s.reference
op_assign
l_string|&quot;HEAD^1&quot;
suffix:semicolon
)brace
id|s.verbose
op_assign
id|verbose
suffix:semicolon
id|s.untracked
op_assign
(paren
id|show_untracked_files
op_eq
id|SHOW_ALL_UNTRACKED_FILES
)paren
suffix:semicolon
id|s.index_file
op_assign
id|index_file
suffix:semicolon
id|s.fp
op_assign
id|fp
suffix:semicolon
id|s.nowarn
op_assign
id|nowarn
suffix:semicolon
id|wt_status_print
c_func
(paren
op_amp
id|s
)paren
suffix:semicolon
r_return
id|s.commitable
suffix:semicolon
)brace
DECL|function|run_hook
r_static
r_int
id|run_hook
c_func
(paren
r_const
r_char
op_star
id|index_file
comma
r_const
r_char
op_star
id|name
comma
dot
dot
dot
)paren
(brace
r_struct
id|child_process
id|hook
suffix:semicolon
r_const
r_char
op_star
id|argv
(braket
l_int|10
)braket
comma
op_star
id|env
(braket
l_int|2
)braket
suffix:semicolon
r_char
id|index
(braket
id|PATH_MAX
)braket
suffix:semicolon
id|va_list
id|args
suffix:semicolon
r_int
id|i
suffix:semicolon
id|va_start
c_func
(paren
id|args
comma
id|name
)paren
suffix:semicolon
id|argv
(braket
l_int|0
)braket
op_assign
id|git_path
c_func
(paren
l_string|&quot;hooks/%s&quot;
comma
id|name
)paren
suffix:semicolon
id|i
op_assign
l_int|0
suffix:semicolon
r_do
(brace
r_if
c_cond
(paren
op_increment
id|i
op_ge
id|ARRAY_SIZE
c_func
(paren
id|argv
)paren
)paren
id|die
(paren
l_string|&quot;run_hook(): too many arguments&quot;
)paren
suffix:semicolon
id|argv
(braket
id|i
)braket
op_assign
id|va_arg
c_func
(paren
id|args
comma
r_const
r_char
op_star
)paren
suffix:semicolon
)brace
r_while
c_loop
(paren
id|argv
(braket
id|i
)braket
)paren
suffix:semicolon
id|va_end
c_func
(paren
id|args
)paren
suffix:semicolon
id|snprintf
c_func
(paren
id|index
comma
r_sizeof
(paren
id|index
)paren
comma
l_string|&quot;GIT_INDEX_FILE=%s&quot;
comma
id|index_file
)paren
suffix:semicolon
id|env
(braket
l_int|0
)braket
op_assign
id|index
suffix:semicolon
id|env
(braket
l_int|1
)braket
op_assign
l_int|NULL
suffix:semicolon
r_if
c_cond
(paren
id|access
c_func
(paren
id|argv
(braket
l_int|0
)braket
comma
id|X_OK
)paren
OL
l_int|0
)paren
r_return
l_int|0
suffix:semicolon
id|memset
c_func
(paren
op_amp
id|hook
comma
l_int|0
comma
r_sizeof
(paren
id|hook
)paren
)paren
suffix:semicolon
id|hook.argv
op_assign
id|argv
suffix:semicolon
id|hook.no_stdin
op_assign
l_int|1
suffix:semicolon
id|hook.stdout_to_stderr
op_assign
l_int|1
suffix:semicolon
id|hook.env
op_assign
id|env
suffix:semicolon
r_return
id|run_command
c_func
(paren
op_amp
id|hook
)paren
suffix:semicolon
)brace
DECL|function|is_a_merge
r_static
r_int
id|is_a_merge
c_func
(paren
r_const
r_int
r_char
op_star
id|sha1
)paren
(brace
r_struct
id|commit
op_star
id|commit
op_assign
id|lookup_commit
c_func
(paren
id|sha1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|commit
op_logical_or
id|parse_commit
c_func
(paren
id|commit
)paren
)paren
id|die
c_func
(paren
l_string|&quot;could not parse HEAD commit&quot;
)paren
suffix:semicolon
r_return
op_logical_neg
op_logical_neg
(paren
id|commit-&gt;parents
op_logical_and
id|commit-&gt;parents-&gt;next
)paren
suffix:semicolon
)brace
DECL|variable|sign_off_header
r_static
r_const
r_char
id|sign_off_header
(braket
)braket
op_assign
l_string|&quot;Signed-off-by: &quot;
suffix:semicolon
DECL|function|determine_author_info
r_static
r_void
id|determine_author_info
c_func
(paren
r_void
)paren
(brace
r_char
op_star
id|name
comma
op_star
id|email
comma
op_star
id|date
suffix:semicolon
id|name
op_assign
id|getenv
c_func
(paren
l_string|&quot;GIT_AUTHOR_NAME&quot;
)paren
suffix:semicolon
id|email
op_assign
id|getenv
c_func
(paren
l_string|&quot;GIT_AUTHOR_EMAIL&quot;
)paren
suffix:semicolon
id|date
op_assign
id|getenv
c_func
(paren
l_string|&quot;GIT_AUTHOR_DATE&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|use_message
)paren
(brace
r_const
r_char
op_star
id|a
comma
op_star
id|lb
comma
op_star
id|rb
comma
op_star
id|eol
suffix:semicolon
id|a
op_assign
id|strstr
c_func
(paren
id|use_message_buffer
comma
l_string|&quot;&bslash;nauthor &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|a
)paren
id|die
c_func
(paren
l_string|&quot;invalid commit: %s&quot;
comma
id|use_message
)paren
suffix:semicolon
id|lb
op_assign
id|strstr
c_func
(paren
id|a
op_plus
l_int|8
comma
l_string|&quot; &lt;&quot;
)paren
suffix:semicolon
id|rb
op_assign
id|strstr
c_func
(paren
id|a
op_plus
l_int|8
comma
l_string|&quot;&gt; &quot;
)paren
suffix:semicolon
id|eol
op_assign
id|strchr
c_func
(paren
id|a
op_plus
l_int|8
comma
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|lb
op_logical_or
op_logical_neg
id|rb
op_logical_or
op_logical_neg
id|eol
)paren
id|die
c_func
(paren
l_string|&quot;invalid commit: %s&quot;
comma
id|use_message
)paren
suffix:semicolon
id|name
op_assign
id|xstrndup
c_func
(paren
id|a
op_plus
l_int|8
comma
id|lb
(paren
id|a
op_plus
l_int|8
)paren
)paren
suffix:semicolon
id|email
op_assign
id|xstrndup
c_func
(paren
id|lb
op_plus
l_int|2
comma
id|rb
(paren
id|lb
op_plus
l_int|2
)paren
)paren
suffix:semicolon
id|date
op_assign
id|xstrndup
c_func
(paren
id|rb
op_plus
l_int|2
comma
id|eol
(paren
id|rb
op_plus
l_int|2
)paren
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|force_author
)paren
(brace
r_const
r_char
op_star
id|lb
op_assign
id|strstr
c_func
(paren
id|force_author
comma
l_string|&quot; &lt;&quot;
)paren
suffix:semicolon
r_const
r_char
op_star
id|rb
op_assign
id|strchr
c_func
(paren
id|force_author
comma
l_char|&squot;&gt;&squot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|lb
op_logical_or
op_logical_neg
id|rb
)paren
id|die
c_func
(paren
l_string|&quot;malformed --author parameter&quot;
)paren
suffix:semicolon
id|name
op_assign
id|xstrndup
c_func
(paren
id|force_author
comma
id|lb
id|force_author
)paren
suffix:semicolon
id|email
op_assign
id|xstrndup
c_func
(paren
id|lb
op_plus
l_int|2
comma
id|rb
(paren
id|lb
op_plus
l_int|2
)paren
)paren
suffix:semicolon
)brace
id|author_name
op_assign
id|name
suffix:semicolon
id|author_email
op_assign
id|email
suffix:semicolon
id|author_date
op_assign
id|date
suffix:semicolon
)brace
DECL|function|prepare_to_commit
r_static
r_int
id|prepare_to_commit
c_func
(paren
r_const
r_char
op_star
id|index_file
comma
r_const
r_char
op_star
id|prefix
)paren
(brace
r_struct
id|stat
id|statbuf
suffix:semicolon
r_int
id|commitable
comma
id|saved_color_setting
suffix:semicolon
r_struct
id|strbuf
id|sb
suffix:semicolon
r_char
op_star
id|buffer
suffix:semicolon
id|FILE
op_star
id|fp
suffix:semicolon
r_const
r_char
op_star
id|hook_arg1
op_assign
l_int|NULL
suffix:semicolon
r_const
r_char
op_star
id|hook_arg2
op_assign
l_int|NULL
suffix:semicolon
r_int
id|ident_shown
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|no_verify
op_logical_and
id|run_hook
c_func
(paren
id|index_file
comma
l_string|&quot;pre-commit&quot;
comma
l_int|NULL
)paren
)paren
r_return
l_int|0
suffix:semicolon
id|strbuf_init
c_func
(paren
op_amp
id|sb
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|message.len
)paren
(brace
id|strbuf_addbuf
c_func
(paren
op_amp
id|sb
comma
op_amp
id|message
)paren
suffix:semicolon
id|hook_arg1
op_assign
l_string|&quot;message&quot;
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|logfile
op_logical_and
op_logical_neg
id|strcmp
c_func
(paren
id|logfile
comma
l_string|&quot;-&quot;
)paren
)paren
(brace
r_if
c_cond
(paren
id|isatty
c_func
(paren
l_int|0
)paren
)paren
id|fprintf
c_func
(paren
id|stderr
comma
l_string|&quot;(reading log message from standard input)&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strbuf_read
c_func
(paren
op_amp
id|sb
comma
l_int|0
comma
l_int|0
)paren
OL
l_int|0
)paren
id|die
c_func
(paren
l_string|&quot;could not read log from standard input&quot;
)paren
suffix:semicolon
id|hook_arg1
op_assign
l_string|&quot;message&quot;
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|logfile
)paren
(brace
r_if
c_cond
(paren
id|strbuf_read_file
c_func
(paren
op_amp
id|sb
comma
id|logfile
comma
l_int|0
)paren
OL
l_int|0
)paren
id|die
c_func
(paren
l_string|&quot;could not read log file &squot;%s&squot;: %s&quot;
comma
id|logfile
comma
id|strerror
c_func
(paren
id|errno
)paren
)paren
suffix:semicolon
id|hook_arg1
op_assign
l_string|&quot;message&quot;
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|use_message
)paren
(brace
id|buffer
op_assign
id|strstr
c_func
(paren
id|use_message_buffer
comma
l_string|&quot;&bslash;n&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|buffer
op_logical_or
id|buffer
(braket
l_int|2
)braket
op_eq
l_char|&squot;&bslash;0&squot;
)paren
id|die
c_func
(paren
l_string|&quot;commit has empty message&quot;
)paren
suffix:semicolon
id|strbuf_add
c_func
(paren
op_amp
id|sb
comma
id|buffer
op_plus
l_int|2
comma
id|strlen
c_func
(paren
id|buffer
op_plus
l_int|2
)paren
)paren
suffix:semicolon
id|hook_arg1
op_assign
l_string|&quot;commit&quot;
suffix:semicolon
id|hook_arg2
op_assign
id|use_message
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|stat
c_func
(paren
id|git_path
c_func
(paren
l_string|&quot;MERGE_MSG&quot;
)paren
comma
op_amp
id|statbuf
)paren
)paren
(brace
r_if
c_cond
(paren
id|strbuf_read_file
c_func
(paren
op_amp
id|sb
comma
id|git_path
c_func
(paren
l_string|&quot;MERGE_MSG&quot;
)paren
comma
l_int|0
)paren
OL
l_int|0
)paren
id|die
c_func
(paren
l_string|&quot;could not read MERGE_MSG: %s&quot;
comma
id|strerror
c_func
(paren
id|errno
)paren
)paren
suffix:semicolon
id|hook_arg1
op_assign
l_string|&quot;merge&quot;
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
op_logical_neg
id|stat
c_func
(paren
id|git_path
c_func
(paren
l_string|&quot;SQUASH_MSG&quot;
)paren
comma
op_amp
id|statbuf
)paren
)paren
(brace
r_if
c_cond
(paren
id|strbuf_read_file
c_func
(paren
op_amp
id|sb
comma
id|git_path
c_func
(paren
l_string|&quot;SQUASH_MSG&quot;
)paren
comma
l_int|0
)paren
OL
l_int|0
)paren
id|die
c_func
(paren
l_string|&quot;could not read SQUASH_MSG: %s&quot;
comma
id|strerror
c_func
(paren
id|errno
)paren
)paren
suffix:semicolon
id|hook_arg1
op_assign
l_string|&quot;squash&quot;
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|template_file
op_logical_and
op_logical_neg
id|stat
c_func
(paren
id|template_file
comma
op_amp
id|statbuf
)paren
)paren
(brace
r_if
c_cond
(paren
id|strbuf_read_file
c_func
(paren
op_amp
id|sb
comma
id|template_file
comma
l_int|0
)paren
OL
l_int|0
)paren
id|die
c_func
(paren
l_string|&quot;could not read %s: %s&quot;
comma
id|template_file
comma
id|strerror
c_func
(paren
id|errno
)paren
)paren
suffix:semicolon
id|hook_arg1
op_assign
l_string|&quot;template&quot;
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * This final case does not modify the template message,&n;&t; * it just sets the argument to the prepare-commit-msg hook.&n;&t; */
r_else
r_if
c_cond
(paren
id|in_merge
)paren
id|hook_arg1
op_assign
l_string|&quot;merge&quot;
suffix:semicolon
id|fp
op_assign
id|fopen
c_func
(paren
id|git_path
c_func
(paren
id|commit_editmsg
)paren
comma
l_string|&quot;w&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fp
op_eq
l_int|NULL
)paren
id|die
c_func
(paren
l_string|&quot;could not open %s: %s&quot;
comma
id|git_path
c_func
(paren
id|commit_editmsg
)paren
comma
id|strerror
c_func
(paren
id|errno
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cleanup_mode
op_ne
id|CLEANUP_NONE
)paren
id|stripspace
c_func
(paren
op_amp
id|sb
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|signoff
)paren
(brace
r_struct
id|strbuf
id|sob
suffix:semicolon
r_int
id|i
suffix:semicolon
id|strbuf_init
c_func
(paren
op_amp
id|sob
comma
l_int|0
)paren
suffix:semicolon
id|strbuf_addstr
c_func
(paren
op_amp
id|sob
comma
id|sign_off_header
)paren
suffix:semicolon
id|strbuf_addstr
c_func
(paren
op_amp
id|sob
comma
id|fmt_name
c_func
(paren
id|getenv
c_func
(paren
l_string|&quot;GIT_COMMITTER_NAME&quot;
)paren
comma
id|getenv
c_func
(paren
l_string|&quot;GIT_COMMITTER_EMAIL&quot;
)paren
)paren
)paren
suffix:semicolon
id|strbuf_addch
c_func
(paren
op_amp
id|sob
comma
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
id|sb.len
l_int|1
suffix:semicolon
id|i
OG
l_int|0
op_logical_and
id|sb.buf
(braket
id|i
l_int|1
)braket
op_ne
l_char|&squot;&bslash;n&squot;
suffix:semicolon
id|i
op_decrement
)paren
suffix:semicolon
multiline_comment|/* do nothing */
r_if
c_cond
(paren
id|prefixcmp
c_func
(paren
id|sb.buf
op_plus
id|i
comma
id|sob.buf
)paren
)paren
(brace
r_if
c_cond
(paren
id|prefixcmp
c_func
(paren
id|sb.buf
op_plus
id|i
comma
id|sign_off_header
)paren
)paren
id|strbuf_addch
c_func
(paren
op_amp
id|sb
comma
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
id|strbuf_addbuf
c_func
(paren
op_amp
id|sb
comma
op_amp
id|sob
)paren
suffix:semicolon
)brace
id|strbuf_release
c_func
(paren
op_amp
id|sob
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|fwrite
c_func
(paren
id|sb.buf
comma
l_int|1
comma
id|sb.len
comma
id|fp
)paren
OL
id|sb.len
)paren
id|die
c_func
(paren
l_string|&quot;could not write commit template: %s&quot;
comma
id|strerror
c_func
(paren
id|errno
)paren
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|sb
)paren
suffix:semicolon
id|determine_author_info
c_func
(paren
)paren
suffix:semicolon
multiline_comment|/* This checks if committer ident is explicitly given */
id|git_committer_info
c_func
(paren
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|use_editor
)paren
(brace
r_char
op_star
id|author_ident
suffix:semicolon
r_const
r_char
op_star
id|committer_ident
suffix:semicolon
r_if
c_cond
(paren
id|in_merge
)paren
id|fprintf
c_func
(paren
id|fp
comma
l_string|&quot;#&bslash;n&quot;
l_string|&quot;# It looks like you may be committing a MERGE.&bslash;n&quot;
l_string|&quot;# If this is not correct, please remove the file&bslash;n&quot;
l_string|&quot;#&t;%s&bslash;n&quot;
l_string|&quot;# and try again.&bslash;n&quot;
l_string|&quot;#&bslash;n&quot;
comma
id|git_path
c_func
(paren
l_string|&quot;MERGE_HEAD&quot;
)paren
)paren
suffix:semicolon
id|fprintf
c_func
(paren
id|fp
comma
l_string|&quot;&bslash;n&quot;
l_string|&quot;# Please enter the commit message for your changes.&bslash;n&quot;
l_string|&quot;# (Comment lines starting with &squot;#&squot; will &quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cleanup_mode
op_eq
id|CLEANUP_ALL
)paren
id|fprintf
c_func
(paren
id|fp
comma
l_string|&quot;not be included)&bslash;n&quot;
)paren
suffix:semicolon
r_else
multiline_comment|/* CLEANUP_SPACE, that is. */
id|fprintf
c_func
(paren
id|fp
comma
l_string|&quot;be kept.&bslash;n&quot;
l_string|&quot;# You can remove them yourself if you want to)&bslash;n&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|only_include_assumed
)paren
id|fprintf
c_func
(paren
id|fp
comma
l_string|&quot;# %s&bslash;n&quot;
comma
id|only_include_assumed
)paren
suffix:semicolon
id|author_ident
op_assign
id|xstrdup
c_func
(paren
id|fmt_name
c_func
(paren
id|author_name
comma
id|author_email
)paren
)paren
suffix:semicolon
id|committer_ident
op_assign
id|fmt_name
c_func
(paren
id|getenv
c_func
(paren
l_string|&quot;GIT_COMMITTER_NAME&quot;
)paren
comma
id|getenv
c_func
(paren
l_string|&quot;GIT_COMMITTER_EMAIL&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|author_ident
comma
id|committer_ident
)paren
)paren
id|fprintf
c_func
(paren
id|fp
comma
l_string|&quot;%s&quot;
l_string|&quot;# Author:    %s&bslash;n&quot;
comma
id|ident_shown
op_increment
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot;#&bslash;n&quot;
comma
id|author_ident
)paren
suffix:semicolon
id|free
c_func
(paren
id|author_ident
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|user_ident_explicitly_given
)paren
id|fprintf
c_func
(paren
id|fp
comma
l_string|&quot;%s&quot;
l_string|&quot;# Committer: %s&bslash;n&quot;
comma
id|ident_shown
op_increment
ques
c_cond
l_string|&quot;&quot;
suffix:colon
l_string|&quot;#&bslash;n&quot;
comma
id|committer_ident
)paren
suffix:semicolon
r_if
c_cond
(paren
id|ident_shown
)paren
id|fprintf
c_func
(paren
id|fp
comma
l_string|&quot;#&bslash;n&quot;
)paren
suffix:semicolon
id|saved_color_setting
op_assign
id|wt_status_use_color
suffix:semicolon
id|wt_status_use_color
op_assign
l_int|0
suffix:semicolon
id|commitable
op_assign
id|run_status
c_func
(paren
id|fp
comma
id|index_file
comma
id|prefix
comma
l_int|1
)paren
suffix:semicolon
id|wt_status_use_color
op_assign
id|saved_color_setting
suffix:semicolon
)brace
r_else
(brace
r_struct
id|rev_info
id|rev
suffix:semicolon
r_int
r_char
id|sha1
(braket
l_int|20
)braket
suffix:semicolon
r_const
r_char
op_star
id|parent
op_assign
l_string|&quot;HEAD&quot;
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|active_nr
op_logical_and
id|read_cache
c_func
(paren
)paren
OL
l_int|0
)paren
id|die
c_func
(paren
l_string|&quot;Cannot read index&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|amend
)paren
id|parent
op_assign
l_string|&quot;HEAD^1&quot;
suffix:semicolon
r_if
c_cond
(paren
id|get_sha1
c_func
(paren
id|parent
comma
id|sha1
)paren
)paren
id|commitable
op_assign
op_logical_neg
op_logical_neg
id|active_nr
suffix:semicolon
r_else
(brace
id|init_revisions
c_func
(paren
op_amp
id|rev
comma
l_string|&quot;&quot;
)paren
suffix:semicolon
id|rev.abbrev
op_assign
l_int|0
suffix:semicolon
id|setup_revisions
c_func
(paren
l_int|0
comma
l_int|NULL
comma
op_amp
id|rev
comma
id|parent
)paren
suffix:semicolon
id|DIFF_OPT_SET
c_func
(paren
op_amp
id|rev.diffopt
comma
id|QUIET
)paren
suffix:semicolon
id|DIFF_OPT_SET
c_func
(paren
op_amp
id|rev.diffopt
comma
id|EXIT_WITH_STATUS
)paren
suffix:semicolon
id|run_diff_index
c_func
(paren
op_amp
id|rev
comma
l_int|1
multiline_comment|/* cached */
)paren
suffix:semicolon
id|commitable
op_assign
op_logical_neg
op_logical_neg
id|DIFF_OPT_TST
c_func
(paren
op_amp
id|rev.diffopt
comma
id|HAS_CHANGES
)paren
suffix:semicolon
)brace
)brace
id|fclose
c_func
(paren
id|fp
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|commitable
op_logical_and
op_logical_neg
id|in_merge
op_logical_and
op_logical_neg
id|allow_empty
op_logical_and
op_logical_neg
(paren
id|amend
op_logical_and
id|is_a_merge
c_func
(paren
id|head_sha1
)paren
)paren
)paren
(brace
id|run_status
c_func
(paren
id|stdout
comma
id|index_file
comma
id|prefix
comma
l_int|0
)paren
suffix:semicolon
id|unlink
c_func
(paren
id|commit_editmsg
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * Re-read the index as pre-commit hook could have updated it,&n;&t; * and write it out as a tree.  We must do this before we invoke&n;&t; * the editor and after we invoke run_status above.&n;&t; */
id|discard_cache
c_func
(paren
)paren
suffix:semicolon
id|read_cache_from
c_func
(paren
id|index_file
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|active_cache_tree
)paren
id|active_cache_tree
op_assign
id|cache_tree
c_func
(paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cache_tree_update
c_func
(paren
id|active_cache_tree
comma
id|active_cache
comma
id|active_nr
comma
l_int|0
comma
l_int|0
)paren
OL
l_int|0
)paren
(brace
id|error
c_func
(paren
l_string|&quot;Error building trees&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
r_if
c_cond
(paren
id|run_hook
c_func
(paren
id|index_file
comma
l_string|&quot;prepare-commit-msg&quot;
comma
id|git_path
c_func
(paren
id|commit_editmsg
)paren
comma
id|hook_arg1
comma
id|hook_arg2
comma
l_int|NULL
)paren
)paren
r_return
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|use_editor
)paren
(brace
r_char
id|index
(braket
id|PATH_MAX
)braket
suffix:semicolon
r_const
r_char
op_star
id|env
(braket
l_int|2
)braket
op_assign
(brace
id|index
comma
l_int|NULL
)brace
suffix:semicolon
id|snprintf
c_func
(paren
id|index
comma
r_sizeof
(paren
id|index
)paren
comma
l_string|&quot;GIT_INDEX_FILE=%s&quot;
comma
id|index_file
)paren
suffix:semicolon
id|launch_editor
c_func
(paren
id|git_path
c_func
(paren
id|commit_editmsg
)paren
comma
l_int|NULL
comma
id|env
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|no_verify
op_logical_and
id|run_hook
c_func
(paren
id|index_file
comma
l_string|&quot;commit-msg&quot;
comma
id|git_path
c_func
(paren
id|commit_editmsg
)paren
comma
l_int|NULL
)paren
)paren
(brace
r_return
l_int|0
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n; * Find out if the message starting at position &squot;start&squot; in the strbuf&n; * contains only whitespace and Signed-off-by lines.&n; */
DECL|function|message_is_empty
r_static
r_int
id|message_is_empty
c_func
(paren
r_struct
id|strbuf
op_star
id|sb
comma
r_int
id|start
)paren
(brace
r_struct
id|strbuf
id|tmpl
suffix:semicolon
r_const
r_char
op_star
id|nl
suffix:semicolon
r_int
id|eol
comma
id|i
suffix:semicolon
r_if
c_cond
(paren
id|cleanup_mode
op_eq
id|CLEANUP_NONE
op_logical_and
id|sb-&gt;len
)paren
r_return
l_int|0
suffix:semicolon
multiline_comment|/* See if the template is just a prefix of the message. */
id|strbuf_init
c_func
(paren
op_amp
id|tmpl
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|template_file
op_logical_and
id|strbuf_read_file
c_func
(paren
op_amp
id|tmpl
comma
id|template_file
comma
l_int|0
)paren
OG
l_int|0
)paren
(brace
id|stripspace
c_func
(paren
op_amp
id|tmpl
comma
id|cleanup_mode
op_eq
id|CLEANUP_ALL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|start
op_plus
id|tmpl.len
op_le
id|sb-&gt;len
op_logical_and
id|memcmp
c_func
(paren
id|tmpl.buf
comma
id|sb-&gt;buf
op_plus
id|start
comma
id|tmpl.len
)paren
op_eq
l_int|0
)paren
id|start
op_add_assign
id|tmpl.len
suffix:semicolon
)brace
id|strbuf_release
c_func
(paren
op_amp
id|tmpl
)paren
suffix:semicolon
multiline_comment|/* Check if the rest is just whitespace and Signed-of-by&squot;s. */
r_for
c_loop
(paren
id|i
op_assign
id|start
suffix:semicolon
id|i
OL
id|sb-&gt;len
suffix:semicolon
id|i
op_increment
)paren
(brace
id|nl
op_assign
id|memchr
c_func
(paren
id|sb-&gt;buf
op_plus
id|i
comma
l_char|&squot;&bslash;n&squot;
comma
id|sb-&gt;len
id|i
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nl
)paren
id|eol
op_assign
id|nl
id|sb-&gt;buf
suffix:semicolon
r_else
id|eol
op_assign
id|sb-&gt;len
suffix:semicolon
r_if
c_cond
(paren
id|strlen
c_func
(paren
id|sign_off_header
)paren
op_le
id|eol
id|i
op_logical_and
op_logical_neg
id|prefixcmp
c_func
(paren
id|sb-&gt;buf
op_plus
id|i
comma
id|sign_off_header
)paren
)paren
(brace
id|i
op_assign
id|eol
suffix:semicolon
r_continue
suffix:semicolon
)brace
r_while
c_loop
(paren
id|i
OL
id|eol
)paren
r_if
c_cond
(paren
op_logical_neg
id|isspace
c_func
(paren
id|sb-&gt;buf
(braket
id|i
op_increment
)braket
)paren
)paren
r_return
l_int|0
suffix:semicolon
)brace
r_return
l_int|1
suffix:semicolon
)brace
DECL|function|parse_and_validate_options
r_static
r_int
id|parse_and_validate_options
c_func
(paren
r_int
id|argc
comma
r_const
r_char
op_star
id|argv
(braket
)braket
comma
r_const
r_char
op_star
r_const
id|usage
(braket
)braket
)paren
(brace
r_int
id|f
op_assign
l_int|0
suffix:semicolon
id|argc
op_assign
id|parse_options
c_func
(paren
id|argc
comma
id|argv
comma
id|builtin_commit_options
comma
id|usage
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
id|logfile
op_logical_or
id|message.len
op_logical_or
id|use_message
)paren
id|use_editor
op_assign
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|edit_flag
)paren
id|use_editor
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|use_editor
)paren
id|setenv
c_func
(paren
l_string|&quot;GIT_EDITOR&quot;
comma
l_string|&quot;:&quot;
comma
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|get_sha1
c_func
(paren
l_string|&quot;HEAD&quot;
comma
id|head_sha1
)paren
)paren
id|initial_commit
op_assign
l_int|1
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|get_sha1
c_func
(paren
l_string|&quot;MERGE_HEAD&quot;
comma
id|merge_head_sha1
)paren
)paren
id|in_merge
op_assign
l_int|1
suffix:semicolon
multiline_comment|/* Sanity check options */
r_if
c_cond
(paren
id|amend
op_logical_and
id|initial_commit
)paren
id|die
c_func
(paren
l_string|&quot;You have nothing to amend.&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|amend
op_logical_and
id|in_merge
)paren
id|die
c_func
(paren
l_string|&quot;You are in the middle of a merge -- cannot amend.&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|use_message
)paren
id|f
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|edit_message
)paren
id|f
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|logfile
)paren
id|f
op_increment
suffix:semicolon
r_if
c_cond
(paren
id|f
OG
l_int|1
)paren
id|die
c_func
(paren
l_string|&quot;Only one of -c/-C/-F can be used.&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|message.len
op_logical_and
id|f
OG
l_int|0
)paren
id|die
c_func
(paren
l_string|&quot;Option -m cannot be combined with -c/-C/-F.&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|edit_message
)paren
id|use_message
op_assign
id|edit_message
suffix:semicolon
r_if
c_cond
(paren
id|amend
op_logical_and
op_logical_neg
id|use_message
)paren
id|use_message
op_assign
l_string|&quot;HEAD&quot;
suffix:semicolon
r_if
c_cond
(paren
id|use_message
)paren
(brace
r_int
r_char
id|sha1
(braket
l_int|20
)braket
suffix:semicolon
r_static
r_char
id|utf8
(braket
)braket
op_assign
l_string|&quot;UTF-8&quot;
suffix:semicolon
r_const
r_char
op_star
id|out_enc
suffix:semicolon
r_char
op_star
id|enc
comma
op_star
id|end
suffix:semicolon
r_struct
id|commit
op_star
id|commit
suffix:semicolon
r_if
c_cond
(paren
id|get_sha1
c_func
(paren
id|use_message
comma
id|sha1
)paren
)paren
id|die
c_func
(paren
l_string|&quot;could not lookup commit %s&quot;
comma
id|use_message
)paren
suffix:semicolon
id|commit
op_assign
id|lookup_commit_reference
c_func
(paren
id|sha1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|commit
op_logical_or
id|parse_commit
c_func
(paren
id|commit
)paren
)paren
id|die
c_func
(paren
l_string|&quot;could not parse commit %s&quot;
comma
id|use_message
)paren
suffix:semicolon
id|enc
op_assign
id|strstr
c_func
(paren
id|commit-&gt;buffer
comma
l_string|&quot;&bslash;nencoding&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|enc
)paren
(brace
id|end
op_assign
id|strchr
c_func
(paren
id|enc
op_plus
l_int|10
comma
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
id|enc
op_assign
id|xstrndup
c_func
(paren
id|enc
op_plus
l_int|10
comma
id|end
(paren
id|enc
op_plus
l_int|10
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
id|enc
op_assign
id|utf8
suffix:semicolon
)brace
id|out_enc
op_assign
id|git_commit_encoding
ques
c_cond
id|git_commit_encoding
suffix:colon
id|utf8
suffix:semicolon
r_if
c_cond
(paren
id|strcmp
c_func
(paren
id|out_enc
comma
id|enc
)paren
)paren
id|use_message_buffer
op_assign
id|reencode_string
c_func
(paren
id|commit-&gt;buffer
comma
id|out_enc
comma
id|enc
)paren
suffix:semicolon
multiline_comment|/*&n;&t;&t; * If we failed to reencode the buffer, just copy it&n;&t;&t; * byte for byte so the user can try to fix it up.&n;&t;&t; * This also handles the case where input and output&n;&t;&t; * encodings are identical.&n;&t;&t; */
r_if
c_cond
(paren
id|use_message_buffer
op_eq
l_int|NULL
)paren
id|use_message_buffer
op_assign
id|xstrdup
c_func
(paren
id|commit-&gt;buffer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|enc
op_ne
id|utf8
)paren
id|free
c_func
(paren
id|enc
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
op_logical_neg
id|also
op_plus
op_logical_neg
op_logical_neg
id|only
op_plus
op_logical_neg
op_logical_neg
id|all
op_plus
op_logical_neg
op_logical_neg
id|interactive
OG
l_int|1
)paren
id|die
c_func
(paren
l_string|&quot;Only one of --include/--only/--all/--interactive can be used.&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|argc
op_eq
l_int|0
op_logical_and
(paren
id|also
op_logical_or
(paren
id|only
op_logical_and
op_logical_neg
id|amend
)paren
)paren
)paren
id|die
c_func
(paren
l_string|&quot;No paths with --include/--only does not make sense.&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|argc
op_eq
l_int|0
op_logical_and
id|only
op_logical_and
id|amend
)paren
id|only_include_assumed
op_assign
l_string|&quot;Clever... amending the last one with dirty index.&quot;
suffix:semicolon
r_if
c_cond
(paren
id|argc
OG
l_int|0
op_logical_and
op_logical_neg
id|also
op_logical_and
op_logical_neg
id|only
)paren
id|only_include_assumed
op_assign
l_string|&quot;Explicit paths specified without -i nor -o; assuming --only paths...&quot;
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|cleanup_arg
op_logical_or
op_logical_neg
id|strcmp
c_func
(paren
id|cleanup_arg
comma
l_string|&quot;default&quot;
)paren
)paren
id|cleanup_mode
op_assign
id|use_editor
ques
c_cond
id|CLEANUP_ALL
suffix:colon
id|CLEANUP_SPACE
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|cleanup_arg
comma
l_string|&quot;verbatim&quot;
)paren
)paren
id|cleanup_mode
op_assign
id|CLEANUP_NONE
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|cleanup_arg
comma
l_string|&quot;whitespace&quot;
)paren
)paren
id|cleanup_mode
op_assign
id|CLEANUP_SPACE
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|cleanup_arg
comma
l_string|&quot;strip&quot;
)paren
)paren
id|cleanup_mode
op_assign
id|CLEANUP_ALL
suffix:semicolon
r_else
id|die
c_func
(paren
l_string|&quot;Invalid cleanup mode %s&quot;
comma
id|cleanup_arg
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|untracked_files_arg
)paren
suffix:semicolon
multiline_comment|/* default already initialized */
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|untracked_files_arg
comma
l_string|&quot;no&quot;
)paren
)paren
id|show_untracked_files
op_assign
id|SHOW_NO_UNTRACKED_FILES
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|untracked_files_arg
comma
l_string|&quot;normal&quot;
)paren
)paren
id|show_untracked_files
op_assign
id|SHOW_NORMAL_UNTRACKED_FILES
suffix:semicolon
r_else
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|untracked_files_arg
comma
l_string|&quot;all&quot;
)paren
)paren
id|show_untracked_files
op_assign
id|SHOW_ALL_UNTRACKED_FILES
suffix:semicolon
r_else
id|die
c_func
(paren
l_string|&quot;Invalid untracked files mode &squot;%s&squot;&quot;
comma
id|untracked_files_arg
)paren
suffix:semicolon
r_if
c_cond
(paren
id|all
op_logical_and
id|argc
OG
l_int|0
)paren
id|die
c_func
(paren
l_string|&quot;Paths with -a does not make sense.&quot;
)paren
suffix:semicolon
r_else
r_if
c_cond
(paren
id|interactive
op_logical_and
id|argc
OG
l_int|0
)paren
id|die
c_func
(paren
l_string|&quot;Paths with --interactive does not make sense.&quot;
)paren
suffix:semicolon
r_return
id|argc
suffix:semicolon
)brace
DECL|function|cmd_status
r_int
id|cmd_status
c_func
(paren
r_int
id|argc
comma
r_const
r_char
op_star
op_star
id|argv
comma
r_const
r_char
op_star
id|prefix
)paren
(brace
r_const
r_char
op_star
id|index_file
suffix:semicolon
r_int
id|commitable
suffix:semicolon
id|git_config
c_func
(paren
id|git_status_config
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|wt_status_use_color
op_eq
l_int|1
)paren
id|wt_status_use_color
op_assign
id|git_use_color_default
suffix:semicolon
id|argc
op_assign
id|parse_and_validate_options
c_func
(paren
id|argc
comma
id|argv
comma
id|builtin_status_usage
)paren
suffix:semicolon
id|index_file
op_assign
id|prepare_index
c_func
(paren
id|argc
comma
id|argv
comma
id|prefix
)paren
suffix:semicolon
id|commitable
op_assign
id|run_status
c_func
(paren
id|stdout
comma
id|index_file
comma
id|prefix
comma
l_int|0
)paren
suffix:semicolon
id|rollback_index_files
c_func
(paren
)paren
suffix:semicolon
r_return
id|commitable
ques
c_cond
l_int|0
suffix:colon
l_int|1
suffix:semicolon
)brace
DECL|function|print_summary
r_static
r_void
id|print_summary
c_func
(paren
r_const
r_char
op_star
id|prefix
comma
r_const
r_int
r_char
op_star
id|sha1
)paren
(brace
r_struct
id|rev_info
id|rev
suffix:semicolon
r_struct
id|commit
op_star
id|commit
suffix:semicolon
id|commit
op_assign
id|lookup_commit
c_func
(paren
id|sha1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|commit
)paren
id|die
c_func
(paren
l_string|&quot;couldn&squot;t look up newly created commit&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|commit
op_logical_or
id|parse_commit
c_func
(paren
id|commit
)paren
)paren
id|die
c_func
(paren
l_string|&quot;could not parse newly created commit&quot;
)paren
suffix:semicolon
id|init_revisions
c_func
(paren
op_amp
id|rev
comma
id|prefix
)paren
suffix:semicolon
id|setup_revisions
c_func
(paren
l_int|0
comma
l_int|NULL
comma
op_amp
id|rev
comma
l_int|NULL
)paren
suffix:semicolon
id|rev.abbrev
op_assign
l_int|0
suffix:semicolon
id|rev.diff
op_assign
l_int|1
suffix:semicolon
id|rev.diffopt.output_format
op_assign
id|DIFF_FORMAT_SHORTSTAT
op_or
id|DIFF_FORMAT_SUMMARY
suffix:semicolon
id|rev.verbose_header
op_assign
l_int|1
suffix:semicolon
id|rev.show_root_diff
op_assign
l_int|1
suffix:semicolon
id|get_commit_format
c_func
(paren
l_string|&quot;format:%h: %s&quot;
comma
op_amp
id|rev
)paren
suffix:semicolon
id|rev.always_show_header
op_assign
l_int|0
suffix:semicolon
id|rev.diffopt.detect_rename
op_assign
l_int|1
suffix:semicolon
id|rev.diffopt.rename_limit
op_assign
l_int|100
suffix:semicolon
id|rev.diffopt.break_opt
op_assign
l_int|0
suffix:semicolon
id|diff_setup_done
c_func
(paren
op_amp
id|rev.diffopt
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;Created %scommit &quot;
comma
id|initial_commit
ques
c_cond
l_string|&quot;initial &quot;
suffix:colon
l_string|&quot;&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|log_tree_commit
c_func
(paren
op_amp
id|rev
comma
id|commit
)paren
)paren
(brace
r_struct
id|strbuf
id|buf
op_assign
id|STRBUF_INIT
suffix:semicolon
id|format_commit_message
c_func
(paren
id|commit
comma
l_string|&quot;%h: %s&quot;
comma
op_amp
id|buf
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|buf.buf
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|buf
)paren
suffix:semicolon
)brace
)brace
DECL|function|git_commit_config
r_int
id|git_commit_config
c_func
(paren
r_const
r_char
op_star
id|k
comma
r_const
r_char
op_star
id|v
comma
r_void
op_star
id|cb
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|strcmp
c_func
(paren
id|k
comma
l_string|&quot;commit.template&quot;
)paren
)paren
r_return
id|git_config_string
c_func
(paren
op_amp
id|template_file
comma
id|k
comma
id|v
)paren
suffix:semicolon
r_return
id|git_status_config
c_func
(paren
id|k
comma
id|v
comma
id|cb
)paren
suffix:semicolon
)brace
DECL|variable|commit_utf8_warn
r_static
r_const
r_char
id|commit_utf8_warn
(braket
)braket
op_assign
l_string|&quot;Warning: commit message does not conform to UTF-8.&bslash;n&quot;
l_string|&quot;You may want to amend it after fixing the message, or set the config&bslash;n&quot;
l_string|&quot;variable i18n.commitencoding to the encoding your project uses.&bslash;n&quot;
suffix:semicolon
DECL|function|add_parent
r_static
r_void
id|add_parent
c_func
(paren
r_struct
id|strbuf
op_star
id|sb
comma
r_const
r_int
r_char
op_star
id|sha1
)paren
(brace
r_struct
id|object
op_star
id|obj
op_assign
id|parse_object
c_func
(paren
id|sha1
)paren
suffix:semicolon
r_const
r_char
op_star
id|parent
op_assign
id|sha1_to_hex
c_func
(paren
id|sha1
)paren
suffix:semicolon
r_const
r_char
op_star
id|cp
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|obj
)paren
id|die
c_func
(paren
l_string|&quot;Unable to find commit parent %s&quot;
comma
id|parent
)paren
suffix:semicolon
r_if
c_cond
(paren
id|obj-&gt;type
op_ne
id|OBJ_COMMIT
)paren
id|die
c_func
(paren
l_string|&quot;Parent %s isn&squot;t a proper commit&quot;
comma
id|parent
)paren
suffix:semicolon
r_for
c_loop
(paren
id|cp
op_assign
id|sb-&gt;buf
suffix:semicolon
id|cp
op_logical_and
(paren
id|cp
op_assign
id|strstr
c_func
(paren
id|cp
comma
l_string|&quot;&bslash;nparent &quot;
)paren
)paren
suffix:semicolon
id|cp
op_add_assign
l_int|8
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|memcmp
c_func
(paren
id|cp
op_plus
l_int|8
comma
id|parent
comma
l_int|40
)paren
op_logical_and
id|cp
(braket
l_int|48
)braket
op_eq
l_char|&squot;&bslash;n&squot;
)paren
(brace
id|error
c_func
(paren
l_string|&quot;duplicate parent %s ignored&quot;
comma
id|parent
)paren
suffix:semicolon
r_return
suffix:semicolon
)brace
)brace
id|strbuf_addf
c_func
(paren
id|sb
comma
l_string|&quot;parent %s&bslash;n&quot;
comma
id|parent
)paren
suffix:semicolon
)brace
DECL|function|cmd_commit
r_int
id|cmd_commit
c_func
(paren
r_int
id|argc
comma
r_const
r_char
op_star
op_star
id|argv
comma
r_const
r_char
op_star
id|prefix
)paren
(brace
r_int
id|header_len
suffix:semicolon
r_struct
id|strbuf
id|sb
suffix:semicolon
r_const
r_char
op_star
id|index_file
comma
op_star
id|reflog_msg
suffix:semicolon
r_char
op_star
id|nl
comma
op_star
id|p
suffix:semicolon
r_int
r_char
id|commit_sha1
(braket
l_int|20
)braket
suffix:semicolon
r_struct
id|ref_lock
op_star
id|ref_lock
suffix:semicolon
id|git_config
c_func
(paren
id|git_commit_config
comma
l_int|NULL
)paren
suffix:semicolon
id|argc
op_assign
id|parse_and_validate_options
c_func
(paren
id|argc
comma
id|argv
comma
id|builtin_commit_usage
)paren
suffix:semicolon
id|index_file
op_assign
id|prepare_index
c_func
(paren
id|argc
comma
id|argv
comma
id|prefix
)paren
suffix:semicolon
multiline_comment|/* Set up everything for writing the commit object.  This includes&n;&t;   running hooks, writing the trees, and interacting with the user.  */
r_if
c_cond
(paren
op_logical_neg
id|prepare_to_commit
c_func
(paren
id|index_file
comma
id|prefix
)paren
)paren
(brace
id|rollback_index_files
c_func
(paren
)paren
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
multiline_comment|/*&n;&t; * The commit object&n;&t; */
id|strbuf_init
c_func
(paren
op_amp
id|sb
comma
l_int|0
)paren
suffix:semicolon
id|strbuf_addf
c_func
(paren
op_amp
id|sb
comma
l_string|&quot;tree %s&bslash;n&quot;
comma
id|sha1_to_hex
c_func
(paren
id|active_cache_tree-&gt;sha1
)paren
)paren
suffix:semicolon
multiline_comment|/* Determine parents */
r_if
c_cond
(paren
id|initial_commit
)paren
(brace
id|reflog_msg
op_assign
l_string|&quot;commit (initial)&quot;
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|amend
)paren
(brace
r_struct
id|commit_list
op_star
id|c
suffix:semicolon
r_struct
id|commit
op_star
id|commit
suffix:semicolon
id|reflog_msg
op_assign
l_string|&quot;commit (amend)&quot;
suffix:semicolon
id|commit
op_assign
id|lookup_commit
c_func
(paren
id|head_sha1
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|commit
op_logical_or
id|parse_commit
c_func
(paren
id|commit
)paren
)paren
id|die
c_func
(paren
l_string|&quot;could not parse HEAD commit&quot;
)paren
suffix:semicolon
r_for
c_loop
(paren
id|c
op_assign
id|commit-&gt;parents
suffix:semicolon
id|c
suffix:semicolon
id|c
op_assign
id|c-&gt;next
)paren
id|add_parent
c_func
(paren
op_amp
id|sb
comma
id|c-&gt;item-&gt;object.sha1
)paren
suffix:semicolon
)brace
r_else
r_if
c_cond
(paren
id|in_merge
)paren
(brace
r_struct
id|strbuf
id|m
suffix:semicolon
id|FILE
op_star
id|fp
suffix:semicolon
id|reflog_msg
op_assign
l_string|&quot;commit (merge)&quot;
suffix:semicolon
id|add_parent
c_func
(paren
op_amp
id|sb
comma
id|head_sha1
)paren
suffix:semicolon
id|strbuf_init
c_func
(paren
op_amp
id|m
comma
l_int|0
)paren
suffix:semicolon
id|fp
op_assign
id|fopen
c_func
(paren
id|git_path
c_func
(paren
l_string|&quot;MERGE_HEAD&quot;
)paren
comma
l_string|&quot;r&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|fp
op_eq
l_int|NULL
)paren
id|die
c_func
(paren
l_string|&quot;could not open %s for reading: %s&quot;
comma
id|git_path
c_func
(paren
l_string|&quot;MERGE_HEAD&quot;
)paren
comma
id|strerror
c_func
(paren
id|errno
)paren
)paren
suffix:semicolon
r_while
c_loop
(paren
id|strbuf_getline
c_func
(paren
op_amp
id|m
comma
id|fp
comma
l_char|&squot;&bslash;n&squot;
)paren
op_ne
id|EOF
)paren
(brace
r_int
r_char
id|sha1
(braket
l_int|20
)braket
suffix:semicolon
r_if
c_cond
(paren
id|get_sha1_hex
c_func
(paren
id|m.buf
comma
id|sha1
)paren
OL
l_int|0
)paren
id|die
c_func
(paren
l_string|&quot;Corrupt MERGE_HEAD file (%s)&quot;
comma
id|m.buf
)paren
suffix:semicolon
id|add_parent
c_func
(paren
op_amp
id|sb
comma
id|sha1
)paren
suffix:semicolon
)brace
id|fclose
c_func
(paren
id|fp
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|m
)paren
suffix:semicolon
)brace
r_else
(brace
id|reflog_msg
op_assign
l_string|&quot;commit&quot;
suffix:semicolon
id|strbuf_addf
c_func
(paren
op_amp
id|sb
comma
l_string|&quot;parent %s&bslash;n&quot;
comma
id|sha1_to_hex
c_func
(paren
id|head_sha1
)paren
)paren
suffix:semicolon
)brace
id|strbuf_addf
c_func
(paren
op_amp
id|sb
comma
l_string|&quot;author %s&bslash;n&quot;
comma
id|fmt_ident
c_func
(paren
id|author_name
comma
id|author_email
comma
id|author_date
comma
id|IDENT_ERROR_ON_NO_NAME
)paren
)paren
suffix:semicolon
id|strbuf_addf
c_func
(paren
op_amp
id|sb
comma
l_string|&quot;committer %s&bslash;n&quot;
comma
id|git_committer_info
c_func
(paren
id|IDENT_ERROR_ON_NO_NAME
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|is_encoding_utf8
c_func
(paren
id|git_commit_encoding
)paren
)paren
id|strbuf_addf
c_func
(paren
op_amp
id|sb
comma
l_string|&quot;encoding %s&bslash;n&quot;
comma
id|git_commit_encoding
)paren
suffix:semicolon
id|strbuf_addch
c_func
(paren
op_amp
id|sb
comma
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
multiline_comment|/* Finally, get the commit message */
id|header_len
op_assign
id|sb.len
suffix:semicolon
r_if
c_cond
(paren
id|strbuf_read_file
c_func
(paren
op_amp
id|sb
comma
id|git_path
c_func
(paren
id|commit_editmsg
)paren
comma
l_int|0
)paren
OL
l_int|0
)paren
(brace
id|rollback_index_files
c_func
(paren
)paren
suffix:semicolon
id|die
c_func
(paren
l_string|&quot;could not read commit message&quot;
)paren
suffix:semicolon
)brace
multiline_comment|/* Truncate the message just before the diff, if any. */
id|p
op_assign
id|strstr
c_func
(paren
id|sb.buf
comma
l_string|&quot;&bslash;ndiff --git a/&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|p
op_ne
l_int|NULL
)paren
id|strbuf_setlen
c_func
(paren
op_amp
id|sb
comma
id|p
id|sb.buf
op_plus
l_int|1
)paren
suffix:semicolon
r_if
c_cond
(paren
id|cleanup_mode
op_ne
id|CLEANUP_NONE
)paren
id|stripspace
c_func
(paren
op_amp
id|sb
comma
id|cleanup_mode
op_eq
id|CLEANUP_ALL
)paren
suffix:semicolon
r_if
c_cond
(paren
id|sb.len
OL
id|header_len
op_logical_or
id|message_is_empty
c_func
(paren
op_amp
id|sb
comma
id|header_len
)paren
)paren
(brace
id|rollback_index_files
c_func
(paren
)paren
suffix:semicolon
id|die
c_func
(paren
l_string|&quot;no commit message?  aborting commit.&quot;
)paren
suffix:semicolon
)brace
id|strbuf_addch
c_func
(paren
op_amp
id|sb
comma
l_char|&squot;&bslash;0&squot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|is_encoding_utf8
c_func
(paren
id|git_commit_encoding
)paren
op_logical_and
op_logical_neg
id|is_utf8
c_func
(paren
id|sb.buf
)paren
)paren
id|fprintf
c_func
(paren
id|stderr
comma
id|commit_utf8_warn
)paren
suffix:semicolon
r_if
c_cond
(paren
id|write_sha1_file
c_func
(paren
id|sb.buf
comma
id|sb.len
l_int|1
comma
id|commit_type
comma
id|commit_sha1
)paren
)paren
(brace
id|rollback_index_files
c_func
(paren
)paren
suffix:semicolon
id|die
c_func
(paren
l_string|&quot;failed to write commit object&quot;
)paren
suffix:semicolon
)brace
id|ref_lock
op_assign
id|lock_any_ref_for_update
c_func
(paren
l_string|&quot;HEAD&quot;
comma
id|initial_commit
ques
c_cond
l_int|NULL
suffix:colon
id|head_sha1
comma
l_int|0
)paren
suffix:semicolon
id|nl
op_assign
id|strchr
c_func
(paren
id|sb.buf
op_plus
id|header_len
comma
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
r_if
c_cond
(paren
id|nl
)paren
id|strbuf_setlen
c_func
(paren
op_amp
id|sb
comma
id|nl
op_plus
l_int|1
id|sb.buf
)paren
suffix:semicolon
r_else
id|strbuf_addch
c_func
(paren
op_amp
id|sb
comma
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
id|strbuf_remove
c_func
(paren
op_amp
id|sb
comma
l_int|0
comma
id|header_len
)paren
suffix:semicolon
id|strbuf_insert
c_func
(paren
op_amp
id|sb
comma
l_int|0
comma
id|reflog_msg
comma
id|strlen
c_func
(paren
id|reflog_msg
)paren
)paren
suffix:semicolon
id|strbuf_insert
c_func
(paren
op_amp
id|sb
comma
id|strlen
c_func
(paren
id|reflog_msg
)paren
comma
l_string|&quot;: &quot;
comma
l_int|2
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|ref_lock
)paren
(brace
id|rollback_index_files
c_func
(paren
)paren
suffix:semicolon
id|die
c_func
(paren
l_string|&quot;cannot lock HEAD ref&quot;
)paren
suffix:semicolon
)brace
r_if
c_cond
(paren
id|write_ref_sha1
c_func
(paren
id|ref_lock
comma
id|commit_sha1
comma
id|sb.buf
)paren
OL
l_int|0
)paren
(brace
id|rollback_index_files
c_func
(paren
)paren
suffix:semicolon
id|die
c_func
(paren
l_string|&quot;cannot update HEAD ref&quot;
)paren
suffix:semicolon
)brace
id|unlink
c_func
(paren
id|git_path
c_func
(paren
l_string|&quot;MERGE_HEAD&quot;
)paren
)paren
suffix:semicolon
id|unlink
c_func
(paren
id|git_path
c_func
(paren
l_string|&quot;MERGE_MSG&quot;
)paren
)paren
suffix:semicolon
id|unlink
c_func
(paren
id|git_path
c_func
(paren
l_string|&quot;SQUASH_MSG&quot;
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
id|commit_index_files
c_func
(paren
)paren
)paren
id|die
(paren
l_string|&quot;Repository has been updated, but unable to write&bslash;n&quot;
l_string|&quot;new_index file. Check that disk is not full or quota is&bslash;n&quot;
l_string|&quot;not exceeded, and then &bslash;&quot;git reset HEAD&bslash;&quot; to recover.&quot;
)paren
suffix:semicolon
id|rerere
c_func
(paren
)paren
suffix:semicolon
id|run_hook
c_func
(paren
id|get_index_file
c_func
(paren
)paren
comma
l_string|&quot;post-commit&quot;
comma
l_int|NULL
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|quiet
)paren
id|print_summary
c_func
(paren
id|prefix
comma
id|commit_sha1
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
eof
