macro_line|#include &quot;../git-compat-util.h&quot;
DECL|function|gitsetenv
r_int
id|gitsetenv
c_func
(paren
r_const
r_char
op_star
id|name
comma
r_const
r_char
op_star
id|value
comma
r_int
id|replace
)paren
(brace
r_int
id|out
suffix:semicolon
r_int
id|namelen
comma
id|valuelen
suffix:semicolon
r_char
op_star
id|envstr
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|name
op_logical_or
op_logical_neg
id|value
)paren
(brace
id|errno
op_assign
id|EINVAL
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
r_if
c_cond
(paren
op_logical_neg
id|replace
)paren
(brace
r_char
op_star
id|oldval
op_assign
l_int|NULL
suffix:semicolon
id|oldval
op_assign
id|getenv
c_func
(paren
id|name
)paren
suffix:semicolon
r_if
c_cond
(paren
id|oldval
)paren
r_return
l_int|0
suffix:semicolon
)brace
id|namelen
op_assign
id|strlen
c_func
(paren
id|name
)paren
suffix:semicolon
id|valuelen
op_assign
id|strlen
c_func
(paren
id|value
)paren
suffix:semicolon
id|envstr
op_assign
id|malloc
c_func
(paren
(paren
id|namelen
op_plus
id|valuelen
op_plus
l_int|2
)paren
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|envstr
)paren
(brace
id|errno
op_assign
id|ENOMEM
suffix:semicolon
r_return
l_int|1
suffix:semicolon
)brace
id|memcpy
c_func
(paren
id|envstr
comma
id|name
comma
id|namelen
)paren
suffix:semicolon
id|envstr
(braket
id|namelen
)braket
op_assign
l_char|&squot;=&squot;
suffix:semicolon
id|memcpy
c_func
(paren
id|envstr
op_plus
id|namelen
op_plus
l_int|1
comma
id|value
comma
id|valuelen
)paren
suffix:semicolon
id|envstr
(braket
id|namelen
op_plus
id|valuelen
op_plus
l_int|1
)braket
op_assign
l_int|0
suffix:semicolon
id|out
op_assign
id|putenv
c_func
(paren
id|envstr
)paren
suffix:semicolon
multiline_comment|/* putenv(3) makes the argument string part of the environment,&n;&t; * and changing that string modifies the environment --- which&n;&t; * means we do not own that storage anymore.  Do not free&n;&t; * envstr.&n;&t; */
r_return
id|out
suffix:semicolon
)brace
eof
