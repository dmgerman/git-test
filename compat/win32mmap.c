macro_line|#include &quot;../git-compat-util.h&quot;
DECL|function|git_mmap
r_void
op_star
id|git_mmap
c_func
(paren
r_void
op_star
id|start
comma
r_int
id|length
comma
r_int
id|prot
comma
r_int
id|flags
comma
r_int
id|fd
comma
id|off_t
id|offset
)paren
(brace
id|HANDLE
id|hmap
suffix:semicolon
r_void
op_star
id|temp
suffix:semicolon
r_int
id|len
suffix:semicolon
r_struct
id|stat
id|st
suffix:semicolon
r_uint64
id|o
op_assign
id|offset
suffix:semicolon
r_uint32
id|l
op_assign
id|o
op_amp
l_int|0xFFFFFFFF
suffix:semicolon
r_uint32
id|h
op_assign
(paren
id|o
op_rshift
l_int|32
)paren
op_amp
l_int|0xFFFFFFFF
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|fstat
c_func
(paren
id|fd
comma
op_amp
id|st
)paren
)paren
id|len
op_assign
id|xsize_t
c_func
(paren
id|st.st_size
)paren
suffix:semicolon
r_else
id|die
c_func
(paren
l_string|&quot;mmap: could not determine filesize&quot;
)paren
suffix:semicolon
r_if
c_cond
(paren
(paren
id|length
op_plus
id|offset
)paren
OG
id|len
)paren
id|length
op_assign
id|len
id|offset
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
(paren
id|flags
op_amp
id|MAP_PRIVATE
)paren
)paren
id|die
c_func
(paren
l_string|&quot;Invalid usage of mmap when built with USE_WIN32_MMAP&quot;
)paren
suffix:semicolon
id|hmap
op_assign
id|CreateFileMapping
c_func
(paren
(paren
id|HANDLE
)paren
id|_get_osfhandle
c_func
(paren
id|fd
)paren
comma
l_int|0
comma
id|PAGE_WRITECOPY
comma
l_int|0
comma
l_int|0
comma
l_int|0
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|hmap
)paren
r_return
id|MAP_FAILED
suffix:semicolon
id|temp
op_assign
id|MapViewOfFileEx
c_func
(paren
id|hmap
comma
id|FILE_MAP_COPY
comma
id|h
comma
id|l
comma
id|length
comma
id|start
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|CloseHandle
c_func
(paren
id|hmap
)paren
)paren
id|warning
c_func
(paren
l_string|&quot;unable to close file mapping handle&bslash;n&quot;
)paren
suffix:semicolon
r_return
id|temp
ques
c_cond
id|temp
suffix:colon
id|MAP_FAILED
suffix:semicolon
)brace
DECL|function|git_munmap
r_int
id|git_munmap
c_func
(paren
r_void
op_star
id|start
comma
r_int
id|length
)paren
(brace
r_return
op_logical_neg
id|UnmapViewOfFile
c_func
(paren
id|start
)paren
suffix:semicolon
)brace
eof
