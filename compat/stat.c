DECL|macro|_POSIX_C_SOURCE
mdefine_line|#define _POSIX_C_SOURCE 200112L
macro_line|#include &lt;sys/stat.h&gt;  /* *stat, S_IS* */
macro_line|#include &lt;sys/types.h&gt; /* mode_t       */
DECL|function|mode_native_to_git
r_static
r_inline
id|mode_t
id|mode_native_to_git
c_func
(paren
id|mode_t
id|native_mode
)paren
(brace
id|mode_t
id|perm_bits
op_assign
id|native_mode
op_amp
l_int|07777
suffix:semicolon
r_if
c_cond
(paren
id|S_ISREG
c_func
(paren
id|native_mode
)paren
)paren
r_return
l_int|0100000
op_or
id|perm_bits
suffix:semicolon
r_if
c_cond
(paren
id|S_ISDIR
c_func
(paren
id|native_mode
)paren
)paren
r_return
l_int|0040000
op_or
id|perm_bits
suffix:semicolon
r_if
c_cond
(paren
id|S_ISLNK
c_func
(paren
id|native_mode
)paren
)paren
r_return
l_int|0120000
op_or
id|perm_bits
suffix:semicolon
r_if
c_cond
(paren
id|S_ISBLK
c_func
(paren
id|native_mode
)paren
)paren
r_return
l_int|0060000
op_or
id|perm_bits
suffix:semicolon
r_if
c_cond
(paren
id|S_ISCHR
c_func
(paren
id|native_mode
)paren
)paren
r_return
l_int|0020000
op_or
id|perm_bits
suffix:semicolon
r_if
c_cond
(paren
id|S_ISFIFO
c_func
(paren
id|native_mode
)paren
)paren
r_return
l_int|0010000
op_or
id|perm_bits
suffix:semicolon
r_if
c_cond
(paren
id|S_ISSOCK
c_func
(paren
id|native_mode
)paren
)paren
r_return
l_int|0140000
op_or
id|perm_bits
suffix:semicolon
multiline_comment|/* Non-standard type bits were given. */
r_return
id|perm_bits
suffix:semicolon
)brace
DECL|function|git_stat
r_int
id|git_stat
c_func
(paren
r_const
r_char
op_star
id|path
comma
r_struct
id|stat
op_star
id|buf
)paren
(brace
r_int
id|rc
op_assign
id|stat
c_func
(paren
id|path
comma
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_eq
l_int|0
)paren
id|buf-&gt;st_mode
op_assign
id|mode_native_to_git
c_func
(paren
id|buf-&gt;st_mode
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|git_fstat
r_int
id|git_fstat
c_func
(paren
r_int
id|fd
comma
r_struct
id|stat
op_star
id|buf
)paren
(brace
r_int
id|rc
op_assign
id|fstat
c_func
(paren
id|fd
comma
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_eq
l_int|0
)paren
id|buf-&gt;st_mode
op_assign
id|mode_native_to_git
c_func
(paren
id|buf-&gt;st_mode
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
DECL|function|git_lstat
r_int
id|git_lstat
c_func
(paren
r_const
r_char
op_star
id|path
comma
r_struct
id|stat
op_star
id|buf
)paren
(brace
r_int
id|rc
op_assign
id|lstat
c_func
(paren
id|path
comma
id|buf
)paren
suffix:semicolon
r_if
c_cond
(paren
id|rc
op_eq
l_int|0
)paren
id|buf-&gt;st_mode
op_assign
id|mode_native_to_git
c_func
(paren
id|buf-&gt;st_mode
)paren
suffix:semicolon
r_return
id|rc
suffix:semicolon
)brace
eof
