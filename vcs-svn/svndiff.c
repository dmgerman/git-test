multiline_comment|/*&n; * Licensed under a two-clause BSD-style license.&n; * See LICENSE for details.&n; */
macro_line|#include &quot;git-compat-util.h&quot;
macro_line|#include &quot;line_buffer.h&quot;
macro_line|#include &quot;svndiff.h&quot;
multiline_comment|/*&n; * svndiff0 applier&n; *&n; * See http://svn.apache.org/repos/asf/subversion/trunk/notes/svndiff.&n; *&n; * svndiff0 ::= &squot;SVN&bslash;0&squot; window*&n; */
DECL|function|error_short_read
r_static
r_int
id|error_short_read
c_func
(paren
r_struct
id|line_buffer
op_star
id|input
)paren
(brace
r_if
c_cond
(paren
id|buffer_ferror
c_func
(paren
id|input
)paren
)paren
r_return
id|error
c_func
(paren
l_string|&quot;error reading delta: %s&quot;
comma
id|strerror
c_func
(paren
id|errno
)paren
)paren
suffix:semicolon
r_return
id|error
c_func
(paren
l_string|&quot;invalid delta: unexpected end of file&quot;
)paren
suffix:semicolon
)brace
DECL|function|read_magic
r_static
r_int
id|read_magic
c_func
(paren
r_struct
id|line_buffer
op_star
id|in
comma
id|off_t
op_star
id|len
)paren
(brace
r_static
r_const
r_char
id|magic
(braket
)braket
op_assign
(brace
l_char|&squot;S&squot;
comma
l_char|&squot;V&squot;
comma
l_char|&squot;N&squot;
comma
l_char|&squot;&bslash;0&squot;
)brace
suffix:semicolon
r_struct
id|strbuf
id|sb
op_assign
id|STRBUF_INIT
suffix:semicolon
r_if
c_cond
(paren
op_star
id|len
OL
r_sizeof
(paren
id|magic
)paren
op_logical_or
id|buffer_read_binary
c_func
(paren
id|in
comma
op_amp
id|sb
comma
r_sizeof
(paren
id|magic
)paren
)paren
op_ne
r_sizeof
(paren
id|magic
)paren
)paren
r_return
id|error_short_read
c_func
(paren
id|in
)paren
suffix:semicolon
r_if
c_cond
(paren
id|memcmp
c_func
(paren
id|sb.buf
comma
id|magic
comma
r_sizeof
(paren
id|magic
)paren
)paren
)paren
r_return
id|error
c_func
(paren
l_string|&quot;invalid delta: unrecognized file type&quot;
)paren
suffix:semicolon
op_star
id|len
op_sub_assign
r_sizeof
(paren
id|magic
)paren
suffix:semicolon
id|strbuf_release
c_func
(paren
op_amp
id|sb
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
DECL|function|svndiff0_apply
r_int
id|svndiff0_apply
c_func
(paren
r_struct
id|line_buffer
op_star
id|delta
comma
id|off_t
id|delta_len
comma
r_struct
id|sliding_view
op_star
id|preimage
comma
id|FILE
op_star
id|postimage
)paren
(brace
m_assert
(paren
id|delta
op_logical_and
id|preimage
op_logical_and
id|postimage
)paren
suffix:semicolon
r_if
c_cond
(paren
id|read_magic
c_func
(paren
id|delta
comma
op_amp
id|delta_len
)paren
)paren
r_return
l_int|1
suffix:semicolon
r_if
c_cond
(paren
id|delta_len
)paren
r_return
id|error
c_func
(paren
l_string|&quot;What do you think I am?  A delta applier?&quot;
)paren
suffix:semicolon
r_return
l_int|0
suffix:semicolon
)brace
eof
