multiline_comment|/*&n; * Licensed under a two-clause BSD-style license.&n; * See LICENSE for details.&n; */
macro_line|#include &quot;git-compat-util.h&quot;
macro_line|#include &quot;trp.h&quot;
macro_line|#include &quot;obj_pool.h&quot;
macro_line|#include &quot;string_pool.h&quot;
DECL|variable|tree
r_static
r_struct
id|trp_root
id|tree
op_assign
(brace
op_complement
l_int|0
)brace
suffix:semicolon
DECL|struct|node
r_struct
id|node
(brace
DECL|member|offset
r_uint32
id|offset
suffix:semicolon
DECL|member|children
r_struct
id|trp_node
id|children
suffix:semicolon
)brace
suffix:semicolon
multiline_comment|/* Two memory pools: one for struct node, and another for strings */
id|obj_pool_gen
c_func
(paren
id|node
comma
r_struct
id|node
comma
l_int|4096
)paren
id|obj_pool_gen
c_func
(paren
id|string
comma
r_char
comma
l_int|4096
)paren
DECL|function|node_value
r_static
r_char
op_star
id|node_value
c_func
(paren
r_struct
id|node
op_star
id|node
)paren
(brace
r_return
id|node
ques
c_cond
id|string_pointer
c_func
(paren
id|node-&gt;offset
)paren
suffix:colon
l_int|NULL
suffix:semicolon
)brace
DECL|function|node_cmp
r_static
r_int
id|node_cmp
c_func
(paren
r_struct
id|node
op_star
id|a
comma
r_struct
id|node
op_star
id|b
)paren
(brace
r_return
id|strcmp
c_func
(paren
id|node_value
c_func
(paren
id|a
)paren
comma
id|node_value
c_func
(paren
id|b
)paren
)paren
suffix:semicolon
)brace
multiline_comment|/* Build a Treap from the node structure (a trp_node w/ offset) */
id|trp_gen
c_func
(paren
r_static
comma
id|tree_
comma
r_struct
id|node
comma
id|children
comma
id|node
comma
id|node_cmp
)paren
suffix:semicolon
DECL|function|pool_fetch
r_const
r_char
op_star
id|pool_fetch
c_func
(paren
r_uint32
id|entry
)paren
(brace
r_return
id|node_value
c_func
(paren
id|node_pointer
c_func
(paren
id|entry
)paren
)paren
suffix:semicolon
)brace
DECL|function|pool_intern
r_uint32
id|pool_intern
c_func
(paren
r_const
r_char
op_star
id|key
)paren
(brace
multiline_comment|/* Canonicalize key */
r_struct
id|node
op_star
id|match
op_assign
l_int|NULL
comma
op_star
id|node
suffix:semicolon
r_uint32
id|key_len
suffix:semicolon
r_if
c_cond
(paren
id|key
op_eq
l_int|NULL
)paren
r_return
op_complement
l_int|0
suffix:semicolon
id|key_len
op_assign
id|strlen
c_func
(paren
id|key
)paren
op_plus
l_int|1
suffix:semicolon
id|node
op_assign
id|node_pointer
c_func
(paren
id|node_alloc
c_func
(paren
l_int|1
)paren
)paren
suffix:semicolon
id|node-&gt;offset
op_assign
id|string_alloc
c_func
(paren
id|key_len
)paren
suffix:semicolon
id|strcpy
c_func
(paren
id|node_value
c_func
(paren
id|node
)paren
comma
id|key
)paren
suffix:semicolon
id|match
op_assign
id|tree_search
c_func
(paren
op_amp
id|tree
comma
id|node
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|match
)paren
(brace
id|tree_insert
c_func
(paren
op_amp
id|tree
comma
id|node
)paren
suffix:semicolon
)brace
r_else
(brace
id|node_free
c_func
(paren
l_int|1
)paren
suffix:semicolon
id|string_free
c_func
(paren
id|key_len
)paren
suffix:semicolon
id|node
op_assign
id|match
suffix:semicolon
)brace
r_return
id|node_offset
c_func
(paren
id|node
)paren
suffix:semicolon
)brace
DECL|function|pool_tok_r
r_uint32
id|pool_tok_r
c_func
(paren
r_char
op_star
id|str
comma
r_const
r_char
op_star
id|delim
comma
r_char
op_star
op_star
id|saveptr
)paren
(brace
r_char
op_star
id|token
op_assign
id|strtok_r
c_func
(paren
id|str
comma
id|delim
comma
id|saveptr
)paren
suffix:semicolon
r_return
id|token
ques
c_cond
id|pool_intern
c_func
(paren
id|token
)paren
suffix:colon
op_complement
l_int|0
suffix:semicolon
)brace
DECL|function|pool_print_seq
r_void
id|pool_print_seq
c_func
(paren
r_uint32
id|len
comma
r_const
r_uint32
op_star
id|seq
comma
r_char
id|delim
comma
id|FILE
op_star
id|stream
)paren
(brace
r_uint32
id|i
suffix:semicolon
r_for
c_loop
(paren
id|i
op_assign
l_int|0
suffix:semicolon
id|i
OL
id|len
op_logical_and
op_complement
id|seq
(braket
id|i
)braket
suffix:semicolon
id|i
op_increment
)paren
(brace
id|fputs
c_func
(paren
id|pool_fetch
c_func
(paren
id|seq
(braket
id|i
)braket
)paren
comma
id|stream
)paren
suffix:semicolon
r_if
c_cond
(paren
id|i
OL
id|len
l_int|1
op_logical_and
op_complement
id|seq
(braket
id|i
op_plus
l_int|1
)braket
)paren
id|fputc
c_func
(paren
id|delim
comma
id|stream
)paren
suffix:semicolon
)brace
)brace
DECL|function|pool_tok_seq
r_uint32
id|pool_tok_seq
c_func
(paren
r_uint32
id|sz
comma
r_uint32
op_star
id|seq
comma
r_const
r_char
op_star
id|delim
comma
r_char
op_star
id|str
)paren
(brace
r_char
op_star
id|context
op_assign
l_int|NULL
suffix:semicolon
r_uint32
id|token
op_assign
op_complement
l_int|0
suffix:semicolon
r_uint32
id|length
suffix:semicolon
r_if
c_cond
(paren
id|sz
op_eq
l_int|0
)paren
r_return
op_complement
l_int|0
suffix:semicolon
r_if
c_cond
(paren
id|str
)paren
id|token
op_assign
id|pool_tok_r
c_func
(paren
id|str
comma
id|delim
comma
op_amp
id|context
)paren
suffix:semicolon
r_for
c_loop
(paren
id|length
op_assign
l_int|0
suffix:semicolon
id|length
OL
id|sz
suffix:semicolon
id|length
op_increment
)paren
(brace
id|seq
(braket
id|length
)braket
op_assign
id|token
suffix:semicolon
r_if
c_cond
(paren
id|token
op_eq
op_complement
l_int|0
)paren
r_return
id|length
suffix:semicolon
id|token
op_assign
id|pool_tok_r
c_func
(paren
l_int|NULL
comma
id|delim
comma
op_amp
id|context
)paren
suffix:semicolon
)brace
id|seq
(braket
id|sz
l_int|1
)braket
op_assign
op_complement
l_int|0
suffix:semicolon
r_return
id|sz
suffix:semicolon
)brace
DECL|function|pool_reset
r_void
id|pool_reset
c_func
(paren
r_void
)paren
(brace
id|node_reset
c_func
(paren
)paren
suffix:semicolon
id|string_reset
c_func
(paren
)paren
suffix:semicolon
)brace
eof
