multiline_comment|/*&n; * Licensed under a two-clause BSD-style license.&n; * See LICENSE for details.&n; */
macro_line|#include &quot;git-compat-util.h&quot;
macro_line|#include &quot;fast_export.h&quot;
macro_line|#include &quot;line_buffer.h&quot;
macro_line|#include &quot;repo_tree.h&quot;
macro_line|#include &quot;string_pool.h&quot;
DECL|macro|MAX_GITSVN_LINE_LEN
mdefine_line|#define MAX_GITSVN_LINE_LEN 4096
DECL|variable|first_commit_done
r_static
r_uint32
id|first_commit_done
suffix:semicolon
DECL|function|fast_export_delete
r_void
id|fast_export_delete
c_func
(paren
r_uint32
id|depth
comma
r_uint32
op_star
id|path
)paren
(brace
id|putchar
c_func
(paren
l_char|&squot;D&squot;
)paren
suffix:semicolon
id|putchar
c_func
(paren
l_char|&squot; &squot;
)paren
suffix:semicolon
id|pool_print_seq
c_func
(paren
id|depth
comma
id|path
comma
l_char|&squot;/&squot;
comma
id|stdout
)paren
suffix:semicolon
id|putchar
c_func
(paren
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
)brace
DECL|function|fast_export_modify
r_void
id|fast_export_modify
c_func
(paren
r_uint32
id|depth
comma
r_uint32
op_star
id|path
comma
r_uint32
id|mode
comma
r_uint32
id|mark
)paren
(brace
multiline_comment|/* Mode must be 100644, 100755, 120000, or 160000. */
id|printf
c_func
(paren
l_string|&quot;M %06&quot;
id|PRIo32
l_string|&quot; :%&quot;
id|PRIu32
l_string|&quot; &quot;
comma
id|mode
comma
id|mark
)paren
suffix:semicolon
id|pool_print_seq
c_func
(paren
id|depth
comma
id|path
comma
l_char|&squot;/&squot;
comma
id|stdout
)paren
suffix:semicolon
id|putchar
c_func
(paren
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
)brace
DECL|variable|gitsvnline
r_static
r_char
id|gitsvnline
(braket
id|MAX_GITSVN_LINE_LEN
)braket
suffix:semicolon
DECL|function|fast_export_commit
r_void
id|fast_export_commit
c_func
(paren
r_uint32
id|revision
comma
r_const
r_char
op_star
id|author
comma
r_const
r_struct
id|strbuf
op_star
id|log
comma
r_const
r_char
op_star
id|uuid
comma
r_const
r_char
op_star
id|url
comma
r_int
r_int
id|timestamp
)paren
(brace
r_static
r_const
r_struct
id|strbuf
id|empty
op_assign
id|STRBUF_INIT
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|log
)paren
id|log
op_assign
op_amp
id|empty
suffix:semicolon
r_if
c_cond
(paren
op_star
id|uuid
op_logical_and
op_star
id|url
)paren
(brace
id|snprintf
c_func
(paren
id|gitsvnline
comma
id|MAX_GITSVN_LINE_LEN
comma
l_string|&quot;&bslash;n&bslash;ngit-svn-id: %s@%&quot;
id|PRIu32
l_string|&quot; %s&bslash;n&quot;
comma
id|url
comma
id|revision
comma
id|uuid
)paren
suffix:semicolon
)brace
r_else
(brace
op_star
id|gitsvnline
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
)brace
id|printf
c_func
(paren
l_string|&quot;commit refs/heads/master&bslash;n&quot;
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;committer %s &lt;%s@%s&gt; %ld +0000&bslash;n&quot;
comma
op_star
id|author
ques
c_cond
id|author
suffix:colon
l_string|&quot;nobody&quot;
comma
op_star
id|author
ques
c_cond
id|author
suffix:colon
l_string|&quot;nobody&quot;
comma
op_star
id|uuid
ques
c_cond
id|uuid
suffix:colon
l_string|&quot;local&quot;
comma
id|timestamp
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;data %&quot;
id|PRIuMAX
l_string|&quot;&bslash;n&quot;
comma
(paren
r_uintmax
)paren
(paren
id|log-&gt;len
op_plus
id|strlen
c_func
(paren
id|gitsvnline
)paren
)paren
)paren
suffix:semicolon
id|fwrite
c_func
(paren
id|log-&gt;buf
comma
id|log-&gt;len
comma
l_int|1
comma
id|stdout
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;%s&bslash;n&quot;
comma
id|gitsvnline
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|first_commit_done
)paren
(brace
r_if
c_cond
(paren
id|revision
OG
l_int|1
)paren
id|printf
c_func
(paren
l_string|&quot;from refs/heads/master^0&bslash;n&quot;
)paren
suffix:semicolon
id|first_commit_done
op_assign
l_int|1
suffix:semicolon
)brace
id|repo_diff
c_func
(paren
id|revision
l_int|1
comma
id|revision
)paren
suffix:semicolon
id|fputc
c_func
(paren
l_char|&squot;&bslash;n&squot;
comma
id|stdout
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;progress Imported commit %&quot;
id|PRIu32
l_string|&quot;.&bslash;n&bslash;n&quot;
comma
id|revision
)paren
suffix:semicolon
)brace
DECL|function|die_short_read
r_static
r_void
id|die_short_read
c_func
(paren
r_struct
id|line_buffer
op_star
id|input
)paren
(brace
r_if
c_cond
(paren
id|buffer_ferror
c_func
(paren
id|input
)paren
)paren
id|die_errno
c_func
(paren
l_string|&quot;error reading dump file&quot;
)paren
suffix:semicolon
id|die
c_func
(paren
l_string|&quot;invalid dump: unexpected end of file&quot;
)paren
suffix:semicolon
)brace
DECL|function|fast_export_blob
r_void
id|fast_export_blob
c_func
(paren
r_uint32
id|mode
comma
r_uint32
id|mark
comma
r_uint32
id|len
comma
r_struct
id|line_buffer
op_star
id|input
)paren
(brace
r_if
c_cond
(paren
id|mode
op_eq
id|REPO_MODE_LNK
)paren
(brace
multiline_comment|/* svn symlink blobs start with &quot;link &quot; */
id|len
op_sub_assign
l_int|5
suffix:semicolon
r_if
c_cond
(paren
id|buffer_skip_bytes
c_func
(paren
id|input
comma
l_int|5
)paren
op_ne
l_int|5
)paren
id|die_short_read
c_func
(paren
id|input
)paren
suffix:semicolon
)brace
id|printf
c_func
(paren
l_string|&quot;blob&bslash;nmark :%&quot;
id|PRIu32
l_string|&quot;&bslash;ndata %&quot;
id|PRIu32
l_string|&quot;&bslash;n&quot;
comma
id|mark
comma
id|len
)paren
suffix:semicolon
r_if
c_cond
(paren
id|buffer_copy_bytes
c_func
(paren
id|input
comma
id|len
)paren
op_ne
id|len
)paren
id|die_short_read
c_func
(paren
id|input
)paren
suffix:semicolon
id|fputc
c_func
(paren
l_char|&squot;&bslash;n&squot;
comma
id|stdout
)paren
suffix:semicolon
)brace
eof
