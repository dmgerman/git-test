multiline_comment|/*&n; * Licensed under a two-clause BSD-style license.&n; * See LICENSE for details.&n; */
macro_line|#include &quot;git-compat-util.h&quot;
macro_line|#include &quot;fast_export.h&quot;
macro_line|#include &quot;line_buffer.h&quot;
macro_line|#include &quot;repo_tree.h&quot;
macro_line|#include &quot;string_pool.h&quot;
DECL|macro|MAX_GITSVN_LINE_LEN
mdefine_line|#define MAX_GITSVN_LINE_LEN 4096
DECL|variable|first_commit_done
r_static
r_uint32
id|first_commit_done
suffix:semicolon
DECL|variable|report_buffer
r_static
r_struct
id|line_buffer
id|report_buffer
op_assign
id|LINE_BUFFER_INIT
suffix:semicolon
DECL|function|fast_export_init
r_void
id|fast_export_init
c_func
(paren
r_int
id|fd
)paren
(brace
r_if
c_cond
(paren
id|buffer_fdinit
c_func
(paren
op_amp
id|report_buffer
comma
id|fd
)paren
)paren
id|die_errno
c_func
(paren
l_string|&quot;cannot read from file descriptor %d&quot;
comma
id|fd
)paren
suffix:semicolon
)brace
DECL|function|fast_export_deinit
r_void
id|fast_export_deinit
c_func
(paren
r_void
)paren
(brace
r_if
c_cond
(paren
id|buffer_deinit
c_func
(paren
op_amp
id|report_buffer
)paren
)paren
id|die_errno
c_func
(paren
l_string|&quot;error closing fast-import feedback stream&quot;
)paren
suffix:semicolon
)brace
DECL|function|fast_export_reset
r_void
id|fast_export_reset
c_func
(paren
r_void
)paren
(brace
id|buffer_reset
c_func
(paren
op_amp
id|report_buffer
)paren
suffix:semicolon
)brace
DECL|function|fast_export_delete
r_void
id|fast_export_delete
c_func
(paren
r_uint32
id|depth
comma
r_uint32
op_star
id|path
)paren
(brace
id|putchar
c_func
(paren
l_char|&squot;D&squot;
)paren
suffix:semicolon
id|putchar
c_func
(paren
l_char|&squot; &squot;
)paren
suffix:semicolon
id|pool_print_seq
c_func
(paren
id|depth
comma
id|path
comma
l_char|&squot;/&squot;
comma
id|stdout
)paren
suffix:semicolon
id|putchar
c_func
(paren
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
)brace
DECL|function|fast_export_modify
r_void
id|fast_export_modify
c_func
(paren
r_uint32
id|depth
comma
r_uint32
op_star
id|path
comma
r_uint32
id|mode
comma
r_uint32
id|mark
)paren
(brace
multiline_comment|/* Mode must be 100644, 100755, 120000, or 160000. */
id|printf
c_func
(paren
l_string|&quot;M %06&quot;
id|PRIo32
l_string|&quot; :%&quot;
id|PRIu32
l_string|&quot; &quot;
comma
id|mode
comma
id|mark
)paren
suffix:semicolon
id|pool_print_seq
c_func
(paren
id|depth
comma
id|path
comma
l_char|&squot;/&squot;
comma
id|stdout
)paren
suffix:semicolon
id|putchar
c_func
(paren
l_char|&squot;&bslash;n&squot;
)paren
suffix:semicolon
)brace
DECL|function|fast_export_begin_commit
r_void
id|fast_export_begin_commit
c_func
(paren
r_uint32
id|revision
)paren
(brace
id|printf
c_func
(paren
l_string|&quot;# commit %&quot;
id|PRIu32
l_string|&quot;.&bslash;n&quot;
comma
id|revision
)paren
suffix:semicolon
)brace
DECL|variable|gitsvnline
r_static
r_char
id|gitsvnline
(braket
id|MAX_GITSVN_LINE_LEN
)braket
suffix:semicolon
DECL|function|fast_export_commit
r_void
id|fast_export_commit
c_func
(paren
r_uint32
id|revision
comma
r_uint32
id|author
comma
r_char
op_star
id|log
comma
r_uint32
id|uuid
comma
r_uint32
id|url
comma
r_int
r_int
id|timestamp
)paren
(brace
r_if
c_cond
(paren
op_logical_neg
id|log
)paren
id|log
op_assign
l_string|&quot;&quot;
suffix:semicolon
r_if
c_cond
(paren
op_complement
id|uuid
op_logical_and
op_complement
id|url
)paren
(brace
id|snprintf
c_func
(paren
id|gitsvnline
comma
id|MAX_GITSVN_LINE_LEN
comma
l_string|&quot;&bslash;n&bslash;ngit-svn-id: %s@%&quot;
id|PRIu32
l_string|&quot; %s&bslash;n&quot;
comma
id|pool_fetch
c_func
(paren
id|url
)paren
comma
id|revision
comma
id|pool_fetch
c_func
(paren
id|uuid
)paren
)paren
suffix:semicolon
)brace
r_else
(brace
op_star
id|gitsvnline
op_assign
l_char|&squot;&bslash;0&squot;
suffix:semicolon
)brace
id|printf
c_func
(paren
l_string|&quot;commit refs/heads/master&bslash;n&quot;
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;mark :%&quot;
id|PRIu32
l_string|&quot;&bslash;n&quot;
comma
id|revision
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;committer %s &lt;%s@%s&gt; %ld +0000&bslash;n&quot;
comma
op_complement
id|author
ques
c_cond
id|pool_fetch
c_func
(paren
id|author
)paren
suffix:colon
l_string|&quot;nobody&quot;
comma
op_complement
id|author
ques
c_cond
id|pool_fetch
c_func
(paren
id|author
)paren
suffix:colon
l_string|&quot;nobody&quot;
comma
op_complement
id|uuid
ques
c_cond
id|pool_fetch
c_func
(paren
id|uuid
)paren
suffix:colon
l_string|&quot;local&quot;
comma
id|timestamp
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;data %&quot;
id|PRIu32
l_string|&quot;&bslash;n%s%s&bslash;n&quot;
comma
(paren
r_uint32
)paren
(paren
id|strlen
c_func
(paren
id|log
)paren
op_plus
id|strlen
c_func
(paren
id|gitsvnline
)paren
)paren
comma
id|log
comma
id|gitsvnline
)paren
suffix:semicolon
r_if
c_cond
(paren
op_logical_neg
id|first_commit_done
)paren
(brace
r_if
c_cond
(paren
id|revision
OG
l_int|1
)paren
id|printf
c_func
(paren
l_string|&quot;from refs/heads/master^0&bslash;n&quot;
)paren
suffix:semicolon
id|first_commit_done
op_assign
l_int|1
suffix:semicolon
)brace
id|repo_diff
c_func
(paren
id|revision
l_int|1
comma
id|revision
)paren
suffix:semicolon
id|fputc
c_func
(paren
l_char|&squot;&bslash;n&squot;
comma
id|stdout
)paren
suffix:semicolon
id|printf
c_func
(paren
l_string|&quot;progress Imported commit %&quot;
id|PRIu32
l_string|&quot;.&bslash;n&bslash;n&quot;
comma
id|revision
)paren
suffix:semicolon
)brace
DECL|function|get_response_line
r_static
r_const
r_char
op_star
id|get_response_line
c_func
(paren
r_void
)paren
(brace
r_const
r_char
op_star
id|line
op_assign
id|buffer_read_line
c_func
(paren
op_amp
id|report_buffer
)paren
suffix:semicolon
r_if
c_cond
(paren
id|line
)paren
r_return
id|line
suffix:semicolon
r_if
c_cond
(paren
id|buffer_ferror
c_func
(paren
op_amp
id|report_buffer
)paren
)paren
id|die_errno
c_func
(paren
l_string|&quot;error reading from fast-import&quot;
)paren
suffix:semicolon
id|die
c_func
(paren
l_string|&quot;unexpected end of fast-import feedback&quot;
)paren
suffix:semicolon
)brace
DECL|function|fast_export_blob
r_void
id|fast_export_blob
c_func
(paren
r_uint32
id|mode
comma
r_uint32
id|mark
comma
r_uint32
id|len
comma
r_struct
id|line_buffer
op_star
id|input
)paren
(brace
r_if
c_cond
(paren
id|mode
op_eq
id|REPO_MODE_LNK
)paren
(brace
multiline_comment|/* svn symlink blobs start with &quot;link &quot; */
id|buffer_skip_bytes
c_func
(paren
id|input
comma
l_int|5
)paren
suffix:semicolon
id|len
op_sub_assign
l_int|5
suffix:semicolon
)brace
id|printf
c_func
(paren
l_string|&quot;blob&bslash;nmark :%&quot;
id|PRIu32
l_string|&quot;&bslash;ndata %&quot;
id|PRIu32
l_string|&quot;&bslash;n&quot;
comma
id|mark
comma
id|len
)paren
suffix:semicolon
id|buffer_copy_bytes
c_func
(paren
id|input
comma
id|len
)paren
suffix:semicolon
id|fputc
c_func
(paren
l_char|&squot;&bslash;n&squot;
comma
id|stdout
)paren
suffix:semicolon
)brace
eof
